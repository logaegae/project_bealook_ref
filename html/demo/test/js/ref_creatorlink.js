var user_css,selectEL='',tmpEL,selectID,selectPOS,X,Y,isEDIT=false,selectCount=0,areYouReallySure=false,internalLink=false,add_font="'Nanum Gothic'",alink=[],header_fixed=0,imgLinkHover=false,imgEditHover=false,isAnimate=false,elgroup=[],ctrlEL,menuEdit=false,editLiked=false,RVIEW=12,GVIEW=6,header_offset=0,PROGRESS=0,progress1=0,progress2=0,btnEnable=true,MENULIST=[],MENULINK=[],isOpen=false,prevONE='',prevMENU='',scrollPos=0,scrollPos2=0,toolPos=0,popPos=0,pTop=0,fTop=0,aTop=0,frAbove='',saving=false,isReplace=false,forumWrap='',cPage=0,cTotal=0,fSearch={'type':'','page':1,'text':'','total':0},contents={"T1":95,"T2":236,"T3":237,"T4":238,"D1":1,"D2":4,"D3":5,"I1":791,"I2":792,"I3":936,"I4":376,"I5":377,"I6":1015,"V1":233,"V2":937,"V3":915,"V4":234,"V5":235,"V6":981,},contents_right={"T1":352,"T2":337,"T3":336,"T4":335,"D1":27,"D2":29,"D3":6,"I1":329,"I2":375,"I3":330,"I4":331,"V1":342,"V2":343,"V3":344},contents_left={"T1":334,"T2":333,"T3":351,"T4":332,"D1":26,"D2":28,"D3":6,"I1":326,"I2":374,"I3":327,"I4":328,"V1":339,"V2":340,"V3":341},font_country="Nanum Gothic",LANG="en",fileDrag=false,arr_font_size=['10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','69','70','71','72','73','74','75','76','77','78','79','80'];function areYouSure(){if(!areYouReallySure&&!internalLink){areYouReallySure=true;$('*[contenteditable]').removeAttr('contenteditable');saveContentedit();}}window.onbeforeunload=areYouSure;$(window).load(function(data){setLanguage(LANG);viewmode('config');if(typeof $.browser.msie!='undefined'){if(parseInt($.browser.version)<10){var str=''+'<ul class="-browser-list">'+'     <li><a href="http://www.google.co.kr/chrome/browser/desktop/"><img src="//i.addblock.net/browser_chrome.png" target="_blank"><br>Chrome</a></li>'+'     <li><a href="https://www.mozilla.org/ko/firefox/new/" target="_blank"><img src="//i.addblock.net/browser_firefox.png"><br>Firefox</a></li>'+'     <li><a href="http://www.opera.com/ko"><img src="//i.addblock.net/browser_opera.png" target="_blank"><br>Opera</a></li>'+'     <li><a href="http://windows.microsoft.com/ko-kr/internet-explorer/download-ie" target="_blank"><img src="//i.addblock.net/browser_explorer.png"><br>Explorer</a></li>'+'</ul>'+'<div class="small">'+$.lang[LANG]['editor.browse.download']+'</div>';$('.dsgn-body').showModalFlat('BROWSER UPDATE REQUIRED',$.lang[LANG]['editor.browse.update']+str,true,false);}}var isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),checkUrl=window.location.origin+'/dashboard';if(!isChrome&&document.referrer==checkUrl){var str='\
            <ul class="-browser-chrome-optimized">\
                <li><img src="//storage.googleapis.com/i.addblock.net/config/creatorlink_and_chrome_logo.png" alt="creatorlink " /></li>\
                <li><h1>'+$.lang[LANG]['editor.browse.chrome.title']+'</h1></li>\
                <li><p>'+$.lang[LANG]['editor.browse.chrome.content']+'</p></li>\
                <li><a href="http://www.google.co.kr/chrome/browser/desktop/index.html" target="_blank">'+$.lang[LANG]['editor.browse.chrome.download']+'</a></li>\
            </ul>\
        ';$('.dsgn-body').showModalFlat('',str,false,false,'','','w830');}setTimeout(function(){if(typeof SETTINGS=='undefined'||typeof SETTINGS.showGuide=='undefined'||!SETTINGS.showGuide)$.guideON(1);if(typeof SETTINGS!='undefined'&&SETTINGS.showPopup===true&&typeof SETTINGS.sitePopup!="undefined"){var org_host=window.location.protocol+'//'+window.location.host+'/config',this_href=decodeURIComponent(location.href),url_arr=[org_host,org_host+'/',org_host+'#',org_host+'/#',org_host+'/page/'+MENULINK[0],org_host+'/page/'+MENULINK[0]+'#'];if((ONE&&!VIEW)||$.inArray(this_href,url_arr)>-1){sitePopupOpen();}}},500);});document.addEventListener("keydown",KeyCheck);function KeyCheck(event){var KeyID=event.keyCode;switch(KeyID){case 8:var d=event.srcElement||event.target;if((d.tagName.toUpperCase()==='INPUT'&&(d.type.toUpperCase()==='TEXT'||d.type.toUpperCase()==='PASSWORD'||d.type.toUpperCase()==='FILE'||d.type.toUpperCase()==='SEARCH'||d.type.toUpperCase()==='EMAIL'||d.type.toUpperCase()==='NUMBER'||d.type.toUpperCase()==='DATE'))||d.tagName.toUpperCase()==='TEXTAREA'||isEDIT==true||$(d).hasClass('note-editable')){doPrevent=d.readOnly||d.disabled;}else{doPrevent=true;}if(doPrevent)event.preventDefault();break;default:break;}}$(function(){$('.dsgn-body').addClass('mode-config');LANG=getLanguage();$.FroalaEditor.DefineIcon('text-align',{NAME:'align-left'});$.FroalaEditor.RegisterCommand('text-align',{title:'Text align',type:'dropdown',focus:false,undo:true,refreshAfterCallback:true,options:{'left':$.lang[LANG]['editor.left'],'center':$.lang[LANG]['editor.center'],'right':$.lang[LANG]['editor.right'],'justify':$.lang[LANG]['editor.justify']},callback:function(cmd,val){var $selector=$('.fr-box.fr-inline'),selector=$selector.attr('data-selector'),el=$selector.parents('.element.active').attr('data-name')
ctrlElementStyleUpdate('.'+el+' '+selector,'text-align',val);$('button[data-cmd="text-align"]').html('<i class="fa fa-align-'+val+'"></i>');$('button[data-cmd="text-align"]').attr('data-value',val);},refresh:function($btn){var $selector=$('.fr-box.fr-inline'),selector=$selector.attr('data-selector'),el=$selector.parents('.element.active').attr('data-name')
val=$('.'+el+' '+selector).css('text-align');if(typeof val=="undefined"||val=='start')val='left';$('button[data-cmd="text-align"]').html('<i class="fa fa-align-'+val+'"></i>');},refreshOnShow:function($btn,$dropdown){var align=$('button[data-cmd="text-align"]').attr('data-value');$dropdown.find('a[data-param1="'+align+'"]').addClass('fr-active');removeColpick();}});$.FroalaEditor.DefineIcon('text-color-icon',{NAME:'tint'});$.FroalaEditor.RegisterCommand('text-color',{title:'Text color',icon:'text-color-icon',undo:true,focus:true,showOnMobile:true,refreshAfterCallback:true,callback:function(){var _this=this;_this.selection.save();selRange=saveSelection();$('.fr-toolbar.fr-inline').addClass('always');$('.fr-toolbar.fr-inline button[data-cmd="text-color"]').toggleClass('active');$('button[data-cmd="text-color"]').colpick({color:'#0088CC',layout:'hex',extend:true,onSubmit:function(hsb,hex,rgb){restoreSelection(selRange);var type=$('.colpick_hex.extend .nav-pills li.active').attr('data-type');if(type=='text')_this.colors.text('#'+hex);else _this.colors.background('#'+hex);$('.fr-toolbar.fr-inline').removeClass('always');$('button[data-cmd="text-color"]').removeClass('active').colpickHide();},onHide:function(){$('.fr-toolbar.fr-inline').removeClass('always');$('.colpick_hex.extend').find('.nav.nav-pills li').removeClass('active').eq(0).addClass('active');},onShow:function(){if($('.fr-toolbar').hasClass('fr-above')){var top=$('.fr-toolbar').css('top').replace('px','');$('.colpick_hex.extend').css('top',(Number(top)-211)+'px');}var type=$('.colpick_hex.extend').find('.nav.nav-pills li.active').attr('data-type'),type=(type=='text')?'color':'background-color',hex=style.getHex($(_this.selection.element()).css(type));$('button[data-cmd="text-color"]').colpickSetColor(hex.replace('#',''));}});},refresh:function($btn){}});$(document).on('click','.colpick_hex.extend .nav-pills li a',function(e){$('.fr-toolbar.fr-inline').addClass('always');$('.colpick_hex.extend .nav-pills li').removeClass('active');$(this).parent().addClass('active');$('.'+selectEL+' *[data-edit="true"]').froalaEditor('selection.save');restoreSelection(selRange);});$(document).on('click','.colpick_hex.extend .colpick-select-color',function(e){e.stopPropagation();var cmd=$(this).attr('data-color'),type=$('.colpick_hex.extend .nav-pills li.active').attr('data-type');$('.fr-toolbar.fr-inline').addClass('always');$('.'+selectEL+' *[data-edit="true"]').froalaEditor('selection.restore');if(cmd=='colpick'){$(this).parent().addClass('active');$('.colpick_hex.extend').addClass('click_extend').toggleClass('show-picker');$('button[data-cmd="text-color"]').addClass('active');}else if(cmd=='REMOVE'){$('.'+selectEL+' *[data-edit="true"]').froalaEditor('colors.'+type,'REMOVE');$('button[data-cmd="text-color"]').removeClass('active').colpickHide();}else{$('.'+selectEL+' *[data-edit="true"]').froalaEditor('colors.'+type,cmd);$('button[data-cmd="text-color"]').removeClass('active');$('button[data-cmd="text-color"]').colpickSetColor(cmd.replace('#',''));}});$(document).on('click','.colpick_hex.extend',function(e){restoreSelection(selRange);});$.modalON();$('#nestable').append(makeMenuList(SMENU));SCREEN=getScreen();$('#el-property').draggable({containment:".dsgn-body",handle:".prop-header"});var editor_html=new Behave({textarea:document.getElementById('edit-tag')}),editor_css=new Behave({textarea:document.getElementById('edit-css')}),editor_js=new Behave({textarea:document.getElementById('edit-js')}),editor_settings=new Behave({textarea:document.getElementById('edit-settings')});$('.dsgn-body').on('scroll',function(){scrollspy();parallax();$('.recomm-image-text').hide();});$(window).resize(function(){var left=parseInt($('#el-property').css('left'));if((left+360)>window.innerWidth){$('#el-property').css('left',window.innerWidth-360);}header_fixed=$('header.navbar').height();if($('body').width()<=768&&$('.dsgn-body').hasClass('sidebar')){if($('header.navbar').hasClass('sidebar')){$('header.navbar').css({'top':'0px'});$('#dsgn-body').text('.dsgn-body.sidebar { padding-left:0 }');}$('.dsgn-body').removeClass('sidebar').addClass('removed-sidebar');}else if($('body').width()>768&&$('.dsgn-body').hasClass('removed-sidebar')){if($('header.navbar').hasClass('sidebar')){$('header.navbar').css({'top':'35px'});$('#dsgn-body').text('.dsgn-body.sidebar { padding-left:'+$('header.navbar').outerWidth()+'px; }');}$('.dsgn-body').removeClass('removed-sidebar').addClass('sidebar');$('.el_0').css('margin-top','0px');if($(".header-empty").length){$('.header-empty').remove();}}if($('body').width()<=768){$('.element').removeClass('active');$('.config-image-view').hide();$('.config-image-link').hide();$('.config-image-edit').hide();$('.config-image-add').hide();$('.config-element-section').hide();$('.addElementButton').remove();}$('.element[data-category="ON"]').each(function(){loadGalleryCategoryBlock($(this));});clearElementController();scrollspy();var clientWindow=getScreen();if(clientWindow!=SCREEN){SCREEN=clientWindow;ieLineClamp();}if($('.fr-view').length){setForumWrap();}sitePopupResize();});var timer=null;$('.dsgn-body').scroll(function(){if($(this).hasClass('sidebar')==false){fixedMenu();}$('.g-body .text-menu').addClass('hide');if(!$('.fr-toolbar').length)return;var thisPos=$(this).scrollTop(),newPos=(scrollPos>thisPos)?(scrollPos-thisPos):(scrollPos-thisPos),newPos2=(scrollPos2>thisPos)?(scrollPos2-thisPos):(scrollPos2-thisPos),caPos=Number(toolPos)+Number(newPos),caPos2=Number(popPos)+Number(newPos);$('.fr-toolbar').css('top',caPos+'px');if($('.fr-toolbar').hasClass('fr-above')){var caPos2=caPos-170;if($('.fr-popup.fr-active .fr-link-insert-layer.fr-active').length)caPos2=caPos-180;}$('.fr-popup').css('top',caPos2+'px');$('button[data-cmd="text-color"]').removeClass('active').colpickHide();});$('#config-publishing').click(function(){var modal=$(this).showModalFlat('INFORMATION','<div><div>'+$.lang[LANG]['editor.publish.info']+'</div><div style="color:#4789E7;font-size:15px;padding-top:5px; padding-bottom: 5px;">'+SID+'.creatorlink.net</div><div>'+$.lang[LANG]['editor.publish.confirm']+'</div></div>',true,true,function(){modal.modal('hide');$.processON($.lang[LANG]['loading.publishing']);$.post('/template/publish',{sid:SID,onoff:1},function(data){if(typeof(data.error)!='undefined'){checkError(data);$.processOFF();return false;}$.ajax({url:'/config/capture/site',dataType:'json',async:true,cache:false});setTimeout(function(){var time=$.now();$('.processModal p').text('');$('.processModal p').css({'width':'385px','height':'215px','top':'0','margin':'auto','background':'none',});$closebtn=$("<button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'><img src='//i.addblock.net/fa-close-modal.png' alt='close'></span></button>");$titleText=$("<h5>PUBLISHING COMPLETED</h5>").css({'font-family':'Raleway','font-size':'15px','color':'#25272b','margin-top':'15px','margin-bottom':'20px','letter-spacing':'0.05em'});$guideText=$("<p class='guideText'>"+$.lang[LANG]['editor.publish.priview']+"</p>").css({'font-family':'Nanum Gothic','margin-bottom':'24px'});$view=$("<a href='http://"+SID+"."+HOST+"' class='btn btn-primary' target='_blank'>"+$.lang[LANG]['config.ok']+"</a>").css({'font-family':'Nanum Gothic','border-radius':'0','background-color':'#2d343e','color':'#fff','border':'none','width':'145px','padding':'13px 40px','line-height':'1','font-size':'13px','margin-bottom':'15px'});$view.on('click',function(){$.processOFF();});$closebtn.on('click',function(){$.processOFF();});$btns=$("<p></p>").css({'width':'100%','height':'100%','background-color':'#fff','font-size':'13px','color':'#25272b','line-height':'1.8','padding':'15px',}).append($closebtn).append($titleText).append($guideText).append($view);$('.processModal p').append($btns);},'7000');},'json');});});$('#nestable').nestable({maxDepth:2}).on('change',function(el){if(menuEdit==true||editLiked==true)return;var prevMenu=$('#nestable-output').val();updateOutput($('#nestable').data('output',$('#nestable-output')));var updateMenu=$('#nestable-output').val();if(prevMenu==updateMenu)return false;releaseLink(updateMenu);setLogs("MENU","menu.move","move",el.sourceId);if(ONE){setTimeout(function(){showPageCallback(showPage);},'500');}});$('#nestableFolder').nestable({maxDepth:1}).on('change',function(el){var prevFolder=$('#nestableFolder-output').val();updateOutputFolder($('#nestableFolder').data('output',$('#nestableFolder-output')));});$('.add-folder').live({click:function(e){if(isFEdit){return;}else{$('.add-folder').attr('data-content','').popover('hide');}if($('#nestableFolder .fli').length>=21){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.resource.folder.maximum'],true,false,'','close');return;}else{$('#nestableFolder .fli.active').removeClass('active').find('.fa-fl').attr('src','//i.addblock.net/icon/fa_folder.png');var add_folder='\
                    <li class="dd-item fli active" data-id="clEmptyFolder">\
                        <img src="//i.addblock.net/icon/fa_folder_open.png" alt="folder icon" class="fa-fl dd-handle" />\
                        <span class="dd-fln"></span>\
                        <span class="dd-flc" attr-count="0">0</span>\
                        <span class="dd-fls" attr-size="0" attr-size-unit="KB">0</span>\
                        <span class="dd-fld" attr-id="clEmptyFolder"><img src="//i.addblock.net/icon/icon-menu-delete-w.png" class="fa"></span>\
                    </li>\
                ';if($('#nestableFolder .fli[data-id="clclEmptyFolder"]').length==0){$('#nestableFolder .fll').append(add_folder);}else{$('#nestableFolder .fli[data-id="clEmptyFolder"]').find('.dd-fln').val('');}$('<input type="text" />').appendTo($('#nestableFolder .fli[data-id="clEmptyFolder"] .dd-fln')).dblclick();if($('.dd-list.fll').children().length>10){$('#nestableFolder .fli[data-id="clEmptyFolder"] .dd-fln').find('input').css('max-width','153px');$('#nestableFolder').scrollTop(2000);}}}});var depfolderClick=false;var isFEdit=false;$('#nestableFolder .fll > .fli').live({click:function(e){if(isFEdit){return;}if($(this).parents('.fll').length==2){depfolderClick=true;}if($(this).parents('.fll').length==1&&depfolderClick){depfolderClick=false;return;}else{if($(this).hasClass('active'))return;$('#nestableFolder .fli.active').removeClass('active').find('.fa-fl').first().attr('src','//i.addblock.net/icon/fa_folder.png');$(this).addClass('active').find('.fa-fl').first().attr('src','//i.addblock.net/icon/fa_folder_open.png');SFOLDER_ACTIVE=($(this).attr('data-id')!='all')?$(this).attr('data-id'):'';cPage=1;resourceGetPage(1,SFOLDER_ACTIVE);}}});$('#nestableFolder .fli .dd-fln').live({dblclick:function(e){if(isFEdit){return;}if($(this).parent().closest('.fli').index()>0){isFEdit=true;editFolder($(this));}}});$('#nestableFolder .fli .dd-fld').live({click:function(e){if(isFEdit){return;}if($(this).prev().attr('attr-size')>0){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.resource.regExp.delete'],true,false,'','close');}else{if($(this).parent().parent().parent('.dd-list').children().length==1){$(this).parent().parent().parent('.dd-list').parent('.fli').first().click();$(this).parent().parent().parent('.dd-list').parent('.fli').find('button[data-action="collapse"]').remove();$(this).parent().parent().parent('.dd-list').parent('.fli').find('button[data-action="expand"]').remove();$(this).parent().parent().parent('.dd-list').remove();}else{$(this).closest('li').remove();}updateOutputFolder($('#nestableFolder').data('output',$('#nestableFolder-output')));$('#nestableFolder').find('.fll').children().first().click();}}});var editFolder=function(ddfl){$this=ddfl;var text=($this.closest('li.fli').attr('data-id')!='clEmptyFolder')?trim($this.text()).replace(/ /g,'-'):'clEmptyFolder';var input_css=($('.dd-list.fll').children().length>10)?"height: 36px; max-width: 153px;":"height: 36px;";$('<input type="text" />').appendTo($this).val((text=='clEmptyFolder')?"":text.replace(/-/g,' ')).select().blur(function(){var regExp=/[\{\}\[\]\/!?.,;:|\)*~`^\-_+<>@\#$%&\\\=\(\'\"]/gi,newText=(trim($(this).val()))?trim($(this).val()):(text=='clEmptyFolder')?'':text,err_str='';if(regExp.test(newText)){$('#nestableFolder').css('pointer-events','none');err_str=$.lang[LANG]['editor.resource.regExp.specialchar'];}else if($('#nestableFolder .fli[data-id="'+newText.replace(/ /g,'-')+'"]:not(.active)').length>0){$('#nestableFolder').css('pointer-events','none');err_str=$.lang[LANG]['editor.resource.regExp.overlap'];}else if(newText.length>20){$('#nestableFolder').css('pointer-events','none');err_str=$.lang[LANG]['editor.resource.regExp.maximum'];}else{$('#nestableFolder').css('pointer-events','auto');err_str='';}newText=newText.replace(/ /g,'-');if(err_str!=''){$(this).focus();$('.add-folder').attr('data-content',err_str).popover("show");if($(this).closest('.fli').index()>9)$('.popover.in').css('top',$(this).offset().top-($('.dd-list').offset().top+5)-$('#nestableFolder').scrollTop());else $('.popover.in').css('top',$(this).offset().top-$('.dd-list').offset().top-5);}else{$('.add-folder').popover("hide");if(!newText&&text=='clEmptyFolder'){$(this).parent().closest('.fli[data-id="clEmptyFolder"]').remove();var last_class=$('#nestableFolder .fli').last().attr('data-id');$('#nestableFolder .fli').last().addClass('active').find('.fa-fl').first().attr('src','//i.addblock.net/icon/fa_folder_open.png');SFOLDER_ACTIVE=last_class;resourceGetPage(1,SFOLDER_ACTIVE);}else{$(this).parent().closest('.fli').attr('data-id',newText);$(this).parent().closest('.fli').find('.dd-fld').attr('attr-id',newText);$(this).parent().text(newText.replace(/-/g,' ')).find('input').remove();updateOutputFolder($('#nestableFolder').data('output',$('#nestableFolder-output')));resourceFileFolderUpdate(text,newText);SFOLDER_ACTIVE=newText;if(text=='clEmptyFolder')resourceGetPage(1,SFOLDER_ACTIVE);else{$('#resource-files .fitem').each(function(){$(this).find('.control-area ul[data-ffolder="'+text+'"]').attr('data-ffolder',newText);});}}$('.add-folder').attr('data-content','').popover('hide');isFEdit=false;}}).attr('style',input_css);}
$('#intro-onoff').live({click:function(e){$('.menu-edit-cancel').click();var check=($(this).attr('attr-val')=='on')?false:true,onoff=(check)?'on':'off',src=(onoff=='on')?'//i.addblock.net/icon/icon-menu-visible.png':'//i.addblock.net/icon/icon-menu-invisible.png';$(this).attr({'attr-val':onoff});var $this=$(this);if(getMenuVisible()){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.visible.info'],true,false,'','ok');(onoff=='on')?$(this).attr('attr-val','off'):$(this).attr('attr-val','on');return false;}$(this).attr({'src':src});updateOutput($('#nestable').data('output',$('#nestable-output')));setLogs("MENU","menu.intro."+onoff,"toggle-"+check,"INTRO");setTimeout(function(){location.replace('/config');},'500');}});$('.menu-visible').live({click:function(e){if($(this).attr('id')=="intro-onoff")return false;$('.menu-edit-cancel').click();menuEdit=false;var src=$(this).attr('src'),rex=new RegExp('icon-menu-visible.png'),onoff='',mstr=$(this).closest('.dd-item').attr('data-id'),mEL=$('#nestable').find('.dd-item[data-id="'+mstr+'"]');if(rex.test(src)){resrc='//i.addblock.net/icon/icon-menu-invisible.png';onoff='off';}else{resrc='//i.addblock.net/icon/icon-menu-visible.png';onoff='on';}setMenuVisibleOnOff(mstr,onoff,resrc);setLoginout(LOGINOUT);}});var setMenuVisibleOnOff=function(mstr,onoff,resrc){$this=$('#nestable').find('.dd-item[data-id="'+mstr+'"]').find('.menu-visible');$this.attr('attr-val',onoff);if(getMenuVisible()){var modal=$this.showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.visible.info'],true,false,'','ok');(onoff=='on')?$this.attr('attr-val','off'):$this.attr('attr-val','on');return false;}$this.attr('src',resrc);updateOutput($('#nestable').data('output',$('#nestable-output')));var icon=(onoff=='on')?"visible-true":"visible-false";setLogs("MENU","menu."+onoff,icon,mstr);var m_family=$this.parents('.dd-item').map(function(){return $(this).attr('data-id').replace(/ /g,'-');}).get();if(ONE||m_family.indexOf(PAGE)>-1){setTimeout(function(){location.replace('/config');},'500');}}
var getMenuVisible=function(){var menus=$('.dd-list .menu-onoff').map(function(){return $(this).attr('attr-val');}).get(),off=true;$.each(menus,function(i,v){if(v=='on'){off=false;}});return off;}
$('.menu-remove').live({click:function(e){$('.menu-edit-cancel').click();var mitem=$(this).closest('.dd-item'),pitem=mitem.parent(),updateMenu=jQuery.parseJSON($('#nestable-output').val()),mstr=mitem.attr('data-id'),parent_mitem=$('#nestable').find('.dd-item[data-id="'+mstr+'"]').parent().closest('.dd-item'),menu_cnt=0;$.each(updateMenu,function(i,v){menu_cnt++;if(v.name=='INTRO'&&v.display=='off')menu_cnt--;if(v.children!=''){menu_cnt=menu_cnt+v.children.length;}});if(menu_cnt<=2){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.delete.info'],true,false,'','ok');return false;}var menuoff=true;$.each(updateMenu,function(i,v){if(v.name==mstr)return true;else{if(v.display=='on')menuoff=false;}});if(menuoff==true){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.delete.confirm'],true,false,'','ok');return false;}var modal=$(this).showModalFlat('MENU DELETE',$.lang[LANG]['editor.menu.delete.confirm'],true,true,function(){if(parent_mitem){if(parent_mitem.find('.dd-item').length==1&&parent_mitem.find('.menu-link').first().attr('attr-link')=='folder-menu')resetLink(parent_mitem.attr('data-id'));}var menu_arr=$('#nestable').find('.dd-item[data-id]').map(function(){return $(this).attr('data-id');}).get();$.each(menu_arr,function(i,v){var child_link=$('#nestable').find('.dd-item[data-id="'+v+'"]').children().find('.menu-link').first().attr('attr-link');if(child_link==mstr)resetLink(v);});mitem.remove();var page=mitem.attr('data-id').replace(" ","-");if(pitem.children().length==0){pitem.parent().find('button').first().remove();pitem.parent().find('ol.dd-list').first().remove();}updateOutput($('#nestable').data('output',$('#nestable-output')));$.post('/template/menu/type/delete/sid/'+SID+'/page/'+encodeURIComponent(page)+'/onepage/'+ONE,{sid:SID},function(data){checkError(data);var d=(data.data)?data.data:{},time=(data.data)?400:0;$.each(data.data,function(i,v){if($('#tpl-menu li a[href="@'+v+'"][attr-bookmark]').length>0){resetLink($('#tpl-menu li a[href="@'+v+'"][attr-bookmark]').text());}delete SETTINGS.blockBookmarkList['bookmark'+v];});setTimeout(function(){setLogs("MENU","menu.delete","delete",mstr);if(ONE)showPageCallback(showPage);if(page==PAGE||VIEW){internalLink=true;location.replace('/config');}modal.modal('hide');},time);},'json');},'cancel');menuEdit=false;}});$('.menu-edit-save').live({click:function(e){menuEdit=false;var text=$(this).parents('.input-group').find('.menu-edit-input'),regex=new RegExp('[\`\~\!\@\#\$\%\^\&\*\(\)\-\+\=\|\\\\\[\}\{\;\:\'\"\,\<\.\>\/\?\]]*'),prev_menu=$(this).data('name'),err=false,tmp='';text.val($.trim(text.val()));var upperMenu=$.map(MENULIST,function(i,k){if(text.attr('data-name').toUpperCase().replace(/ /g,"-")!=i.toUpperCase().replace(/ /g,"-"))return i.toUpperCase().replace(/ /g,"-");});tmp=text.val().replace(/ /g,"-");if(regex.test(text.val())){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.characters'],true,false,'','ok');return;}if(!text.val()){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.input.info'],true,false,'','ok');text.focus();return;}if(text.attr('data-name').replace(/ /g,"-")==tmp){$(this).closest('.menu-edit-text').hide();$('#menu-add').show();return;}if($.inArray(tmp.toUpperCase(),upperMenu)>-1){$('.dd-item[data-id="menu-added"]').remove();updateOutput($('#nestable').data('output',$('#nestable-output')));$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.exisits'],true,false,'','ok');$(this).closest('.menu-edit-text').hide();$('#menu-add').show();return;}var check_mname=text.attr('data-name');if(check_mname.indexOf('-')>-1){check_mname=check_mname.replace(/-/g,' ');}if(text.val()=='form'){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.menu.form'],true,false,'','ok');text.focus();return;}$('#nestable').find('.dd-list li[data-id="'+check_mname+'"] .menu-lock[attr-lock="'+SID+check_mname.replace(/ /g,"-")+'"]').attr('attr-lock',SID+tmp);$('#nestable').find('.dd-item[data-id]').children().find('.menu-link[attr-link="'+check_mname+'"]').attr('attr-link',text.val()).addClass('active');$('#menu-add').show();target_page=$.trim(text.val()).replace(/ /g,"-");parent=PAGE.split(",");$.post('/template/update/type/rename',{s:text.attr('data-name'),id:SID,rename:target_page,page:PAGE},function(data){if(typeof data.error!="undefined"&&data.error){if(prev_menu!=$.trim(text.val())){err=true;$(this).showModalFlat('INFORMATION',data.error,true,false,'','ok');return false;}}updateOutput($('#nestable').data('output',$('#nestable-output')));},'json');if(err)return;text.attr('data-name',$.trim(text.val()));$(this).parents('li').first().find('.dd-handle .menu-name').first().text($.trim(text.val()));$(this).parents('li').first().attr('data-id',$.trim(text.val()));$(this).closest('.menu-edit-text').hide();updateOutput($('#nestable').data('output',$('#nestable-output')));var action=(prev_menu=='menu-added')?"menu.added":"menu.edit",icon=(prev_menu=='menu-added')?"add":"modify",obj=(prev_menu=='menu-added')?text.val():prev_menu+' �� '+text.val();setLogs("MENU",action,icon,obj);if(ONE)showPageCallback(showPage);else{if(decodeURIComponent(prev_menu)==decodeURIComponent(PAGE)){location.replace('/config/page/'+decodeURIComponent(target_page));}}}});$('.menu-link').live({click:function(e){$('.menu-edit-cancel').click();editLiked=false;var type='menu',mName=$(this).parents('li').attr('data-id'),prev_link=(typeof $(this).attr('attr-link')!='undefined'&&$(this).attr('attr-link'))?$(this).attr('attr-link'):mName,ch_menu=[],link_content="<div class='link-info'>"+$.lang[LANG]['editor.link.info.menu-link']+"</div>",target_check=($(this).attr('attr-ltarget')=='_blank')?'checked':'',regex=/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/,regex2=/^((http(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/;link_content=link_content+makeLinkList(SMENU,type,mName,prev_link)+"\
                </ul>\
                <div class='link-target'>\
                    <span>"+$.lang[LANG]["editor.link.open.target"]+"</span><input type='checkbox' class='img-link-target' id='menu-linktarget-onoff' "+target_check+" data-el='"+mName+"'/>\
                </div>\
            \
            ";var modal=$(this).showModalFlat('CONFIGURE LINK',link_content,true,true,function(){var input_type=$('.link-content').find('.link-type.active').children().attr('class');var result=getInputLink(input_type),link=result[0],isOkay=result[1],isActive=result[2],target_change='';target_val=($('#menu-linktarget-onoff').prop('checked'))?'_blank':'';target_change=(((target_check=='checked')?'on':'off')==((target_val=='_blank')?'on':'off'))?false:true;if((isActive&&prev_link==link||!isActive&&prev_link==mName)&&!target_change){modal.modal('hide');return true;}if(isOkay){if(isActive){$('#nestable').find('.dd-item[data-id="'+mName+'"] > span > .menu-link').attr('attr-link',link).addClass('active');}else{$('#nestable').find('.dd-item[data-id="'+mName+'"] > span > .menu-link').attr('attr-link',link).removeClass('active');}if(target_change){$('#nestable').find('.dd-item[data-id="'+mName+'"] > span > .menu-link').attr('attr-ltarget',target_val);}var log_text=(isActive||!isActive&&target_change)?'active':'broken';updateOutput($('#nestable').data('output',$('#nestable-output')));setLogs("MENU","menu.link."+log_text,"link-"+log_text,mName);modal.modal('hide');if(ONE){showPageCallback(showPage);}else{if(decodeURIComponent(mName.replace(/ /g,'-'))==decodeURIComponent(PAGE)){location.replace('/config');}else{location.replace('/config/page/'+decodeURIComponent(PAGE));}}}else{return false;}},'cancel','w450');}});$('.menu-lock').live({click:function(e){if(ONE){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['config.meun-lock.onepage-cantuse-lock'],true,false,'','ok');return false;}var type='menu',mName=$(this).parents('li').attr('data-id'),prev_lock=($(this).attr('attr-lock'))?$(this).attr('attr-lock'):'',is_default=(prev_lock=='')?'active':'',is_alone=(prev_lock==SID+mName.replace(/ /g,"-"))?'active':'',is_password=(prev_lock&&is_alone!='active')?'active':'';prev_lock=(is_password!='active'&&is_alone=='active')?'':prev_lock;var lock_content="\
                                <div class='lock-header'>\
                                    "+$.lang[LANG]['config.meun-lock.text']+"\
                                </div>\
                                <ul class='lock-content'>\
                                    <li class='"+is_default+"'>\
                                        <div class='lock-default'>\
                                            <i class='fa fa-check-circle'></i>\
                                            <h5>"+$.lang[LANG]['config.meun-lock.type.default']+"</h5>\
                                        </div>\
                                    </li>\
                                    <li class='"+is_alone+"'>\
                                        <div class='lock-alone'>\
                                            <i class='fa fa-check-circle'></i>\
                                            <h5>"+$.lang[LANG]['config.meun-lock.type.alone']+"</h5>\
                                        </div>\
                                    </li>\
                                    <li class='"+is_password+"'>\
                                        <div class='lock-password'>\
                                            <i class='fa fa-check-circle'></i>\
                                            <h5>"+$.lang[LANG]['config.meun-lock.type.password']+"</h5>\
                                            <div class='group-wrap'>\
                                                <div class='input-group'>\
                                                    <input type='password' class='lock-input form-control' placeholder='"+$.lang[LANG]["config.enter-password"]+"' value='"+prev_lock+"'>\
                                                    <label class='lock-input-error'></label>\
                                                </div>\
                                            </div>\
                                        </div>\
                                    </li>\
                                </ul>\
                                ";var modal=$(this).showModalFlat($.lang[LANG]['config.meun-lock.title'],lock_content,true,true,function(){var input_type=$('.lock-content').find('li.active').children().attr('class');var input_val='',isActive=false;switch(input_type){case'lock-default':input_val='';isActive=false;break;case'lock-alone':input_val=SID+mName.replace(/ /g,"-");isActive=true;break;case'lock-password':input_val=$('.lock-input').val();isActive=true;break;}if(input_type=='lock-password'&&$('.lock-input').val().length==0){$('.lock-input').focus();$('.lock-input-error').text($.lang[LANG]["config.modal.password"]);return false;}if(isActive){$('#nestable').find('.dd-list li[data-id="'+mName+'"] > span > .menu-lock').attr('attr-lock',input_val).addClass('active');}else{$('#nestable').find('.dd-list li[data-id="'+mName+'"] > span > .menu-lock').attr('attr-lock',input_val).removeClass('active');}updateOutput($('#nestable').data('output',$('#nestable-output')));var log_text=(isActive)?'active':'broken';setLogs("MENU","menu.lock."+log_text,"lock-"+log_text,mName);modal.modal('hide');},'cancel','w450');}});$('.lock-content li').live({click:function(e){if($(this).hasClass('disabled')){$('.lock-content li').find('.lockguidetext').remove();$(this).children().prepend('<span class="lockguidetext"><i class="fa fa-exclamation-circle"></i>'+$.lang[LANG]['editor.link.inner.guide']+'</span>');return;}if(!$(this).hasClass('active'))$('.lock-content li').find('.lockguidetext').remove();$(this).parent().children().removeClass('active');$(this).addClass('active');}});$('.config-image-view').on({click:function(e){menuConfigToggle('close');siteConfigToggle('close');$('.config-image-view').hide();var src=$(this).attr('data-src').split('/'),file=src[src.length-1],free=(src[4]=='free')?true:false;if(SID&&file){$('.tooltip.in').removeClass('in');var openNewWindow=window.open("about:blank");openNewWindow.location.href='/image/original/sid/'+SID+'/file/'+file+'/free/'+free;}else{console.log('None:: sid or src');return false;}}});$('.config-image-link').live({click:function(e){menuConfigToggle('close');siteConfigToggle('close');var idx=$(this).attr('data-index'),ig=$('.'+selectEL).attr('data-type'),src=$(this).attr('data-src');if(idx==-1&&ig!='image'){var modal=$(this).showModalFlat('INFORMATION','�대�吏��먮쭔 留곹겕 嫄� �� �덉쓬',true,true,function(){location.href='/config';});return false;}imageLinkController(selectEL,idx,ig,src);}});var imageLinkController=function(selectEL,idx,ig,src){editLiked=false;$el=$('.element[data-el="'+selectEL+'"]');$select_el=$el.find('img[data-attach="true"]:eq('+idx+')');var type='image',el_name=$el.attr('data-name'),el_id=$el.attr('data-id'),pn='image-link-change',element=$el.attr('data-element'),prev_link='',input_link='',target_check='',link_content='';if($select_el.parent('a').length>0){prev_link=$select_el.parent('a').attr('href');if($select_el.parent('a[data-user-link]').length>0){prev_link=prev_link.substring(1,prev_link.length);}else if($select_el.parent('a[attr-bookmark]').length>0){prev_link=prev_link;}else{prev_link=$select_el.parent('a').attr('attr-link');}target_check=($select_el.parent('a').attr('target')=='_blank')?'checked':'';}link_content=makeLinkList(SMENU,'image',el_name,prev_link);link_content=link_content+"\
            </ul>\
            <div class='link-target'>\
                <span>"+$.lang[LANG]["editor.link.open.target"]+"</span><input type='checkbox' class='img-link-target' id='linktarget-onoff' "+target_check+" data-el='"+selectEL+"' data-idx='"+idx+"'/>\
            </div>\
        \
        ";var modal=$(this).showModalFlat('IMAGE LINK',link_content,true,true,function(){var input_type=$('.link-content').find('.link-type.active').children().attr('class');var result=getInputLink(input_type),link=result[0],isOkay=result[1],isActive=result[2],img_link='',target_val='',target_change='';target_val=($('#linktarget-onoff').prop('checked'))?'_blank':'';target_change=(((target_check=='checked')?'on':'off')==((target_val=='_blank')?'on':'off'))?false:true;if(isOkay){if(isActive&&prev_link==link&&!target_change||!isActive&&prev_link==''){modal.modal('hide');return true;}img_link=makeLinkUrl(link,ONE,VIEW);var el_parent=$select_el.parent('a');if(isActive){if(el_parent.length==0){if(input_type=='link-menu'){$select_el.wrap('<a href="'+img_link+'" data-user-link="'+img_link+'" target="'+target_val+'"></a>');}else if(input_type=='link-bookmark'){$select_el.wrap('<a href="'+img_link+'" attr-bookmark="'+img_link.replace(/^\@/g,'')+'" target="'+target_val+'"></a>');}else{$select_el.wrap('<a href="'+img_link+'" attr-link="'+link+'" target="'+target_val+'"></a>');}}else{el_parent.removeAttr('attr-link').removeAttr('attr-bookmark').removeAttr('data-user-link').removeAttr('target');if(input_type=='link-menu'){el_parent.attr('data-user-link',img_link);}else if(input_type=='link-bookmark'){el_parent.attr('attr-bookmark',img_link);}else{el_parent.attr('attr-link',link);}el_parent.attr({'href':img_link,'target':target_val});}}else{if(el_parent.length>0){$select_el.unwrap();}}var eltag=$el.html();if(eltag.length>0){eltag='<div class="'+el_name+'">'+eltag+'</div>';}if(SID){$.post('/template/update/type/el-tag',{id:SID,s:eltag,seq:el_id},function(data){checkError(data);},'json');}var log_text=(isActive)?'active':'broken';setLogs("image","image.link."+log_text,"link-"+log_text,el_name);modal.modal('hide');if(ONE)showPageCallback(showPage);else{if(VIEW){location.reload(true);}else{location.replace('/config/page/'+decodeURIComponent(PAGE));}}}else{return false;}},'cancel','w450');}
$('#linktarget-onoff').live({click:function(e){$el=$('.element[data-el="'+$(this).attr('data-el')+'"]');$select_el=$el.find('img[data-attach="true"]:eq('+$(this).attr('data-idx')+')');if($(this).prop('checked')){$select_el.closest('a[attr-link]').attr('target','_blank');}else{$select_el.closest('a[attr-link]').removeAttr('target');}}});$('.gl-item-link, .gallery-item-link-icon').live({click:function(){var config_icon=($(this).hasClass('gl-item-link'))?'gl-item-link':'gallery-item-link-icon',seq=$(this).data('glseq'),glink=$(this).attr('data-glink'),is_glink_target=$(this).attr('data-glink-target'),glmode=$('.gallery-item[data-seq="'+seq+'"]').closest('.element').attr('data-mode'),glpid=$('.gallery-item[data-seq="'+seq+'"]').closest('.element').attr('data-id'),glel=$('.'+selectEL),prev_glink='',input_glink='',target_check=(typeof is_glink_target!='undefined'&&is_glink_target=='_blank')?'checked':'',link_content='';$select_glink=$('.gallery-item[data-seq="'+seq+'"]').find('a');if(typeof glink!='undefined'&&glink){if($select_glink.attr('data-user-link')){prev_glink=glink;}else if($select_glink.attr('attr-bookmark')){prev_glink=$select_glink.attr('href');}else if($select_glink.attr('attr-link')){prev_glink=$select_glink.attr('attr-link');}else{prev_glink=glink;}}link_content="<ul class='link-content gallery' data-type='"+glmode+"' data-name='"+glel.attr('data-name')+"'>\
                            "+makeLinkList(SMENU,'gallery',glel.attr('data-name'),prev_glink);link_content=link_content+"\
                </ul>\
                <div class='link-target'>\
                    <span>"+$.lang[LANG]["editor.link.open.target"]+"</span><input type='checkbox' class='img-link-target' id='linktarget-onoff' "+target_check+" data-el='"+selectEL+"' />\
                </div>\
            \
            ";var modal=$(this).showModalFlat('GALLERY LINK',link_content,true,true,function(){var input_type=$('.link-content').find('.link-type.active').children().attr('class');var result=getInputLink(input_type);link=result[0],isOkay=result[1],isActive=result[2],target_val='',target_change='';target_val=($('#linktarget-onoff').prop('checked'))?'_blank':'';target_change=(((target_check=='checked')?'on':'off')==((target_val=='_blank')?'on':'off'))?false:true;if(isOkay){if((isActive&&prev_glink==link||isActive==false&&prev_glink=='')&&!target_change){modal.modal('hide');return true;}var gsettings={'glink':link,'glink_target':target_val}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(gsettings),el:'gallery_settings',seq:seq},function(data){checkError(data);$select_glink.removeAttr('data-user-link').removeAttr('attr-link').removeAttr('attr-bookmark').removeAttr('data-gallery');$select_glink_config=$('#el-property[data-element="'+selectEL+'"] #gallery-list-config');if(link){var gallery_link=makeLinkUrl(link,ONE,VIEW);$select_glink.attr('href',gallery_link);if(MENULIST.indexOf(link.replace(/ /g,'-'))>-1){$select_glink.attr('data-user-link',gallery_link);}else if(link.match(/^\@/g)){$select_glink.attr('attr-bookmark',link);}else{$select_glink.attr('attr-link',link);}$select_glink_config.find('.gl-item-link[data-glseq="'+seq+'"]').attr('data-glink',link).addClass('active');if(config_icon=='gallery-item-link-icon')$('.gallery-item-link-icon[data-glseq="'+seq+'"]').attr('data-glink',link);}else{$select_glink_config.find('.gl-item-link[data-glseq="'+seq+'"]').attr('data-glink',link).removeClass('active');if(config_icon=='gallery-item-link-icon')$('.gallery-item-link-icon[data-glseq="'+seq+'"]').attr('data-glink',link);var imgURL=$('.gallery-item[data-seq="'+seq+'"]').find('img').prop('src');if(glmode=='gallery'){$('.gallery-item[data-seq="'+seq+'"]').find('a').attr({'href':imgURL,'data-gallery':'#gframe-'+glpid});}else{$('.gallery-item[data-seq="'+seq+'"]').find('a').removeAttr('data-gallery');$('.gallery-item[data-seq="'+seq+'"]').find('a').attr('href','/config/page/'+PAGE+'/view/'+seq);}}if(target_change){if(target_val)$select_glink.attr('target',target_val);else $select_glink.removeAttr('target');$select_glink_config.find('.gl-item-link[data-glseq="'+seq+'"]').attr('data-glink-target',target_val);if(config_icon=='gallery-item-link-icon')$('.gallery-item-link-icon[data-glseq="'+seq+'"]').attr('data-glink-target',target_val);}var log_text=(isActive||!isActive&&target_change)?'active':'broken',type=getElementType();setLogs(type,"gallery.link."+log_text,"link-"+log_text,type);},'json');modal.modal('hide');}},'cancel','w450 modal-portfolio-link');}});var getInputLink=function(type){var link='',isOkay=true,isActive=true,regex=/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/,regex2=/^((http(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/;regexTel=/^tel\:[0-9-+]+$/;switch(type){case'link-default':link='';isActive=false;break;case'link-out':link=$('.link-input').val();isOkay=false;if(link==''){$('.link-input').focus();if($('.link-out').find('.linkguidetext').length==0)$('.link-out').prepend('<span class="linkguidetext"><i class="fa fa-exclamation-circle"></i>'+$.lang[LANG]['editor.menu.input-link.info']+'</span>');}else if(link!=''){if(link.match("^(tel:|mailto:)")!==null){isOkay=true;}else if(!regex2.test(link)){if(regex.test(link)){isOkay=true;}else if(regexTel.test(link)){isOkay=true;}else{$('.link-input').focus();if($('.link-out').find('.linkguidetext').length==0)$('.link-out').prepend('<span class="linkguidetext"><i class="fa fa-exclamation-circle"></i>'+$.lang[LANG]['editor.menu.input-link.info']+'</span>');}}else{if($('.link-out').find('.linkguidetext').length>0)$('.link-out').find('.linkguidetext').remove();isOkay=true;}}break;case'link-inner':case'link-menu':var select_menu=$('.link-innerlist').find('.active');isOkay=false;if(select_menu.length>0){link=select_menu.first().attr('data-userlink');isOkay=true;}break;case'link-bookmark':var select_bookmark=$('.link-bookmarklist').find('.active');isOkay=false;if(select_bookmark.length>0){link=select_bookmark.first().attr('data-bookmark').replace('bookmark','\@');isOkay=true;}break;case'link-folder':link='folder-menu';break;default:break;}var result=[link,isOkay,isActive];return result;}
var makeLinkList=function(e,type,id,prev_link){var link_content=(type=='gallery')?"":"<ul class='link-content' data-type='"+type+"' data-name='"+id+"'>",isDefault='',isOut='',isFolder='',isInner='',out_link='',icon_text='fa fa-check-circle',isBookmark='',org_prev_link=(prev_link)?prev_link:'';if(prev_link.match(/^\@/g)!==null){isBookmark='active';}else{if(type=='menu'){if(prev_link==id){isDefault='active';}else if(MENULIST.indexOf(prev_link.replace(/ /g,'-'))>-1){isInner='active';}else if(prev_link=='folder-menu'){isFolder='active';}else{isOut='active';out_link=prev_link;}}if(type=='image'||type=='gallery'){if(prev_link==''){isDefault='active';}else if(MENULIST.indexOf(prev_link.replace(/ /g,'-'))>-1){isInner='active';}else{isOut='active';out_link=prev_link;}}}var temp=(type=='menu')?'editor.link.inner.select.menu':(ONE)?'editor.link.inner.select.page.1':'editor.link.inner.select.page.0';prev_link=(isInner)?prev_link:$.lang[LANG][temp];var menulist_val=makeMenuLinkList(SMENU,type,id,prev_link),isList=true,submenu_disable='';if(menulist_val.length==0){prev_link=$.lang[LANG]['editor.link.inner.empty'];isList=false;submenu_disable='disabled';if(type=='menu'){isInner=(isInner=='active')?'':isInner;isFolder=(isFolder=='active')?'':isFolder;icon_text='fa fa-minus-circle';}}var bookmark_disable='',isBookmarkList=true,bookmark_icon_text='fa fa-check-circle',select_bookmark_str=$.lang[LANG]['editor.link.bookmark.select'],bookmarklist_val=makeBookmarkList(SETTINGS.blockBookmarkList,type,id,org_prev_link);if(bookmarklist_val.length==0){if(isBookmark=='active'){isBookmark='';isDefault='active';prev_link=$.lang[LANG][temp];}isBookmarkList=false;bookmark_disable='disabled';bookmark_icon_text='fa fa-minus-circle';select_bookmark_str=$.lang[LANG]['editor.link.bookmark.empty'];}else{if(typeof SETTINGS.blockBookmarkList[org_prev_link.replace(/^\@/g,'bookmark')]!='undefined'&&SETTINGS.blockBookmarkList[org_prev_link.replace(/^\@/g,'bookmark')]){select_bookmark_str=SETTINGS.blockBookmarkList['bookmark'+org_prev_link.replace(/^\@/g,'')];}else{if(isBookmark=='active'){isBookmark='';isDefault='active';prev_link=$.lang[LANG][temp];}}}if(type=='menu'){if(isDefault==''&&isOut==''&&isFolder==''&&isInner==''&&isBookmark==''){isDefault='active';}}if(type=='image'||type=='gallery'){if(isDefault==''&&isOut==''&&isInner==''&&isBookmark==''){isDefault='active';}}var link_deafult_text=(type=='menu'||type=='gallery')?$.lang[LANG]['editor.link.default']:$.lang[LANG]['editor.link.default.image'];link_content=link_content+"\
                <li class='link-type "+isDefault+"'>\
                    <div class='link-default'>\
                        <i class='fa fa-check-circle'></i>\
                        <h5>"+link_deafult_text+"</h5>\
                    </div>\
                </li>\
                <li class='link-type "+isOut+"'>\
                    <div class='link-out'>\
                        <i class='fa fa-check-circle'></i>\
                        <h5>"+$.lang[LANG]['editor.link.out']+"</h5>\
                        <div class='group-wrap'>\
                            <div class='input-group'>\
                                <input type='text' class='link-input form-control' placeholder='"+$.lang[LANG]['editor.link.input.info']+"' value='"+out_link+"'/>\
                            </div>\
                        <div>\
                    </div>\
                </li>";if(type=='menu'){link_content=link_content+"<li class='link-type "+isInner+" "+submenu_disable+"'>\
                    <div class='link-inner'>\
                        <i class='"+icon_text+"'></i>\
                        <h5>"+$.lang[LANG]['editor.link.inner']+"</h5>\
                        <div class='group-wrap'>\
                            <div class='btn-group'>\
                                <div class='inner-toggle btn btn-sm dropdown-toggle "+submenu_disable+"' data-toggle='dropdown'>\
                                    <span class='select-link'>"+prev_link+"</span>";if(isList)link_content=link_content+"<span class='caret'></span>";link_content=link_content+"\
                                </div>\
                                <ul class='dropdown-menu link-innerlist' role='menu'>\
                                    "+menulist_val+"\
                                </ul>\
                            </div>\
                        <div>\
                    </div>\
                </li>\
                ";}if(type=='image'||type=='gallery'){var lang_text="editor.link.inner.menu";link_content=link_content+"<li class='link-type "+isInner+" "+submenu_disable+"'>\
                    <div class='link-menu'>\
                        <i class='fa fa-check-circle'></i>\
                        <h5>"+$.lang[LANG][lang_text]+"</h5>\
                        <div class='group-wrap'>\
                            <div class='btn-group'>\
                                <div class='inner-toggle btn btn-sm dropdown-toggle "+submenu_disable+"' data-toggle='dropdown'>\
                                    <span class='select-link'>"+prev_link+"</span>";if(isList)link_content=link_content+"<span class='caret'></span>";link_content=link_content+"\
                                </div>\
                                <ul class='dropdown-menu link-innerlist' role='menu'>\
                                    "+menulist_val+"\
                                </ul>\
                            </div>\
                        <div>\
                    </div>\
                </li>\
            \
            ";}link_content=link_content+"\
                <li class='link-type "+isBookmark+" "+bookmark_disable+"'>\
                    <div class='link-bookmark'>\
                        <i class='"+bookmark_icon_text+"'></i>\
                        <h5>"+$.lang[LANG]['editor.link.bookmark']+"\
                            <span class='bookmark-tooltip'><i class='fa fa-question-circle' data-toggle='tooltip' data-placement='top' data-html='true' data-original-title='"+$.lang[LANG]['editor.link.bookmark.info']+"' ></i></span>\
                        </h5>\
                        <div class='group-wrap'>\
                            <div class='btn-group'>\
                                <div class='bookmark-toggle btn btn-sm dropdown-toggle "+bookmark_disable+"' data-toggle='dropdown'>\
                                    <span class='select-bookmark'>"+select_bookmark_str+"</span>\
                                    ";if(isBookmarkList)link_content=link_content+"<span class='caret'></span>";link_content=link_content+"\
                                </div>\
                                <ul class='dropdown-menu link-bookmarklist' role='bookmark'>\
                                    "+bookmarklist_val+"\
                                </ul>\
                            </div>\
                        </div>\
                    </div>\
                </li>\
                ";if(type=='menu'){link_content=link_content+"\
                <li class='link-type "+isFolder+" "+submenu_disable+"'>\
                    <div class='link-folder'>\
                        <i class='"+icon_text+"'></i>\
                        <h5>"+$.lang[LANG]['editor.link.folder']+"</h5>\
                    </div>\
                </li>\
            ";}return link_content;}
var makeBookmarkList=function(bookmarklist,type,id,link){var str='',isActive='';if(typeof bookmarklist=='undefined'||!bookmarklist)return str;$.each(bookmarklist,function(k,v){isActive=(k==link.replace(/^\@/g,'bookmark'))?'active':'';str=str+"<li class='"+isActive+"' data-bookmark='"+k+"' data-bookmark-name='"+v+"'><a href='javascript:;'>"+v+"</a></li>";});return str;}
$('.link-type').live({click:function(e){if($(this).hasClass('disabled')){$('.link-type').find('.linkguidetext').remove();if($(this).find('.link-bookmark').length>0){$(this).children().prepend('<span class="linkguidetext"><i class="fa fa-exclamation-circle"></i>'+$.lang[LANG]['editor.link.bookmark.guide']+'</span>');}else{$(this).children().prepend('<span class="linkguidetext"><i class="fa fa-exclamation-circle"></i>'+$.lang[LANG]['editor.link.inner.guide']+'</span>');}return;}if(!$(this).hasClass('active'))$('.link-type').find('.linkguidetext').remove();$(this).parent().children().removeClass('active');$(this).addClass('active');}});$('.inner-toggle').live({click:function(e){if($(this).parents('.link-type').hasClass('disabled')){$('.link-type').find('.linkguidetext').remove();$(this).next().hide();$(this).parents('.link-type').children().prepend('<span class="linkguidetext"><i class="fa fa-exclamation-circle"></i>'+$.lang[LANG]['editor.link.inner.guide']+'</span>');return;}$(this).parents('.link-type').parent().children().removeClass('active');$(this).parents('.link-type').addClass('active');}});$('.link-innerlist li').live({click:function(e){$('.link-innerlist li').removeClass('active');$(this).addClass('active');var select_userlink=$(this).attr('data-userlink');$('.link-content .dropdown-toggle .select-link').text(select_userlink);}});$('.menu-edit').live({click:function(e){$('.menu-edit-cancel').click();menuEdit=true;var text=$(this).parents('li').attr('data-id');$(this).parent().parent().find('.menu-edit-input').first().val(text);$(this).parent().parent().find('.menu-edit-text').first().show();if($('.menu-infomation').css('display')=='block')$('.menu-infomation .close').click();$('#menu-add').hide();}});$('#menu-add').live({click:function(e){menuEdit=true;var name='';if($('.dd-list').children().last().attr('data-id')=='menu-added'){return false;}if($('.menu-infomation').css('display')=='block')$('.menu-infomation .close').click();$('#nestable .dd-list').first().append(addMenu('menu-added','on','','','',0,true,false));$('.menu-edit-input').focus();$('#menu-add').hide();}});$('.link-bookmarklist li').live({click:function(e){$('.link-bookmarklist li').removeClass('active');$(this).addClass('active');var select_bookmark=$(this).attr('data-bookmark-name');$('.link-content .dropdown-toggle .select-bookmark').text(select_bookmark);}});$('#serialize').click(function(){$('#nestable-output').toggle();});$('#menu-save').click(function(){$("#accordion").accordion({disabled:false});});$('.toggle').live({click:function(){$(this).toggleClass('open');$(this).parents('li').find('.toggle-body').slideToggle();}});$('.switch.prop-wrap').click(function(){var el=$(this).attr('el'),pn=$(this).attr('pn'),val;switch(pn){case"text-decoration":val=($(this).find('.switch-input').is(":checked"))?"underline":"none";break;}elUpdate(el,pn,val);});$('#el-fileupload').on('show.bs.modal',function(e){ADD=false;UPLOAD=0;UPLOADED=0;UPLOADSIZE=0;cPage=1;initResource();resourceGetPage(1,SFOLDER_ACTIVE);$('.resource-selectAll').show();if($('.fli.active').length==0){$('.fli[data-id="all"]').click();}$('.resource-useit').removeClass('active');$('.progress .progress-bar').css({'width':'0%','padding-right':'0px'}).text('');});$('#el-fileupload').on('hide.bs.modal',function(e){if($('.fli.active[data-id="clEmptyFolder"]').length>0){$('.fli.active[data-id="clEmptyFolder"]').remove();isFEdit=false;}if($('#nestableFolder .fli.active .dd-fln').find('input').length>0){$('#nestableFolder .fli.active .dd-fln').find('input').val('').remove();isFEdit=false;}if($('#el-property [data-loop-type="matrix"] .attach-thumb[data-toggle="modal"]').length>0){var idx=$('#el-property [data-loop-type="matrix"] .attach-thumb[data-toggle="modal"]').attr('idx');$('#el-property [data-loop-type="matrix"] .attach-thumb[data-toggle="modal"]').removeAttr('data-toggle');if(!$('#el-property [data-loop-type="matrix"] .ui-sortable').children().first().hasClass('active'))$('#el-property [data-loop-type="matrix"] .ui-sortable').children().first().click();}$('.add-folder').attr('data-content','').popover('hide');$('.resource-useit').show();selectCount=0;});$('.modal-upload-button').live({click:function(){var ffolder=(SFOLDER_ACTIVE)?SFOLDER_ACTIVE:'all';$(this).fileupload({url:'/template/resource/upload/ffolder/'+ffolder,dataType:'json',async:true,add:function(e,data){var filesize=data.files[0].size;if(filesize>1e+7){filesize=filesize/1024/1024;$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.upload.max.1']+$.lang[LANG]['editor.upload.max.2']+'<br>file : '+data.files[0].name+'<br>size : '+filesize.toFixed(1)+'Mb',true,false,'','ok');return;}var filename=data.files[0].name;var search=/%/g,match=filename.match(search);if(match===null){var uploadErrors=[];var acceptFileTypes=/^image\/(gif|jpe?g|png)$/i;if(data.originalFiles[0]['type'].length&&!acceptFileTypes.test(data.originalFiles[0]['type'])){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.upload.error.ext'],true,false,'','ok');return;}else{UPLOAD++;UPLOADSIZE+=parseInt(data.files[0].size/1024);data.submit();}}else{$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.upload.filename'],true,false,'','ok');return;}},done:function(e,data){$('.uploadModal .uploadModal-message').html('<i class="fa fa-spinner fa-pulse fa-fw margin-bottom" aria-hidden="true"></i> '+data.result.client_name+' images creating...');progress1=parseInt(UPLOADED/UPLOAD*50,10);PROGRESS=progress1+progress2;$('.file-upload-progress .progress-bar').css({'width':PROGRESS+'%','text-align':'right','padding-right':'5px'}).text(PROGRESS+'% ');UPLOADED++;if(UPLOADED){if(UPLOAD==UPLOADED){setTimeout(function(){if(SFOLDER_ACTIVE!='')resetFolderInfo(UPLOAD,UPLOADSIZE,'all','upload');UPLOAD=0;UPLOADED=0;UPLOADSIZE=0;PROGRESS=0;$.uploadOFF();resourceGetPage(1,SFOLDER_ACTIVE);updateOutputFolder($('#nestableFolder').data('output',$('#nestableFolder-output')));},500);$('.file-upload-progress .progress-bar').css({'width':PROGRESS+'%','padding-right':'0px'}).text('');}}if(data.result.error===undefined){$("li.resource-none").remove();if(ADD){addGalleryfile(data.result.file_name,SID,PAGE);}}else{checkError(data.result);}},progressall:function(e,data){$.uploadON();progress2=parseInt(data.loaded/data.total*50,10);PROGRESS=progress1+progress2;$('.file-upload-progress .progress-bar').css({'width':PROGRESS+'%','text-align':'right','padding-right':'5px'}).text(PROGRESS+'% ');},start:function(e,data){progress1=0;progress2=0;PROGRESS=0;},dragover:function(e,data){e.preventDefault();}}).prop('disabled',!$.support.fileInput).parent().addClass($.support.fileInput?undefined:'disabled');}});var mouseX,mouseY;$('#el-fileupload').mousemove(function(e){mouseX=e.pageX;mouseY=e.pageY;$('.resource-tooltip').css({'top':mouseY-20,'left':mouseX-20});});$("#resource-files").selectable({filter:".fitem",cancel:"i,.ui-selected",selected:function(event,ui){var files=[],files_path=[],files_size=[],files_seq=[],file='',file_path='',file_size=0,file_seq='';if($(ui.selected).is(".fitem")){file=$(ui.selected).closest('.fitem').find(".resource-file-name").attr("data-source");file_path=RPATH+"60/"+file;file_size=$(ui.selected).closest('.fitem').find('.resource-file-size').text();file_seq=$(ui.selected).closest('.fitem').find(".resource-file-name").attr("data-seq");var ffloder=$("#resource-files ul[data-source='"+file+"']").attr('data-ffolder');if($(".selected-files").find("li[data-source='"+file+"']").length==0){$(".selected-files").append("<li data-source='"+file+"' data-ffolder='"+ffloder+"' data-seq='"+file_seq+"' data-size='"+file_size+"'><img src='"+file_path+"'><div class='selected-hover'>&times;<p class='selected-file-name'>"+file+"</p><p class='selected-file-size'>"+file_size+"</p></div></li>");}}resetFileSelectedStr();},unselected:function(event,ui){if($(ui.unselected).is('.fitem')){if(!event.ctrlKey&&!event.shiftKey){$(".selected-files").empty();}}resetFileSelectedStr();},stop:function(event,ui){if($('.selected-files').children().length!=$('#resource-files').children('.fitem').length){if($('#selectAll').prop('checked'))$('#selectAll').removeAttr('checked');}}});$('#selectAll').click(function(){var check=$(this);var selected=$('.selected-files li').map(function(i,n){return $(this).find("p.selected-file-name").text();}).get();$('#resource-files li').each(function(){var file=$(this).find('.resource-file-name').attr('data-source'),file_path=RPATH+'60/'+file,ffloder=$("#resource-files ul[data-source='"+file+"']").attr('data-ffolder'),file_size=$("#resource-files .resource-file-name[data-source='"+file+"']").next('.resource-file-size').text(),file_seq=$(this).find('.resource-file-name').attr('data-seq');if(check.prop('checked')){$(this).find('.fitem').addClass('ui-selected');exist=$('p.resource-file-name[data-source="'+file+'"]').attr('data-source');isAppend=($.inArray(exist,selected)>-1)?false:true;if(exist&&isAppend){$('.selected-files').append("<li data-source='"+file+"' data-ffolder='"+ffloder+"' data-seq='"+file_seq+"'><img src='"+file_path+"'><div class='selected-hover'>&times;<p class='selected-file-name'>"+file+"</p><p class='selected-file-size'>"+file_size+"</p></div></li>");$('.selected-files-count').text(selected.length);}}else{$('.selected-files p:contains("'+file+'")').parents('li').remove();$(this).find('.resource-image').removeClass('ui-selected');$('.resource-selected-str').hide();}});resetFileSelectedStr();});$('#resource-delete').click(function(){if($('.selected-files').children().length==0){return;}var r_pages=Number($('.resource-paging .pagination').attr('data-pages')),r_page=Number($('.resource-paging .pagination li.active').text()),r_file_cnt=$('#resource-files li.fitem').length;var modal=$(this).showModalFlat('DELETE IMAGE',$.lang[LANG]['config.common.resource.delete'],true,true,function(){$.processON('Deleting the image(s)...');modal.modal('hide');var files=[],seqs=[],sizes=[],ffolders=[];$('.selected-files li').each(function(){files.push($(this).attr('data-source'));seqs.push($(this).attr('data-seq'));sizes.push($(this).find('.selected-file-size').text());ffolders.push($(this).attr('data-ffolder'));});$('.selected-files').empty();$('.resource-useit').removeClass('active');resourceFileDelete(files,seqs,function(){files.forEach(function(v,i){if(SFOLDER_ACTIVE!=''){resetFolderInfo(-1,-sizes[i],'all','delete');}else{resetFolderInfo(-1,-sizes[i],ffolders[i],'delete');}});r_page=((r_file_cnt-files.length)==0&&r_pages<=r_page)?r_page-1:r_page;r_page=1;resourceGetPage(r_page,SFOLDER_ACTIVE);updateOutputFolder($('#nestableFolder').data('output',$('#nestableFolder-output')));$.processOFF();});},'cancel');});$('#add-gallery').click(function(){ADD=true;});$('.resource-useit').click(function(){var list=($(this).hasClass('free'))?'.fr-selected-files':'.selected-files',files=$(list+' li').map(function(i,n){return $(this).find("p.selected-file-name").text();}).get().join('|');var selected=(files)?true:false,selected_count=$(list+' li').length,pn=$(this).attr('data-property'),element=$(this).attr('data-element'),ctrl=$(this).attr('data-ctrl'),idx=$(this).attr('data-idx'),seq=$(this).attr('data-seq'),col=$(this).attr('data-col'),count=(typeof $(this).attr('data-replace-count')!="undefined")?$(this).attr('data-replace-count'):0,p=RESOURCE+'/'+SID;if(!selected){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.resource.useit'],true,false,'','ok');}else if(selected&&count>0&&selected_count>count){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.resource.choose.count.'+count],true,false,'','ok');}else{if(element=='site-template'){siteTemplateImage(files);}else{if(element){if(typeof ctrl=="undefined"){if(pn=='video-poster-change'){videoPosterChange(element,files,p);}else if(pn=='popup-image-add'||pn=='popup-image-change'){var pn_mode=(pn=='popup-image-add')?'add':'change';popupItemImageChange(element,files,p,idx,pn_mode);}else{elementUpdate(element,pn,files,idx);}}else{ctrlElementUpdate(element,pn,files,idx);}}else if(pn=='gallery-resource-change'){galleryResourceUpdate(seq,files);}else if(pn=='add-content-images'){if(col==0)addContentImages(seq,files);else setContentImages(seq,files,col);}else if(pn=='element-image-upload'){elementUploadImage(seq,files);}else if(pn=='gallery-item-image'){galleryItemImageChange(files);}else if(pn=='add-attach'){addAttachItem(files,p);}else if(pn=='add-clone'){addCloneItem(files,p);}else if(pn=='add-matrix'){addCloneItem(files,p,'matrix');}else addGalleryfile(files,SID,PAGE);}selectCount=0;$('#el-fileupload').modal('hide');}});$('#el-gallery').on('hidden.bs.modal',function(e){GLID="";showPage(MCSS,MSTYLE,MTAG);});$('*[contenteditable]').live({paste:function(event){if($('.note-editable').length)return false;event.preventDefault();if(window.clipboardData){var text=window.clipboardData.getData('Text');if(window.getSelection){window.getSelection().getRangeAt(0).insertNode(document.createTextNode(text));}else if(document.selection&&document.selection.createRange){text=text.replace(/\n/g,"<br />");document.selection.createRange().pasteHTML(text);}}else{var text=(event.originalEvent||event).clipboardData.getData('text/plain')||prompt('Paste something..');text=text.replace(/\n/g,"<br />");window.document.execCommand('insertHtml',false,text);}}});function pasteHtmlAtCaret(html){var sel,range;if(window.getSelection){sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0);range.deleteContents();var el=document.createElement("p");el.innerHTML=html;var frag=document.createDocumentFragment(),node,lastNode;while((node=el.firstChild)){lastNode=frag.appendChild(node);}range.insertNode(frag);if(lastNode){range=range.cloneRange();range.setStartAfter(lastNode);range.collapse(true);sel.removeAllRanges();sel.addRange(range);}}}else if(document.selection&&document.selection.type!="Control"){document.selection.createRange().pasteHTML(html);}}$('.prop-header span.close').click(function(){hideConfigPanel();})
$('.menu-config.edit-menu').click(function(){($(this).hasClass('active'))?menuConfigToggle('close'):menuConfigToggle('open');});$('.menu-config.edit-site').click(function(){($(this).hasClass('active'))?siteConfigToggle('close'):siteConfigToggle('open');});$("*[contenteditable]").live("keypress",function(e){if($(this).hasClass('note-editable'))return;if(e.which==13){if($(this).hasClass('btn')){$('.g-body .text-menu').removeClass('active').addClass('hide');if($('.generic-modal').length)return false;$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.button.nobr'],true,false,'','ok');return false;}if(window.getSelection){var selection=window.getSelection(),range=selection.getRangeAt(0),br=document.createElement("br");range.deleteContents();range.insertNode(br);range.setStartAfter(br);range.setEndAfter(br);range.collapse(false);selection.removeAllRanges();selection.addRange(range);return false;}}}).live("keyup",function(e){if(e.which==8||e.which==46){if($(this).html().length==0){$(this).html('&nbsp;');$(this).focus();}}});$('#content-overlap').live({click:function(){$('header.navbar').toggleClass('transparent');var url='/template/update/type/header/mode/',checked=$(this).prop('checked');HEADER=checked;var param={s:PAGE,id:SID}
$.post(url,param,function(data){checkError(data);if(checked)$('.header-empty').css('background-color','transparent');updateOutput($('#nestable').data('output',$('#nestable-output')));setLogs("MENU","menu.overlap."+checked,"toggle-"+checked,"MENU");},'json');}});$('#change-mode').click(function(){if(COUNT==0){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.block.preview'],true,false,'','ok');return false;}saveContentedit();var tmp=PAGE.split(","),page=tmp[0];page=(VIEW)?page+"/view/"+VIEW:page;var openNewWindow=window.open("about:blank");openNewWindow.location.href="http://"+SID+"."+HOST+"/render/"+page;});$('#config-mode').click(function(){viewmode('config');});$('.el-back').click(function(){menuContextDisplay('show');});$('.add-contents-close').click(function(){addController('hide');}).disableSelection();$('.add-icon.add-element.has-child').mouseenter(function(){var ref=$(this).data('ref');if($(this).hasClass('sub-element'))return;$('.add-element.sub-element').removeClass('hide').hide();$('.add-element.'+ref).show();}).disableSelection();$('.add-Header').click(function(){var attr=$(this).data('attribute'),align=$('.el_0').attr('data-align');selectID=getContnetsAlign(align,attr);addContents(selectID,selectPOS);var type=getElementType();setLogs(type,"block.add.false","block-add-false",type);});$('.add-Text').click(function(){var attr=$(this).data('attribute'),align=$('.el_0').attr('data-align');selectID=getContnetsAlign(align,attr);addContents(selectID,selectPOS);var type=getElementType();setLogs(type,"block.add.false","block-add-false",type);});$('.add-Divider').click(function(){var attr=$(this).data('attribute'),align=$('.el_0').attr('data-align');selectID=getContnetsAlign(align,attr);addContents(selectID,selectPOS);var type=getElementType();setLogs(type,"block.add.false","block-add-false",type);});$('.add-Image').click(function(){var attr=$(this).data('attribute'),align=$('.el_0').attr('data-align'),selectID=getContnetsAlign(align,attr),col=($(this).data('col'))?$(this).data('col'):0,resource_count=0;selectID=contents[attr];$('.resource-useit').attr('data-property','add-content-images').attr('data-col',col).attr('data-seq',selectID).removeAttr('data-element').attr('data-replace-count',resource_count);selectCount=resource_count;$('#el-fileupload').modal('show');});$('.add-Video').click(function(){var attr=$(this).data('attribute'),count=(typeof $(this).data('count')!='undefined')?$(this).data('count'):1;$('#insert-video-save').attr('data-attribute',attr);$('.insert-video-list').html('');for(var i=0;i<count;i++){$('.insert-video-list').append("<li><input class='insert-video-url form-control span12' type='text' placeholder='https://www.youtube.com/watch?v=mzPxo7Y6JyA' /></li>");}$('#insert-video').modal('show');});$('#insert-video-save').click(function(){var url_arr=$('.insert-video-url').map(function(){return $(this).val()}).get(),attr=$(this).attr('data-attribute'),align=$('.el_0').attr('data-align'),$video;selectID=getContnetsAlign(align,attr);$('.form-group').find('.error').remove();var empty=false;$.each(url_arr,function(i,v){if(!v){empty=true;if($('.form-group').find('.error').length==0)$('.insert-video-list').after('<label class="error">'+$.lang[LANG]['editor.video.url']+'</label>');$('.insert-video-list li:nth-child('+(i+1)+')').find('.insert-video-url').focus();return false;}});if(!empty){var video_arr=insertVideo(url_arr);if(!video_arr&&typeof video_arr=="boolean"){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.video.url.error'],true,false,'','ok');$('#insert-video').modal('hide');return false;}var id=addContents(selectID,selectPOS),element=$('.element[data-id="'+id+'"]').attr('data-el');$.each(video_arr,function(i,v){$('.'+element).find('[data-video="true"]').eq(i).empty().append(v);});selectEL=element;saveContentElement();$('.dsgn-body').fitVids();$(this).removeAttr('data-attribute');var type=getElementType();setLogs(type,"block.add.false","block-add-false",type);$('#insert-video').modal('hide');}});$('a[href="#mystorage"]').click(function(e){resetFileSelectedStr();});$('a[href="#freestorage"]').click(function(e){$('.listprogress').remove();resetFileSelectedFr();if($('.fr-storage').length==0){fSearch.type='new';fSearch.page=1,fSearch.total=-1;storageInit();var $ul=$('<ul class="fr-storage-list"></ul>'),$latest=$('<li class="latest"><i class="fa fa-check" aria-hidden="true"></i> '+$.lang[LANG]['free.storage.new']+'</li>'),$favor=$('<li class="favor"><i class="fa fa-star"></i> '+$.lang[LANG]['free.storage.favor']+'</li>'),$used=$('<li class="used"><i class="fa fa-thumb-tack" aria-hidden="true"></i> '+$.lang[LANG]['free.storage.used']+'</li>');if($('.fr-storage-list').length==0){$ul.append($latest).append($favor).append($used);$('.fr-strg.resource-filelist').append($ul);$ul.find('li').click(function(e){if($(this).hasClass('latest')){if(!$('.fr-storage').hasClass('new')){fSearch.type='new';fSearch.page=1,fSearch.total=-1;storageInit();getFreeImage(fSearch.page,fSearch.type);}$('.fr-storage').removeClass('favor used').addClass('new');}else if($(this).hasClass('favor')){if(!$('.fr-storage').hasClass('favor')){fSearch.type='favor';fSearch.page=1;fSearch.total=-1;storageInit();getFreeImage(fSearch.page,fSearch.type);}$('.fr-storage').removeClass('new used').addClass('favor');var items=$('.fr-storage .imgs').length;if(fSearch.total==items)return;}else if($(this).hasClass('used')){if(!$('.fr-storage').hasClass('used')){fSearch.type='used';fSearch.page=1;fSearch.total=-1;storageInit();getFreeImage(fSearch.page,fSearch.type);}$('.fr-storage').removeClass('new favor').addClass('used');var items=$('.fr-storage .imgs').length;}$ul.find('li').removeClass('active');$(this).addClass('active');$(".fr-selected-files").empty();resetFileSelectedFr();});$('.fr-storage-list .latest').addClass('active');fSearch.type='new';fSearch.page=1,fSearch.total=-1;getFreeImage(fSearch.page,fSearch.type);}}});$('.free-search').keyup(function(e){var keyCode=e.keyCode,search=$(this).val().trim();if(keyCode==13){if(search==''){alert('Please enter search text...');$(this).focus();return false;}fSearch.type='search';fSearch.page=1;fSearch.text=search;fSearch.total=0;$('.free-search').val('');$('.free-search-result').text('');$('.fr-storage-list li').removeClass('active');$('.fr-storage').remove();$('.fr-strg.resource-container').prepend('<div class="fr-storage"></div>');$('.fr-storage').prepend('<div class="listprogress" style="width: 100%; min-height: 40px; text-align:center; padding-top:50px;"><svg version="1.1" xmlns="http://www.w3.org/svg/2000" viewBox="0 0 30 30" width="60" style="width:30px; height: 30px;"><circle cy="15" cx="15" r="14" style="stroke:#00baff;"></circle></svg></div>');var $frstorage=$('.fr-strg.resource-container .fr-storage');for(var i=0;i<4;i++){$frstorage.append('<div class="fr-row"></div>');}$.getJSON('/template/translate/'+encodeURIComponent(search),function(data){search=data.data.translations[0].translatedText;fSearch.text=search;$('.free-search').val(search);getFreeImage(fSearch.page,fSearch.type,search);});}});});var storageInit=function(){$('.free-search').val('');$('.free-search-result').text('');$('.fr-storage').remove();$('.fr-strg.resource-container').prepend('<div class="fr-storage"></div>');$('.fr-storage').prepend('<div class="listprogress" style="width: 100%; min-height: 40px; text-align:center; padding-top:50px;"><svg version="1.1" xmlns="http://www.w3.org/svg/2000" viewBox="0 0 30 30" width="60" style="width:30px; height: 30px;"><circle cy="15" cx="15" r="14" style="stroke:#00baff;"></circle></svg></div>');var $frstorage=$('.fr-strg.resource-container .fr-storage');for(var i=0;i<4;i++){$frstorage.append('<div class="fr-row"></div>');}}
var rePaintFavor=function(){var $org=$('.fr-storage .imgs'),$items={};for(var i=0;i<$org.length;i++){var $i=$('.fr-storage .imgs[data-idx="'+i+'"]');$items[i]=$i.clone();$i.remove();}var idx=0,$fHeight=$('.fr-storage .fr-row'),height=[$fHeight.eq(0).height(),$fHeight.eq(1).height(),$fHeight.eq(2).height(),$fHeight.eq(3).height(),];$.each($items,function(i,v){var set=(i<4)?i:height.indexOf(Math.min.apply(null,height)),w=$(this).find('.control-area').attr('data-width'),h=$(this).find('.control-area').attr('data-height'),r=Math.round(h*1080/w);height[set]=height[set]+r;$('.fr-storage .fr-row').eq(set).append($(this));});}
var getFreeImage=function(page,type,stx,collection){type=(typeof type=='undefined')?'new':type;stx=(typeof stx=='undefined')?'':stx;page=(typeof page=='undefined')?1:page;collection=(typeof collection=='undefined')?'':collection;if(type=='new'){dest='/template/free/new/photos';}else if(type=='favor'){dest='/template/favorite/list/type/F';}else if(type=='search'){dest='/template/free/search/'+encodeURIComponent(stx);}else if(type=='used'){dest='/template/favorite/list/type/U';}if(page>1)dest=dest+'/page/'+page;$.ajax({type:'GET',url:dest,dataType:'json',async:true,success:function(data){var photos=(fSearch.type=='new')?data.photos:data.photos.results;if(photos){$('.listprogress').remove();if(photos.length==0){$('.fr-storage').append('<div class="result-none">No results found</div>');}else{var idx=0,$fHeight=$('.fr-storage .fr-row'),height=[$fHeight.eq(0).height(),$fHeight.eq(1).height(),$fHeight.eq(2).height(),$fHeight.eq(3).height(),];$.each(photos,function(i,v){var set=(i<4)?i:height.indexOf(Math.min.apply(null,height)),r=Math.round(v.height*1080/v.width);var tpl=tplPhoto(v.urls.small,v.user.profile_image.small,v.user.username,v.user.links.html,v.color,v.urls.full,v.urls.raw,v.links.download,v.width,v.height,v.id,fSearch.type,i);height[set]=height[set]+r;$('.fr-storage .fr-row').eq(set).append(tpl);});$('.fr-storage').selectable({filter:" .imgs",cancel:"i,.ui-selected, .user-name",selected:function(event,ui){var files=[],files_path=[],files_size=[],files_seq=[],file='',file_path='',file_size=0,file_seq='';if($(ui.selected).is(".imgs")){file=$(ui.selected).find('.control-area').attr("data-small");id=$(ui.selected).find('.control-area').attr("data-id");urls=new getLocation(file);file=(urls.pathname).replace("/","");file_path='https://'+urls.host+urls.pathname+'?ixlib=rb-0.3.5&q=80&fm=jpg&crop=face&cs=tinysrgb&w=60&h=60&fit=crop';tmp_image='https://'+urls.host+urls.pathname+'?ixlib=rb-0.3.5&q=85&fm=jpg&crop=entropy&cs=srgb';file_size=$(ui.selected).closest('.imgs').find('.resource-file-size').text();file_seq=$(ui.selected).closest('.imgs').find(".resource-file-name").attr("data-seq");var ffloder=$("#resource-files ul[data-source='"+file+"']").attr('data-ffolder');if($(".fr-selected-files").find("li[data-source='"+file+"']").length==0){$(".fr-selected-files").append("<li data-source='"+file+"' data-id='"+id+"' data-ffolder='"+ffloder+"' data-seq='"+file_seq+"' data-size='"+file_size+"'><img src='"+file_path+"'><div class='selected-hover'>&times;<p class='selected-file-name'>"+file+"</p><p class='selected-file-size'>"+file_size+"</p><p class='tmp-image'>"+tmp_image+"</p></div></li>");}}resetFileSelectedFr();},unselected:function(event,ui){if($(ui.unselected).is('.imgs')){if(!event.ctrlKey&&!event.shiftKey){$(".fr-selected-files").empty();}}resetFileSelectedFr();},stop:function(event,ui){if($('.selected-files').children().length!=$('#resource-files').children('.fitem').length){if($('#selectAll').prop('checked'))$('#selectAll').removeAttr('checked');}}});if(fSearch.type=='search'||fSearch.type=='favor'||fSearch.type=='used')fSearch.total=data.photos.total;fSearch.page=fSearch.page+1;if(typeof data.photos.total!='undefined'&&fSearch.type=='search'){if(data.photos.total>0)$('.free-search-result').text(Number(data.photos.total).format());else $('.free-search-result').text('');}}}else{$('.listprogress').remove();$('.fr-storage').append('<div class="result-none text-center">Error get photo lists</div>');}}});}
var tplPhoto=function(src,profile,name,link,color,full,raw,down,width,height,id,type,i){var str='';str='\
        <div class="imgs" data-idx="'+i+'">\
            <div class="fitem">\
                <img src="'+src+'">\
                <div class="control-area" data-color="'+color+'" data-full="'+full+'" data-username="'+name+'" data-raw="'+raw+'" data-full="'+full+'" data-small="'+src+'" data-down="'+down+'" data-userlink="'+link+'" data-width="'+width+'" data-height="'+height+'" data-id="'+id+'" data-color="'+color+'">\
                    <ul>\
                        <li class="fr-search"><i class="fa fa-search"></i></li>\
                        <li class="fr-download"><i class="fa fa-download"></i></li>\
    ';if(type!='used'){str=str+'\
                        <li class="fr-star"><i class="fa fa-star'+((type=='favor')?'':'-o')+'"></i></li>\
        ';}str=str+'\
                    </ul>\
                </div>\
            </div>\
            <div class="user-name">Photo by <a href="'+link+'?utm_source=creatorlink&utm_medium=referral&utm_campaign=api-credit" target="_blank">'+name+'</a></div>\
        </div>\
    ';return str;}
$('.fr-storage .imgs .control-area .fr-search').live('click',function(e){var $popup=$('<div class="photo-popup"></div>'),$close=$('<div class="photo-close"><img src="//i.addblock.net/fa-close-modal-white.png"></div>'),color=$(this).parents('.control-area').attr('data-color'),full=$(this).parents('.control-area').attr('data-full');$popup.append('<img src="'+full+'">');$('.photo-popup').css('background-color',color);if($('.photo-popup').length==0){$('body').append($popup).append($close);$('.photo-popup').css('background-color',color);}$popup.hover(function(){$('.photo-close').show();});resetFileSelectedFr();});$('.fr-storage .imgs .control-area .fr-star').live('click',function(e){var $i=$(this).parents('.control-area'),image={'id':$i.attr('data-id'),'width':$i.attr('data-width'),'height':$i.attr('data-height'),'username':$i.attr('data-username'),'userlink':$i.attr('data-userlink'),'raw':$i.attr('data-raw'),'full':$i.attr('data-full'),'small':$i.attr('data-small'),'down':$i.attr('data-down'),'color':$i.attr('data-color')},$star=$(this).find('i'),$item=$(this).parents('.imgs');$.post('/template/favorite/image',{image:image},function(data){if(data.type=='insert'){$star.removeClass('fa-star-o').addClass('fa-star');}else if(data.type=='delete'){$star.removeClass('fa-star').addClass('fa-star-o');if(fSearch.type=='favor'){var idx=$item.attr('data-idx');$.each($('.fr-storage .imgs'),function(i,v){var cidx=$(this).attr('data-idx');if(cidx==idx)$(this).remove();if(idx<cidx)$(this).attr('data-idx',Number(cidx)-1);});fSearch.total=fSearch.total-1;rePaintFavor();}}},'json');});$('.fr-storage .imgs .control-area .fr-download').live('click',function(e){var $i=$(this).parents('.control-area'),down=$i.attr('data-down');window.open(down+'?force=true','_blank');});$('.photo-popup, .photo-close').live('click',function(e){$(this).addClass('down');setTimeout(function(){$('.photo-close').remove();$('.photo-popup').remove();},400);});$('.fr-storage').live({mousemove:function(){$(this).scroll(function(){var listScroll=$('.fr-storage').scrollTop();if((this.scrollTop+this.clientHeight)>(this.scrollHeight-100)){if((fSearch.type=='search'||fSearch.type=='favor'||fSearch.type=='used')&&fSearch.total!=0){var items=$('.fr-storage .imgs').length;if(fSearch.total==items){return false;}}if($('.fr-storage').find('.listprogress').length==0){$('.fr-storage').append('<div class="listprogress" style="width: 100%; min-height: 40px; text-align:center; padding-top:10px;"><svg version="1.1" xmlns="http://www.w3.org/svg/2000" viewBox="0 0 30 30" width="60" style="width:30px; height: 30px;"><circle cy="15" cx="15" r="14" style="stroke:#00baff;"></circle></svg></div>');getFreeImage(fSearch.page,fSearch.type,fSearch.text);}}});}});$('div.render').live('click',function(e){e.preventDefault();return false;});var setContentImages=function(seq,files,col){var images=files.split("|"),j=Number(selectPOS);var id=addContents(seq,Number(selectPOS)),element=$('.element[data-id="'+id+'"]').attr('data-el'),pn="image-change";for(var i=0;i<images.length;i++){if(i%Number(col)==0&&i>0){j=j+1;id=addContents(seq,j),element=$('.element[data-id="'+id+'"]').attr('data-el');}selectEL=element;selectID=id;elementUpdate(element,pn,images[i],i%Number(col),false);if(i%Number(col)==1){var type=getElementType();setLogs(type,"block.add.false","block-add-false",type);}}}
var addContentImages=function(seq,files){var images=files.split("|");for(var i=0;i<images.length;i++){var id=addContents(seq,Number(selectPOS)+Number(i)),element=$('.element[data-id="'+id+'"]').attr('data-el'),pn="image-change",idx=0;selectEL=element;selectID=id;elementUpdate(element,pn,images[i],idx,false);var type=getElementType();setLogs(type,"block.add.false","block-add-false",type);}}
var galleryResourceUpdate=function(seq,files){$.post('/template/gallery/resource-update',{seq:seq,file:files},function(data){checkError(data);},'json');showPage(MCSS,MSTYLE,MTAG,true);activeEL(selectEL,true);}
var addContents=function(elid,selectPOS){var seq=0;selectPOS=(typeof selectPOS=='undefined'||!selectPOS)?0:selectPOS;$.post('/template/update/type/el-insert',{s:elid,id:SID,page:PAGE,pos:selectPOS},function(data){checkError(data);seq=data.insertID;if(data.insertID){var idx=0,block={};$.each(data.el,function(i,v){if(v.seq!=data.insertID){var cls=$('.element[data-id="'+v.seq+'"]').attr('class');match=cls.match(/el_\d{0,3}/);cls=cls.replace(/el_\d{0,3}/,"el_"+i);$('.element[data-id="'+v.seq+'"]').attr('class',cls);$('.element[data-id="'+v.seq+'"]').attr('data-pos',i+1).attr('data-el','el_'+i);$('.config-element-section[data-id="'+v.seq+'"]').attr('class','config-element-section el_'+i+'_ctrl');$('#'+match+'css').attr('id','el_'+i+'css');}else{idx=i;block=v;}});addSelectBlock(idx,block,function(){setTimeout(function(){},100);});COUNT++;}},'json');addController('hide');return seq;}
var scrollToBottom=function(callback){if(typeof callback=="function"){callback();}$(".dsgn-body").animate({scrollTop:$('.dsgn-body').prop('scrollHeight')},"fast");return false;}
var closeAddContent=function(){$('.add-element').removeClass('slideUp');}
var viewmode=function(mode){$.cookie('mode',mode);if(mode=='view'){$('.dsgn-body').addClass('view-mode');$('.add-footer-information').hide();$('.editor-navbar').slideUp('fast',function(){$('.dsgn-body').removeClass('navbar-margin').css('min-height','100%').find('.element').removeClass('element').removeClass('el-active').addClass('element-disable');$('.view-controller').fadeIn('200');menuConfigToggle('close');if($('#el-site-config').css('top')>0)siteConfigToggle('close');hideConfigPanel();($('.header.el-menu').hasClass('fixed')&&!$('.header.el-menu').hasClass('sidebar'))?$('.fixed').addClass('fixed-position'):$('.fixed').removeClass('fixed-position');$('.config-element-section').hide();$('.el-footer.disable').hide();});internalLink=true;}else{$('.dsgn-body').removeClass('view-mode');$('.el-footer.disable').show();$('.add-footer-information').show();if(selectEL)elementEnter();if($('.dsgn-body').width()>767){$(".view-controller").fadeOut('200',function(){$('.editor-navbar').slideDown('fast');$('.dsgn-body').addClass('navbar-margin').css('min-height','').find('.element-disable').removeClass('element-disable').addClass('element');($('.header.el-menu').hasClass('fixed')&&!$('.header.el-menu').hasClass('sidebar'))?$('.fixed').removeClass('fixed-position'):$('.fixed').addClass('fixed-position');});}internalLink=false;}}
var updateOutputFolder=function(e){var list=e.length?e:$(e.target),output=list.data('output');if(window.JSON&&list.attr('class')=='dd'){output.val(window.JSON.stringify(list.nestable('serialize')));}else{if(typeof output!="undefined")output.val('JSON browser support required');}if(SID){$.post('/template/update/type/folder',{s:$('#nestableFolder-output').val(),id:SID,page:PAGE},function(data){checkError(data);},'json');}}
var updateOutput=function(e){var list=e.length?e:$(e.target),output=list.data('output');if(window.JSON&&list.attr('class')=='dd'){output.val(window.JSON.stringify(list.nestable('serialize')));}else{if(typeof output!="undefined")output.val('JSON browser support required');}if(SID){$.ajax({url:'/template/update/type/menu?'+Math.random(),data:{s:$('#nestable-output').val(),id:SID,page:PAGE},dataType:'json',type:'POST',async:false,cache:false,success:function(data){checkError(data);}});}liveUpdate(jQuery.parseJSON($('#nestable-output').val()));setLoginout(LOGINOUT);};function liveUpdate(obj){var menu=$('#tpl-menu'),idx=0,regex=/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/,regex2=/^((http(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/;SMENU=obj;menu.empty();MENULINK=[];MENULIST=[];$.each(SMENU,function(idx,obj){MENULIST.push(obj.name.replace(/ /g,'-'));if(obj.children){$.each(obj.children,function(idx,obj){MENULIST.push(obj.name.replace(/ /g,'-'));});}});for(i=0;i<obj.length;i++){var link=obj[i].name,link=link.replace(/ /g,"-"),parent=PAGE.split(","),link_text='',target='',isBookmark='';if(i==0){if(obj[i].display=='on')MENULINK.push(link);continue;}var active=(link==PAGE||link==parent[0])?"active":"",sub=obj[i].children.length;if(ONE){linkUrl='#';linkUrl=(VIEW)?'/config/page/view/index#':'#';}else{linkUrl="/config/page/";}if(obj[i].display=='on'){MENULINK.push(link);link=(obj[i].link)?obj[i].link.replace(/ /g,"-"):link;isBookmark=(link.match(/^\@/g))?"attr-bookmark='"+link.replace(/^\@/g,"")+"'":"";target=(obj[i].ltarget=='_blank')?"target='_blank'":"";if(sub){var sub_menu='',sub_show=0;sub_menu="<ul class='dropdown-menu'>\r\n";for(j=0;j<obj[i].children.length;j++){var child=obj[i].children,child_link=(child[j].link)?child[j].link.replace(/ /g,"-"):'',child_isBookmark=(child_link.match(/^\@/g))?"attr-bookmark='"+child_link.replace(/^\@/g,"")+"'":"",sub_link=(child_link)?child_link:child[j].name.replace(/ /g,"-"),sub_target=(child[j].ltarget=='_blank')?"target='_blank'":"";if(!active){active=(sub_link==PAGE&&!active)?"active":"";}if(child[j].display=="on"){MENULINK.push(child[j].name.replace(/ /g,"-"));link_text=(MENULIST.indexOf(sub_link)>-1)?linkUrl+sub_link:(!regex2.test(sub_link)&&regex.test(sub_link))?'//'+sub_link:sub_link;sub_menu=sub_menu+"<li><a href='"+link_text+"' "+sub_target+" "+child_isBookmark+">"+child[j].name+"</a></li>\r\n";sub_show++;}}sub_menu=sub_menu+"</ul>\r\n";if(link=='folder-menu'){link_text='javascript:;';target='';if(typeof menu.closest('.navbar-menu-'+SID).attr('data-submenu')!='undefined')target=" data-toggle='dropdown' aria-expanded='false' data-submenu='true' ";}else{link_text=(MENULIST.indexOf(link)>-1)?linkUrl+link:(!regex2.test(link)&&regex.test(link))?'//'+link:link;}var caret=($('header.navbar').hasClass('sidebar'))?" <i class='fa fa-caret-right fa-1' aria-hidden='true'></i>":" <i class='fa fa-caret-down fa-1' aria-hidden='true'></i>";if(sub_show){menu.append("<li class='"+active+" dropdown'><a href='"+link_text+"' class='dropdown-toggle' "+target+" "+isBookmark+">"+obj[i].name+caret+"</a></li>\r\n");}else{menu.append("\r\n<li class='"+active+"'><a href='"+link_text+"' "+target+" "+isBookmark+">"+obj[i].name+"</a></li>");}if(sub_show)menu.find(".dropdown:last").append(sub_menu);}else{if(link=='folder-menu'){link_text='javascript:;';target='';if(typeof menu.closest('.navbar-menu-'+SID).attr('data-submenu')!='undefined')target=" data-toggle='dropdown' aria-expanded='false' data-submenu='true' ";}else{link_text=(MENULIST.indexOf(link)>-1)?linkUrl+link:(!regex2.test(link)&&regex.test(link))?'//'+link:link;}menu.append("<li class='"+active+"'><a href='"+link_text+"' "+target+" "+isBookmark+">"+obj[i].name+"</a></li>\r\n");}idx++;}}$(".url-link").empty();for(i=0;i<MENULINK.length;i++){$('.url-link').append("<p value='/"+MENULINK[i]+"'><i class='fa fa-file-text-o'></i> &nbsp;"+MENULINK[i].replace(/-/g," ")+"</p>");}$('#tpl-menu').children().first().find('a').attr('data-selector','ul.navbar-nav > li > a').attr('data-font','true').attr('data-title',$.lang[LANG]['config.menu.font']);}var makeMenuList=function(s){var depth=0,str='';menu=function(level,depth){str=str+'<ol class="dd-list">';$.each(level,function(idx,obj){if(idx==0){if(depth==0)str=str+addFirstMenu(obj.name,obj.display,obj.lock);else str=str+addMenu(obj.name,obj.display,obj.lock,obj.link,obj.ltarget,1,false,false);}else{str=str+addMenu(obj.name,obj.display,obj.lock,obj.link,obj.ltarget,1,false,false);}if(obj.children)menu(obj.children,depth+1);str=str+"</li>";});str=str+'</ol>';return str;}
return menu(s,depth);};var addFirstMenu=function(name,display,lock){var menu='',menu_name=(name=='INTRO')?$.lang[LANG]['editor.intro-menu']:name,visible=(display=='on')?"visible":"invisible";lock=(typeof lock=='undefined'||!lock)?"":lock;lock_active=(lock)?"active":"";menu=""+"<li class='dd-first' data-id='"+name+"'>\n"+"   <span class='pull-right'><i class='fa fa-lock menu-lock hand "+lock_active+"' attr-lock='"+lock+"'></i></span>\n"+"   <span class='pull-right'><img src='//i.addblock.net/icon/icon-menu-"+visible+".png' class='menu-visible hand menu-onoff' id='intro-onoff' attr-val='"+display+"'></span>\n"+"   <div class='dd-handle-first'><span class='menu-name' data-lang='editor.intro-menu'>"+menu_name+"</span></div>\n"+"</li>";return menu;}
var addMenu=function(name,display,lock,link,ltarget,init,view,linkview){var mName=name,on,off,edit;edit=(typeof view=='undefined'||!view)?"none":"block";edit_link=(typeof linkview=='undefined'||!linkview)?"none":"block";link=(typeof link=='undefined'||!link)?"":link;ltarget=(typeof ltarget=='undefined'||!ltarget)?"":ltarget;lock=(typeof lock=='undefined'||!lock)?"":lock;mName=mName.replace(/ /g,"-");visible=(display=='on')?"visible":"invisible";var pageID=PAGE.split(",");active=(pageID[0]==name.replace(/ /g,"-"))?" active":"";link_active=(link)?"active":"";lock_active=(lock)?"active":"";var menu='';menu=menu+'<li class="dd-item'+active+'" data-id="'+name+'">\n';menu=menu+' <span class="pull-right"><img src="//i.addblock.net/icon/icon-menu-delete.png" class="menu-remove hand"></span>\n';menu=menu+' <span class="pull-right"><i class="fa fa-pencil menu-edit hand"></i></span>\n';menu=menu+' <span class="pull-right"><i class="fa fa-link menu-link hand '+link_active+'" attr-link="'+link+'" attr-ltarget="'+ltarget+'"></i></span>\n';menu=menu+' <span class="pull-right"><i class="fa fa-lock menu-lock hand '+lock_active+'" attr-lock="'+lock+'"></i></span>\n';menu=menu+' <span class="pull-right"><img src="//i.addblock.net/icon/icon-menu-'+visible+'.png" class="menu-visible hand menu-onoff" attr-val="'+display+'"></span>\n';menu=menu+' <div class="dd-handle">\n';menu=menu+'     <span class="pull-left move-icon"><img src="//i.addblock.net/icon/icon-menu-move.png" class="hand move"><img src="//i.addblock.net/icon/icon-menu-move_over.png" class="hand move active"></span>\n';menu=menu+'     <span class="menu-name">'+name+'</span>\n';menu=menu+' </div>\n';menu=menu+' <div class="menu-link-text" style="display:none;">\n';menu=menu+'     <div class="input-group">\n';menu=menu+'         <span class="input-group-addon">http://</span>\n';menu=menu+'         <input type="text" class="menu-link-input form-control" data-name="'+mName+'">\n';menu=menu+'         <span class="input-group-btn">\n';menu=menu+'             <button class="menu-link-save btn btn-default btn-primary" type="button" data-name="'+mName+'"><i class="fa fa-check"></i></button>\n';menu=menu+'         </span>\n';menu=menu+'     </div>\n';menu=menu+'     <div class="menu-link-cancel"><i class="fa fa-times"></i></div>\n';menu=menu+' </div>\n';menu=menu+' <div class="menu-edit-text" style="display:'+edit+';">\n';menu=menu+'     <div class="input-group">\n';menu=menu+'         <input type="text" class="menu-edit-input form-control" data-name="'+mName+'" maxlength="35" placeholder="'+$.lang[LANG]['editor.menu.input-name']+'">\n';menu=menu+'         <span class="input-group-btn">\n';menu=menu+'             <button class="menu-edit-save btn btn-default btn-primary" type="button" data-name="'+mName+'"><i class="fa fa-check"></i></button>\n';menu=menu+'         </span>\n';menu=menu+'     </div>\n';menu=menu+'     <div class="menu-edit-cancel"><i class="fa fa-times"></i></div>\n';menu=menu+' </div>\n';if(typeof init=='undefined')menu=menu+'</li>\n';return menu;};var makeMenuLinkList=function(s,type,id,prev_link){var depth=0,str='',isActive='';if(type=="menu"){menu=function(level,depth){$.each(level,function(idx,obj){if(obj.name==id&&obj.children)menu(obj.children,depth+1);if(depth!=0){isActive=(prev_link==obj.name)?'active':'';str=str+"<li data-userlink='"+obj.name+"' class='"+isActive+"'><a href='javascript:;'>"+obj.name+"</a></li>";}});return str;}
return menu(s,depth);}if(type=="image"||type=="gallery"){menu=function(level,depth){$.each(level,function(idx,obj){isActive=(prev_link==obj.name)?'active':'';if(depth==0){if(idx==0&&obj.name=='INTRO'){if(obj.display=='on'){str=str+"<li data-userlink='"+obj.name+"' class='"+isActive+"'><a href='javascript:;'>"+obj.name+"</a></li>";}}else{str=str+"<li data-userlink='"+obj.name+"' class='"+isActive+"'><a href='javascript:;'>"+obj.name+"</a></li>";}}else{str=str+"\
                    <li data-userlink='"+obj.name+"' class='"+isActive+"'>\
                        <a href='javascript:;'><i class='fa fa-level-up'></i>"+obj.name+"</a>\
                    </li>";}if(obj.children)menu(obj.children,depth+1);});return str;}
return menu(s,depth);}};$('.menu-edit-cancel').live('click',function(){menuEdit=false;if($('#nestable > .dd-list').children().last().attr('data-id')=='menu-added'){$('#nestable > .dd-list').children().last().remove();}else{$(this).parents('.menu-edit-text').hide();}$('#menu-add').show();});var setTplmenu=function(name){updateOutput($('#nestable').data('output',$('#nestable-output')));};var elUpdate=function(el,pn,val,path){var ss=(selectEL=='el-menu')?$('#menu-'+SID):$('#'+el+'css'),j=CSSJSON.toJSON(ss.text());selector=(selectEL=='el-menu')?'menu-'+SID:$('.'+el).attr('data-name'),eid=(selectEL=='el-menu')?"menu":$('.'+el).attr('data-id'),e=$('.'+el);p=(typeof path!='undefined'&&path)?path:RESOURCE+'/'+SID;r=style.get(j,selector);rc=style.set(j,r,selector,pn,val,p);ss.text(CSSJSON.toCSS(rc));var css=(selectEL=='el-menu')?JSON.stringify(rc):ss.text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:eid},function(data){checkError(data);if(eid=='menu'){MCSS=$.parseJSON(css);}},'json');if(selectEL=='el_0'&&$('.'+selectEL).attr('data-type')=='project'&&pn=='background-image'){if($('.'+selectEL).hasClass('data-project-image-bg')){$.post('/template/element/type/update-projectData/seq/'+eid,{sid:SID,gid:VIEW,pid:PARENT['pid'],image:val},function(data){checkError(data);},'json');}}}
var elPush=function(prop){var pageID=PAGE.split(","),chgBG=false,saved=false,d=new Date(),now=d.getTime(),tmpTag='',pid=0,default_t_css='',default_m_css='';$.getJSON('/template/contents/sid/'+SID+'/page/'+encodeURIComponent(PAGE)+'?_'+now,function(data){checkError(data);$(".dsgn-body").children().filter(function(){return this.className.match(/el_\d{0,3}/);}).each(function(){var cssRemove=this.className.match(/el_\d{0,3}/)[0];$('#'+cssRemove+'css').remove();$(this).remove();});$('#el-empty').empty();var $loading=$('.processModal');$.each(data,function(idx,val){if($loading.length){$loading.find('p').text('Loading... '+(idx+1)+'/'+data.length+1);}var tag=htmlspecialchars_decode(val.eltag),gallery_empty=true;if(val.type=="gallery"){$('#el-empty').append($(tag));$('#el-empty').find('[data-loop="true"]').html('');var nodes=$(tag).find('[data-loop="true"]').children(),p=$('#el-empty').children(),i=[],view=$(tag).find("[data-loop='true']").data('view'),total=0;if(typeof view=="undefined")view=10;var cookie_page=1,cookie_view=view;cookie_gallery_category='',is_gc_cookie=(typeof $.cookie('gallery-category-'+val.seq)!='undefined'&&$.cookie('gallery-category-'+val.seq).length>0)?true:false;if(typeof $.cookie('loadmore-'+val.seq)!='undefined'&&$.cookie('loadmore-'+val.seq).length>0){cookie_page=$.cookie('loadmore-'+val.seq);cookie_gallery_category=(typeof $.cookie('gallery-category-'+val.seq)!='undefined')?$.cookie('gallery-category-'+val.seq):'';$.cookie('gallery-page-'+val.seq,cookie_page,{path:'/',expires:12*60*60*1000});$.cookie('gallery-category-'+val.seq,cookie_gallery_category,{path:'/',expires:12*60*60*1000});cookie_view=cookie_page*view;$.removeCookie('loadmore-'+val.seq,{path:'/'});}else{$.cookie('gallery-page-'+val.seq,1,{path:'/',expires:12*60*60*1000});$.cookie('gallery-category-'+val.seq,cookie_gallery_category,{path:'/',expires:12*60*60*1000});}$.ajax({url:'/template/gallery/list/pid/'+val.seq+'/sid/'+SID+'/spage/'+PAGE+'/mode/design/view/'+cookie_view,data:{sfl:'category',stx:unescape(cookie_gallery_category)},dataType:'json',type:'POST',async:false,cache:false,success:function(data){$.each(data.list,function(idx,v){i.push(v);});total=data.total.list_total;cookie_view=(cookie_view<total)?cookie_view:total;if(total>0)gallery_empty=false;if(i.length>0||(i.length==0&&is_gc_cookie)){var loop_count=nodes.length,item_index=0;var elem=[]
$.each(i,function(index,v){loop_pos=index%loop_count;c=nodes[loop_pos];v.title=(v.title.length>0)?v.title:'Title';v.caption=(v.caption.length>0)?v.caption:'You can change this text';$(c).addClass('gallery-item').attr('data-index',index).attr('data-seq',v.seq);var vgsettings=(typeof v.gsettings!='undefined'&&v.gsettings)?$.parseJSON(v.gsettings):{},img_path=(vgsettings&&typeof vgsettings['storage']!='undefined')?vgsettings['storage']:RESOURCE+"/"+SID+"/",img_original=(vgsettings&&typeof vgsettings['storage']!='undefined')?img_path+'1920/':img_path;$(c).find('img').attr("src",img_path+val.folder+"/"+v.image);if(typeof vgsettings['glink']!='undefined'&&vgsettings['glink']){var glink=vgsettings['glink'],glink_val=(glink)?makeLinkUrl(glink,ONE,VIEW):'';$(c).find('a').attr('href',glink_val);$(c).find('a').removeAttr('data-gallery');if(MENULIST.indexOf(glink.replace(/ /g,'-'))>-1){$(c).find('a').attr('data-user-link',glink_val);}else if(glink.match(/^\@/g)){$(c).find('a').attr('attr-bookmark',glink);}else{$(c).find('a').attr('attr-link',glink);}}else{$(c).find('a').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');if(val.mode=="gallery"){$(c).find('a').attr("href",img_original+v.image);$(c).find('a').attr('data-gallery','#gframe-'+val.seq);}else{$(c).find('a').removeAttr('data-gallery');$(c).find('a').attr("href","/config/page/"+PAGE+"/view/"+v.seq);}}if(typeof vgsettings['glink_target']!='undefined'&&vgsettings['glink_target']=='_blank')$(c).find('a').attr('target','_blank');else $(c).find('a').removeAttr('target');$(c).find('a').attr("data-title",v.title).attr('title',v.title);var ftitle=$(c).find('h5.figure'),fcaption=$(c).find('p.figure'),fdatetime=$(c).find('.figure.datetime'),fhashtag=$(c).find('.figure.hashtag');if(fdatetime.length<1){$(c).find('figcaption').append("<div class='figure datetime hide'></div>");fdatetime=$(c).find('.figure.datetime');}if(fhashtag.length<1){$(c).find('figcaption').append("<div class='figure hashtag hide'></div>");fhashtag=$(c).find('.figure.hashtag');}$(c).find('figcaption').removeClass('hide');if(v.title||v.caption){ftitle.text(v.title);var gallery_caption=v.caption;gallery_caption=gallery_caption.replace(/\n/g,"<br />");fcaption.html(gallery_caption);fcaption.removeClass('hide');fdatetime.text(v.datetime);fhashtag.text(v.hashtag);}$(p).find('[data-loop="true"]').append($(c)[0].outerHTML);});}else{nodes.find('a').addClass('emptyGalleryItem').attr('href',"/config/page/"+PAGE+"/view/template").removeAttr('data-gallery').find('img').attr('data-index',0);$(p).find('[data-loop="true"]').append(nodes);}tag=$(p)[0].outerHTML;if(val.mode=="gallery"&&total)tag=appendGalleryFrame($(tag),val.seq,val.elsettings);$('#el-empty').empty();}});}else{if(typeof pageID[1]!="undefined"&&(idx==0&&COUNT==0||idx==1&&COUNT==1)&&pageID[1]!='template'){saved=true;d=document.createElement('div');$(d).addClass('temp-element').html(tag);var pTitle=(PARENT.title)?PARENT.title:"Title",pCaption=(PARENT.caption)?PARENT.caption:"You can change this text";pCaption=pCaption.replace(/\n/g,"<br />");$(d).find('.data-date').text(PARENT.datetime);$(d).find('.data-category').text(PARENT.category);$(d).find('h5.figure').text(pTitle);$(d).find('p.figure').html(pCaption);tag=$(d).html();$(d).remove();tmpTag=tag;if(idx==0&&COUNT==0||idx==1&&COUNT==1){$.ajax({type:'POST',url:'/template/element/type/update-text/seq/'+val.seq,data:{tag:tmpTag,sid:SID},async:false});}}}if(saved)COUNT++;var $style_tag=$('<style type="text/css"></style>');$style_tag.attr('id',"el_"+idx+"css");if(typeof pageID[1]!="undefined"&&idx==0&&pageID[1]!='template'&&VIEW&&val.type2==''){$.post('/template/element/type/get-projectData/seq/'+val.seq,{sid:SID,gid:VIEW,pid:PARENT['pid']},function(data){if(data.data[0]){saved=true;var isPHBG=false,isPHBGclass=false;d=document.createElement('div');$(d).addClass('temp-element').html(tag);if(data.data[0].title.length>0)$(d).find('*[data-project-title]').html(data.data[0].title);if(data.data[0].description.length>0)$(d).find('*[data-project-description]').html(data.data[0].description);tag=$(d).html();$(d).remove();tmpTag=tag;if(data.data[0].title.length==0&&data.data[0].description.length==0){saved=false;}if(saved){$.ajax({type:'POST',url:'/template/element/type/update-text/seq/'+val.seq,data:{tag:tmpTag,sid:SID},async:false});}if(isPHBG){var elstyle=CSSJSON.toJSON(htmlspecialchars_decode(val.elcss));var elselector=(isPHBGclass)?'.userEL'+val.seq:'.userEL'+val.seq+' .data-project-image-bg';elstyle=style.setCssProperty(elstyle,elselector,'background-image','url("'+src+'")');val.elcss=CSSJSON.toCSS(elstyle);var elcss=val.elcss;if(saved){$.ajax({type:'POST',url:'/template/update/type/el-css',data:{id:SID,s:elcss,seq:val.seq},async:false});}}}},'json');var elstyle=CSSJSON.toJSON(htmlspecialchars_decode(val.elcss));if(chgBG){elstyle=style.setCssProperty(elstyle,'.'+val.elname+' '+target,'background-image','url("'+RPATH+PARENT.image+'")');val.elcss=CSSJSON.toCSS(elstyle);var elcss=val.elcss;if(COUNT==0){$.ajax({type:'POST',url:'/template/update/type/el-css',data:{id:SID,s:elcss,seq:val.seq},async:false});}}}$style_tag.html(htmlspecialchars_decode(val.elcss));$('#dsgn-'+SID).after($style_tag);var $tag=$(tag);$.each($tag.find('[data-edit="true"]'),function(i,v){var source=$(this).html();source=source.replace(/&lt;&nbsp;/g,"&lt;").replace(/&nbsp;&gt;/g,"&gt;");$(this).html(source);});if(val.type=="gallery"&&total>view&&total>cookie_view){btn_class=(val.feature=='masonry')?"gallery-loadmore masonry-layout":"gallery-loadmore";$tag.find('.'+btn_class).remove();$tag.append('<div class="'+btn_class+'" data-total = "'+total+'" data-id="'+val.seq+'" data-page="'+(Number(cookie_page)+1)+'" data-view="'+view+'" data-folder="'+val.folder+'" data-mode="'+val.mode+'">LOAD MORE &nbsp;(<span class="display">'+cookie_view+'</span> / '+total+')</div>');}msny=(val.feature=='masonry')?true:false;$tag.addClass('el_'+idx).attr('data-id',val.seq).attr('data-el','el_'+idx).attr('data-pos',val.pos).attr('data-name',val.elname).attr('data-msny',msny).attr('data-type',val.type).attr('data-type2',val.type2).attr('data-mode',val.mode).attr('data-width',val.folder).attr('data-overlap',val.overlap);if(ONE&&val.orgpos==1){$tag.attr('data-link',val.orgpage);}if(val.type=='sns'&&val.type2=='feed'){$tag.find('.data-feed-load-more').attr('data-feed-el',val.elname);$tag.find('.data-feed-load-more').removeAttr('style');$tag.find('.show-posts').removeClass('show-posts');}var settings=(val.elsettings==""||typeof val.elsettings=="undefined")?{}:$.parseJSON(val.elsettings);if(typeof settings.bookmark!="undefined"&&settings.bookmark){$tag.attr('data-bookmark',val.seq);}if(val.type=='gallery'){var category_onoff=(typeof settings.category_display=="undefined")?"OFF":settings.category_display;$tag.attr('data-category',category_onoff);}if(VIEW){var img_onoff=(typeof settings.img_original_display=="undefined")?"OFF":settings.img_original_display;$tag.find('img[data-attach="true"]').attr('data-img-original',img_onoff);}$tag.find('[data-map="true"]').attr('id','map-'+val.seq);setPanelTranslate($tag);$tag.addClass('element');var map_url=$tag.find('[data-map="true"]').attr('data-url');$tag.removeClass(function(i,css){return(css.match(/link-to-\S+/g)||[]).join(' ');});if(val.orgpos==1||(PARENT.page&&idx==0)){var setPage=(val.orgpage)?val.orgpage:PARENT.page;if(setPage!==null)$tag.addClass('link-to-'+setPage.replace(/ /g,"-"));}var $cog=$('<div class="el_'+idx+'_ctrl config-element-section" data-id="'+val.seq+'"><div class="config-element"><img src="//i.addblock.net/icon/fa_config_icon.png"></div>');$cog.appendTo('.dsgn-body');(val.type=='gallery'&&total==0)?$tag.addClass('emptyGallery'):$tag.removeClass('emptyGallery');$.each($tag.find('[data-edit="true"]'),function(i,v){$(this).css('z-index','');});$tag.appendTo('.dsgn-body');if(val.type=='gallery'&&category_onoff=="ON"){loadGalleryCategoryBlock($tag,val.seq,'',settings);if(gallery_empty&&!is_gc_cookie)$tag.find('.gallery-category-nav').addClass('empty');}if(val.type=="forum"){var view=$tag.find('[data-loop="true"]').attr('data-view');if(typeof view=="undefined")view=10;if(typeof $.cookie('forum_'+val.seq)!="undefined"&&$.cookie('forum_'+val.seq))$.forum.init(val.seq,PAGE,view,$.cookie('forum_'+val.seq),$.cookie('forum_'+val.seq+'_sfl'),$.cookie('forum_'+val.seq+'_stx'));else
$.forum.init(val.seq,PAGE,view);$.removeCookie('forum_'+val.seq,{path:'/'});$.removeCookie('forum_'+val.seq+'_sfl',{path:'/'});$.removeCookie('forum_'+val.seq+'_stx',{path:'/'});}else if(val.type=="sns"&&val.type2=="feed"){if(typeof settings.sns!="undefined"&&(settings.sns.twitter||settings.sns.instagram)){updateFeed(val.elname,settings.sns);loadingElement(val.elname,'loading posts...');}}if(val.type=="others"&&val.type2=="countdown"){var el_dday=$tag.find('[data-dday="true"]'),cd_date=(el_dday.attr('data-countdown'))?el_dday.attr('data-countdown'):new Date(),dateformat={days:'%D',hours:'%H',minutes:'%M',seconds:'%S'},dateendformat={days:'00',hours:'00',minutes:'00',seconds:'00'};if(val.elsettings.indexOf('countdown')>0){var elsettings=(val.elsettings=="")?{}:$.parseJSON(val.elsettings);if(typeof elsettings.countdown!="undefined"&&elsettings.countdown){cd_date=elsettings.countdown;}}if(!el_dday.attr('data-countdown')&&typeof cd_date=="object"){cd_date.setTime(cd_date.getTime()+(35*24*60*60*1000));}cd_date=moment(cd_date).format('YYYY/MM/DD HH:mm:ss');el_dday.find('.date-item').each(function(){if(typeof $(this).attr('data-format')!='undefined'&&$(this).attr('data-format')){dateformat[$(this).attr('data-datetype')]=$(this).attr('data-format');}if(typeof $(this).attr('data-finish')!='undefined'&&$(this).attr('data-finish')){dateendformat[$(this).attr('data-datetype')]=$(this).attr('data-finish');}});el_dday.countdown(cd_date,function(event){if(event.elapsed){$(this).find('.date-item[data-datetype="days"]').text(dateendformat['days']);$(this).find('.date-item[data-datetype="hours"]').text(dateendformat['hours']);$(this).find('.date-item[data-datetype="minutes"]').text(dateendformat['minutes']);$(this).find('.date-item[data-datetype="seconds"]').text(dateendformat['seconds']);}else{$(this).find('.date-item[data-datetype="days"]').text(event.strftime(dateformat['days']));$(this).find('.date-item[data-datetype="hours"]').text(event.strftime(dateformat['hours']));$(this).find('.date-item[data-datetype="minutes"]').text(event.strftime(dateformat['minutes']));$(this).find('.date-item[data-datetype="seconds"]').text(event.strftime(dateformat['seconds']));}});}if(typeof map_url!='undefined'){map_style=$tag.find('[data-map="true"]').attr('data-style');loadmap(map_url,'map-'+val.seq,map_style);}if(val.eljs){var js_string=val.eljs;var $script_tag=$('<script type="text/javascript"></script>');$script_tag.html(js_string);$('.dsgn-body').append($script_tag);}var jcss=CSSJSON.toJSON($style_tag.text());var elpd=style.getPadding(jcss,val.elname);var pt=parseInt(elpd.top),pb=parseInt(elpd.bottom);if(pt>0||pb>0){default_t_css=default_t_css+'.'+val.elname+'{';if(Math.ceil(pt*0.8)>0)default_t_css=default_t_css+'padding-top: '+Math.ceil(pt*0.8)+'px!important;';if(Math.ceil(pb*0.8)>0)default_t_css=default_t_css+'padding-bottom: '+Math.ceil(pb*0.8)+'px!important;';default_t_css=default_t_css+'}';default_m_css=default_m_css+'.'+val.elname+'{';if(Math.ceil(pt*0.5)>0)default_m_css=default_m_css+'padding-top: '+Math.ceil(pt*0.5)+'px!important;';if(Math.ceil(pb*0.5)>0)default_m_css=default_m_css+'padding-bottom: '+Math.ceil(pb*0.5)+'px!important;';default_m_css=default_m_css+'}';}if(idx==data.length-1){var css="@media only screen and (max-width:768px) {\
                            "+default_t_css+"\
                        }\
                        @media only screen and (max-width:480px) {\
                            "+default_m_css+"\
                        }\
                    ";$('#dsgn-'+SID).append(css);}});$('.dsgn-body').fitVids();enableCarousel();elSortable();if(selectID)$('.panel[data-id="'+selectID+'"]').find('.panel-heading').addClass('active');if(data.length==0){}else $('.dsgn-body').removeClass('element');$('.font-slider').slider().on('slide',function(ev){$('#dsgn-body-font-size').text(ev.value);}).on('slideStop',function(ev){var el=(selectEL=='el-menu')?$("header"):$('.'+$(this).attr('el')),pn=$(this).attr('pn');$('#dsgn-body-font-size').text(ev.value);$('.dsgn-body').css('font-size',ev.value+'px');setStyleCss('.dsgn-body','font-size',ev.value+'px');});$('.data-page-prev').addClass('active');$('.data-page-next').addClass('active');if(PARENT.prev===null)$('.data-page-prev').removeClass('active');if(PARENT.next===null)$('.data-page-next').removeClass('active');if(VIEW&&typeof pageID[1]!="undefined"&&COUNT==1){var default_img="\
                <div class='default_project_contents'>\
                    <div class='container'>\
                        <div class='row' style='padding:30px 0;'>\
                            <div class='col-xs-12 col-sm-12 col-md-12'>\
                                <div class='image-wrap'><img src='//storage.googleapis.com/i.addblock.net/icon/project_add_info_contents.png' class='img-responsive' data-attach='true'/></div>\
                                <h1 class='text-center'>"+$.lang[LANG]['config.gallery.type.project.addcontents']+"</h1>\
                            </div>\
                        </div>\
                    </div>\
                </div>\
            ";$('.element[data-type="project"]').after(default_img);}$('.element').find('[data-fixed-width]').each(function(){$(this).css('width',$(this).attr('data-fixed-width')+'px');});funcCallback(elFooter,function(){displayComment(VIEW);if(VIEW&&PAGE.split(",")[0]!='forum'){funcCallback(displayPageToolbar,function(){displaySnsShare(PARENT.pid);});}if(VIEW)displayBottomList(PARENT.pid);});funcCallback(displayEmptyAddblock);});};var displayComment=function(pid){var option=(PARENT.settings)?jQuery.parseJSON(PARENT.settings):{};if(typeof option.comment_display=="undefined"||!option.comment_display||option.comment_display=="OFF")return false;var checkUrl=PAGE.split(","),type=(checkUrl[0]=="forum")?"F":"P";$.comment.init({pid:pid,type:type});}
var displaySnsShare=function(pid){var option=(PARENT.settings)?jQuery.parseJSON(PARENT.settings):{};if(typeof option.sns_share_display=="undefined"||!option.sns_share_display)return false;else if(option.sns_share_display=='ON'){$('.tpl-page-footer').removeClass('hide');}}
var displayBottomList=function(pid){var option=(PARENT.settings)?jQuery.parseJSON(PARENT.settings):{};if(typeof option.bottomlist_display=="undefined"||!option.bottomlist_display)return false;else if(option.bottomlist_display=='ON'){var checkUrl=PAGE.split(","),type=(checkUrl[0]=="forum")?"F":"P";$.bottomlist.init({pid:pid,type:type});}}
var funcCallback=function(func,callback){func();if(typeof callback=='function'){callback();}}
var blockCallback=function(func,callback){func;if(typeof callback=='function'){callback();}}
var displayEmptyAddblock=function(){var checkUrl=PAGE.split(",");if(checkUrl[0]=="forum"&&VIEW){$.forum.view(VIEW);return;}if(!ONE||VIEW){addElementInfo();return;}for(var i=0;i<MENULINK.length;i++){var menulist_index=$.inArray(MENULINK[i],MENULIST),isElement=$('.link-to-'+MENULINK[i]),elMenuName=(i==0&&MENULINK[i]=='INTRO')?MENULINK[0]:$('#nestable').find('.dd-item').eq(menulist_index-1).attr('data-id'),isEllink=(i==0&&MENULINK[i]=='INTRO')?$('#nestable').find('.dd-item[data-id="'+elMenuName+'"] > span > .menu-link'):$('#nestable').find('.dd-item').eq(menulist_index-1).find('.menu-link'),isEllink_text=(isEllink.hasClass('active'))?isEllink.attr('attr-link'):'';if(isElement.length==0){var idx=i+1,thisMenu=MENULINK[i],selectMenu='';while(idx<MENULINK.length){if($('.link-to-'+MENULINK[idx]).length){selectMenu='.link-to-'+MENULINK[idx];break;}idx++;}if(!selectMenu){if($('.add-footer-information').length){selectMenu='.add-footer-information';}else{selectMenu=($('.el-footer_ctrl').length)?'.el-footer_ctrl':'.el-footer';}}var $select=$(selectMenu),dataPos=$select.attr('data-pos');var el=$select.attr('data-el');if($('.'+el+'_ctrl').length){$select=$('.'+el+'_ctrl');}if(typeof dataPos=='undefined'){dataPos='-1';}else dataPos--;var isLink=(isEllink_text&&isEllink.hasClass('active'))?'style="display:none;"':'';if(MENULINK[i]){var $str=$("<div class='element addEL-wrap link-to-"+MENULINK[i]+"' data-el='"+thisMenu+"' data-pos='"+dataPos+"' onclick='showElList();' "+isLink+"><div class='info'><div><img src='//i.addblock.net/addblock.png'></div"+$.lang[LANG]['editor.click-to-add']+" <b>"+elMenuName+" "+$.lang[LANG]['editor.s-block']+"</b></div></div>");$select.before($str);}}}}
var elHtml=function(seq){if($('.addElementWrap').length==0)seq=(selectEL=='el-menu')?"menu":seq;if(!seq){alert('Invalid element ID');return;}menuConfigToggle('close');siteConfigToggle('close');$('#el-property').hide(enableCarousel());tpl=$('.ellist-sidebar .nav li.active').data('type');if($('#el-navbar-menu').length){tpl=$('#el-navbar-menu li.active a').data('type');}tpl=(typeof(tpl)=='undefined')?null:tpl;$.getJSON('/template/element/type/get/seq/'+seq+'/tpl/'+tpl,{sid:SID},function(data){checkError(data);$.each(data,function(idx,val){if(selectEL=='el-menu'&&$('.addElementWrap').length==0)val.elcss=CSSJSON.toCSS(JSON.parse(val.elcss));$('#tpl-html .tpl-element').val(htmlspecialchars_decode(val.eltag));$('#tpl-css .tpl-element').val(htmlspecialchars_decode(val.elcss));$('#tpl-js .tpl-element').val(val.eljs);$('#tpl-settings .tpl-element').val(val.elsettings);$('#tpl-title-name').text(val.elname);if(val.elimg){$('#tpl-image').empty();$('#tpl-image').attr('data-seq',val.seq);$('#tpl-image').append('<img src="'+val.elimg+'">');}$('#tpl-prop-elnew').val(val.elnew);var elnew_b=(val.elnew=='1')?true:false;$('#tpl-prop-elnew').attr('checked',elnew_b);$('#tpl-prop-type').val(val.type);$('#tpl-prop-type2').val(val.type2);$('#tpl-prop-overlap').val(val.overlap);$('#tpl-prop-feature').val(val.feature);$('#tpl-prop-folder').val(val.folder);$('#tpl-prop-name').val(val.elname);});$("#el-save").data('seq',seq).data('type',tpl).data('menu','');$('#tpl-image').attr('data-seq',seq).attr('type',tpl);if(selectEL=='el-menu'&&$('.addElementWrap').length==0)$("#el-save").data('menu','true').data('seq','menu');$('#el-edit').modal('show');});}
var strAgreementDelete=function(block_type,type_str,step){var str="";switch(step){case 1:str="\
                <div class='block-delete'>\
                    <!--<div class='top-sub-text'>"+type_str[0]+" "+$.lang[LANG]['editor.block.delete.title']+type_str[1].toLowerCase()+"</div>-->\
                    <hr class='divider'/>\
                    <ul class='guide-list'>\
                        <li>"+type_str[0]+$.lang[LANG]['editor.block.delete.guide.1']+$.lang[LANG]['editor.block.delete.data.'+block_type]+$.lang[LANG]['editor.block.delete.guide.2']+"</li>\
                    </ul>\
                    <hr class='divider'/>\
                    <div class='agreement-info'>"+$.lang[LANG]['editor.block.delete.agreement.1']+' '+type_str[0]+' '+$.lang[LANG]['editor.block.delete.agreement.2']+type_str[1].toLowerCase()+"</div>\
                    <div class='agreement-box'><input type='text' class='agreement-input'/><label class='error'></label></div>\
                </div>\
            ";break;case 2:str="\
                <div class='block-deleting'>\
                    <div class='deleting-info'>"+$.lang[LANG]['editor.block.delete.agreement.remaining']+"</div>\
                    <div><strong class='point'>15</strong><span>"+$.lang[LANG]['editor.block.delete.agreement.sec']+"</span></div>\
                </div>\
            ";break;default:break;}return str;}
var elDelete=function(seq){if($('.ctrl-delete').hasClass('disabled'))return false;$('.config-image-edit').hide();$('.recomm-image-text').hide();var el=$('.element[data-id="'+seq+'"]'),selectedEL=selectEL,el_type=el.attr('data-type'),isEmpty=true,del_str=(typeof $('.'+selectEL).attr('data-bookmark')!='undefinde'&&$('.'+selectEL).attr('data-bookmark'))?'.bookmark':'';var agreementDelete=['forum'],checkAgreement=($.inArray(el_type,agreementDelete)>-1)?true:false;type_str=(!checkAgreement)?'':[$.lang[LANG]['editor.block.delete.type.'+el_type+'.1'],$.lang[LANG]['editor.block.delete.type.'+el_type+'.2']],modal_class=(!checkAgreement)?'':'agreement-delete',modal_header=(!checkAgreement)?'DELETE BLOCK':type_str[0]+$.lang[LANG]['editor.block.delete'].toUpperCase()+type_str[1].toUpperCase(),modal_str=(!checkAgreement)?$.lang[LANG]['editor.block.delete.info'+del_str]:strAgreementDelete(el_type,type_str,1);var modal=$('.dsgn-body').showModalFlat(modal_header.toLowerCase(),modal_str,true,true,function(){var del=(checkAgreement)?false:true;if(!checkAgreement&&del){funcBlockDelete();}else{var agree_text=$.lang[LANG]['editor.block.delete.agreement.text'];if($('.agreement-input').val().trim().toLowerCase()!=agree_text.toLowerCase()){var error=($('.agreement-input').val().length==0)?$.lang[LANG]['editor.block.delete.agreement.empty']:$.lang[LANG]['editor.block.delete.agreement.wrong'];$('.agreement-input').focus();$('.agreement-box .error').text(error).show();return false;}$('.agreement-box .error').text('').hide();var modal_str2=strAgreementDelete(el_type,type_str,2);var deleting_modal=$(this).showModalFlat('INFORMATION',modal_str2,true,false,'','cancel');var s=10,count_end=false;funcCountDown(s);function funcCountDown(s){if(s>0){$('.block-deleting .point').text(s);setTimeout(function(){funcCountDown(s-1);},1000)}else{count_end=true;deleting_modal.modal('hide');}}deleting_modal.on('hidden.bs.modal',function(){if(count_end){$.processON('Deleting...');setTimeout(function(){del=true;funcBlockDelete();},1000);}else{del=false;return false;}});}function funcBlockDelete(){if(!del){var failed_modal=$(this).showModalFlat('ERROR',$.lang[LANG]['editor.block.delete.agreement.error'],true,false,'','close');return false;}if(!checkAgreement)$.processON('Deleting...');if(seq!='footer')COUNT--;menuContextDisplay('close');modal.modal('hide');el.removeClass('el-active');el.fadeOut('slow',function(){$(this).remove();$('.'+selectedEL+'_ctrl').remove();$('#'+selectedEL+'css').remove();$('.addElementButton.add'+selectedEL).remove();if(VIEW&&COUNT==1){var str="\
                    <div class='default_project_contents'>\
                        <div class='container'>\
                            <div class='row' style='padding:30px 0;'>\
                                <div class='col-xs-12 col-sm-12 col-md-12'>\
                                    <div class='image-wrap'><img src='//storage.googleapis.com/i.addblock.net/icon/project_add_info_contents.png' class='img-responsive' data-attach='true'/></div>\
                                    <h1 class='text-center'>"+$.lang[LANG]['config.gallery.type.project.addcontents']+"</h1>\
                                </div>\
                            </div>\
                        </div>\
                    </div>\
                    ";$('.element[data-type="project"]').after(str);}var list=$('.element[data-id]');$.each(list,function(i,v){if(!$(v).hasClass('el-footer')){var cls=$(v).attr('class'),elseq=$(v).attr('data-id');match=cls.match(/el_\d{0,3}/);cls=cls.replace(/el_\d{0,3}/,"el_"+i);$(v).attr('class',cls);$(v).attr('data-pos',i+1).attr('data-el','el_'+i);$('.config-element-section[data-id="'+elseq+'"]').attr('class','config-element-section el_'+i+'_ctrl');$('#'+match+'css').removeAttr('id').attr('id','el_'+i+'css');isEmpty=false;}});if($('.el_0').attr('data-overlap')!='1'||$('header.navbar').hasClass('sidebar')){$('header').removeClass('transparent');HEADER=0;}$.post('/template/update/type/el-delete',{s:seq,id:SID,page:PAGE},function(data){checkError(data);if(ONE){if(data.el.length){$.each(data.el,function(i,v){if(v.orgpos=="1"){$('.element[data-id="'+v.seq+'"]').addClass('link-to-'+v.orgpage);}});}}bookmarkDelete(SID,seq);if(el_type=='gallery'&&typeof SETTINGS.blockBookmarkList!='undefined'&&SETTINGS.blockBookmarkList){var bookmark=[];$.each(SETTINGS.blockBookmarkList,function(k,v){bookmark.push(k.replace('bookmark',''));});if(bookmark.length>0){$.post('/template/element/type/check-valid-bookmarkBlock/seq/'+seq,{sid:SID,page:PAGE,bookmark:bookmark},function(data){checkError(data);var d=data.data;for(var i=0;i<d.length;i++){bookmarkDelete(SID,d[i]);}},'json');}}displayEmptyAddblock();var type=getElementType();if(seq=='footer'){FTAG="";addFooterInfoDisplay();type="FOOT";}setLogs(type,"block.delete","delete",type);$.processOFF();},'json');});}},'cancel',modal_class);}
$('#el-navbar li a').live({click:function(){showElList($(this).data('type'));}});$('.el-nav-close').live({click:function(){showPage(MCSS,MSTYLE,MTAG);}});$('#el-save').live({click:function(){var seq=$(this).data('seq'),tpl=$(this).data('type'),tpl_tag=$('#tpl-html .tpl-element').val(),tpl_css=(seq=='menu')?JSON.stringify(CSSJSON.toJSON($('#tpl-css .tpl-element').val())):$('#tpl-css .tpl-element').val(),tpl_js=$('#tpl-js .tpl-element').val(),tpl_settings=$('#tpl-settings .tpl-element').val(),tpl_img=$('#tpl-image').find('img').attr('src'),p_elnew=$('#tpl-prop-elnew').val(),p_type=$('#tpl-prop-type').val(),p_type2=$('#tpl-prop-type2').val(),p_feature=$('#tpl-prop-feature').val(),p_folder=$('#tpl-prop-folder').val(),p_name=$('#tpl-prop-name').val(),p_overlap=$('#tpl-prop-overlap').val();if(!p_type&&!p_feature&&!p_folder&&!p_name){($(this).data('menu'))?tpl="menutemp":tpl="temp";if(tpl=="menutemp")p_type="menutemp";seq=-1;}if(errorTag(tpl_tag)){alert('html tag error. check please...');return false;}if(errorCss($('#tpl-css .tpl-element').val())){alert('css error. check please...');return false;}var update_proc;if(seq=="menu"){update_proc="update-menu";}else if(seq=="footer"){update_proc="update-footer";}else update_proc="update";if(p_type=='project'){var $tag=$(htmlspecialchars_decode(tpl_tag)),title=$tag.find('*[data-project-title]').html(),caption=$tag.find('*[data-project-description]').html();$.post('/template/element/type/update-projectData/seq/'+seq,{sid:SID,gid:VIEW,pid:PARENT['pid'],title:title,caption:caption,image:''},function(data){checkError(data);},'json');}$.post('/template/element/type/'+update_proc+'/seq/'+seq+'/tpl/'+tpl,{tag:tpl_tag,css:tpl_css,js:tpl_js,settings:tpl_settings,tpl_elnew:p_elnew,tpl_type:p_type,tpl_type2:p_type2,tpl_feature:p_feature,tpl_folder:p_folder,tpl_name:p_name,tpl_overlap:p_overlap,sid:SID,tpl_img:tpl_img},function(data){checkError(data);},'json');if(tpl&&tpl!='null'){if(selectEL=='el-menu-template'){showMenuList(tpl);}else{showElementList(tpl);clearElementView();}}else{if(seq=='menu'){showPage(JSON.parse(tpl_css),MSTYLE,tpl_tag);}else if(seq=='footer'){FTAG=tpl_tag;FCSS=tpl_css;showPage(MCSS,MSTYLE,MTAG);}else{showPageCallback(showPage);}}var type=getElementType();setLogs(type,"block.source.change","block-source",type);$('#el-edit').modal('hide');if(seq==-1){$('.ellist-sidebar .nav li').removeClass('active');$('.ellist-sidebar .nav').find('.template').addClass('active');showElementList('temp');clearElementView();}var rolling=$('.'+selectEL).attr('data-rolling');if(p_type=='showcase'||(typeof rolling!='undefined'&&rolling=="true")){enableCarousel();}}});$('.selected-files li').live({mouseenter:function(){$(this).find('.selected-hover').show();},mouseleave:function(){$(this).find('.selected-hover').hide();}});$('.fr-selected-files li').live({mouseenter:function(){$(this).find('.selected-hover').show();},mouseleave:function(){$(this).find('.selected-hover').hide();}});$(document).on({click:function(){var file=$(this).find('p.selected-file-name').text();$(this).parent().fadeOut(300,function(){$(this).remove();if(myStorageActive()){$('#resource-files li .ui-selected').find('p.resource-file-name[data-source="'+file+'"]').closest('.fitem').removeClass('ui-selected');displaySelectedFilesStr();}else{var id=$(this).attr('data-id');console.log(id);$('.fr-storage .imgs.ui-selected').find('.control-area[data-id="'+id+'"]').parents('.imgs').removeClass('ui-selected');}});if($('.selected-files li').length==1){$('.resource-useit').removeClass('active');$('#selectAll').prop('checked',false);}}},'.selected-hover');var addItemGallery=function(item_page){$('#gallery-list-config').html('');$('#prop-gallery-pagination').remove();(typeof item_page=='undefined')?1:item_page;galleryGetPage(item_page);}
var showMenucontroller=function(type,id){type=(typeof type=="undefined")?"normal":type;var active=new Array();active[0]=(type=='back')?"active":"";active[1]=(type=='normal')?"active":"";active[2]=(type=='sidebar')?"active":"";active[3]=(type=='menutemp')?"active":"";var str='\
<div id="el-nav" class="navbar navbar-inverse navbar-static-top" data-type="'+type+'">\
    <div class="pull-left">\
        <ul class="nav nav-pills" id="el-navbar-menu">\
          <li class="nav-button el-nav-close"><i class="fa fa-arrow-left"></i> Back to page</li>\
    ';if(typeof id=="undefined"){str=str+'\
          <li class="'+active[1]+'"><a href="#" data-type="normal">TOP</a></li>\
          <li class="'+active[2]+'"><a href="#" data-type="sidebar">SIDEBAR</a></li>\
        ';}if(rt_admin=="adm")str=str+'<li class="'+active[3]+'"><a href="#" data-type="menutemp">Temp</a></li>';str=str+'\
        </ul>\
    </div>\
    <div class="pull-right close el-nav-close">&times;</div>\
</div>\
    ';return str;}
var showElList=function(type,id){showElementList("showcase");}
var selectGalleryCategory=function(seq){var el_css=$('#'+selectEL+'css'),el_css_j=CSSJSON.toJSON(el_css.text()),category_block_css='',gallery_empty=($('.element[data-id="'+selectID+'"]').find('.emptyGalleryItem').length==0)?false:true;$.each(el_css_j["children"],function(i,v){if(i.indexOf('.gallery-category-nav')>-1||i.indexOf('.gallery-category-wrap')>-1||i.indexOf('data-category-color')>-1){delete el_css_j["children"][i];}});$.ajax({url:'/template/element/type/get/seq/'+seq+'/tpl/gallerycategory',dataType:'json',async:false,cache:false,success:function(data){checkError(data);d=data[0];var d_elcss=d.elcss,d_elname=d.elname,d_elnameRE=new RegExp(d_elname,'g');category_block_css=d_elcss.replace(d_elnameRE,$('.element[data-el="'+selectEL+'"]').attr('data-name'));el_css.text(CSSJSON.toCSS(el_css_j)+htmlspecialchars_decode(category_block_css));loadGalleryCategoryBlock($('.element[data-id="'+selectID+'"]'),selectID,'');if(gallery_empty&&$('.element[data-id="'+selectID+'"] .gallery-category-nav .active').index()==0)$('.element[data-id="'+selectID+'"]').find('.gallery-category-nav').addClass('empty');var css=$('#'+selectEL+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:selectID},function(data){checkError(data);},'json');var logtype=getElementType();setLogs(logtype,'gallery.category.change','change',logtype);hideElementListPanel();}});}
var selectElement=function(seq,duplicate){if(typeof selectPOS=="undefined"||selectPOS=='')selectPOS=-1;if(selectEL=='el-menu')selectPOS=0;var ref=$('li[data-id="'+seq+'"]').attr('data-ref'),tag='',css='',selectELType=$('.'+selectEL).attr('data-type'),btnPos=$('.addElementButton.active').attr('data-idx');btnPos=(typeof btnPos=="undefined"||btnPos=="undefined")?1:btnPos;ref=(typeof ref=="undefined"||ref=="undefined")?"":ref;duplicate=(typeof duplicate=="undefined")?false:true;var type=(selectID=='footer')?"el-footer":"el-insert";var isPass=false;$.post('/template/update/type/'+type,{s:seq,id:SID,page:PAGE,seq:ref,pos:selectPOS,el:selectEL,duplicate:duplicate,btnPos:btnPos},function(data){checkError(data);if(typeof data.error=="undefined"&&!data.error){isPass=true;if(data.insertID){var idx=0,block={};if(data.header=='0'||$('header.navbar').hasClass('sidebar')){HEADER='';$('header.navbar').removeClass('transparent');}$.each(data.el,function(i,v){var eltag=htmlspecialchars_decode(v.eltag);if(v.seq!=data.insertID){var cls=$('.element[data-id="'+v.seq+'"]').attr('class');match=cls.match(/el_\d{0,3}/);cls=cls.replace(/el_\d{0,3}/,"el_"+i);$('.element[data-id="'+v.seq+'"]').attr('class',cls);$('.element[data-id="'+v.seq+'"]').attr('data-pos',i+1).attr('data-el','el_'+i);$('.config-element-section[data-id="'+v.seq+'"]').attr('class','config-element-section el_'+i+'_ctrl');$('#'+match+'css').attr('id','el_'+i+'css');}else{idx=i;block=v;if(v.type=='form'||v.type2=='form'){var $insertEL=$(htmlspecialchars_decode(v.eltag)),$elms=$insertEL.find('[form-idx]'),forms=[];$.each($elms,function(key,val){var prop={};prop.idx=$(this).attr('form-idx');prop.name=$(this).attr('form-name');prop.require=$(this).attr('form-require');prop.check=$(this).attr('form-check');prop.type=$(this).attr('form-type');prop.val=($(this).attr('form-val')=='undefined'||$(this).attr('form-val')=='')?'A`B':$(this).attr('form-val');forms.push(prop);});$.post('/template/forms/insert',{sid:SID,id:v.seq,prop:forms});}}});COUNT++;}if(typeof data.el.tag!="undefined"){tag=data.el.tag;css=data.el.css;}if(typeof data.el[0]!='undefined'&&data.el[0].type=='project'&&$('.element[data-id="'+ref+'"]').attr('data-type')=='project'&&data.el[0].type2==''){tag=htmlspecialchars_decode(data.el[0].eltag);$.post('/template/element/type/get-projectData/seq/'+ref,{sid:SID,gid:VIEW,pid:PARENT['pid']},function(data){if(data.data[0]){var isChangeEnd=false;d=document.createElement('div');$(d).addClass('temp-element').html(tag);if(data.data[0].title.length>0)$(d).find('*[data-project-title]').html(data.data[0].title);if(data.data[0].description.length>0)$(d).find('*[data-project-description]').html(data.data[0].description);tag=$(d).html();$(d).remove();tmpTag=tag;isChangeEnd=true;if(isChangeEnd){$.ajax({type:'POST',url:'/template/element/type/update-text/seq/'+ref,data:{tag:tmpTag,sid:SID},async:false});}}},'json');}}},'json');if(isPass){var msg="block.add.",icon="block-add-";var logtype=getElementType();if(type=='el-footer'){if(FTAG){msg="block.footer.";icon="change-";}FTAG=htmlspecialchars_decode(tag);FCSS=css;logtype="FOOT";}if(ref&&type!='el-footer'){logtype="ELEM";msg=(selectEL=='el_0'&&VIEW&&selectELType=='project')?"project.title.change":selectELType+".design.change";duplicate="";icon="change";if(!VIEW&&selectELType=='gallery'){var settings={category_color_type:''};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:ref},function(data){checkError(data);},'json');}}if(selectEL=='el-menu'&&!ref){logtype="ELEM";}setLogs(logtype,msg+duplicate,icon+duplicate,logtype);hideElementListPanel();selectEL='el_'+selectPOS;$.cookie('block-add','.'+selectEL,{path:'/'});if(ref&&type!='el-footer'&&VIEW==""&&selectELType=="gallery"){$.ajax({type:'post',url:'/template/gallery/check',data:{sid:SID,el:ref,seq:seq,page:PAGE},dataType:'json',async:true,success:function(data){checkError(data);var process=frStorageResize(data.items,data.width,data.total);process.then(function(){$.processOFF();showPageCallback(showPage);});}});}else{showPageCallback(showPage);}}else{hideElementListPanel();}return;}
var frStorageResize=function(data,width,total){var deferred=$.Deferred(),process=0;$.each(data,function(i,v){var settings=(v.gsettings)?$.parseJSON(v.gsettings):{},storage=(typeof settings.storage!='undefined')?settings.storage:'';$.ajax({type:'post',url:'/template/frstorage/resize',data:{sid:SID,img:v.image,w:width,storage:storage},dataType:'json',async:true,success:function(data){process++;$.processON($.lang[LANG]['editor.gallery.resize']+'<br>'+(process)+' / '+total);if(process==total){deferred.resolve();}}});});return deferred.promise();}
var clearDsgnbody=function(){$('.dsgn-body').empty();$('#menu-'+SID).remove();$('#dsgn-'+SID).remove();$('.header.element').remove();}
var showPage=function(css,style,tag,prop){funcCallback(getSiteController,function(){menuConfigToggle('close');siteConfigToggle('close');});$('body').removeClass('transparent');clearDsgnbody();$.each(style.children,function(k,v){if(k!='.dsgn-body'){delete style.children[k];}});$('.dsgn-body').removeClass('tpl-margin');$('.dsgn-body').append("<style id='menu-"+SID+"'>"+CSSJSON.toCSS(css)+"</style>");$('.dsgn-body').append("<style id='dsgn-"+SID+"'>"+CSSJSON.toCSS(style)+"</style>");var $cog=$('<div class="el-menu_ctrl config-element-section"><div class="config-element"><img src="//i.addblock.net/icon/fa_config_icon.png"></div></div>');if($(tag).hasClass('sidebar')){var left=$('header.navbar').width()-50;$cog.find('.config-element').css({'right':'inherit','left':left+'px',});}$cog.appendTo('.dsgn-body');$('.dsgn-body').append($('<div class="header element">').addClass('el-menu').attr('data-el','el-menu').attr('data-name','menu'));var $tag=$(tag).removeClass('tpl_menu');if(ONE){if(VIEW)$tag.find('#site-home').attr('href','/config').removeClass('mini-home');else
$tag.find('#site-home').attr('href','javascript:;').addClass('mini-home');}else
$tag.find('#site-home').attr('href','/config').removeClass('mini-home');var isSidebar=$(tag).hasClass('sidebar');if(isSidebar){$('.dsgn-body').addClass('sidebar');$('.header.el-menu').addClass('sidebar');if($('.editor-navbar').css('display')!='none')$tag.css('top','35px');}$('.dsgn-body > div.header.el-menu').append($tag);if(HEADER&&!isSidebar){$('header.navbar').addClass('transparent');}menu_color=$('header.navbar').css('background-color');header_fixed=$('header.navbar').height();if(menu_color==('rgba(0, 0, 0, 0)')){$('header.navbar').css('background-color',$('dsgn-body').css('background-color'));}setTplmenu($('.dsgn-body > header').data('name'));elPush(prop);selectPOS='';if(PARENT.page){$('#tpl-menu li').find("a:contains('"+PARENT.page+"')").parent().addClass('active');}else{if(ONE){if($('.dd-first #intro-onoff').attr('attr-val')=='off')$('#tpl-menu li').first().addClass('active');}}setLoginout(LOGINOUT);}
var setLoginout=function(v){if(v=='1'&&$('#tpl-menu').find('li.loginout').length==0){$('#tpl-menu').append('<li class="loginout"><a href="javascript:;" title="CREATORLINK login"><i class="fa fa-user"></i></a></li>');}var checked=(v=='1')?true:false;$('#el-menu-config').find('#loginout-onoff').first().attr('checked',checked);}
var elSortable=function(){$('.el-reorder').sortable({update:function(event,ui){var order=$(this).sortable('toArray');$.post('/template/update/type/el-order',{s:order,id:SID,page:PAGE,idx:ui.item.index()},function(data){checkError(data);showPageCallback(showPage);if(data.overlap==0){$('header.navbar').removeClass('transparent');}},'json');$(this).children().each(function(k,i){$(this).attr('id','el_'+k);});var active=$('.panel-reorder.active').parent().prop('id');}}).disableSelection();}
var blockSortable=function(){$('.el-sortable').sortable({items:".render:not(.unsort)",cancel:".sort-empty",scroll:true,start:function(event,ui){$(this).sortable("refresh");},stop:function(event,ui){$.each($('.sort-empty'),function(i,v){if($(this).next().hasClass('sort-empty')&&!$(this).next().hasClass('page')){var $empty=$("<div class='sort-empty page'>PAGE EMPTY</div>");if(!$(this).hasClass('page'))$(this).after($empty);}});},sort:function(event,ui){$('.sort-empty.page').hide().remove();$(this).sortable("refresh");var top=ui.position.top*5,left=ui.position.left*5;ui.offset.top=ui.offset.top*5;ui.offset.left=ui.offset.left*5;$('.el-sortable').sortable("refresh");if(ui.item.attr('data-type')=='showcase'){$('.render.carousel').css('min-height','inherit !important');}if(ui.item.css('background-color')==='rgba(0, 0, 0, 0)'){background=$('.dsgn-body').css('background-color');}else{background=ui.item.css('background-color');}ui.helper.css({'top':top+'px','left':left+'px','background-color':background,'min-height':'0px'});ui.placeholder.css("visibility","visible");},update:function(event,ui){}}).disableSelection();}
var logout=function(){location.replace('/member/login/out');}
var login=function(SID){if(typeof SID=="undefined"||!SID||SID.length<1)location.replace('/member/login');return;}
var initResource=function(){$('#progress .progress-bar').css('width','0%');$('.selected-files').empty();$('.resource-useit').removeClass('active');$('.fr-selected-files').empty();$('.fr-storage .imgs').removeClass('ui-selected');}
var resourceFileTag=function(source,seq,path,selected,ffolder,page,origname,filesize){active=($.inArray(source,selected)>-1)?" ui-selected":"";var control_box='<ul data-ffolder="'+ffolder+'" data-page="'+page+'" data-source="'+source+'" data-seq="'+seq+'" data-fsize="'+filesize+'">\
        <li><i class="fa fa-search resource-file-search" aria-hidden="true"></i></li>\
        <li><a href="'+path+'/'+source+'" alt="'+source+'" download="'+origname+'"><i class="fa fa-download" aria-hidden="true"></i></a></li>\
        <li><i class="fa fa-trash-o resource-file-delete" aria-hidden="true"></i></li>\
    </ul>\
    ';var $item=$("<div class='fitem'></div>"),$img=$('<div class="resource-image'+active+'"><img src="'+path+'/800/'+source+'" alt="'+source+'"></div><div class="control-area">'+control_box+'</div>');$item.append($img);$item.append('<p class="resource-file-name" data-seq="'+seq+'" data-source="'+source+'">'+origname+'</p><p class="resource-file-size">'+filesize+'</p>');return $item;}
var addGalleryfile=function(files,sid,page){var width=$('.'+selectEL).attr('data-width');width=(typeof width=='undefined')?"":width;if(myStorageActive()){$.post('/template/gallery/add/sid/'+sid+'/spage/'+page,{s:files,pid:selectID},function(data){checkError(data);$('.gallery-result-none').remove();galleryGetPage(1);var type=getElementType();setLogs(type,"gallery.data.add","add",type);},"json");showPageCallback(showPage);}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(files,width);frUpload.then(function(data){$.post('/template/gallery/add/sid/'+sid+'/spage/'+page,{s:data.files,pid:selectID,storage:data.path},function(data){checkError(data);$('.gallery-result-none').remove();galleryGetPage(1);var type=getElementType();setLogs(type,"gallery.data.add","add",type);},"json");showPageCallback(showPage);});}}
var addGalleryContent=function(file,resource,glseq,title,caption,visible,pos,idx,rtnPage,settings){var itemIndex=((rtnPage-1)*GVIEW)+idx,filepath=resource+'/'+SID+'/60/'+file;if(typeof title=="undefined")title="";if(typeof caption=="undefined")caption="";var icon_caption=(title.length||caption.length)?"fa-comment":"fa-comment-o",v_active=(visible==1)?"active":"",icon_src=(v_active)?'//i.addblock.net/icon/icon-menu-invisible.png':'//i.addblock.net/icon/icon-menu-visible.png',settings=(settings==""||typeof settings=="undefined")?{}:$.parseJSON(settings),glink=(typeof settings['glink']!="undefined"&&settings['glink'])?settings['glink']:'',glink_target=(typeof settings['glink_target']!="undefined"&&settings['glink_target']=='_blank')?'_blank':'',gl_active=(glink.length>0)?"active":"",cls=(title.length>0)?"":"none",title=(title.length>0)?title:$.lang[LANG]['config.click-to-text'];filepath=(typeof settings['storage']!='undefined')?settings['storage']+'60/'+file:filepath;var info=getRecommendInfo($('.'+selectEL),$('<img src="'+filepath+'"">'));var str='\
    <div class="image-wrap" data-glseq="'+glseq+'" id="glorder'+idx+'">\
        <div class="attach-thumb"><img class="galleryItemEdit" src="'+filepath+'" data-index="'+itemIndex+'"  data-seq="'+glseq+'" data-toggle="tooltip" data-html="true" data-placement="left" data-title=\''+info+'\'></div>\
        <div class="image-title galleryItemEdit hand '+cls+'" data-index="'+itemIndex+'" data-seq="'+glseq+'">'+title+'</div>\
        <div class="icons btn-group dropup">\
            <span class="dropdown-toggle gl-sort" data-toggle="dropdown" data-pos="'+pos+'">\
                <i class="fa fa-sort" data-toggle="tooltip" data-placement="top" title="'+$.lang[LANG]['editor.gallery.icon.order']+'"></i>\
            </span>\
            <ul class="dropdown-menu sort-item" role="menu">\
                <li><a href="javascript:;" onclick="getSortItems('+pos+', 1,'+glseq+','+rtnPage+')"><i class="fa fa-angle-double-up"></i> <span data-lang="config.gallery.order.first">'+$.lang[LANG]['config.gallery.order.first']+'</span></a></li>\
                <li><a href="javascript:;" onclick="getSortItems('+pos+', '+(eval(pos)-1)+','+glseq+','+rtnPage+')"><i class="fa fa-angle-up"></i> <span data-lang="config.gallery.order.up">'+$.lang[LANG]['config.gallery.order.up']+'</span></a></li>\
                <li><a href="javascript:;" onclick="getSortItems('+pos+', '+(eval(pos)+1)+','+glseq+','+rtnPage+')"><i class="fa fa-angle-down"></i> <span data-lang="config.gallery.order.down">'+$.lang[LANG]['config.gallery.order.down']+'</span></a></li>\
                <li><a href="javascript:;" onclick="getSortItems('+pos+', -1,'+glseq+','+rtnPage+')"><i class="fa fa-angle-double-down"></i> <span data-lang="config.gallery.order.last">'+$.lang[LANG]['config.gallery.order.last']+'</span></a></li>\
            </ul>\
        </div>\
        <div class="icons gl-item-clone '+v_active+'" data-glseq="'+glseq+'" data-page="1"><i class="fa fa-clone tooltips" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="'+$.lang[LANG]['editor.gallery.icon.clone']+'"></i></div>\
        <div class="icons gl-item-visible '+v_active+'" data-glseq="'+glseq+'" data-visible="'+visible+'"><img src="'+icon_src+'" class="fa"  data-toggle="tooltip" data-placement="top" title="'+$.lang[LANG]['editor.gallery.icon.visible']+'"/></div>\
        <div class="icons gl-item-link '+gl_active+'" data-glseq="'+glseq+'" data-glink="'+glink+'" data-glink-target="'+glink_target+'"><i class="fa fa-link" data-toggle="tooltip" data-placement="top" title="'+$.lang[LANG]['editor.gallery.icon.link']+'"></i></div>\
        <div class="icons gl-item-delete" data-glseq="'+glseq+'" data-page="'+rtnPage+'"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" title="'+$.lang[LANG]['editor.gallery.icon.delete']+'"></i></div>\
    </div>\
    ';$('#gallery-list-config').append(str);glSortable();}
$('.add-caption-toggle').live({click:function(){if(!$(this).parent().find('.prop-addcaption').hasClass('open')){$('.prop-addcaption.open').hide().removeClass('open');}$(this).find('.prop-addcaption').toggle().addClass('open');$(this).parents('.icon-caption').find('.prop-addcaption').addClass('open').siblings().removeClass('open');$(this).parent().find('.prop-addcaption.open').toggle();}});$('.gl-item-clone').live({click:function(e){var seq=$(this).data('glseq'),item_page=$(this).data('page');if(typeof seq=='undefined'||seq==''){alert('Invalid variable');return false;}var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.gallery.clone'],true,true,function(){$.post('/template/gallery/clone',{s:seq,sid:SID},function(data){checkError(data);},'json');galleryGetPage(item_page);modal.modal('hide');showPageCallback(showPage);var type=getElementType();setLogs(type,"gallery.item.clone","clone",type);});}});$('.gl-item-visible').live({click:function(){var visible=$(this).data('visible'),icon_src='//i.addblock.net/icon/icon-menu-visible.png';visible=(visible==1)?0:1;$(this).data('visible',visible);icon_src=(visible==1)?'//i.addblock.net/icon/icon-menu-invisible.png':icon_src;$(this).find('img.fa').attr('src',icon_src);$.post('/template/gallery/visible',{s:$(this).data('glseq'),view:visible},function(data){checkError(data);},'json');showPageCallback(showPage);var type=getElementType(),checked=(visible)?false:true;setLogs(type,"gallery.item.visible."+checked,"visible-"+checked,type);}});$('.gl-item-delete').live({click:function(){var seq=$(this).data('glseq'),item_page=$(this).data('page');var modal=$(this).showModalFlat('DELETE',$.lang[LANG]['config.common.delete'],true,true,function(){$.post('/template/element/type/get-projectPage-bookmarkBlock/seq/'+seq,{sid:SID,page:PAGE},function(data){checkError(data);var d=data.data;$.each(d,function(i,o){bookmarkDelete(o.sid,o.seq);});glItemDelete(seq);galleryGetPage(item_page);modal.modal('hide');showPageCallback(showPage);var type=getElementType();setLogs(type,"gallery.item.delete","delete",type);},'json');});}});var showPageCallback=function(callback){$.modalON();callback(MCSS,MSTYLE,MTAG,true);var activePrev=(selectEL!='el_0'&&selectEL!=''&&typeof selectID!="undefined")?selectID:'';setTimeout(function(){funcCallback(activeEL,function(){moveScroll(0);if(typeof $.cookie('gallery')!='undefined')moveGallery($.cookie('gallery'));if(typeof $.cookie('block-add')!='undefined')moveGallery($.cookie('block-add'),'add');if(typeof $.cookie('gallery-item')!='undefined'&&VIEW==''){$('.dsgn-body').scrollTo('.gallery-item[data-seq="'+$.cookie('gallery-item')+'"]',{offset:-100,easing:'easeInOutQuart'});$.removeCookie('gallery-item',{path:'/'});}if(typeof $.cookie('gallery')=='undefined'&&typeof $.cookie('block-add')=='undefined'&&typeof $.cookie('gallery-item')=='undefined'){if(activePrev){var navheight=$('#tpl-menu').height(),offset=($('.dsgn-body').hasClass('sidebar'))?0:-navheight;$('.dsgn-body').scrollTo('.element[data-id="'+activePrev+'"]',{offset:offset,easing:'easeInOutQuart'});if(selectID!=activePrev){selectID=activePrev;$('.element').removeClass('active');selectEL=$('.element[data-id="'+selectID+'"]').addClass('active').attr('data-el');}}}});$.modalOFF();},500);}
var pageHeight=function(){$('.page-comments').css('margin-top','0px');$('.el-footer').css('margin-top','0px');var docHeight=$(document).height();$('.dsgn-body').wrapInner('<div class="dsgn-body-wrap"></div>');var dsgnHeight=$('.dsgn-body-wrap').height();var diff=docHeight-dsgnHeight;$('.dsgn-body > .dsgn-body-wrap').contents().unwrap();return(diff>0)?diff:0;}
var setHeight=function(height){if(VIEW=="")return false;if(height>0){height=(typeof MODE=="undefined")?height:height-35;if($('.page-comments').length){$('.page-comments').css('margin-top',height+'px');}else if($('.page-bottomlist').length){$('.page-bottomlist').css('margin-top',height+'px');}else if($('.el-footer').length){$('.el-footer').css('margin-top',height+'px');}}}
$('.gl-text-save').live({click:function(){var type=$(this).data('type'),seq=$(this).data('glseq'),title=$(this).parents('.gc-title').find('.cont-title').val(),caption=$(this).parents('.gc-title').find('.cont-caption').val(),linkText=$(this).parents('.gc-title').find('.conf-text-link').val(),link=$(this).parents('.gc-title').find('.conf-input-link').val(),blank=$(this).parents('.gc-title').find('.link-target-property').prop('checked');blank=(blank)?"_blank":"";if(!type){alert('Error caption type!');return false;}if(type=='gallery'){$.post('/template/gallery/add_info/type/'+type,{s:seq,title:title,caption:caption,sid:SID,page:PAGE},function(data){checkError(data);},'json');(title||caption)?$(this).parents('.icon-caption').find('.fa').removeClass('fa-comment-o').addClass('fa-comment'):$(this).parents('.icon-caption').find('.fa').removeClass('fa-comment').addClass('fa-comment-o');$(this).parents('.image-wrap').find('.image-title').text(title);}else if(type=='showcase'){var child=$('.'+selectEL).find('[data-loop="true"]').children(),idx=$(this).data('idx'),r=$(child[idx]);r.find('.figure-title').text(title.replace(/\r?\n/g,'<br />'));r.find('.figure-caption').text(caption.replace(/\r?\n/g,'<br />'));var $linkButton=r.find('.conf-link-button');if($linkButton.length>0){if(!link.match("^(http://|https://|mailto:|tel:)")){if(link.substring(0,1)!="/"){link="http://"+link;$linkButton.removeAttr('data-user-link');}else{$linkButton.attr('data-user-link',link);}}$linkButton.attr('href',link).attr('target',blank).text(linkText);}saveContentElement();}$('.prop-addcaption.open').hide().removeClass('open');showPageCallback(showPage);}});var glSortable=function(){$('#gallery-list-config').sortable({update:function(event,ui){var pos=$(this).data().uiSortable.currentItem.find('.gl-sort').data('pos'),seq=$(this).data().uiSortable.currentItem.data('glseq'),gpage=$(this).attr('data-page');target=((gpage-1)*GVIEW)+ui.item.index()+1;getSortItems(pos,target,seq,gpage);}}).disableSelection();}
var glItemDelete=function(ids){$.post('/template/gallery/delete',{s:ids},function(data){checkError(data);},'json');}
var getSortItems=function(pos,target,seq,item_page){$.post('/template/gallery/pos',{gid:selectID,p:pos,t:target,s:seq},function(data){checkError(data);addItemGallery(item_page);showPageCallback(showPage);var type=getElementType();setLogs(type,"gallery.reorder","move",type);},'json');}
var galleryFrame=function(id){var str='\
<div id="gframe-'+id+'" class="blueimp-gallery blueimp-gallery-controls">\
    <div class="slides"></div>\
    <h3 class="title"></h3>\
    <a class="prev"><img src="//i.addblock.net/icon/fa_gframe_prev.png" alt="" /></a>\
    <a class="next"><img src="//i.addblock.net/icon/fa_gframe_next.png" alt="" /></a>\
    <a class="close"><img src="//i.addblock.net/icon/fa_gframe_close.png" alt="" /></a>\
    <a class="play-pause"></a>\
    <ol class="indicator"></ol>\
</div>\
    ';$('.gallery-frame').append(str);}
var showElementProperty=function(X,Y){X=($(window).width()<X+360)?$(window).width()-380:X;Y=($(window).height()<Y+$('.config-window').height())?$(window).height()-$('.config-window').height():Y;$('#el-property').css('left',X);$('#el-property').css('top',Y);}
var hideConfigPanel=function(){$('.element').removeClass('el-active');$('#el-property').hide(enableCarousel());}
var hideAllModal=function(){menuConfigToggle('close');siteConfigToggle('close');$('.ellist-sidebar.open').find('.panel-close').click();$('.reorderModal').find('.btn-default').click();$('.modal#el-fileupload').modal('hide');$('.modal#flat-modal').modal('hide');hideConfigPanel();}
var getSiteController=function(){$('#site-accordion').empty();var bc=style.get(USTYLE,'dsgn-body'),uc=style.getCssProperty(USTYLE,'.dsgn-body a','color'),fc=$('.dsgn-body').css('font-size').replace("px",""),fn=style.getCssProperty(USTYLE,'.dsgn-body','font-family').split(",")[0],td=style.getCssProperty(USTYLE,'.dsgn-body a:hover','text-decoration'),bb=style.getCssProperty(USTYLE,'.dsgn-body','background-image').trim().replace(/^url\(['"]?/,'').replace(/['"]?\)$/,''),bp=style.getCssProperty(USTYLE,'.dsgn-body','background-position'),br=style.getCssProperty(USTYLE,'.dsgn-body','background-repeat'),bs=style.getCssProperty(USTYLE,'.dsgn-body','background-size'),wp=[];wp[0]=(WRAP)?"":"checked";wp[1]=(WRAP)?"checked":"";var check_one=(ONE)?"checked":"",right_click=(typeof SETTINGS.rightClick=="undefined"||SETTINGS.rightClick===false)?"":"checked",musicUse=(typeof SETTINGS.musicUse=="undefined"||SETTINGS.musicUse===false)?"":"checked",popupUse=(typeof SETTINGS.showPopup=="undefined"||SETTINGS.showPopup===false)?"":"checked",popup_o=(typeof SETTINGS.sitePopup=="undefined"||SETTINGS.sitePopup==='')?new Array():SETTINGS.sitePopup,mobile_zoom=(typeof SETTINGS.zoom=="undefined"||SETTINGS.zoom===false)?"":"checked";file=bb.split("/");file_path='';for(i=0;i<file.length-1;i++){file_path=file_path+file[i]+'/';}file_path=file_path.replace('/1920/','/');url_path=(bb&&bb!='none'&&bb!='initial')?file_path+'60/'+file[file.length-1]:"";fn=fn.replace(/'/gi,"");siteTitle=$.lang[LANG]['editor.title'];siteMeta=$.lang[LANG]['editor.meta'];onePageDesign=$.lang[LANG]['editor.one-page-design'];background=$.lang[LANG]['editor.background'];backgroundColor=$.lang[LANG]['editor.background.color'];backgroundImage=$.lang[LANG]['editor.background'];font=$.lang[LANG]['editor.font'];fontColor=$.lang[LANG]['editor.font.color'];fontName=$.lang[LANG]['editor.font.font'];fontInfo=$.lang[LANG]['editor.font.info'];body_basic="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle no-toggle' data-toggle='collapse'><span data-lang='editor.title'>\
              "+siteTitle+"\
            </span></a>\
            <span class='pull-right site-title-edit hand'>&nbsp;&nbsp;<i class='fa fa-pencil'></i></span>\
            <span class='site-title site-title-edit'>"+TITLE+"</span>\
          </h4>\
          <div class='site-edit-text'>\
               <div class='input-group'>\
                   <input type='text' class='site-edit-input form-control'>\
                   <span class='input-group-btn'>\
                       <button class='site-edit-save btn btn-default btn-primary' type='button'><i class='fa fa-check'></i></button>\
                   </span>\
               </div>\
               <div class='site-edit-cancel'><i class='fa fa-times'></i></div>\
          </div>\
        </div>\
        <div id='site-default' class='panel-collapse collapse'>\
          <div class='panel-body'>\
            <div class='form-horizontal'>\
                <div class='form-group'>\
                    <label class='col-sm-3 control-label'>"+$.lang[LANG]['editor.sitename']+"</label>\
                    <div class='col-sm-9'>\
                        <input type='text' id='site_reg_sname' name='sname' class='form-control' value='"+TITLE+"' placeholder='"+$.lang[LANG]['editor.sitename.info']+"'>\
                    </div>\
                </div>\
                <div class='form-group'>\
                    <label class='col-sm-3 control-label'>URL</label>\
                    <div class='col-sm-9 input-group'>\
                        <input type='text' id='site_reg_sid' name='sid' class='form-control' value='"+SID+"' placeholder='"+$.lang[LANG]['editor.sid.info']+"' disabled>\
                        <span class='input-group-addon'>.creatorlink.net</span>\
                    </div>\
                </div>\
                <div class='text-center'><button type='submit' class='btn btn-primary btn-sm' id='site-conf-save'>"+$.lang[LANG]['config.save']+"</button></div>\
            </div>\
          </div>\
        </div>\
      </div>\
    ";body_meta="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle no-toggle' data-toggle='collapse'><span data-lang='editor.meta'>\
              "+siteMeta+"\
            </span></a>\
            <span class='pull-right site-meta-edit hand'>&nbsp;&nbsp;<i class='fa fa-pencil'></i></span>\
          </h4>\
        </div>\
      </div>\
    ";body_onepage="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:0px;'>\
            <a class='accordion-toggle no-toggle'><span data-lang='editor.one-page-design'>\
              "+onePageDesign+"\
            </span></a>\
              <span class='pull-right' style='margin-top:3px;margin-right:20px;height:30px;'>\
                <label class='switch site-onepage'>\
                    <input type='checkbox' class='switch-input' id='site-onepage' "+check_one+">\
                    <span class='switch-label' data-on='On' data-off='Off'></span>\
                    <span class='switch-handle'></span>\
                </label>\
              </span>\
          </h4>\
        </div>\
      </div>\
    ";body_rclick="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:0px;'>\
            <a class='accordion-toggle no-toggle'>\
              "+$.lang[LANG]['editor.right-click']+"\
            </a>\
              <span class='pull-right' style='margin-top:3px;margin-right:20px;height:30px;'>\
                <label class='switch site-right-click'>\
                    <input type='checkbox' class='switch-input' id='site-right-click' "+right_click+">\
                    <span class='switch-label' data-on='On' data-off='Off'></span>\
                    <span class='switch-handle'></span>\
                </label>\
              </span>\
          </h4>\
        </div>\
      </div>\
    ";body_zoom="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:0px;'>\
            <a class='accordion-toggle no-toggle'>\
              "+$.lang[LANG]['editor.mobile.zoom']+"\
            </a>\
              <span class='pull-right' style='margin-top:3px;margin-right:20px;height:30px;'>\
                <label class='switch site-mobile-zoom'>\
                    <input type='checkbox' class='switch-input' id='site-mobile-zoom' "+mobile_zoom+">\
                    <span class='switch-label' data-on='On' data-off='Off'></span>\
                    <span class='switch-handle'></span>\
                </label>\
              </span>\
          </h4>\
        </div>\
      </div>\
    ";body_wrap="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle no-toggle' data-toggle='collapse'>\
              "+$.lang[LANG]['editor.max-width']+"\
            </a>\
            <span class='pull-right'>\
                <label class='radio-inline'>\
                    <input type='radio' name='body-wrap' class='site-body-wrap normal' "+wp[0]+"> 1170px\
                </label>\
                <label class='radio-inline'>\
                    <input type='radio' name='body-wrap' class='site-body-wrap tiny' "+wp[1]+"> 940px\
                </label>\
            </span>\
          </h4>\
        </div>\
      </div>\
    ";body_font="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#site-accordion' href='#site-font'><span data-lang='editor.font'>\
              "+font+"\
            </span></a>\
          </h4>\
        </div>\
        <div id='site-font' class='panel-collapse collapse'>\
          <div class='panel-body'>\
            <div class='form-horizontal'>\
                <div class='form-group'>\
                    <label class='col-sm-3 control-label'><span data-lang='editor.font.color'>\
                    "+fontColor+"\
                    </span></label>\
                    <span class='col-sm-9'>\
                        <span class='color tooltips font-picker-body' el='dsgn-body' pn='color' data-toggle='tooltip' data-placement='top' title='color' style='background-color:"+bc.txColor+";'></span>\
                        <span class='txt-dsgn-font-color'>"+bc.txColor+"</span>\
                    </span>\
                </div>\
                <div class='form-group'>\
                    <label class='col-sm-3 control-label'><span data-lang='editor.font.font'>\
                    "+fontName+"\
                    </span></label>\
                    <span class='col-sm-7 set-font'>\
    ";body_font=body_font+style.selectFontSelectForm('font-family-body',fn);body_font=body_font+"\
                    </span>\
                    <span class='col-sm-1 default-font-info no-padding'>\
                        <i class='fa fa-question-circle trigger' data-original-title='\
                        "+fontInfo+"\
                        '  data-toggle='tooltip' data-placement='top'></i>\
                    </span>\
                </div>\
                <!--\
                <div class='form-group'>\
                    <label class='col-sm-3 control-label'><span data-lang='editor.font.size'>Size</span> <span class='slider-value' id='dsgn-body-font-size'>"+fc+"</span>px</label>\
                    <span class='col-sm-9'>\
                        <div class='font-slider' data-slider-min='10' data-slider-max='80' data-slider-step='1' data-slider-value='"+fc+"' data-slider-tooltip='hide' el='font-size' selector='dsgn-body' pn='font-size'></div>\
                    </span>\
                </div>\
                -->\
            </div>\
          </div>\
        </div>\
      </div>\
      ";body_background="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#site-accordion' href='#site-background'><span data-lang='editor.background'>\
            "+background+"\
            </span></a>\
          </h4>\
        </div>\
        <div id='site-background' class='panel-collapse collapse'>\
            <div class='panel-body'>\
                <div class='form-horizontal'>\
                <!--\
                    <div class='form-group'>\
                        <label class='col-sm-4 control-label' data-lang='editor.coverage'>CSS coverage</label>\
                        <span class='col-sm-8'>\
                            <label class='radio-inline'>\
                                <input type='radio' name='css-coverage-background' class='css-coverage-background' value='all' style='margin-top:7px;' checked> <span data-lang='editor.coverage.all'>All</span>\
                            </label>\
                            <label class='radio-inline'>\
                                <input type='radio' name='css-coverage-background' class='css-coverage-background' value='page' style='margin-top:7px;'> <span data-lang='editor.coverage.page'>Current page</span>\
                            </label>\
                        </span>\
                    </div>\
                -->\
                    <div class='form-group'>\
                        <label class='col-sm-4 control-label'><span data-lang='editor.background.color'>\
                        "+backgroundColor+"\
                        </span></label>\
                        <span class='col-sm-8'>\
                            <span class='color tooltips bg-picker' el='dsgn-body' selector='dsgn-body' pn='background-color' data-toggle='tooltip' data-placement='top' title='color' style='background-color:"+bc.bgColor+";'></span>\
                            <span class='txt-dsgn-background-color'>"+bc.bgColor+"</span>\
                        </span>\
                    </div>\
                    <div class='form-group'>\
                        <label class='col-sm-4 control-label'><span data-lang='editor.background.image'>\
                        "+backgroundImage+"\
                        </span></label>\
                        <span class='col-sm-8'>\
                            <span class='btn btn-default btn-sm fileinput-button' data-toggle='modal' el='dsgn-body' data-target='#el-fileupload' id='prop-method-background-body'>\
                                <i class='glyphicon glyphicon-folder-open'></i>&nbsp;\
                            </span>\
                            <span class='prop-background-body-ctrl'>";if(url_path)body_background=body_background+"<span class='attach-thumb'><img src='"+url_path+"'></span> <i class='fa fa-trash-o hand' id='prop-background-body-delete' data-el='dsgn-body' data-pn='background-image'></i>";body_background=body_background+"\
                            </span>\
                        </span>\
                    </div>\
                    <div class='prop-body-background-option'>\
                    <div class='form-group'>\
                        <label class='col-sm-4 control-label'>\
                        "+$.lang[LANG]['editor.background.position']+"\
                        </label>\
                        <span class='col-sm-8'>\
    ";body_background=body_background+style.selectBackgroundSelectForm("position","body-background-position",bp);body_background=body_background+"\
                        </span>\
                    </div>\
                    <div class='form-group'>\
                        <label class='col-sm-4 control-label'>\
                        "+$.lang[LANG]['editor.background.repeat']+"\
                        </label>\
                        <span class='col-sm-8'>\
    ";body_background=body_background+style.selectBackgroundSelectForm("repeat","body-background-repeat",br);body_background=body_background+"\
                        </span>\
                    </div>\
                    <div class='form-group'>\
                        <label class='col-sm-4 control-label'>\
                        "+$.lang[LANG]['editor.background.size']+"\
                        </label>\
                        <span class='col-sm-8'>\
    ";body_background=body_background+style.selectBackgroundSelectForm("bgsize","body-background-size",bs);body_background=body_background+"\
                        </span>\
                    </div>\
                    </div>\
                </div>\
            </div>\
        </div>\
      </div>\
    ";body_style="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#site-accordion' href='#site-style'>\
              Style\
            </a>\
          </h4>\
        </div>\
        <div id='site-style' class='panel-collapse collapse'>\
          <div class='panel-body'>\
            <div class='form-horizontal'>\
                <div class='form-group'>\
                    <label class='col-sm-4 control-label'>NOW</label>\
                    <span class='col-sm-8'>\
                        <span class='color tooltips style-picker' style='background-color:"+uc+";'></span>\
                        <span class='current-color'>"+uc+"</span>\
                    </span>\
                </div>\
                <div class='form-group'>\
                    <label class='col-sm-4 control-label'>COLOR</label>\
                    <span class='col-sm-8'>\
                        <span class='color set-style' style='background-color:#0088CC;'></span>\
                        <span class='color set-style' style='background-color:#2BAAB1;'></span>\
                        <span class='color set-style' style='background-color:#E36159;'></span>\
                        <span class='color set-style' style='background-color:#4A5B7D;'></span>\
                        <span class='color set-style' style='background-color:#B8A279;'></span>\
                        <span class='color set-style' style='background-color:#C71C77;'></span>\
                        <span class='color set-style' style='background-color:#734BA9;'></span>\
                        <span class='color set-style' style='background-color:#47C6BA;'></span>\
                    </span>\
                </div>\
                <div class='form-group'>\
                    <label class='col-sm-4 control-label' style='line-height: 15px !important;'>LINK<br>Underline</label>\
                    <span class='col-sm-8'>\
                        <label class='switch'>\
                            <input type='checkbox' class='switch-input' id='text-deco-body' "+((td=='initial'||td=='underline')?"checked":"")+">\
                            <span class='switch-label' data-on='On' data-off='Off'></span>\
                            <span class='switch-handle'></span>\
                        </label>\
                    </span>\
                </div>\
            </div>\
          </div>\
        </div>\
      </div>\
    ";var is_favicon=($('#user-favicon').prop('href').indexOf('default-favicon.ico')>0)?'display:none':'';body_favicon="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle  collapsed display-block' data-toggle='collapse' data-parent='#site-accordion' href='#site-favicon'>\
               <span>"+$.lang[LANG]['editor.favicon']+"</span>\
            </a>\
          </h4>\
        </div>\
        <div id='site-favicon' class='panel-collapse collapse'>\
            <div class='panel-body'>\
                <div class='form-horizontal'>\
                    <div class='form-group'>\
                        <div class='col-xs-12 col-sm-12 col-md-12'>\
                            <img src='//i.addblock.net/config/favicon_info.jpg' alt='' class='img-responsive' />\
                        </div>\
                    </div>\
    ";if(!VALIDPLAN){body_favicon=body_favicon+"\
                    <div class='form-group'>\
                        <div class='col-xs-12 col-sm-12 col-md-12'>\
                            <span class='favicon-description'>"+$.lang[LANG]['editor.favicon.info']+"</span>\
                            <hr class='favicon-dividers' />\
                        </div>\
                    </div>\
                    <div class='form-group'>\
                        <div class='col-xs-6 col-sm-6 col-md-6 col-md-offset-6 text-right'>\
                            <a href='/upgrade/site/"+SID+"' target='_blank'>\
                            <span class='btn btn-primary btn-sm'>\
                                <i class='fa fa-level-up'></i>\
                                <span>"+$.lang[LANG]['editor.favicon.upgrade']+"</span>\
                            </span>\
                            </a>\
                        </div>\
                    </div>\
                    ";}else{body_favicon=body_favicon+"\
                    <div class='form-group'>\
                        <div class='col-xs-12 col-sm-12 col-md-12'>\
                            <span class='favicon-description'>"+$.lang[LANG]['editor.favicon.upgrade.info']+"</span>\
                            <hr class='favicon-dividers' />\
                        </div>\
                    </div>\
                    <div class='form-group'>\
                        <label class='col-xs-4 col-sm-4 col-md-4 control-label'><span data-lang='editor.background.image'>"+$.lang[LANG]['editor.background.image']+"</span></label>\
                        <span class='col-xs-8 col-sm-8 col-md-8'>\
                            <span class='btn btn-sm btn-default fileinput-button favicon-fileinput'>\
                                <i class='glyphicon glyphicon-folder-open'></i>\
                                <input type='file' name='files[]' id='fileupload' class='favicon-upload-button'/>\
                            </span>\
                            <span class='prop-favicon-ctrl'>\
                                <span class='attach-thumb'>\
                                    <img src='"+$('#user-favicon').prop('href')+"' alt='' class='img-responsive favicon-img'/>\
                                </span>\
                                <span class='favicon-progress' style='float:right; display:none;'><i class='fa fa-spinner' aria-hidden='true'></i></span>\
                                <i class='fa fa-trash-o hand' id='favicon-image-delete' data-el='#site-favicon-link' data-pn='favicon-image' style='"+is_favicon+"'></i>\
                            </span>\
                        </span>\
                    </div>\
        ";}body_favicon=body_favicon+"\
                </div>\
            </div>\
        </div>\
    </div>\
    ";body_music="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#site-accordion' href='#site-music'>\
               <span>"+$.lang[LANG]['editor.music']+"</span>\
            </a>\
          </h4>\
        </div>\
        <div id='site-music' class='panel-collapse collapse'>\
            <div class='panel-body'>\
                <div class='form-horizontal'>\
                    <div class='form-group'>\
                        <div class='col-xs-12 col-sm-12 col-md-12'>\
                            <div class='form-group'>\
                                <label class='col-sm-4 control-label'><span data-lang='editor.music.use'>ì‚¬ìš©</span></label>\
                                <span class='col-sm-8'>\
                                    <label class='switch site-music'>\
                                        <input type='checkbox' class='switch-input' id='site-music-use' "+musicUse+">\
                                        <span class='switch-label' data-on='On' data-off='Off'></span>\
                                        <span class='switch-handle'></span>\
                                    </label>\
                                </span>\
                            </div>\
                            <hr>\
                            <ul class='music-list'></ul>\
                            <div class='music-progress progress'><div class='progress-bar' role='progressbar' aria-valuemin='0' aria-valuemax='100'>0%</div></div>\
                            <div class='music-upload-info' data-lang='editor.music.upload.info'></div>\
                            <div class='pull-right'>\
                                <span class='btn btn-sm btn-primary fileinput-button music-fileinput'>\
                                <i class='fa fa-plus'></i> <span data-lang='editor.music.add'>ìŒì•…ì¶”ê°€</span>\
                                <input type='file' name='files[]' id='fileupload' class='music-upload-button'/>\
                                </span>\
                            </div>\
                        </div>\
                    </div>\
                </div>\
            </div>\
        </div>\
    </div>\
    ";var body_popup="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#site-accordion' href='#site-popup'>\
               <span>"+$.lang[LANG]['editor.popup']+"</span>\
            </a>\
          </h4>\
        </div>\
        <div id='site-popup' class='panel-collapse collapse'>\
            <div class='panel-body'>\
                <div class='form-horizontal'>\
                    <div class='form-group'>\
                        <div class='col-xs-12 col-sm-12 col-md-12'>\
                            <div class='form-group'>\
                                <label class='col-sm-4 control-label'><span>"+$.lang[LANG]['editor.popup.use']+"</span></label>\
                                <span class='col-sm-8'>\
                                    <label class='switch site-popup'>\
                                        <input type='checkbox' class='switch-input' id='site-popup-use' "+popupUse+">\
                                        <span class='switch-label' data-on='On' data-off='Off'></span>\
                                        <span class='switch-handle'></span>\
                                    </label>\
                                </span>\
                                <!--<span class='col-sm-4 no-padding'>\
                                    <div class='refresh-wrap popup-panel'>\
                                        <span class='btn btn-xs btn-default popup-refresh'data-toggle='tooltip' data-placement='top' data-html='true' data-original-title='"+$.lang[LANG]['editor.popup.tooltip.refresh']+"'><i class='fa fa-refresh' ></i> "+$.lang[LANG]['editor.popup.refresh']+"</span>\
                                    </div>\
                                </span>-->\
                            </div>\
                            <hr class='popup-panel'>\
                            <ul class='popup-list popup-panel'></ul>\
                            <div class='popup-info popup-panel'>"+$.lang[LANG]['editor.popup.info']+"</div>\
                            <div class='pull-right popup-panel'>\
                                <span class='btn btn-sm btn-primary fileinput-button site-popup-add'>\
                                    <i class='fa fa-plus'></i> "+$.lang[LANG]['editor.popup.add']+"\
                                </span>\
                            </div>\
                        </div>\
                    </div>\
                </div>\
            </div>\
        </div>\
    </div>\
    ";$('#site-accordion').append(body_basic).append(body_meta).append(body_onepage).append(body_rclick).append(body_zoom).append(body_background).append(body_font).append(body_favicon).append(body_music).append(body_popup);$.each(MUSIC,function(i,v){addMusicItem(v.title,v.id,v.pos);if(MUSIC.length>4){$('.music-fileinput').hide();}});$.each(popup_o,function(i,o){addPopupItem(i,o);if(i>=2){$('.site-popup-add').hide();return false;}});if(!popupUse)$('.popup-panel').hide();$('.music-list').sortable({handle:'.drag-handle',update:function(event,ui){updateMusicList();}});$('.music-list').disableSelection();(url_path)?$('.prop-body-background-option').show():$('.prop-body-background-option').hide();$("#site-accordion").collapse({toggle:false});$('.style-picker').colpick({color:'#0088CC',onSubmit:function(hsb,hex,rgb){setStyleColor(rgb);$('.current-color').text('#'+hex);$('.style-picker').css('background-color','#'+hex);$('.style-picker').colpickHide();}});$('.bg-picker').colpick({color:bc.bgColor,onSubmit:function(hsb,hex,rgb){setStyleCss('.dsgn-body','background-color','#'+hex);$('.txt-dsgn-background-color').text('#'+hex);$('.bg-picker').css('background-color','#'+hex);$('.bg-picker').colpickHide();setLogs("SITE","background.color.false","transparent-false","SITE");}});$('.font-picker-body').colpick({color:bc.txColor,onSubmit:function(hsb,hex,rgb){setStyleCss('.dsgn-body','color','#'+hex);$('.txt-dsgn-font-color').text('#'+hex);$('.font-picker-body').css('background-color','#'+hex);$('.font-picker-body').colpickHide();setLogs("SITE","font.color","transparent-false","SITE");}});$('.music-upload-button').fileupload({url:'/template/music/upload',dataType:'json',async:true,cache:false,add:function(e,data){$('.music-progress').show();data.submit();},progressall:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);$('.music-progress .progress-bar').css('width',progress+'%').text(progress+'%');if(progress==100){$('.music-progress .progress-bar').html('<i class="fa fa-spinner fa-spin"></i> Upload cloud storage...');}},done:function(e,data){if(typeof data.result.error!='undefined'&&data.result.error){$(this).showModalFlat('INFORMATION',data.result.error,true,false,'','ok');$('.music-progress').hide();$('.music-progress .progress-bar').html('');return;}if(typeof data.result.file=='undefined'&&!data.result.file){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.music.uploaded.error'],true,false,'','ok');$('.music-progress').hide();$('.music-progress .progress-bar').html('');return;}else{var $list=$('.music-list');addMusicItem(data.result.title,data.result.seq,data.result.pos,function(){updateMusicList();});$('.music-progress').hide();$('.music-progress .progress-bar').html('');}},}).prop('disabled',!$.support.fileInput).parent().addClass($.support.fileInput?undefined:'disabled');$('.favicon-upload-button').fileupload({url:'/template/resource/upload-favicon',dataType:'json',async:true,cache:false,add:function(e,data){data.submit();},progressall:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);if(progress==100)$('.favicon-progress').hide();},done:function(e,data){if(typeof data.result.error!='undefined'&&data.result.error){$(this).showModalFlat('ERROR',data.result.error,true,false,'','ok');return;}if(typeof data.result.file=='undefined'&&!data.result.file){$(this).showModalFlat('ERROR',$.lang[LANG]['editor.favicon.uploaded.error'],true,false,'','ok');return;}else{$('.prop-favicon-ctrl .attach-thumb').empty().append('<img src="'+data.result.file+'?_'+new Date().getTime()+'" alt="" class="img-responsive favicon-img"/>');$('.prop-favicon-ctrl').find('#favicon-image-delete').show();}},}).prop('disabled',!$.support.fileInput).parent().addClass($.support.fileInput?undefined:'disabled');$('#favicon-image-delete').live({click:function(){$.ajax({url:'/template/resource/delete-favicon',data:{sid:SID},type:'POST',async:true,success:function(data){checkError(data);$('.prop-favicon-ctrl .attach-thumb').empty().append('<img src="//i.addblock.net/default-favicon.ico" alt="" class="img-responsive favicon-img"/>');$('#favicon-image-delete').hide();}});}});}
$('.site-meta-edit').live('click',function(e){$.post('/template/update/type/get_meta',{id:SID,s:'config'},function(data){if(typeof data.error!="undefined"&&data.error){checkError(data);return false;}var meta=jQuery.parseJSON(data.meta);var newStr="\
                    <div class='meta-top'>\
                        "+$.lang[LANG]['editor.meta.headtext']+"<br>\
                        <a class='help' href='/support/search/meta%20tag' target='_blank'>"+$.lang[LANG]['config.map.info1-link']+" <i class='fa fa-caret-right'></i></a> \
                        <a class='help' href='/support/search/webmaster' target='_blank'>"+$.lang[LANG]['config.webmaster.howto-more']+" <i class='fa fa-caret-right'></i></a>\
                    </div>\
                    <div class='meta-box'>\
                        <ul id='meta-source'>\
                            <li class='default'>\
                                <div>"+$.lang[LANG]['editor.meta.author']+"<input class='key' type='hidden' value='author' /></div>\
                                <input class='val' type='text' value='"+meta.author+"'/>\
                            </li>\
                            <li class='default'>\
                                <div>"+$.lang[LANG]['editor.meta.title']+"<input class='key' type='hidden' value='title'/></div>\
                                <!--<input class='val' type='text' value='"+meta.title+"'/>-->\
                                <i class='fa fa-info-circle' data-toggle='tooltip' data-placement='right' data-html='true' data-original-title='"+$.lang[LANG]['editor.meta.title.info']+"'></i>\
                                <span id='site-meta-title'>"+meta.title+" </span>\
                            </li>\
                            <li class='default'>\
                                <div>"+$.lang[LANG]['editor.meta.description']+"<input class='key' type='hidden' value='description'/></div>\
                                <input class='val' type='text' value='"+meta.description+"' placeholder='"+$.lang[LANG]['editor.meta.description.placeholder']+"'/>\
                            </li>\
                            <li class='default'>\
                                <div>"+$.lang[LANG]['editor.meta.keywords']+"<input class='key' type='hidden' value='keywords'/></div>\
                                <input class='val' type='text' value='"+meta.keywords+"' placeholder='"+$.lang[LANG]['editor.meta.keywords.placeholder']+"'/>\
                            </li>\
                    ";var getStr=$.each(meta,function(k,v){if(k!='author'&&k!='title'&&k!='description'&&k!='keywords'){newStr=newStr+"\
                            <li class='"+v+"'>\
                                <input class='key' type='text' value='"+k+"'/>\
                                <input class='val' type='text' value='"+v+"'/>\
                                <div class='meta-cancel'><img src='//i.addblock.net/icon/fa-meta-close.png' class='fa fa-close'/></div>\
                            </li>";}});newStr=newStr+"\
                        </ul>\
                        <div class='btn meta-plus'><img src='//i.addblock.net/icon/fa_plus_icon.png'> "+$.lang[LANG]['editor.meta.add']+"</div>\
                    </div>";var modal=$(this).showModalFlat('EDIT META TAG',newStr,true,true,function(){var arrkey={},arrval={},tag=new Object(),isValid=true;$('#meta-source li').each(function(i){if($(this).find('input.key').val()){arrkey[i]=$(this).find('input.key').val();arrval[i]=($(this).find('#site-meta-title').length===1)?$(this).find('#site-meta-title').text().trim():$(this).find('input.val').val();tag[arrkey[i]]=arrval[i];}else{isValid=false;$(this).find('input.key').focus();if($('.meta-box').find('.error').length==0)$('.meta-box').append("<label class='error'>"+$.lang[LANG]['editor.meta.empty.name']+"</label>");return false;}});if(isValid){if($('.meta-box').find('.error').length>0)$('.meta-box .error').remove();$.post('/template/update/type/meta',{id:SID,s:JSON.stringify(tag)},function(data){if(typeof data.error!="undefined"&&data.error){$(this).showModalFlat('ERROR',data.error,true,false,'','ok');return false;}modal.modal('hide');},'json');}},'cancel','w480');$('.flat-modal .modal-body').css('padding','0px 30px 15px');$('.flat-modal .modal-footer').css('padding-bottom','0');},'json');});$('.meta-cancel').live('click',function(e){$(this).parent().remove();if($('.meta-box').find('.error').length>0)$('.meta-box .error').remove();});$('.meta-plus').live('click',function(e){var metaKey=$('#meta-source li').last().find('input.key'),metaVal=$('#meta-source li').last().find('input.val');if((metaKey.val().length>0||metaVal.val().length>0)&&($('.meta-box').find('.error').length>0))$('.meta-box .error').remove();if(metaKey.val().length==0){metaKey.focus();if($('.meta-box').find('.error').length==0)$('.meta-box').append("<label class='error'>"+$.lang[LANG]['editor.meta.empty.name']+"</label>");}else if(metaVal.val().length==0&&!metaVal.parent().hasClass('default')){metaVal.focus();if($('.meta-box').find('.error').length==0)$('.meta-box').append("<label class='error' style='margin-left:80px;'>"+$.lang[LANG]['editor.meta.empty.content']+"</label>");}else{$('#meta-source').append('<li><input class="key" type="text" value=""/><input class="val" type="text" value=""/><div class="meta-cancel"><img src="//i.addblock.net/icon/fa-meta-close.png" class="fa fa-close"/></div></li>');$('#meta-source li').last().find('input.key').css('margin-right','2.333%').focus();}});$('.meta-reset').live('click',function(e){$('.modal-backdrop').remove();$('#flat-modal').remove();$.post('/template/update/type/meta',{id:SID,s:'reset'},function(data){if(typeof data.error!="undefined"&&data.error){$(this).showModalFlat('ERROR',data.error,true,false,'','ok');return false;}$('.site-meta-edit').click();},'json');});$('#text-deco-body').live({click:function(){var j=CSSJSON.toJSON($('#dsgn-'+SID).text());deco=style.getCssProperty(j,'.dsgn-body a:hover','text-decoration'),td=$(this).prop('checked');j=(td)?setStyleCss('.dsgn-body a:hover','text-decoration','underline'):setStyleCss('.dsgn-body a:hover','text-decoration','none');}});$('.set-style').live({click:function(){var color=$(this).css('background-color'),hex=style.getHex(color),rgb=style.getRGBobject(color);$('.current-color').text(hex);$('.style-picker').css('background-color',color);setStyleColor(rgb);}});$('.default_project_contents').live({click:function(){if(VIEW)$('.addElementButton.addel_0').find('.add-block').click();}});var getElementController=function(el){clearElementController();var content=$('.prop-content'),css=getStyleText(),selector=(selectEL=='el-menu')?'menu-'+SID:$('.'+el).attr('data-name'),j=(selectEL=='el-menu')?CSSJSON.toJSON($('#'+selector).text()):CSSJSON.toJSON($('#'+selector+'css').text()),isPB=($('#el-property').attr('data-project-block'))?true:false;if(selector==''){alert('Invalid variable EL data-name');return false;}var s=style.get(css,selector),seq=(selectEL=='el-menu')?"menu":$('.'+el).data('id'),bg=(selectEL=='el-menu')?style.getCssProperty(j,'.'+selector,'background-image').trim().replace(/^url\(['"]?/,'').replace(/['"]?\)$/,''):$('.'+el).css('background-image').trim().replace(/^url\(['"]?/,'').replace(/['"]?\)$/,''),wp=(selectEL=='el-menu')?!$('header.navbar').children().hasClass('full-width'):!$('.'+el).children().hasClass('full-width'),d={},logo_text_color=style.getHex($('.menu-'+SID+' #tpl-logo-text').css('color')),elname=(selectEL=='el-menu')?'menu-'+SID:$('.'+el).data('name'),bp=style.getCssProperty(css,'.'+elname,'background-position'),br=style.getCssProperty(css,'.'+elname,'background-repeat'),bs=style.getCssProperty(css,'.'+elname,'background-size'),bgVideo=$('.'+el).find('[data-bg-video="true"]');bp=(bp=='center')?'center center':bp;if(selectEL=='el-menu'){s.txColor=style.getHex($('.el-menu ul.navbar-nav > li:not(.active) > a').first().css('color'));}if(selectEL!='el-menu'){$.ajax({url:'/template/element/type/get/seq/'+seq,dataType:'json',async:false,cache:false,success:function(data){checkError(data);d=data[0];}});}if(selectEL=='el-menu')d.type="";if(typeof d=='undefined')return false;content.empty();if(isEDIT==false)content.append($("<li>").append("<div class='panel-group content-property' id='prop-accordion'>"));var settings=(d.elsettings==""||typeof d.elsettings=="undefined")?{}:$.parseJSON(d.elsettings);content_change="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:15px;'>\
            <div id='menu-show'>\
                <a class='accordion-toggle no-toggle' data-lang='config.extra.change-menu'>\
                  Change menu design\
                </a>\
                <span class='pull-right'>\
                    <i class='fa fa-refresh menu-change-style'></i>\
                </span>\
            </div>\
          </h4>\
        </div>\
      </div>\
    ";gallery_change="\
      <div class='panel panel-default panel-line'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:15px;'>\
            <div id='change-gallery'>\
                <a class='accordion-toggle no-toggle' data-lang='config.gallery.change-gallery'>\
                    CHANGE GALLERY\
                </a>\
                <span class='pull-right'>\
                <i class='fa fa-refresh menu-change-style'></i>\
                </span>\
            </div>\
          </h4>\
        </div>\
      </div>\
    ";forum_config="\
      <div class='panel panel-default panel-line'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:15px;'>\
            <div id='change-forum'>\
                <a class='accordion-toggle no-toggle' data-lang='forum.change-design'></a>\
                <span class='pull-right'>\
                    <i class='fa fa-refresh menu-change-style'></i>\
                </span>\
            </div>\
          </h4>\
        </div>\
      </div>\
    ";footer_change="\
      <div class='panel panel-default panel-line'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:15px;'>\
            <div id='footer-show'>\
                <a class='accordion-toggle no-toggle'>\
                  "+$.lang[LANG]['config.footer.change']+"\
                </a>\
                <span class='pull-right'>\
                    <i class='fa fa-refresh menu-change-style'></i>\
                </span>\
            </div>\
          </h4>\
        </div>\
      </div>\
    ";project_change="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:15px;'>\
            <div id='change-project-titleblock' data-elname='"+d.elname+"'>\
                <a class='accordion-toggle no-toggle' data-lang='config.project.change-titleblock'>\
                    CHANGE PROJECT TITLE\
                </a>\
                <span class='pull-right'>\
                    <i class='fa fa-refresh menu-change-style'></i>\
                </span>\
            </div>\
          </h4>\
        </div>\
      </div>\
    ";sns_config="";if(d.type=="sns"&&d.type2=='feed'){if(typeof settings.sns=="undefined"){settings.sns={};}var el_twitter=(typeof settings.sns.twitter=='undefined')?'':settings.sns.twitter,el_instagram=(typeof settings.sns.instagram=='undefined')?'':settings.sns.instagram,el_facebook=(typeof settings.sns.facebook=='undefined')?'':settings.sns.facebook;var str_instagram=(typeof el_instagram.token!='undefined'&&el_instagram.token.length>0)?[el_instagram.token,el_instagram.expires,el_instagram.id,el_instagram.name,$.lang[LANG]['config.sns.feed.disconnect']]:['','','','',$.lang[LANG]['config.sns.feed.connect']];sns_config="\
          <div class='panel panel-default'>\
            <div class='panel-heading'>\
              <h4 class='panel-title'>\
                <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-sns-account' data-lang='config.sns.feed-info'></a>\
              </h4>\
            </div>\
            <div id='prop-sns-account' class='panel-collapse collapse'>\
                <div class='panel-body'>\
                    <p class='sns-twitter'>\
                        <label class='sm' data-lang=''><i class='fa fa-twitter' aria-hidden='true'></i></label>\
                        <span><input type='text' value='"+el_twitter+"' placeholder='@creatorlink' /></span>\
                    </p>\
                    <p class='sns-instagram'>\
                        <label class='sm' data-lang=''><i class='fa fa-instagram' aria-hidden='true'></i></label>\
                        <span>\
                            <input type='hidden' class='sns-instagram-token' value='"+str_instagram[0]+"' />\
                            <input type='hidden' class='sns-instagram-expires' value='"+str_instagram[1]+"' />\
                            <input type='hidden' class='sns-instagram-id' value='"+str_instagram[2]+"' />\
                            <span class='sns-user'><input type='text' class='sns-instagram-name' value='"+str_instagram[3]+"' placeholder='creatorlink' disabled /></span>\
                            <span class='btn btn-default btn-sm btn-right' id='sns-account-instagram'>"+str_instagram[4]+"</span>\
                        </span>\
                    </p>\
                    <p class='sns-facebook'>\
                        <label class='sm' data-lang=''><i class='fa fa-facebook' aria-hidden='true'></i></label>\
                        <span><input type='text' value='"+el_facebook+"' placeholder='"+$.lang[LANG]["config.available.soon"]+"' disabled /></span>\
                    </p>\
                    <p class='prop-ctrl' style='padding: 0 20px; text-align: right;'><span class='btn btn-default btn-sm' id='sns-account-save' data-lang='config.save'></span></p>\
                </div>\
            </div>\
          </div>\
        ";}content_overlap="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:0px;'>\
            <a class='accordion-toggle no-toggle' data-lang='config.overlap'>\
              Overlay menu\
            </a>\
              <span class='pull-right' style='padding-top: 6px;margin-right: 10px;line-height: 1;'>\
                <label class='switch prop-wrap'>\
                    <input type='checkbox' class='switch-input' id='content-overlap'>\
                    <span class='switch-label' data-on='On' data-off='Off'></span>\
                    <span class='switch-handle'></span>\
                </label>\
              </span>\
          </h4>\
        </div>\
      </div>\
    ";content_wrap="\
      <div class='panel panel-default panel-line'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:0px;'>\
            <a class='accordion-toggle no-toggle' data-lang='config.content-wrap'>\
              Content wrap\
            </a>\
              <span class='pull-right' style='padding-top: 3px;margin-right: 10px;line-height: 1;'>\
                <label class='switch prop-wrap'>\
                    <input type='checkbox' class='switch-input' id='content-wrap' data-el='"+el+"'>\
                    <span class='switch-label' data-on='On' data-off='Off'></span>\
                    <span class='switch-handle'></span>\
                </label>\
              </span>\
          </h4>\
        </div>\
      </div>\
    "
var disabled_type=['video','others'],disabled_padding=($.inArray(d.type,disabled_type)>-1&&d.eltag.indexOf('data-bg-video')>-1)?true:false;if(disabled_padding){content_padding="\
      <div class='panel panel-default panel-line'>\
        <div class='panel-heading disabled'>\
          <h4 class='panel-title' style='padding-right:0px;'>\
            <a class='accordion-toggle no-toggle'>\
              "+$.lang[LANG]['config.content-padding']+"\
              <span class='bgvid-cp-tooltip'><i class='fa fa-exclamation-circle' data-toggle='tooltip' data-placement='bottom' data-html='true' data-original-title='"+$.lang[LANG]['editor.bg-video.tooltip.content-padding']+"' ></i></span>\
            </a>\
          </h4>\
        </div>\
      </div>\
    ";}else{content_padding="\
    <div class='panel panel-default'>\
        <div class='panel-heading'>\
            <h4 class='panel-title'>\
                <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-padding' data-lang='config.content-padding'>\
                    Content Padding\
                </a>\
            </h4>\
        </div>\
        <div id='prop-padding' class='panel-collapse collapse'>\
          <div class='panel-body'>\
            <div class='sl'><label class='sm'><span data-lang='config.content-padding.top'>top</span> <span class='slider-value'>"+s.pdTop+"</span>px</label>\
            <div class='el-slider' data-slider-min='0' data-slider-max='100' data-slider-step='2' data-slider-value='"+s.pdTop+"' data-slider-tooltip='hide' el='"+el+"' selector='"+selector+"' pn='padding-top'></div></div>\
            <div class='sl'><label class='sm'><span data-lang='config.content-padding.bottom'>bottom</span> <span class='slider-value'>"+s.pdBottom+"</span>px</label>\
            <div class='el-slider' data-slider-min='0' data-slider-max='100' data-slider-step='2' data-slider-value='"+s.pdBottom+"' data-slider-tooltip='hide' el='"+el+"' selector='"+selector+"' pn='padding-bottom'></div></div>\
            <!--<div class='sl'><label class='sm'><span data-lang='config.content-padding.left'>left</span> <span class='slider-value'>"+s.pdLeft+"</span>px</label>\
            <div class='el-slider' data-slider-min='0' data-slider-max='100' data-slider-step='2' data-slider-value='"+s.pdLeft+"' data-slider-tooltip='hide' el='"+el+"' selector='"+selector+"' pn='padding-left'></div></div>\
            <div class='sl'><label class='sm'><span data-lang='config.content-padding.right'>right</span> <span class='slider-value'>"+s.pdRight+"</span>px</label>\
            <div class='el-slider' data-slider-min='0' data-slider-max='100' data-slider-step='2' data-slider-value='"+s.pdRight+"' data-slider-tooltip='hide' el='"+el+"' selector='"+selector+"' pn='padding-right'></div></div>-->\
            <div class='sl'><label class='sm'></label><div class='prop-ctrl'><span class='btn btn-default btn-xs' onclick=\"reset_padding('"+el+"',"+s.pdTop+","+s.pdBottom+","+s.pdLeft+","+s.pdRight+");\" data-lang='config.content-padding.reset'>ì´ì „ ì†ì„±</span></div></div>\
          </div>\
        </div>\
      </div>\
    ";}checked=(s.bgColor=='transparent'||s.bgColor=='none'||!s.bgColor)?"checked":"";checked_class=(checked)?"transparent":"";background="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-background' data-lang='editor.background'>\
              Background\
            </a>\
          </h4>\
        </div>\
        <div id='prop-background' class='panel-collapse collapse'>\
          <div class='panel-body'>\
            <p>\
                <label class='sm' data-lang='editor.background.color'>Color</label>\
                <span class='color-picker'>\
                    <span class='color tooltips bg-picker-"+el+" "+checked_class+"' el='"+el+"' selector='"+selector+"' pn='background-color' data-toggle='tooltip' data-placement='top' title='color' style='background-color:"+s.bgColor+"'></span> &nbsp;\
                    <span class='sm-upper'><input type='checkbox' class='check-transparent' "+checked+" data-el='bg-picker-"+el+"'> <span data-lang='editor.background.color.transparent'>Transparent</span></span>\
                </span>\
            </p>\
            <p>\
                <label class='sm' data-lang='editor.background.image'>Image</label>";background=background+"\
                <span class='btn btn-default fileinput-button' data-toggle='modal' el='"+el+"' data-target='#el-fileupload' id='prop-method-background'>\
                    <i class='glyphicon glyphicon-folder-open'></i>&nbsp;\
                </span>\
                <span class='prop-background-el'>";if(bg!='none'&&bg!='initial'&&bg!='')background=background+"<span class='attach-thumb'><img src='"+bg+"'></span> <i class='fa fa-trash-o hand' id='prop-background-delete' data-el='"+el+"' data-pn='background-image'></i>";background=background+"\
                </span>\
            </p>\
    ";background=background+"\
            <div class='prop-background-option'>\
            <p>\
                <label class='sm' data-lang='editor.background.position'>Position</label>\
    ";background=background+style.selectBackgroundSelectForm('position','el-background-position',bp,elname);background=background+"\
            </p>\
            <p>\
                <label class='sm' data-lang='editor.background.repeat'>Repeat</label>\
    ";background=background+style.selectBackgroundSelectForm('repeat','el-background-repeat',br,elname);background=background+"\
            </p>\
            <p>\
                <label class='sm' data-lang='editor.background.size'>Size</label>\
    ";background=background+style.selectBackgroundSelectForm('bgsize','el-background-size',bs,elname);background=background+"\
            </p>\
            </div>\
    ";form_config='';if(d.type=="form"){form_config="\
      <div class='panel panel-default panel-line'>\
        <div class='panel-heading'>\
          <h4 class='panel-title' style='padding-right:0px;'>\
            <a class='accordion-toggle no-toggle openFormConfig' data-lang='config.form' data-id='"+d.seq+"'>\
              Form config\
            </a>\
              <span class='pull-right' style='padding-top: 7px;margin-right: 16px;line-height: 1;'>\
                <i class='fa fa-cog openFormConfig' data-id='"+d.seq+"'></i>\
              </span>\
              <span class='pull-right' style='padding-top: 6px;line-height: 1;'>\
                <label class='label label-default label-form' style='text-align:center;padding-top:3px;'><a href='/forms' target='_blank'>"+$.lang[LANG]['form.link.text']+"</a></label>\
              </span>\
          </h4>\
        </div>\
      </div>\
    ";}if(typeof $(bgVideo).attr('data-bg-video')!='undefined'){var openVideoPanel=(d.type2=="countdown")?false:true,collapse_class=(openVideoPanel)?['','in']:['collapsed','collapse'];background="\
          <div class='panel panel-default'>\
            <div class='panel-heading'>\
              <h4 class='panel-title'>\
                <a class='accordion-toggle display-block "+collapse_class[0]+"' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-background' data-lang='editor.background'>\
                  Background\
                </a>\
              </h4>\
            </div>\
            <div id='prop-background' class='panel-collapse "+collapse_class[1]+"'>\
              <div class='panel-body bg-video'>\
          ";bg_video_info="\
            <div class='bg-video-info tooltip bottom "+LANG+"'>\
                <div class='tooltip-arrow'>\
                </div>\
                <div class='tooltip-inner'>\
                    <p>\
                      <span class='ex'>"+$.lang[LANG]['editor.bg-video.info.2']+"</span>\
                      <br><span class='ex-link first'>"+$.lang[LANG]['editor.bg-video.info.3']+"</span>\
                      <span class='ex-link'>"+$.lang[LANG]['editor.bg-video.info.4']+"</span>\
                    </p>\
                    <ul class='video-req-list'>\
                      <li class='list-title'>"+$.lang[LANG]['editor.bg-video.info.5']+"</li>\
                      <li>"+$.lang[LANG]['editor.bg-video.info.6']+"</li>\
                      <li>"+$.lang[LANG]['editor.bg-video.info.7']+"</li>\
                      <li>"+$.lang[LANG]['editor.bg-video.info.8']+"</li>\
                      <li>"+$.lang[LANG]['editor.bg-video.info.9']+"</li>\
                    </ul>\
                </div>\
            </div>\
            ";bg_video_resource="\
                <div class='prop-images' style='padding: 0px 20px 5px;'>\
                    <i class='fa fa-video-camera'></i>\
                    <span data-lang='config.extra.bg-video'>Video</span>\
                    <span class='trigger no-padding'>\
                        <i class='fa fa-question-circle'></i>\
                    </span>"+bg_video_info+"</div>\
                <div class='bg-video-controller'>\
            ";$(bgVideo).find('source').each(function(){var $this=$(this),src=$(this).prop('src');if($this.hasClass('display'))vd_src=src;});vd_input="\
                    <div class='input-group'>\
                      <span class='input-group-addon icon'><i class='fa fa-link'></i></span>\
                      <input type='text' class='form-control bg-video-url' value='"+vd_src+"'>\
                      <span class='input-group-btn save-btn'>\
                        <button class='btn btn-default save-bg-video-url' type='button' data-el='"+el+"'><span data-lang='config.save'>save</span></button>\
                      </span>\
                    </div>\
            ";bg_preview_image_info="\
          <div class='bg-preview-image-info tooltip bottom "+LANG+"'>\
            <div class='tooltip-arrow'>\
            </div>\
            <div class='tooltip-inner'>\
              <p class='text'>"+$.lang[LANG]['editor.bg-preview-image.info.1']+"</p>\
            </div>\
          </div>\
          ";bg_poster="\
                <div class='prop-images' style='padding: 0px 20px 5px;'>\
                    <i class='fa fa-picture-o'></i>\
                    <span data-lang='editor.bg-video.poster'>ì •ì§€ ì´ë¯¸ì§€</span>\
                    <span class='trigger no-padding'>\
                        <i class='fa fa-question-circle'></i>\
                    </span>"+bg_preview_image_info+"</div>\
                <div class='bg-video-poster-controller'>\
            ";poster_src=$(bgVideo).attr('data-poster-thumb');poster_change="\
                    <p>\
                        <span class='btn btn-default fileinput-button' data-toggle='modal' el='"+el+"' data-target='#el-fileupload' id='bg-video-poster-change'>\
                            <i class='glyphicon glyphicon-folder-open'></i>&nbsp;\
                        </span>\
                        <span class='prop-video-poster'>";poster_change=poster_change+"\
                        <span class='attach-thumb'>\
                            <img src='"+poster_src+"'>\
                        </span>\
            ";poster_change=poster_change+"\
                        </span>\
                    </p>";background=background+bg_video_resource;background=background+vd_input;background=background+"\
                </div>\
            ";background=background+bg_poster;background=background+poster_change;background=background+"\
                </div>\
            ";}background=background+"\
          </div>\
        </div>\
      </div>\
      ";var isBookmark=(typeof settings.bookmark!='undefined'&&settings.bookmark)?'checked':'',bookmark_name_hide=(isBookmark.length>0)?'':'hide',bookmark_name=(isBookmark.length>0)?settings.bookmark:'';bookmark="\
    <div class='panel panel-default'>\
        <div class='panel-heading'>\
            <h4 class='panel-title'>\
                <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-bookmark'>\
                    "+$.lang[LANG]['config.bookmark.1']+" \
                    <span class='bookmark-tooltip'><i class='fa fa-question-circle' data-toggle='tooltip' data-placement='top' data-html='true' data-original-title='"+$.lang[LANG]['editor.link.bookmark.info']+"' ></i></span>\
                </a>\
            </h4>\
        </div>\
        <div id='prop-bookmark' class='panel-collapse collapse'>\
            <div class='panel-body'>\
                <p>\
                    <label class='sm'>"+$.lang[LANG]['config.bookmark.2']+"</label>\
                    <span class='property-bookmark-wrap'>\
                        <label class='switch prop-wrap'>\
                            <input type='checkbox' class='switch-input' id='bookmark' data-el='"+el+"' "+isBookmark+"/>\
                            <span class='switch-label' data-on='On' data-off='Off'></span>\
                            <span class='switch-handle'></span>\
                        </label>\
                    </span>\
                </p>\
                <p class='property-bookmark-name-wrap "+bookmark_name_hide+"'>\
                    <label class='sm'>"+$.lang[LANG]['config.bookmark.name']+"</label>\
                    <span>\
                        <input type='text' value='"+bookmark_name+"' />\
                        <i class='fa fa-check bookmark-name-saved hide'></i>\
                        <span class='btn btn-default btn-sm' id='bookmark-name-save' data-lang='config.save' data-el='"+el+"'></span>\
                    </span>\
                </p>\
                <p class='error hide'>\
                    <label class='sm'></label>\
                    <span data-lang='config.bookmark.name.length'></span>\
                </p>\
            </div>\
        </div>\
    </div>\
    ";if(d.type==""||d.elname=='footer'){contact_settings_email="";}else{var obj_setting=(d.elsettings=="")?"":$.parseJSON(d.elsettings);contact_settings_email=(typeof obj_setting['contact_email']=="undefined")?"":obj_setting['contact_email'];var gallery_settings_category=(typeof obj_setting['category']=="undefined")?"category1, category2, category3":obj_setting['category'].replace(/\|/g,"").replace(/\,/g,", "),gallery_settings_category_display=(typeof obj_setting['category_display']=="undefined")?"OFF":obj_setting['category_display'];}if(d.type=="gallery")$('#el-property').addClass('maxheight');else $('#el-property').removeClass('maxheight');if(d.type=="gallery"||d.type=='forum'){var tag=htmlspecialchars_decode(d.eltag),view=$(tag).find('[data-loop="true"]').data('view');dataview_config="\
          <div class='panel panel-default'>\
            <div class='panel-heading'>\
              <h4 class='panel-title'>\
                <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-list-dataview' data-lang='config.list.dataview'>\
                    Number of posts per page\
                </a>\
              </h4>\
            </div>\
            <div id='prop-list-dataview' class='panel-collapse collapse'>\
                <div class='panel-body'>\
                    <p class='list-default-number'>\
                        <label class='sm'>"+$.lang[LANG]['config.number']+"</label>\
                        <span>\
                            <input type='number' value='"+view+"'/>\
                            <span class='btn btn-default btn-sm' id='list-dataview-save' data-lang='config.save' data-type='"+d.type+"'></span>\
                        </span>\
                    </p>\
                    <p class='error hide'>\
                        <label class='sm'></label>\
                        <span data-lang='config.list.dataview.required'></span>\
                    </p>\
                </div>\
            </div>\
          </div>\
        ";}if(d.type=="others"&&d.type2=="countdown"){var tag=htmlspecialchars_decode(d.eltag),elsettings=(d.elsettings=="")?"":$.parseJSON(d.elsettings),cd_date=(typeof elsettings.countdown!="undefined"&&elsettings.countdown)?elsettings.countdown:$(tag).find('[data-dday="true"]').attr('data-countdown');var collapse_class=(d.type=="others"&&d.type2=="countdown")?['','in']:['collapsed','collapse'];dday_config="\
          <div class='panel panel-default'>\
            <div class='panel-heading'>\
              <h4 class='panel-title'>\
                <a class='accordion-toggle display-block "+collapse_class[0]+"' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-countdown' data-lang='config.dday'>\
                    Date calculation\
                </a>\
              </h4>\
            </div>\
            <div id='prop-countdown' class='panel-collapse "+collapse_class[1]+"'>\
                <div class='panel-body'>\
                    <p class='setdate'>\
                        <label class='sm'>"+$.lang[LANG]['config.dday.setdate']+"</label>\
                        <span>\
                            <input type='text' placeholder='"+$.lang[LANG]['config.dday.required']+"' class='ddaydatetimepicker' value='"+cd_date+"'/>\
                        </span>\
                    </p>\
                    <p class='error hide'>\
                        <label class='sm'></label>\
                        <span data-lang='config.dday.required'></span>\
                    </p>\
                </div>\
            </div>\
          </div>\
        ";}if(d.type=="gallery"){var gc_font_name=$('.'+d.elname).find('.gallery-category-nav li a').css('font-family');if(typeof gc_font_name=='undefined'||!gc_font_name||gc_font_name=='initial'){var tmp=$('.dsgn-body').css('font-family').split(",");gc_font_name=tmp[0].replace(/\'/g,'').replace(/\"/g,'').trim();}else{gc_font_name=gc_font_name.split(",");gc_font_name=gc_font_name[0].replace(/\"/g,'').replace(/\'/g,'').trim();}var gc_font=style.selectFontSelectForm('ctrl-font-family-el',gc_font_name,'.'+d.elname+' .gallery-category-nav li a');var $gc_default=$('.'+d.elname).find('.gallery-category-nav li:not(.active) a'),$gc_active=$('.'+d.elname).find('.gallery-category-nav li.active a');var gc_color_font=$gc_default.css('color'),gc_color_font_active=$gc_active.css('color'),gc_color_background=$gc_default.css('background-color'),gc_color_background_active=$gc_active.css('background-color'),gc_color_border=($gc_default.css('border-bottom-width')!='0px')?$gc_default.css('border-bottom-color'):'',gc_color_border_active=($gc_active.css('border-bottom-width')!='0px')?$gc_active.css('border-bottom-color'):'';var gc_color_set={gc_color_font:gc_color_font,gc_color_font_active:gc_color_font_active,gc_color_background:gc_color_background,gc_color_background_active:gc_color_background_active,gc_color_border:gc_color_border,gc_color_border_active:gc_color_border_active}
var gc_color_mode=$('.'+d.elname).find('.gallery-category-nav').attr('data-category-color'),gc_color=style.selectGalleryCategoryColorSetFrom('ctrl-color-set-cg',gc_color_set,el,d.elname,gc_color_mode);var gc_text_align=$('.'+d.elname).find('.gallery-category-wrap').css('text-align'),gc_align=style.selectTextAlignForm('ctrl-text-align-el',gc_text_align,'.'+d.elname+' .gallery-category-wrap');gallery_settings_category_display=(gallery_settings_category_display=="ON")?true:false;var gc_display=(gallery_settings_category_display)?'':'disabled';gallery_category="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-category' data-lang='editor.gallery.category.config'>\
                "+$.lang[LANG]['editor.gallery.category.config']+"\
            </a>\
          </h4>\
        </div>\
        <div id='prop-category' class='panel-collapse collapse'>\
            <div class='panel-body'>\
                <div class='line'>\
                    <label class='sm'>"+$.lang[LANG]['editor.gallery.category']+"</label>\
                    <span class='switch-wrap'>\
                        <label class='switch prop-wrap'>\
                            <input type='checkbox' class='switch-input' id='category-display' data-el='"+el+"'>\
                            <span class='switch-label' data-on='On' data-off='Off'></span>\
                            <span class='switch-handle'></span>\
                        </label>\
                    </span>\
                    <span class='btn btn-default btn-sm pull-right "+gc_display+"' id='change-gallerycategory' data-type='gallerycategory'><i class='fa fa-refresh'></i> "+$.lang[LANG]['editor.gallery.category.change']+"</span>\
                </div>\
                <div class='line "+gc_display+"'>\
                    <label class='sm'>"+$.lang[LANG]['editor.gallery.category.list']+"</label>\
                    <span><span class='selected-category'>"+gallery_settings_category+"</span></span>\
                    <span>\
                        <span class='hand category-config' data-pid='"+d.seq+"'><i class='fa fa-pencil' aria-hidden='true'></i></span>\
                    </span>\
                </div>\
                <div class='line "+gc_display+"'>\
                    <label class='sm'>"+$.lang[LANG]['editor.font.font']+"</label>\
                    <span class='gc-option gallery-category-font'> "+gc_font+"</span>\
                </div>\
                <div class='line "+gc_display+"'>\
                    <label class='sm'>"+$.lang[LANG]['editor.gallery.category.color']+"</label>\
                    <span class='gc-option gallery-category-color'> "+gc_color+"</span>\
                </div>\
                <div class='line "+gc_display+"'>\
                    <label class='sm'>"+$.lang[LANG]['editor.gallery.category.align']+"</label>\
                    <span class='gc-option gallery-category-align'> "+gc_align+"</span>\
                </div>\
            </div>\
        </div>\
      </div>\
      ";}contact_mail="\
      <div class='panel panel-default panel-line'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle no-toggle' data-toggle='collapse'><span data-lang='editor.contact.title'>\
              Send to\
            </span></a>\
            <span class='pull-right contact-title-edit hand'>&nbsp;&nbsp;<i class='fa fa-pencil'></i></span>\
            <span class='contact-title contact-title-edit'>"+contact_settings_email+"</span>\
          </h4>\
          <div class='contact-edit-text'>\
               <div class='input-group'>\
                   <input type='text' class='contact-edit-input form-control' value='"+contact_settings_email+"'>\
                   <span class='input-group-btn'>\
                       <button class='contact-edit-save btn btn-default btn-primary' type='button'><i class='fa fa-check'></i></button>\
                   </span>\
               </div>\
               <div class='contact-edit-cancel'><i class='fa fa-times'></i></div>\
          </div>\
        </div>\
      </div>\
    ";var font_select='',font_check='',fn='',font_size=0;font_size=(s.txSize)?s.txSize:$('.'+el).css('font-size').replace('px','');font_size=Math.floor(font_size);if(selectEL=='el-menu'){fn=style.getCssProperty(css,'.menu-'+SID,'font-family').split(",");}else{fn=style.getCssProperty(css,'.'+elname,'font-family').split(",");}font_name=fn[0].replace(/'/g,'').replace(/"/g,'');if(!font_name||font_name=='initial')font_name=$('.dsgn-body').css('font-family');font_select='';text_color="\
      <div class='panel panel-default'>\
        <div class='panel-heading'>\
          <h4 class='panel-title'>\
            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#prop-accordion' href='#prop-text'>\
              Text\
            </a>\
          </h4>\
        </div>\
        <div id='prop-text' class='panel-collapse collapse'>\
          <div class='panel-body'>\
            <p>\
                <label class='sm'>Color</label>\
                <span class='color-picker'>\
                    <span class='color tooltips txt-picker-"+el+"' el='"+el+"' pn='color' data-toggle='tooltip' data-placement='top' title='color' style='background-color:"+s.txColor+"'></span>\
                </span>\
            </p>\
            <p>\
                <label class='sm'>Font</label>\
                "+font_select+"\
            </p>\
            <p>\
            <div class='sl'>\
                <label class='sm'>Size <span class='slider-value'>"+font_size+"</span>px</label>\
                <div class='el-font-slider' data-slider-min='10' data-slider-max='80' data-slider-step='1' data-slider-value='"+font_size+"' data-slider-tooltip='hide' el='' selector='select' pn='font-size'></div>\
            </div>\
            </p>\
          </div>\
        </div>\
      </div>\
    ";var config_title=(selectEL=='el-menu')?"<span data-lang='config.extra.logo'>Logo</span>":"<span data-lang='config.extra.images'>Images</span>",add_imgsize=(d.type=='showcase'&&d.type2=='imgsize')?"<span class='pull-right add-imgsize' data-toggle='tooltip' data-placement='top' data-html='true' data-original-title='"+$.lang[LANG]['editor.block.showcase.imgsize.tooltip']+"'><i class='fa fa-exclamation-triangle' aria-hidden='true'></i> "+$.lang[LANG]['editor.block.showcase.imgsize.refer']+"</span>":"",add_attach=(selectEL=='el-menu'||d.type!='showcase')?"":"<span class='pull-right btn btn-primary btn-sm add-attach'><img src='//i.addblock.net/icon/fa_plus_icon.png'> <span data-lang='config.extra.images.add'>ADD</span></span>",add_clone=(add_attach.length==""&&selectEL!='el-menu'&&d.type!='showcase'&&$('.'+selectEL+' [data-clone-loop="true"]').length>0&&$('.'+selectEL+' [data-clone-loop="true"]').find('[data-attach="true"]').length>0)?"<div class='add-clone-wrap text-right'><span class='btn btn-primary btn-sm add-clone'><img src='//i.addblock.net/icon/fa_plus_icon.png'> <span data-lang='config.extra.images.add'>ADD</span></span></div>":"",add_matrix=(add_attach.length==""&&selectEL!='el-menu'&&d.type!='showcase'&&d.eltag.indexOf('data-matrix-loop')>-1)?"<span class='pull-right btn btn-primary btn-sm add-matrix'><img src='//i.addblock.net/icon/fa_plus_icon.png'> <span data-lang='config.extra.images.add'>ADD</span></span>":"";var matrix_resource=function(s_el,itemtype,add_btn,onoff){var matrix_col=$('.'+s_el).find('[data-matrix-loop="true"]').attr('data-matrix-column'),selector=$('.'+s_el).attr('data-name'),img_original_active=(onoff=='OFF')?"btn-default":"btn-primary";var str="\
        <div class='prop-title column-count'><span>"+$.lang[LANG]['config.matrix.column-count']+"</span>";if(VIEW){str=str+"\
            <div class='btn-group pull-right imgoriginal-config'>\
                <button type='button' class='btn btn-default btn-sm fsm' data-lang='config.imageoriginal'></button>\
                <button type='button' class='btn "+img_original_active+" btn-sm fsm dropdown-toggle' data-toggle='dropdown' id='img-original-mode'><span data-lang=''>"+onoff+"</span> <span class='caret'></span></button>\
                <ul class='dropdown-menu' role='menu'>\
                    <li><a href='#' class='img-original-mode' data-img-original='ON'>ON</a></li>\
                    <li><a href='#' class='img-original-mode' data-img-original='OFF'>OFF</a></li>\
                </ul>\
            </div>\
            ";}str=str+"\
        </div>\
        <div class='prop-column'>\
            <div class='sl'>\
                <label class='xs'><span class='slider-value'>"+matrix_col+"</span> <span>"+$.lang[LANG]['config.matrix.column-count.unit']+"</span></label>\
                <div class='el-matrix-slider' data-slider-min='1' data-slider-max='6' data-slider-step='1' data-slider-value='"+matrix_col+"' data-slider-tooltip='hide' el='"+s_el+"' selector='"+selector+"'></div>\
            </div>\
        </div>\
        <div class='prop-title list-title'><span>"+$.lang[LANG]['config.matrix.content-list']+"</span></div>\
        <div class='prop-icons'>\
        ";if(itemtype=='image'){var imgAttach=$('.'+selectEL).find('[data-attach="true"]').first(),imgAlign=$('.'+s_el).find('.image-wrap').first();align=getImageAlign(imgAlign);str=str+"\
                <div class='icons' data-toggle='tooltip' data-placement='bottom' data-original-title='"+$.lang[LANG]['config.matrix.img-replace']+"'>\
                    <i class='fa fa-refresh matrix-img-change hand __matrix' data-attach='"+s_el+"'></i>\
                </div>\
            ";if((typeof(imgAttach).attr('data-target')=="undefined"||!imgAttach.attr('data-target'))&&(typeof(imgAttach).attr('data-fixedsize')=="undefined"||!imgAttach.attr('data-fixedsize')||imgAttach.attr('data-fixedsize')=="false")){str=str+"\
                <div class='icons' data-toggle='tooltip' data-placement='bottom' data-original-title='"+$.lang[LANG]['config.matrix.img-size']+"'>\
                    <i class='fa fa-expand dropdown-toggle attach-folder-update __matrix hand' data-toggle='dropdown'></i>\
                    <ul class='dropdown-menu pull-right prop-image-size dropup' role='menu'>\
                        <li data-folder=''    ><a href='javascript:;' onclick='callChangeImageSize(0)' data-toggle='tooltip' data-placement='left' data-html='true' data-original-title='"+$.lang[LANG]['config.image.original.info']+"'>ORIGINAL</a></li>\
                        <li data-folder='1920'><a href='javascript:;' onclick='callChangeImageSize(1920)'>1920 (AUTO)</a></li>\
                        <li data-folder='800' ><a href='javascript:;' onclick='callChangeImageSize(800)'>800 (AUTO)</a></li>\
                        <li data-folder='700' ><a href='javascript:;' onclick='callChangeImageSize(700)'>700 (7:5)</a></li>\
                        <li data-folder='670' ><a href='javascript:;' onclick='callChangeImageSize(670)'>670 (6:9)</a></li>\
                        <li data-folder='650' ><a href='javascript:;' onclick='callChangeImageSize(650)'>650 (16:9)</a></li>\
                        <li data-folder='600' ><a href='javascript:;' onclick='callChangeImageSize(600)'>600 (1:1)</a></li>\
                    </ul>\
                </div>\
                ";}if(imgAlign.length>0){str=str+"\
                <div class='icons' data-toggle='tooltip' data-placement='bottom' data-original-title='"+$.lang[LANG]['config.matrix.img-align']+"'>\
                    <img src='//i.addblock.net/icon-align-"+align+".gif' class='dropdown-toggle prop-image-align __matrix hand' data-toggle='dropdown' vertical-align='middle'>\
                    <ul class='dropdown-menu pull-right prop-image-align dropup' role='menu'>\
                        <li data-image-align='left'  ><a href='javascript:;' onclick='imageWrap(\"left\")' data-toggle='tooltip' data-placement='top' data-original-title='left'><img class='fa' src='//i.addblock.net/icon-align-left.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-left_on.gif' vertical-align='middle'></a></li>\
                        <li data-image-align='center'><a href='javascript:;' onclick='imageWrap(\"center\")' data-toggle='tooltip' data-placement='top' data-original-title='center'><img class='fa' src='//i.addblock.net/icon-align-center.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-center_on.gif' vertical-align='middle'></a></li>\
                        <li data-image-align='right' ><a href='javascript:;' onclick='imageWrap(\"right\")' data-toggle='tooltip' data-placement='top' data-original-title='right'><img class='fa' src='//i.addblock.net/icon-align-right.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-right_on.gif' vertical-align='middle'></a></li>\
                    </ul>\
                </div>\
                ";}}str=str+"\
            <div class='icons' data-toggle='tooltip' data-placement='bottom' data-original-title='"+$.lang[LANG]['config.matrix.delete']+"'>\
                <i class='fa fa-trash-o matrix-delete hand __matrix "+itemtype+"-delete' data-attach='"+s_el+"'></i>\
            </div>\
        </div>\
        <div class='"+itemtype+"-content clear clearfix'></div>\
        <div class='matrix-add-wrap text-right  clear clearfix'>"+add_btn+"</div>\
        ";return str;}
var snsItemWidth=(add_clone.length>0&&d.type=='sns'&&d.type2=='icon'&&$('.'+selectEL).find('[data-min-width]').length)?$('.'+selectEL).find('.item'):null,snsItemWidthSlider='';if(snsItemWidth!==null){var el_selector='.'+$('.'+selectEL).attr('data-name')+' [data-clone-loop=\"true\"] .item',cloneloop=$('.'+selectEL).find('[data-clone-loop="true"]'),item_width=Number(cloneloop.find('.item').first().css('width').replace('px','')),font_size=Number(cloneloop.find('.item').first().css('font-size').replace('px','')),minwidth=(typeof cloneloop.attr('data-min-width')!='undefined')?Number(cloneloop.attr('data-min-width')):50,maxwidth=(typeof cloneloop.attr('data-max-width')!='undefined')?Number(cloneloop.attr('data-max-width')):100,minmax_per=parseInt(((item_width-minwidth)/(maxwidth-minwidth))*100);snsItemWidthSlider="\
        <div class='prop-title minmax-width-h'><span>"+$.lang[LANG]['config.sns.minmax-width']+"</span></div>\
        <div class='prop-minmax "+LANG+"'>\
            <div class='sl minmax-width-sl'>\
                <span class='min-txt'>"+$.lang[LANG]['config.sns.minmax-width.min']+"</span>\
                <label class='xs hidden'><span class='slider-value'>"+minmax_per+"</span> <span>%</span></label>\
                <div class='ctrl-el-snsicon-slider' data-slider-min='"+minwidth+"' data-slider-max='"+maxwidth+"' data-slider-step='3' data-slider-value='"+item_width+"' data-slider-tooltip='hide' el='"+selectEL+"' selector='"+el_selector+"' pn='width'></div>\
                <span class='max-txt'>"+$.lang[LANG]['config.sns.minmax-width.max']+"</span>\
            </div>\
        </div>\
        <div class='clear clearfix'></div>\
        ";}var snsImgAlign=(add_clone.length>0&&((d.type=='sns'&&d.type2=='icon')||selectEL=='el-footer')&&$('.'+selectEL).find('.image-wrap').length)?$('.'+selectEL).find('.image-wrap'):null,add_snsImgAlign='';if(snsImgAlign!==null){var align=getImageAlign(snsImgAlign),align_class=['active','',''];if(align=='center')align_class=['','active',''];if(align=='right')align_class=['','','active'];add_snsImgAlign=add_snsImgAlign+"\
        <span class='snsicon-imgalign-wrap'>\
            <span class='img-align-wrap' el='"+selectEL+"'>\
                <ul class='dropdown-menu prop-image-align btn-group' data-toggle='buttons'>\
                    <li class='"+align_class[0]+"' data-image-align='left'  ><a href='javascript:;' onclick='imageWrap(\"left\")' data-toggle='tooltip' data-placement='top' data-original-title='left'><img class='fa' src='//i.addblock.net/icon-align-left.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-left_on.gif' vertical-align='middle'></a></li>\
                    <li class='"+align_class[1]+"' data-image-align='center'><a href='javascript:;' onclick='imageWrap(\"center\")' data-toggle='tooltip' data-placement='top' data-original-title='center'><img class='fa' src='//i.addblock.net/icon-align-center.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-center_on.gif' vertical-align='middle'></a></li>\
                    <li class='"+align_class[2]+"' data-image-align='right' ><a href='javascript:;' onclick='imageWrap(\"right\")' data-toggle='tooltip' data-placement='top' data-original-title='right'><img class='fa' src='//i.addblock.net/icon-align-right.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-right_on.gif' vertical-align='middle'></a></li>\
                </ul>\
            </span>\
        </span>\
        ";}var logotype=($('#tpl-logo-text').hasClass('hide'))?"image":"text";var config_menu_logotype="\
            <div class='btn-group pull-right logotype-config'>\
                <button type='button' class='btn btn-default btn-sm fsm' data-lang='config.gallery.type'>type</button>\
                <button type='button' class='btn btn-primary btn-sm fsm dropdown-toggle' data-toggle='dropdown' id='logotype-mode'><span data-lang='config.logo.type."+logotype+"'>"+logotype+"</span>  <span class='caret'></span></button>\
                <ul class='dropdown-menu' role='menu'>\
                    <li><a href='#' class='logotype-mode' data-logotype='image' data-lang='config.logo.type.image'>image</a></li>\
                    <li><a href='#' class='logotype-mode' data-logotype='text' data-lang='config.logo.type.text'>text</a></li>\
                </ul>\
            </div>\
        ";config_menu_logotype=(selectEL=='el-menu')?config_menu_logotype:"";var settings=(d.elsettings==""||typeof d.elsettings=="undefined")?{}:$.parseJSON(d.elsettings),img_original_active=(!settings.img_original_display||typeof settings.img_original_display=="undefined"||settings.img_original_display=="OFF")?"btn-default":"btn-primary",img_original_onoff=(img_original_active=="btn-primary")?"ON":"OFF";var img_original_view=(VIEW&&selectEL!='el-menu')?"\
            <div class='btn-group pull-right imgoriginal-config'>\
                <button type='button' class='btn btn-default btn-sm fsm' data-lang='config.imageoriginal'></button>\
                <button type='button' class='btn "+img_original_active+" btn-sm fsm dropdown-toggle' data-toggle='dropdown' id='img-original-mode'><span data-lang=''>"+img_original_onoff+"</span>  <span class='caret'></span></button>\
                <ul class='dropdown-menu' role='menu'>\
                    <li><a href='#' class='img-original-mode' data-img-original='ON'>ON</a></li>\
                    <li><a href='#' class='img-original-mode' data-img-original='OFF'>OFF</a></li>\
                </ul>\
            </div>":"";var img_resource="\
        "+snsItemWidthSlider+"\
        <div class='prop-images'>\
            <i class='fa fa-picture-o'></i> "+config_title+"\
            "+add_attach+add_imgsize+add_snsImgAlign+config_menu_logotype+img_original_view+"\
        </div>\
        <div class='image-content'></div>\
        "+add_clone+"\
    ";if(add_matrix.length>0&&$('.'+selectEL+' [data-matrix-loop="true"]').find('[data-attach="true"]').length>0)img_resource=matrix_resource(selectEL,'image',add_matrix,img_original_onoff);var gallery_resource=function(mode,settings){galleryImageType=$.lang[LANG]['config.gallery.type.gallery'],galleryProjectType=$.lang[LANG]['config.gallery.type.project'],str="\
        <div class='prop-images'>\
            <div class='btn-group'>\
                <button type='button' class='btn btn-default btn-sm fsm' data-lang='config.gallery.type'>TYPE</button>\
                <button type='button' class='btn btn-primary btn-sm fsm dropdown-toggle' data-toggle='dropdown' id='gl-mode'><span data-lang='config.gallery.type."+mode+"'>"+mode+"</span>  <span class='caret'></span></button>\
                <ul class='dropdown-menu' role='menu'>\
                    <li><a href='#' class='gl-mode' data-mode='gallery'>"+galleryImageType+"</a></li>\
                    <li><a href='#' class='gl-mode' data-mode='project'>"+galleryProjectType+"</a></li>\
                </ul>\
            </div>\
            <div class='clear clearfix'></div>";var option=(settings)?jQuery.parseJSON(settings):{};var original_view_config=(mode=="gallery")?"block":"none";var originalViewChecked=(typeof option.img_original_display=="undefined"||!option.img_original_display||option.img_original_display=='OFF')?"":"checked";str=str+"\
            <span class='pull-left config-original-view' style='display:"+original_view_config+";' >"+$.lang[LANG]['config.imageoriginal.short']+"<label class='switch prop-wrap gallery'>\
                    <input type='checkbox' class='switch-input' id='original-view'"+originalViewChecked+"/>\
                    <span class='switch-label' data-on='On' data-off='Off'></span>\
                    <span class='switch-handle'></span>\
                </label>\
            </span>";var comment_config=(mode=="project")?"block":"none";var commentChecked=(typeof option.comment_display=="undefined"||!option.comment_display||option.comment_display=='OFF')?"":"checked";str=str+"\
            <span class='pull-left config-comment-sns' style='display:"+comment_config+";'>"+$.lang[LANG]['config.comments']+"<label class='switch prop-wrap project'>\
                    <input type='checkbox' class='switch-input' id='comment-display' "+commentChecked+">\
                    <span class='switch-label' data-on='On' data-off='Off'></span>\
                    <span class='switch-handle'></span>\
                </label>\
            </span>";var sns_share_config=(mode=="project")?"block":"none";var snsShareChecked=(typeof option.sns_share_display=="undefined"||!option.sns_share_display||option.sns_share_display=='OFF')?'':'checked';str=str+"\
                <span class='pull-left config-comment-sns' style='display:"+sns_share_config+";'>"+$.lang[LANG]['config.sns-share']+"<label class='switch prop-wrap project'>\
                        <input type='checkbox' class='switch-input' id='sns-share-display' "+snsShareChecked+">\
                        <span class='switch-label' data-on='On' data-off='Off'></span>\
                        <span class='switch-handle'></span>\
                    </label>\
                </span>";var bottomlist_config=(mode=="project")?"block":"none";var bottomListChecked=(typeof option.bottomlist_display=="undefined"||!option.bottomlist_display||option.bottomlist_display=="OFF")?"":"checked";str=str+"\
                <span class='pull-left config-bottomlist' style='display:"+bottomlist_config+";'>"+$.lang[LANG]['config.bottomlist']+"<label class='switch prop-wrap project'>\
                        <input type='checkbox' class='switch-input' id='gallery-bottomlist-display' "+bottomListChecked+">\
                        <span class='switch-label' data-on='On' data-off='Off'></span>\
                        <span class='switch-handle'></span>\
                    </label>\
                </span>";str=str+"\
            <div class='clear clearfix'></div>\
            <div id='gallery-list-config'></div>\
        </div>\
        <div class='image-content'></div>\
        ";return str;}
var forum_panel=function(){var str=$.forum.panelconfig(selectID);return str;}
var forum_control=function(mode,settings){var str="\
        <div class='prop-forums'>\
            <div class='forum-info'><i class='fa fa-exclamation-circle'></i><span data-lang='forum.forum-info'></span></div>\
        </div>\
        ";return str;}
var overlap=false,isOverlap=false;isOverlap=$('header.navbar').hasClass('transparent');isVisible=(FOOTER)?false:true;if(selectEL=='el-menu'){$('.content-property').append(content_change);overlap=($('.el_0').attr('data-overlap')=='1'&&$('header.navbar').hasClass('sidebar')==false)?true:false;if(overlap)$('.content-property').append(content_overlap);}if(selectID=='footer'){$('.content-property').append(footer_change);}if(isEDIT==false){$('.content-property').append(content_wrap);if(selectEL!='el-menu')$('.content-property').append(content_padding);$('.content-property').append(background);if(selectEL!='el-menu'&&selectEL!='el-footer'){$('.content-property').append(bookmark);$('.content-property').append(form_config);}(bg!='none'&&bg!='initial'&&bg!='')?$('.prop-background-option').show():$('.prop-background-option').hide();if(d.feature=='parallax')$('.prop-background-option').html('<p class="prop-parallax">'+$.lang[LANG]['config.parallax.bg-img-option']+'</p>');if(d.type=='contact'&&d.eltag.indexOf('data-contact-submit')>-1)$('.content-property').append(contact_mail);}var $el_ctrl=$('.'+el).find('[data-selector]');setting_resource="\
        <div class='ctrl-content-controller' id='ctrl-accordion'></div>\
    ";if($el_ctrl.length>0){content.append(setting_resource);$.each($el_ctrl,function(i,v){ctrl_title=$(v).data('title');ctrl_class=($(v).prop('class')).split(" ").join(".");ctrl_class=(ctrl_class)?"."+ctrl_class:"";ctrl_selector=$(v).attr('data-selector');ctrl_id=(ctrl_selector=="ul.navbar-nav > li > a")?ctrl_selector:ctrl_selector.replace(" ","-");if($("[data-ctrl-id='"+ctrl_id+"']").length)return;ctrl_el="."+selector.trim()+" "+ctrl_selector.trim();ctrl_el_background=$(ctrl_el).css('background-color');ctrl_title=(typeof ctrl_title=='undefined')?$(v).prop('tagName')+ctrl_class:ctrl_title;ctrl_el_background_checked=(ctrl_el_background=='transparent'||ctrl_el_background=='rgba(0, 0, 0, 0)'||ctrl_el_background=='none'||!ctrl_el_background)?"checked":"";ctrl_el_background_class=(ctrl_el_background_checked)?"transparent":"";ctrl_bg=$(v).css('background-image').trim().replace(/^url\(['"]?/,'').replace(/['"]?\)$/,'');ctrl_bp=$(v).css('background-position');ctrl_br=$(v).css('background-repeat');ctrl_bs=$(v).css('background-size');ctrl_bp_class="ctrl_background-position";ctrl_br_class="ctrl_background-repeat";ctrl_bs_class="ctrl_background-size";var ctrl_font_select='',ctrl_font_check='',ctrl_fn='',ctrl_font_size=0,ctrl_font_color='';ctrl_font_size=$(v).css('font-size').replace('px','');ctrl_font_size=Math.floor(ctrl_font_size);ctrl_font_color=$(v).css('color');ctrl_fn=$(v).css('font-family').split(",");ctrl_font_name=ctrl_fn[0].replace(/'/g,'').replace(/"/g,'').trim();if(!ctrl_font_name||ctrl_font_name=='initial'||ctrl_font_name=='inherit'){tmp=$('.dsgn-body').css('font-family').split(",");ctrl_font_name=tmp[0].replace(/'/g,'').replace(/"/g,'').trim();}ctrl_font_align=$(ctrl_el).css('text-align');if(ctrl_el_background=='rgba(0, 0, 0, 0)')ctrl_el_background='#fff';var ctrl_divider_width=0;ctrl_divider_width=getWidthPercent(v).replace('%','');dp_background=$(v).data('background');dp_border=$(v).data('border');dp_font=$(v).data('font')
dp_divider=$(v).data('divider')
if(dp_background!=true&&dp_border!=true&&dp_font!=true&&dp_divider!=true)return true;ctrl_element="\
                <div class='panel panel-default' data-ctrl-id='"+ctrl_id+"'>\
                    <div class='panel-heading'>\
                        <h4 class='panel-title'>\
                            <a class='accordion-toggle collapsed display-block' data-toggle='collapse' data-parent='#ctrl-accordion' href='#ctrl-element"+i+"'' style='color:#6B91BE;'>\
                                "+ctrl_title+"\
                            </a>\
                        </h4>\
                    </div>\
                    <div id='ctrl-element"+i+"' class='panel-collapse collapse panel-group'>\
            ";if(dp_background==true){ctrl_element=ctrl_element+"\
                        <div class='panel sub'>\
                            <!--<h4 class='panel-title sub'>\
                                <a class='accordion-toggle display-block collapsed' data-toggle='collapse' data-parent='#ctrl-element"+i+"' href='#ctrl-el-background"+i+"' data-lang='editor.background'>Background</a>\
                            </h4>-->\
                            <div id='ctrl-element"+i+"' class='panel-collapse in'>\
                                <div class='panel-body sub'>\
                                    <p>\
                                        <label class='sm' data-lang='editor.background.color'>Color</label>\
                                        <span class='color-picker'>\
                                            <span class='color tooltips ctrl-bg-picker-"+el+" "+ctrl_el_background_class+"' el='"+el+"' selector='"+ctrl_el+"' pn='background-color' data-toggle='tooltip' data-placement='top' title='color' style='background-color:"+ctrl_el_background+"'></span> &nbsp;\
                                            <span class='sm-upper'><input type='checkbox' class='ctrl-check-transparent' "+ctrl_el_background_checked+" data-selector='"+ctrl_el+"' data-el='"+el+"'> <span data-lang='editor.background.color.transparent'>Transparent</span></span>\
                                        </span>\
                                    </p>\
                                    <p>\
                                        <label class='sm' data-lang='editor.background.image'>Image</label>\
                                        <span class='btn btn-default fileinput-button ctrl-prop-method-background' data-toggle='modal' el='"+el+"' data-target='#el-fileupload' selector='"+ctrl_el+"' data-idx='"+i+"'>\
                                            <i class='glyphicon glyphicon-folder-open'></i>&nbsp;\
                                        </span>\
                                        <span class='prop-background-ctrl ctrl-element-background"+i+"'>\
                                        "+((ctrl_bg!='none')?"<span class='attach-thumb'><img src='"+ctrl_bg+"'></span> <i class='fa fa-trash-o hand ctrl-prop-background-delete' data-el='"+el+"' data-pn='background-image' data-selector='"+ctrl_el+"' data-idx='"+i+"'></i>":"")+"\
                                        </span>\
                                    </p>\
                                    <div class='prop-ctrl-background-option"+i+"'><!--\
                                    <p>\
                                        <label class='sm' data-lang='editor.background.position'>Position</label>\
                                        "+style.selectBackgroundSelectForm('position','el-ctrl-background-position',ctrl_bp,ctrl_el,ctrl_bp_class)+"\
                                    </p>\
                                    <p>\
                                        <label class='sm' data-lang='editor.background.repeat'>Repeat</label>\
                                        "+style.selectBackgroundSelectForm('repeat','el-ctrl-background-repeat',ctrl_br,ctrl_el,ctrl_br_class)+"\
                                    </p>\
                                    <p>\
                                        <label class='sm' data-lang='editor.background.size'>Size</label>\
                                        "+style.selectBackgroundSelectForm('bgsize','el-ctrl-background-size',ctrl_bs,ctrl_el,ctrl_bs_class)+"\
                                    </p>-->\
                                    </div>\
                                </div>\
                            </div>\
                        </div>\
                ";}if(dp_font==true){ctrl_font_select=style.selectFontSelectForm('ctrl-font-family-el',ctrl_font_name,ctrl_el);ctrl_element=ctrl_element+"\
                        <div class='panel sub'>\
                        <!--\
                            <h4 class='panel-title sub'>\
                                <a class='accordion-toggle display-block collapsed' data-toggle='collapse' data-parent='#ctrl-element"+i+"' href='#ctrl-el-font"+i+"' data-lang='editor.font'>Font</a>\
                            </h4>\
                        -->\
                        </div>\
                        <!--<div id='ctrl-el-font"+i+"' class='panel-collapse in'>-->\
                        <div id='ctrl-element"+i+"' class='panel-collapse in'>\
                            <div class='panel-body sub'>\
                ";ctrl_element=ctrl_element+"\
                                <div>\
                                    <label class='sm' data-lang='editor.font.color'>Color</label>\
                                    <span class='color-picker'>\
                                        <span class='color tooltips ctrl-font-picker-"+el+"' el='"+el+"' selector='"+ctrl_el+"' pn='color' data-toggle='tooltip' data-placement='top' title='color' style='background-color:"+ctrl_font_color+"'></span> &nbsp;\
                                    </span>\
                                </div>\
                ";ctrl_element=ctrl_element+"\
                                <div>\
                                    <label class='sm' data-lang='editor.font.font'>Font</label>\
                                    "+ctrl_font_select+"\
                                </div>\
                ";ctrl_element=ctrl_element+"\
                                <div class='sl'>\
                                    <label class='sm'><span data-lang='editor.font.size'>Size</span> <span class='slider-value'>"+ctrl_font_size+"</span>px</label>\
                                    <div class='ctrl-el-font-slider' data-slider-min='10' data-slider-max='80' data-slider-step='1' data-slider-value='"+ctrl_font_size+"' data-slider-tooltip='hide' el='' selector='"+ctrl_el+"' pn='font-size'></div>\
                                </div>\
                ";ctrl_element=ctrl_element+"\
                            </div>\
                        </div>\
                ";}if(dp_border==true){ctrl_element=ctrl_element+"\
                        <div class='panel sub'>\
                            <!--\
                            <h4 class='panel-title sub'>\
                                <a class='accordion-toggle display-block collapsed' data-toggle='collapse' data-parent='#ctrl-element"+i+"' href='#ctrl-border"+i+"' data-lang='config.extra.border'>border</a>\
                            </h4>-->\
                            <!--<div id='ctrl-border"+i+"' class='panel-collapse collapse collapse'>-->\
                            "+style.getElementProperty('border',ctrl_el,i,el)+"\
                            <!--</div>-->\
                        </div>\
                ";}if(dp_divider==true){ctrl_element=ctrl_element+"\
                        <div id='ctrl-element"+i+"' class='panel-collapse in'>\
                            <div class='panel-body sub'>\
                                <div class='sl'>\
                                    <label class='sm'><span data-lang='editor.width'>Width</span> <span class='slider-value'>"+ctrl_divider_width+"</span>%</label>\
                                    <div class='ctrl-el-divider-slider' data-slider-min='5' data-slider-max='100' data-slider-step='5' data-slider-value='"+ctrl_divider_width+"' data-slider-tooltip='hide' el='' selector='"+ctrl_el+"' pn='width'></div>\
                                </div>\
                            </div>\
                        </div>\
                ";}ctrl_element=ctrl_element+"\
                    </div>\
                </div>\
            ";$('.ctrl-content-controller').append(ctrl_element);(ctrl_bg!='none')?$('.prop-ctrl-background-option'+i).show():$('.prop-ctrl-background-option'+i).hide();if(dp_border==true){var border_color=style.getHex($(".ctrl-border-picker-"+i).css('background-color'));$('.ctrl-border-picker-'+i).colpick({color:border_color,onSubmit:function(hsb,hex,rgb,el){var selector=$(el).attr('data-selector'),val='#'+hex;$(el).css('background-color',val);ctrlElementStyleUpdate(selector,'border-color',val);ctrlElementTplStyleUpdate(selector,'border-color',val);var type=getElementType();setLogs(type,"border.color.change","transparent-false",type);$(el).colpickHide();}});$('.ctrl-el-border-width-slider').slider().on('slide',function(ev){$(this).parents('.sl').find('.slider-value').text(ev.value);}).on('slideStop',function(ev){var selector=$(this).attr('selector'),val=ev.value+'px';ctrlElementStyleUpdate(selector,'border-width',val);});$('.ctrl-el-border-radius-slider').slider().on('slide',function(ev){$(this).parents('.sl').find('.slider-value').text(ev.value);}).on('slideStop',function(ev){var selector=$(this).attr('selector'),val=ev.value+'px';ctrlElementStyleUpdate(selector,'border-radius',val);});}});}$('#content-overlap').prop('checked',isOverlap);$('#content-wrap').prop('checked',wp);image_attach=function(element,i,src,t,p){title=$(p).find('.figure-title').html();title=(typeof title=="undefined")?"":title.replace(/<br.*?>/g,"\r\n");caption=$(p).find('.figure-caption').html();caption=(typeof caption=="undefined")?"":caption.replace(/<br.*?>/g,"\r\n");icon_caption=(title||caption)?"fa-comment":"fa-comment-o";$btn=$(p).find('.conf-link-button');btn_text=$btn.text();btn_display=($btn.hasClass('hide'))?"hide":"";btn_check=(btn_display)?"":"checked";btn_link=$btn.attr('href');btn_target=$btn.attr('target');btn_target=(typeof btn_target=="undefined")?"_self":btn_target;btn_targe_check=(btn_target=="_self")?"":"checked";logo=(selectEL=='el-menu')?"logo":"";var type=$('.'+selectEL).attr('data-type'),sortType='default',isSort=$('.'+selectEL).find('[data-loop="true"]').length,cloneSort=$('.'+selectEL).find('[data-clone-loop="true"]').length,matrixSort=($('.'+selectEL).find('[data-matrix-loop="true"]').length>0)?$('.'+selectEL).find('[data-matrix-loop="true"]').attr('data-matrix-column'):0,logotype_image=((selectEL=='el-menu'&&$('#tpl-logo-text').hasClass('hide'))||selectEL!='el-menu')?"":"hide",info=(selectEL!='el-menu')?getRecommendInfo($('.'+selectEL),$('<img src="'+src+'"">')):'';if(isSort==0){if(cloneSort>0){isSort=cloneSort;sortType='clone';}else if(matrixSort>0&&$('.'+selectEL+' [data-matrix-loop="true"]').find('[data-attach="true"]').length>0){isSort=matrixSort;sortType='matrix';}else{sortType='none';}}var str="\
        <div class='image-wrap' id='imgsort"+i+"'>\
            <div class='attach-thumb "+logo+" "+t+" hand "+logotype_image+"' data-toggle='modal' el='"+element+"' idx='"+i+"' data-target='#el-fileupload'><img src='"+src+"' data-toggle='tooltip' data-placement='left' data-html='true' data-original-title='"+info+"'></div>\
        ";if(selectEL!='el-menu'){str=str+"<div>&nbsp;</div>";if(isSort){str=str+"<div class='icons'><i class='fa fa-arrows'></i></div>"}}else{var logo_text=$('#tpl-logo-text').html().replace(/<br.*?>/g,"\r\n"),logo_use_text=($('#tpl-logo-text').hasClass('hide'))?"":"checked";toggle=(logo_use_text)?"":"hide";logo_style="",logo_font_size=(typeof $('.menu-'+SID+' #tpl-logo-text').css('font-size')!='undefined')?$('.menu-'+SID+' #tpl-logo-text').css('font-size').replace(/[^0-9]/g,''):$('.dsgn-body').css('font-size').replace(/[^0-9]/g,'');logo_style=logo_style+"\
                <div class='sl'>\
                    <label class='sm logo-font-size'><span data-lang='editor.font.size'></span> <span class='slider-value'>"+logo_font_size+"</span>px</label>\
                    <div class='logo-slider' data-slider-min='1' data-slider-max='100' data-slider-step='1' data-slider-value='"+logo_font_size+"' data-slider-tooltip='hide' el='' selector='' pn='padding-top'></div>\
                </div>\
            ";fn=style.getCssProperty(MCSS,'.menu-'+SID+' #tpl-logo-text','font-family').split(",");select_font=fn[0].replace(/'/g,'').replace(/"/g,'');logo_style="\
                <div>\
                    <label class='sm logo-font-font'><span data-lang='editor.font.font'></span></label>\
                    <div class='logo-font-font-name'>\
                    "+style.selectFontSelectForm('font-family-logo',select_font,'.menu-'+SID)+"\
                    </div>\
                </div>"+logo_style;str=str+"<div class='logo-edit-text "+toggle+" pull-left'>\
                            <div class='input-group'>\
                                <textarea class='form-control custom-control gl-text logo-input-text' rows='1' style='resize:none;'>"+logo_text+"</textarea>\
                                <span class='logo-edit-save btn input-group-addon' data-lang='config.save'>SAVE</span>\
                            </div>\
                        </div>\
                  ";str=str+"\
                <div class='icons prop-logos "+toggle+" pull-right'>\
                    <i class='fa fa-font logo-font-wrap' data-toggle='tooltip' data-placement='top' title='font'></i>\
                    <div class='logo-text-style hide'>\
                        "+logo_style+"\
                    </div>\
                </div>\
                <div class='icons color-icon prop-logos "+toggle+" pull-right'><span class='color tooltips logo-picker' el='el-menu' selector='#tpl-logo-text' pn='color' data-toggle='tooltip' data-placement='top' title='color' style='background-color:"+logo_text_color+"'></span></div>\
            ";}page_link="<ul class='page-list'>";for(j=0;j<MENULINK.length;j++){page_link=page_link+"<li data-idx='"+i+"'>"+MENULINK[j]+"</li>";}page_link=page_link+"</ul>";if($('.'+selectEL).attr('data-type')!='showcase'&&selectEL!='el-menu'){var imgAttach=$('.'+selectEL).find('[data-attach="true"]')[i],icon=$(imgAttach).hasClass('hide')?"fa-eye-slash":"fa-eye",imgAlign=$('.'+selectEL).find('.image-wrap');var isSnsIconBlock=($('.'+selectEL).attr('data-type')=='sns'&&$('.'+selectEL).attr('data-type2')=='icon'||selectEL=='el-footer'&&$('.'+selectEL).find('[data-clone-loop="true"]').length>0)?true:false;if(imgAlign.length&&!isSnsIconBlock){var align=getImageAlign(imgAlign);str=str+"\
                <div class='icons hand' el='"+element+"'>\
                    <img src='//i.addblock.net/icon-align-"+align+".gif' class='dropdown-toggle prop-image-align' data-toggle='dropdown' data-idx='"+i+"' vertical-align='middle'>\
                    <ul class='dropdown-menu pull-right prop-image-align dropup' role='menu'>\
                        <li data-image-align='left'  ><a href='javascript:;' onclick='imageWrap(\"left\")' data-toggle='tooltip' data-placement='top' data-original-title='left'><img class='fa' src='//i.addblock.net/icon-align-left.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-left_on.gif' vertical-align='middle'></a></li>\
                        <li data-image-align='center'><a href='javascript:;' onclick='imageWrap(\"center\")' data-toggle='tooltip' data-placement='top' data-original-title='center'><img class='fa' src='//i.addblock.net/icon-align-center.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-center_on.gif' vertical-align='middle'></a></li>\
                        <li data-image-align='right' ><a href='javascript:;' onclick='imageWrap(\"right\")' data-toggle='tooltip' data-placement='top' data-original-title='right'><img class='fa' src='//i.addblock.net/icon-align-right.gif' vertical-align='middle'><img class='fa on' src='//i.addblock.net/icon/icon-align-right_on.gif' vertical-align='middle'></a></li>\
                    </ul>\
                </div>\
                ";}if(typeof $(imgAttach).attr('data-target')=="undefined"||!$(imgAttach).attr('data-target')){if(typeof $(imgAttach).attr('data-fixedsize')=="undefined"||$(imgAttach).attr('data-fixedsize')=="false"){str=str+"\
                        <div class='icons hand' el='"+element+"' id='prop-image-size'>\
                            <i class='fa fa-expand dropdown-toggle attach-folder-update' data-toggle='dropdown' data-idx='"+i+"'></i>\
                            <ul class='dropdown-menu pull-right prop-image-size dropup' role='menu'>\
                                <li data-folder=''    ><a href='javascript:;' onclick='changeImageSize("+i+")' data-toggle='tooltip' data-placement='left' data-html='true' data-original-title='"+$.lang[LANG]['config.image.original.info']+"'>ORIGINAL</a></li>\
                                <li data-folder='1920'><a href='javascript:;' onclick='changeImageSize("+i+",1920)'>1920 (AUTO)</a></li>\
                                <li data-folder='800' ><a href='javascript:;' onclick='changeImageSize("+i+",800)'>800 (AUTO)</a></li>\
                                <li data-folder='700' ><a href='javascript:;' onclick='changeImageSize("+i+",700)'>700 (7:5)</a></li>\
                                <li data-folder='670' ><a href='javascript:;' onclick='changeImageSize("+i+",670)'>670 (6:9)</a></li>\
                                <li data-folder='650' ><a href='javascript:;' onclick='changeImageSize("+i+",650)'>650 (16:9)</a></li>\
                                <li data-folder='600' ><a href='javascript:;' onclick='changeImageSize("+i+",600)'>600 (1:1)</a></li>\
                            </ul>\
                        </div>\
                    ";}}}if(selectEL!=='el-menu'&&type=='showcase')str=str+"<div class='icons'><i class='fa fa-trash-o attach-delete' data-idx='"+i+"' data-attach='"+element+"'></i></div>";if(selectEL!='el-menu'&&type!='showcase'&&sortType=='clone')str=str+"<div class='icons'><i class='fa fa-trash-o clone-delete' data-idx='"+i+"' data-attach='"+element+"'></i></div>";str=str+"\
        </div>";if(selectEL!='el-menu'&&type!='showcase'&&sortType=='matrix'){var temp=document.createElement('div');$(temp).append(str);$(temp).find('.image-wrap > div:not(".attach-thumb")').remove();$(temp).find('.attach-thumb').removeAttr('data-toggle');$(temp).find('.attach-thumb').find('img').removeAttr('data-toggle');$(temp).find('.attach-thumb').find('img').each(function(i){$(this).parent('.attach-thumb').css('background-image','url("'+$(this).attr('src')+'")');});str=$(temp).html();}return str;}
$("#prop-accordion").collapse({toggle:false});var e=$('.'+el),img=e.find('[data-attach="true"]'),css=CSSJSON.toJSON($('#'+el+'css').text()),vd=e.find('[data-video="true"]');video_resource="\
        <div class='prop-images' style='padding:20px 20px 5px;'><i class='fa fa-video-camera'></i> <span data-lang='config.extra.video'>Video</span></div>\
        <div class='video-content-controller'></div>\
    ";if(typeof $(vd).attr('data-video')!='undefined'){content.append(video_resource);$.each(vd,function(i,v){vd_src=$(this).find('iframe').prop('src');vd_input="\
                <div class='input-group'>\
                  <span class='input-group-addon'><i class='fa fa-link'></i></span>\
                  <input type='text' class='form-control gl-text video-iframe-url' value='"+vd_src+"' data-idx='"+i+"'>\
                  <span class='input-group-btn'>\
                    <button class='btn btn-default save-video-url' type='button' data-el='"+el+"' data-idx='"+i+"'><span data-lang='config.save'>save</span></button>\
                  </span>\
                </div>\
            ";$('.video-content-controller').append(vd_input);});}var map=e.find('[data-map="true"]'),map_url=$(map).attr('data-url'),map_style=$(map).attr('data-style');if(isEDIT==false){if(typeof map_style=="undefined")map_style="style_normal";map_resource="\
            <div class='prop-images' style='padding:20px 20px 0px;'>\
                <i class='fa fa-map-marker'></i> <span data-lang='config.extra.map'>Map</span>\
            </div>\
            <div class='map-content-controller'></div>\
        ";if(typeof map_url!='undefined'){content.append(map_resource);map_input="\
                <div class='input-group'>\
                    <span class='input-group-addon'><i class='fa fa-link'></i></span>\
                    <input type='text' class='form-control gl-text map-iframe-url' value='"+map_url+"'>\
                    <span class='input-group-btn'>\
                        <button class='btn btn-default save-map-url' type='button' data-el='"+el+"'><span data-lang='config.save'>save</span></button>\
                    </span>\
                </div>\
                <div class='style-map'>\
                    <label class='radio-inline'>\
                        <input type='radio' name='map_style' class='map-style' value='style_normal' "+((map_style=='style_normal')?"checked":"")+"> <span data-lang='config.extra.map.normal'>normal</span>\
                    </label>\
                    <label class='radio-inline'>\
                        <input type='radio' name='map_style' class='map-style' value='style_grey' "+((map_style=='style_grey')?"checked":"")+"> <span data-lang='config.extra.map.grey'>grey</span>\
                    </label>\
                    <label class='radio-inline'>\
                        <input type='radio' name='map_style' class='map-style' value='style_red' "+((map_style=='style_red')?"checked":"")+"> <span data-lang='config.extra.map.red'>red</span>\
                    </label>\
                    <label class='radio-inline'>\
                        <input type='radio' name='map_style' class='map-style' value='style_blue' "+((map_style=='style_blue')?"checked":"")+"> <span data-lang='config.extra.map.blue'>blue</span>\
                    </label>\
                    <label class='radio-inline'>\
                        <input type='radio' name='map_style' class='map-style' value='style_black' "+((map_style=='style_black')?"checked":"")+"> <span data-lang='config.extra.map.black'>black</span>\
                    </label>\
                </div>\
                <span class='small url-info'>"+$.lang[LANG]['config.map.info1']+"</span>\
                <a class='help' target='_blank' href='http://creatorlink.net/support/search/%EA%B5%AC%EA%B8%80%20%EC%A7%80%EB%8F%84'>"+$.lang[LANG]['config.map.info1-link']+"&nbsp;<i class='fa fa-caret-right'></i></a>\
                <br />\
                <span class='small'>"+$.lang[LANG]['config.map.info2']+"</span>\
                <br/> \
                <span class='small'>"+$.lang[LANG]['config.map.info3']+"</span>\
            ";$('.map-content-controller').append(map_input);}}if(isEDIT==false){if(img.length>0){var imgstype='default';if($('.'+el).find('[data-clone-loop="true"]').length>0&&$('.'+el+' [data-clone-loop="true"]').find('[data-attach="true"]').length>0)imgstype='clone';if($('.'+el).find('[data-matrix-loop="true"]').length>0&&$('.'+el+' [data-matrix-loop="true"]').find('[data-attach="true"]').length>0)imgstype='matrix';content.append($('<li class="images" data-loop-type="'+imgstype+'">').append(img_resource));if(imgstype=='matrix')content.find('.images').attr('data-matrix-column',$('.'+el).find('[data-matrix-loop="true"]').attr('data-matrix-column'));var loop_class=(imgstype=='default')?'':imgstype+'-',child=$('.'+selectEL).find('[data-'+loop_class+'loop="true"]').children();img.each(function(idx){var target=$(this).attr('data-target');if(typeof target=="undefined"){var selector=$(this).attr('data-selector');if(typeof selector!="undefined"){prop=style.find(css,selector);selector=$('.'+selectEL).attr('data-name')+' '+selector;$('.image-content').append(image_attach(selector,idx,prop,'prop-method-image-url',child[idx]));}else $('.image-content').append(image_attach(el,idx,$(this).prop('src'),'prop-method-image',child[idx]));}else{var selector='.'+elname+' '+target;prop=style.find(css,selector);$('.image-content').append(image_attach(target,idx,prop,'prop-method-image-url',child[idx]));}});}var ctext=$('.'+el).find('[data-clone-type="ctext"]'),matrix=$('.'+el).find('[data-matrix-loop="true"]');if(ctext.children('.item').length>0||add_matrix.length>0&&matrix.find('[data-attach="true"]').length==0){var loop_type=(add_matrix.length>0)?'matrix':'ctext',add_clone=(loop_type=='ctext'&&selectEL!='el-menu'&&selectEL!='el-footer'&&d.eltag.indexOf('data-clone-loop')>-1)?"<div class='add-clone-wrap text-right'><span class='btn btn-primary btn-sm add-clone'><img src='//i.addblock.net/icon/fa_plus_icon.png'> <span data-lang='config.extra.images.add'>ADD</span></span></div>":"";var ctext_resource='';if(loop_type=='matrix'){ctext_resource=matrix_resource(selectEL,'ctext',add_matrix);}else{ctext_resource="\
                    <div class='prop-ctext'>\
                        <i class='fa fa-font'></i><span data-lang='config.extra.text'>Text</span>\
                    </div>\
                    <div class='ctext-content'></div>\
                     "+add_clone+"\
                ";}content.append($('<li class="ctext">').append(ctext_resource));if(loop_type=='matrix'){content.find('li.ctext').attr('data-loop-type',loop_type);content.find('li.ctext').attr('data-matrix-column',matrix.attr('data-matrix-column'));matrix.children('.item').each(function(idx){var selector=(typeof $(this).attr('data-selector')!='undefined')?$(this).attr('data-selector'):selectEL,ctext_item="\
                    <div class='ctext-wrap' id='ctxtsort"+idx+"'>\
                            <div class='attach-thumb' idx='"+idx+"'><i class='fa fa-font'></i></div>\
                            <!--<div class='icons'><i class='fa fa-trash-o matrix-delete ctext-delete' data-idx='"+idx+"' data-attach='"+selector+"'></i></div>-->\
                    </div>";$('.ctext-content').append(ctext_item);});}else{content.find('li.ctext').attr('data-loop-type','clone');ctext.children('.item').each(function(idx){var selector=(typeof $(this).attr('data-selector')!='undefined')?$(this).attr('data-selector'):selectEL,ctext_item="\
                        <div class='ctext-wrap' id='ctxtsort"+idx+"'>\
                            <div class='attach-thumb' idx='"+idx+"'><i class='fa fa-font'></i></div>\
                            <div class='empty'> &nbsp; </div>\
                            <div class='icons'><i class='fa fa-arrows'></i></div>\
                            <div class='icons'><i class='fa fa-trash-o clone-delete ctext-delete' data-idx='"+idx+"' data-attach='"+selector+"'></i></div>\
                        </div>\
                    ";$('.ctext-content').append(ctext_item);});}}if(typeof d!="undefined"){if(d.type=="gallery"){$('.content-property').append(gallery_change).append(dataview_config).append(gallery_category);$('#category-display').prop('checked',gallery_settings_category_display);content.append($('<li class="images">').append(gallery_resource(d.mode,d.elsettings)));addItemGallery(1);}if(d.type=="project"&&isPB){$('.content-property').append(project_change);}if(d.type=="sns"&&d.type2=='feed'){$('.content-property').append(sns_config);}if(d.type=="forum"){$('.content-property').append(forum_config).append(dataview_config).append(forum_panel());content.append($('<li class="forums">').append(forum_control(d.mode,d.elsettings)));}if(d.type=="others"&&d.type2=="countdown"){$('.content-property').append(dday_config);$('#el-property[data-element="'+selectEL+'"]').find('.ddaydatetimepicker').datetimepicker({format:'YYYY/MM/DD HH:mm:ss',}).on('dp.change',function(ev){var cd_date=$(this).val(),el_dday=$('.element[data-id="'+d.seq+'"]').find('[data-dday="true"]'),el_cd_date=el_dday.attr('data-countdown'),dateformat={days:'%D',hours:'%H',minutes:'%M',seconds:'%S'},dateendformat={days:'00',hours:'00',minutes:'00',seconds:'00'};if(cd_date==el_cd_date)return false;var settings={countdown:cd_date}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);el_dday.find('.date-item').each(function(){if(typeof $(this).attr('data-format')!='undefined'&&$(this).attr('data-format')){dateformat[$(this).attr('data-datetype')]=$(this).attr('data-format');}if(typeof $(this).attr('data-finish')!='undefined'&&$(this).attr('data-finish')){dateendformat[$(this).attr('data-datetype')]=$(this).attr('data-finish');}});el_dday.countdown(cd_date,function(event){if(event.elapsed){$(this).find('.date-item[data-datetype="days"]').text(dateendformat['days']);$(this).find('.date-item[data-datetype="hours"]').text(dateendformat['hours']);$(this).find('.date-item[data-datetype="minutes"]').text(dateendformat['minutes']);$(this).find('.date-item[data-datetype="seconds"]').text(dateendformat['seconds']);}else{$(this).find('.date-item[data-datetype="days"]').text(event.strftime(dateformat['days']));$(this).find('.date-item[data-datetype="hours"]').text(event.strftime(dateformat['hours']));$(this).find('.date-item[data-datetype="minutes"]').text(event.strftime(dateformat['minutes']));$(this).find('.date-item[data-datetype="seconds"]').text(event.strftime(dateformat['seconds']));}});var type=getElementType();setLogs(type,"countdown.change","countdown",type);},'json');}).on('dp.hide',function(){$(this).blur();});}}}var block_active=(selectEL=='el-menu'||selectEL=='el-footer'||(d.type=="project"&&isPB))?"disabled":"",html_active=(selectEL=='el-footer'&&$('#el-property').attr('data-member')==1)?"disabled'":"' onclick='elHtml(selectID);'",delete_active=((selectEL=='el-footer'&&$('#el-property').attr('data-member')==1)||selectEL=='el-menu'||(d.type=="project"&&isPB&&$('#el-property').attr('data-member')==1))?"disabled'":"' onclick='elDelete(selectID);'";add_config="\
        <ul class='controller-toolbar'>\
            <li class='ctrl-reorder "+block_active+"' onclick='reorderBlock(selectID)'><div><i class='fa fa-sort'></i></div><div class='toolbar-title' data-lang='config.reorder'>RE-ORDER BLOCK</div></li>\
            <li class='ctrl-copypaste "+block_active+"' onclick='duplicate(selectID)'><div><i class='fa fa-files-o'></i></div><div class='toolbar-title' data-lang='config.duplicate'>DUPLICATE BLOCK</div></li>\
            <li class='ctrl-html "+html_active+"><div><i class='fa fa-file-code-o'></i></div><div class='toolbar-title' data-lang='config.html'>HTML / CSS</div></li>\
            <li class='ctrl-delete "+delete_active+"><div><i class='fa fa-trash-o'></i></div><div class='toolbar-title' data-lang='config.block.delete'>DELETE BLOCK</div></li>\
        </ul>\
    ";$('#el-property .controller-toolbar').remove();$add_config=$(add_config);if(selectEL=='el-footer'){$add_config.children('.ctrl-reorder').addClass('disabled').removeAttr('onclick');$add_config.children('.ctrl-delete').addClass('disabled').removeAttr('onclick');}if(rt_admin==''&&d.type=='form'){$add_config.children('.ctrl-html').addClass('disabled').removeAttr('onclick');}if(d.type=='form')$add_config.children('.ctrl-copypaste').addClass('disabled').removeAttr('onclick');if(isEDIT==false)$('#el-property').append($add_config);$('.g-body .text-menu').css('left','-1000px');var checkLoop=(e.find('[data-loop="true"]').length>0)?true:false,checkCloneLoop=(e.find('[data-clone-loop="true"]').length>0)?true:false,checkMatrixLoop=(e.find('[data-matrix-loop="true"]').length>0)?true:false,typeMatrixLoop=(checkMatrixLoop&&e.find('[data-matrix-loop="true"]').find('[data-attach="true"]').length>0)?'images':'ctext';if(selectEL!='el-menu'&&(checkLoop||checkCloneLoop||checkMatrixLoop)){if(e.find('[data-attach="true"]').length>0){$('.image-content').sortable({start:function(event,ui){},update:function(event,ui){var loop_type=($('.'+selectEL).find('[data-matrix-loop="true"]').length>0)?'matrix':'clone',nodes=($('.'+selectEL).find('[data-loop="true"]').length>0)?$('.'+selectEL).find('[data-loop="true"]').children():$('.'+selectEL).find('[data-'+loop_type+'-loop="true"]').find('.item'),elems=nodes.clone(),nav=$('.'+selectEL).find('[data-nav="true"]').children();sorted=$(".image-content").sortable("toArray").map(function(n,i){return n.replace(/imgsort/,"");});$.each(nodes,function(k,v){if($('.'+selectEL).data('type')=='showcase'){(k==0)?$(nav[k]).addClass('active'):$(nav[k]).removeClass('active');(k==0)?$(elems[sorted[k]]).addClass('active').removeClass('left').removeClass('next'):$(elems[sorted[k]]).removeClass('active').removeClass('left').removeClass('next')}$(this).replaceWith($(elems[sorted[k]]));});$(this).children().each(function(k,i){$(this).find('[idx]').attr('idx',k);$(this).find('[data-idx]').attr('data-idx',k);$(this).attr('id','imgsort'+k);$(this).find('.prop-image-size li').each(function(){var ffolder=$(this).attr('data-folder');$(this).find('a').attr('onclick','changeImageSize('+k+','+ffolder+')');});});saveContentElement();var type=getElementType();setLogs(type,"image.sort","image-sort",type);},out:function(e,ui){if(checkMatrixLoop){var idx=ui.item.index();if(!$(this).find('.image-wrap').eq(idx).hasClass('active'))$(this).find('.image-wrap').eq(idx).click();if($(this).prev('.prop-icons').attr('data-idx')!=idx){$(this).prev('.prop-icons').attr('data-idx',idx);$(this).prev('.prop-icons').find('.__matrix.hand').attr('data-idx',idx);}}}}).disableSelection().bind('click.outside',function(e){if($(e.target).closest('[data-loop-type="matrix"]').length>0&&$(e.target).hasClass('ui-sortable')&&$(e.target).children('.image-wrap.active').length>0){$(e.target).children('.image-wrap.active').click();}});}if(e.find('[data-clone-type="ctext"]').children('.item').length>0||checkMatrixLoop&&typeMatrixLoop=='ctext'){$('.ctext-content').sortable({start:function(event,ui){},update:function(event,ui){var loop_type=(checkMatrixLoop)?'matrix':'clone',nodes=$('.'+selectEL).find('[data-'+loop_type+'-loop="true"]').find('.item'),elems=nodes.clone();sorted=$('.ctext-content').sortable('toArray').map(function(n,i){return n.replace(/ctxtsort/,"");});$.each(nodes,function(k,v){$(this).replaceWith($(elems[sorted[k]]));});$(this).children().each(function(k,i){$(this).attr('id','ctxtsort'+k);$(this).find('[idx]').attr('idx',k);$(this).find('[data-idx]').attr('data-idx',k);});saveContentElement();var type=getElementType();setLogs(type,"ctext.sort","ctext-sort",type);},out:function(e,ui){if(checkMatrixLoop){var idx=ui.item.index();if(!$(this).find('.ctext-wrap').eq(idx).hasClass('active'))$(this).find('.ctext-wrap').eq(idx).click();if($(this).prev('.prop-icons').attr('data-idx')!=idx){$(this).prev('.prop-icons').attr('data-idx',idx);$(this).prev('.prop-icons').find('.__matrix.hand').attr('data-idx',idx);}}}}).disableSelection().bind('click.outside',function(e){if($(e.target).closest('[data-loop-type="matrix"]').length>0&&$(e.target).hasClass('ui-sortable')&&$(e.target).children('.ctext-wrap.active').length>0){$(e.target).children('.ctext-wrap.active').click();}});}}setLanguage(LANG);$('.el-matrix-slider').slider().on('slide',function(ev){$(this).parents('.sl').find('.slider-value').text(ev.value);matrixColumnChange($('.'+$(this).attr('el')),ev.value,false);}).on('slideStop',function(ev){var el=(selectEL=='el_menu')?$("header"):$('.'+$(this).attr('el'));$(this).parents('.sl').find('.slider-value').text(ev.value);matrixColumnChange(el,ev.value,true);});$('.el-slider').slider().on('slide',function(ev){$(this).parents('.sl').find('.slider-value').text(ev.value);}).on('slideStop',function(ev){var el=(selectEL=='el-menu')?$("header"):$('.'+$(this).attr('el')),pn=$(this).attr('pn');$(el).css(pn,ev.value);elUpdate($(this).attr('el'),pn,ev.value);ctrlElementTplStyleUpdate(el.attr('data-name'),pn,ev.value+'px');var type=getElementType();setLogs(type,"block.padding.change","slider",type);$(this).parents('.sl').find('.slider-value').text(ev.value);if(pn=='padding-top'||pn=='padding-bottom'){var css='@media only screen and (max-width:768px) {\
                .'+$(el).attr('data-name')+' { '+pn+': '+Math.ceil(ev.value*0.8)+'px!important }\
            }\
            @media only screen and (max-width:479px) {\
                .'+$(el).attr('data-name')+' { '+pn+': '+Math.ceil(ev.value*0.5)+'px!important }\
            }\
            ';$('#dsgn-'+SID).append(css);}ctrlElementTplStyleUpdate(ev,pn,ev.value,'media');});$('.logo-slider').slider().on('slide',function(ev){$(this).parents('.sl').find('.slider-value').text(ev.value);}).on('slideStop',function(ev){menu_css=style.setCssProperty(MCSS,'.menu-'+SID+' #tpl-logo-text','font-size',ev.value+'px');setMenuStyle(menu_css);$(this).parents('.sl').find('.slider-value').text(ev.value);setLogs('MENU','logo.font.size.change','slider','MENU');});$('.el-font-slider').slider().on('slide',function(ev){$(this).parents('.sl').find('.slider-value').text(ev.value);}).on('slideStop',function(ev){css=getStyleText();setElementStyleCss(css,'.'+elname,'font-size',ev.value+'px');});$('.ctrl-el-font-slider').slider().on('slide',function(ev){isOpen=true;$(this).parents('.sl').find('.slider-value').text(ev.value);}).on('slideStop',function(ev){isOpen=false;$(this).parents('.sl').find('.slider-value').text(ev.value);var selector=$(this).attr('selector'),val=ev.value+'px';ctrlElementStyleUpdate(selector,'font-size',val);ctrlElementTplStyleUpdate(selector,'font-size',val);var type=getElementType();setLogs(type,'font.size.change','slider',type);});$('.ctrl-el-snsicon-slider').slider().on('slide',function(ev){var selector=$(this).attr('selector'),minwidth=Number($(selector.replace(' .item','')).attr('data-min-width')),maxwidth=Number($(selector.replace(' .item','')).attr('data-max-width')),minmax_per=parseInt(((Number(ev.value)-minwidth)/(maxwidth-minwidth))*100);$(this).parents('.sl').find('.slider-value').text(minmax_per);isOpen=true;}).on('slideStop',function(ev){isOpen=false;var selector=$(this).attr('selector'),f_size=$(selector.replace(' .item','.image-wrap')).css('font-size').replace('px',''),pn=$(this).attr('pn'),val=(Number(ev.value)/Number(f_size))+'em',minwidth=Number($(selector.replace(' .item','')).attr('data-min-width')),maxwidth=Number($(selector.replace(' .item','')).attr('data-max-width')),minmax_per=parseInt(((Number(ev.value)-minwidth)/(maxwidth-minwidth))*100);$(this).parents('.sl').find('.slider-value').text(minmax_per);ctrlElementStyleUpdate(selector,pn,val);ctrlElementTplStyleUpdate(selector,pn,val);var type=getElementType();setLogs(type,'sns.icon.width.cheange','slider',type);});$('.ctrl-el-divider-slider').slider().on('slide',function(ev){$(this).parents('.sl').find('.slider-value').text(ev.value);}).on('slideStop',function(ev){var selector=$(this).attr('selector'),val=ev.value+'%';ctrlElementStyleUpdate(selector,'width',val);$(this).parents('.sl').find('.slider-value').text(ev.value);var type=getElementType();setLogs(type,'divider.width.change','slider',type);});$('.bg-picker-'+el).colpick({color:s.bgColor,onSubmit:function(hsb,hex,rgb,el){$(el).removeClass('transparent');$(el).parent().find('input').attr('checked',false);colorChange(hex,el);if(selectEL=='el-menu'&&$('.header-empty').length>0){$('.header-empty').css('background-color','#'+hex);}var elname=$('.'+selectEL).attr('data-name'),selector=$(el).attr('selector');if(typeof elname!='undefined'&&elname){if(elname=='menu'){ctrlElementStyleUpdate(selector,'background-color','#'+hex);}else{ctrlElementTplStyleUpdate(elname,'background-color','#'+hex);}}var type=getElementType();setLogs(type,"background.color.false","transparent-false",type);}});$('.ctrl-bg-picker-'+el).colpick({color:s.bgColor,onSubmit:function(hsb,hex,rgb,el){var selector=$(el).attr('selector'),ctrl_el=$(el).attr('el'),j=CSSJSON.toJSON($('#'+ctrl_el+'css').text());j=style.setCssProperty(j,selector,'background-color','#'+hex);$('#'+ctrl_el+'css').text(CSSJSON.toCSS(j));$(el).css('background-color','#'+hex);var css=$('#'+ctrl_el+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:seq},function(data){checkError(data);},'json');$(el).parents('span.color-picker').find('span.color').removeClass('transparent');$(el).parent().find('.ctrl-check-transparent').prop('checked',false);$(el).colpickHide();ctrlElementTplStyleUpdate(selector,'background-color','#'+hex);var type=getElementType();setLogs(type,"ctrl.background.color.false","transparent-false",type);}});$('.color-line:not(.disabled) .ctrl-gc-color-picker-'+el).colpick({color:s.bgColor,onSubmit:function(hsb,hex,rgb,el){var selector=$(el).attr('data-selector'),ctrl_el=$(el).attr('el'),j=CSSJSON.toJSON($('#'+ctrl_el+'css').text()),pn=$(el).attr('pn'),opacity=$(el).parents('span.color-picker').find('span.color').attr('data-opacity'),color_type=$('.'+ctrl_el).find('.gallery-category-nav').attr('data-category-color');j=style.setCssProperty(j,selector,pn,'#'+hex);$('#'+ctrl_el+'css').text(CSSJSON.toCSS(j));$(el).css('background-color','#'+hex);var css=$('#'+ctrl_el+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:seq},function(data){checkError(data);},'json');$(el).colpickHide();if(typeof color_type!='undefined'&&color_type){var settings={category_color_type:''};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:seq},function(data){checkError(data);$('.'+ctrl_el).find('.gallery-category-nav').removeAttr('data-category-color');$('#prop-category .btn-color-mode.now-color-palette').addClass('active').siblings().removeClass('active');},'json');}var type=getElementType();setLogs(type,"gallery.category.color.change","transparent-false",type);}});$('.txt-picker-'+el).colpick({color:s.txColor,onSubmit:function(hsb,hex,rgb,el){colorChange(hex,el);}});$('.ctrl-font-picker-'+el).colpick({color:s.txColor,onSubmit:function(hsb,hex,rgb,el){var selector=$(el).attr('selector'),val='#'+hex;$(el).css('background-color','#'+hex);ctrlElementStyleUpdate(selector,'color',val);$(el).colpickHide();var type=getElementType();ctrlElementTplStyleUpdate(selector,'color',val);setLogs(type,'font.color','transparent-false',type);}});if(logo_text_color=='inherit')logo_text_color="#ffffff";$('.logo-picker').colpick({color:logo_text_color,onSubmit:function(hsb,hex,rgb,el){menu_css=style.setCssProperty(MCSS,'.menu-'+SID+' #tpl-logo-text','color','#'+hex);setMenuStyle(menu_css);$('.logo-picker').css('background-color','#'+hex);$('.logo-picker').colpickHide();setLogs('MENU','logo.color.change','transparent-false','MENU');}});}
var reset_padding=function(el,pdTop,pdBottom,pdLeft,pdRight){$('.'+el).css({'padding-top':pdTop,'padding-bottom':pdBottom,});$('.el-slider[pn="padding-top"]').slider('setValue',pdTop);$('.el-slider[pn="padding-bottom"]').slider('setValue',pdBottom);$('.el-slider[pn="padding-top"]').parents('.sl').find('.slider-value').text(pdTop);$('.el-slider[pn="padding-bottom"]').parents('.sl').find('.slider-value').text(pdBottom);elUpdate(el,'padding',0);var elName=$('.'+el).attr('data-name');ctrlElementTplStyleUpdate(elName,'padding',0,'reset');}
var colorChange=function(hex,el){var e=$(el).attr('el'),p=$(el).attr('pn');if(hex!="transparent")$(el).css('background-color','#'+hex);else $(el).css('background-color','#'+hex);$(el).colpickHide();elUpdate(e,p,'#'+hex);}
var matrixColumnChange=function(el,column,isSave){var org_col=el.find('[data-matrix-loop="true"]').attr('data-matrix-column'),col_xs=['','12','12','12','6','12','6'],col_sm=['','12','6','4','6','6','4'],col_md=['','12','6','4','3','15','2'],class_str='col-xs-'+col_xs[column]+' col-sm-'+col_sm[column]+' col-md-'+col_md[column]+' ';var checkChangCol=el.find('[data-matrix-loop="true"]').find('.item').first().hasClass('col-md-'+col_md[column]);if(!isSave&&checkChangCol||isSave&&column==org_col)return false;el.find('.item').each(function(i){var org_class=$(this).attr('class').split(' '),new_class='';org_class.forEach(function(v,i){if(v.match(/col-/g)===null)new_class=new_class+' '+v;});new_class=class_str+new_class.trim();$(this).attr('class',new_class);});if(isSave){$('#el-property').find('[data-loop-type="matrix"][data-matrix-column]').attr('data-matrix-column',column);el.find('[data-matrix-loop="true"]').attr('data-matrix-column',column);saveContentElement(selectEL);var type=getElementType();setLogs(type,"matrix.column.change","column-change",type);}}
var elementUpdate=function(el,pn,value,idx,logs){if(!el||!pn||!value){alert('Invalid variable elementUpdate()\r\nel : '+el+'\r\npn : '+pn+'\r\nvalue : '+value);return;}logs=(typeof logs=="undefined")?true:false;var t=(el[0]==".")?$(el):$('.'+el),w=t.attr('data-width'),p=RESOURCE+'/'+SID,f=(w!=0&&typeof w!="undefined")?'/'+w+'/':'/';switch(pn){case"background-image-body":if(myStorageActive()){var $img=$('<img>').attr('src',p+'/'+value);$img.on('load',function(){var path=p;if($(this)[0].width>=1920)path=RESOURCE+'/'+SID+'/1920';setStyleCss('.dsgn-body','background-image','url("'+path+'/'+value+'")');setStyleCss('.dsgn-body','background-position','center center');setStyleCss('.dsgn-body','background-repeat','repeat');setStyleCss('.dsgn-body','background-size','cover');setStyleCss('.dsgn-body','background-attachment','fixed');$('.prop-background-body-ctrl').empty();path=p+'/60/'+value;ctrl="<span class='attach-thumb'><img src='"+path+"'></span> <i class='fa fa-trash-o hand' id='prop-background-body-delete'></i></span>";$('.prop-background-body-ctrl').show().append(ctrl);$('.prop-body-background-option').fadeIn();});}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(value,1920);frUpload.then(function(data){$img=$('<img>').attr('src',data.image);$img.on('load',function(){setStyleCss('.dsgn-body','background-image','url("'+data.image+'")');setStyleCss('.dsgn-body','background-position','center center');setStyleCss('.dsgn-body','background-repeat','repeat');setStyleCss('.dsgn-body','background-size','cover');setStyleCss('.dsgn-body','background-attachment','fixed');$('.prop-background-body-ctrl').empty();ctrl="<span class='attach-thumb'><img src='"+data.thumb+"'></span> <i class='fa fa-trash-o hand' id='prop-background-body-delete'></i></span>";$('.prop-background-body-ctrl').show().append(ctrl);$('.prop-body-background-option').fadeIn();});});$('#body-background-position option[value="center center"]').attr('selected','selected');$('#body-background-repeat option[value="repeat"]').attr('selected','selected');$('#body-background-size option[value="cover"]').attr('selected','selected');setLogs("SITE","background.image.change","image-change","SITE");}break;case"background-image":if(myStorageActive()){var $img=$('<img>').attr('src',p+'/'+value);$img.on('load',function(){if($(this)[0].width>=1920)p=RESOURCE+'/'+SID+'/1920';elUpdate(el,pn,value,p);$('.prop-background-el').empty();if(value!="none"){bg=RESOURCE+'/'+SID+'/60/'+value;ctrl="<span class='attach-thumb'><img src='"+bg+"'></span> <i class='fa fa-trash-o hand' id='prop-background-delete' data-el='"+el+"' data-pn='background-image'></i></span>";$('.prop-background-el').append(ctrl);$('.prop-background-option').fadeIn();$('#el-background-position option[value="center center"]').attr('selected','selected');$('#el-background-repeat option[value="no-repeat"]').attr('selected','selected');$('#el-background-size option[value="cover"]').attr('selected','selected');}});}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(value,1920);frUpload.then(function(data){$img=$('<img>').attr('src',data.image);$img.on('load',function(){if($(this)[0].width>=1920)p=data.path+'1920';elUpdate(el,pn,data.f,p);$('.prop-background-el').empty();if(value!="none"){bg=data.thumb;ctrl="<span class='attach-thumb'><img src='"+bg+"'></span> <i class='fa fa-trash-o hand' id='prop-background-delete' data-el='"+el+"' data-pn='background-image'></i></span>";$('.prop-background-el').append(ctrl);$('.prop-background-option').fadeIn();$('#el-background-position option[value="center center"]').attr('selected','selected');$('#el-background-repeat option[value="no-repeat"]').attr('selected','selected');$('#el-background-size option[value="cover"]').attr('selected','selected');}});});}var type=getElementType();setLogs(type,"background.image.change","image-change",type);break;case"ctrl-background-image":console.log('ctrl-background-image function');break;case"image-change":var s=t.find('img[data-attach="true"]')[idx],o=$('.image-content .attach-thumb')[idx],img_width=$(s).attr('data-width');var tWidth=(typeof img_width=='undefined')?w:img_width;if(typeof tWidth!="undefined"){f=(tWidth=='0'||tWidth=='')?'/':'/'+tWidth+'/';}tWidth=(typeof tWidth=='undefined')?1920:tWidth;if(myStorageActive()){var src=p+f+value;$(s).attr('src',src).removeAttr('data-storage').removeAttr('data-photo-id').removeAttr('data-img-val');if($(s).parent().attr('id')!='site-home'&&typeof $(s).parent().attr('attr-link')=='undefined'&&typeof $(s).parent().attr('data-user-link')=='undefined'&&typeof $(s).parent().attr('attr-bookmark')=='undefined')$(s).parent().attr('href',p+'/'+value);if($(o).attr('el')=='el-menu'){$(o).find('img').attr('src',p+'/'+value);}else{$(o).find('img').attr('src',p+'/60/'+value);}if($(o).closest('[data-loop-type="matrix"]').length>0){if($(o).css('background-image')!='none'&&$(o).css('background-image').indexOf('url(')>-1){$(o).css('background-image','url(\"'+p+'/'+value+'\")');}}saveContentElement();}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(value,tWidth,$(o).attr('data-phto-id'));frUpload.then(function(data){if($(s).parent().attr('id')!='site-home'&&typeof $(s).parent().attr('attr-link')=='undefined'&&typeof $(s).parent().attr('data-user-link')=='undefined'&&typeof $(s).parent().attr('attr-bookmark')=='undefined')$(s).parent().attr('href',data.image);$(s).attr('src',data.image).attr('data-storage','free').attr('data-photo-id',data.id).attr('data-img-val',value);$(o).find('img').attr('src',data.thumb);if($(o).closest('[data-loop-type="matrix"]').length>0){if($(o).css('background-image')!='none'&&$(o).css('background-image').indexOf('url(')>-1){$(o).css('background-image','url(\"'+data.thumb+'\")');}}selectEL=el.replace(".","");saveContentElement();});}var type=getElementType();if(logs)setLogs(type,"image.change","image-change",type);break;case"image-url-change":var tc=$('#'+selectEL+'css'),ec=CSSJSON.toJSON(tc.text()),o=$('.image-content .attach-thumb')[idx],p=RESOURCE+'/'+SID,selector="."+$('.'+selectEL).attr('data-name')+" "+el,eid=$('.'+selectEL).data('id');if(myStorageActive()){var $img=$('<img>').attr('src',p+'/'+value);$img.on('load',function(){var path=p;if($(this)[0].width>=1920)p=RESOURCE+'/'+SID+'/1920';var img_path="url('"+p+"/"+value+"')",r=style.setCssProperty(ec,selector,"background-image",img_path);if($(o).closest('[data-loop-type="matrix"]').length>0){if($(o).css('background-image')!='none'&&$(o).css('background-image').indexOf('url(')>-1){$(o).css('background-image','url(\"'+p+'/'+value+'\")');}}$(o).find('img').attr('src',path+'/60/'+value);tc.text(CSSJSON.toCSS(r));var css=tc.text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:eid},function(data){checkError(data);var type=getElementType();setLogs(type,"image.change","image-change",type);},'json');});}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(value,1920);frUpload.then(function(data){$img=$('<img>').attr('src',data.image);$img.on('load',function(){if($(this)[0].width>=1920)p=data.path+'1920';var img_path="url('"+data.image+"')",r=style.setCssProperty(ec,selector,"background-image",img_path);if($(o).closest('[data-loop-type="matrix"]').length>0){if($(o).css('background-image')!='none'&&$(o).css('background-image').indexOf('url(')>-1){$(o).css('background-image','url(\"'+data.thumb+'\")');}}$(o).find('img').attr('src',data.thumb);tc.text(CSSJSON.toCSS(r));var css=tc.text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:eid},function(data){checkError(data);var type=getElementType();setLogs(type,"image.change","image-change",type);},'json');});});}break;default:break;}enableCarousel();}
var frStorageUpload=function(v,w,id){var deferred=$.Deferred(),id=(typeof id!='undefined'&&id)?id:$('li[data-source="'+v+'"]').attr('data-id');var ex=v.split("|"),s=[];if(ex.length>1){$.each(ex,function(i,d){s[i]=$('li[data-source="'+d+'"]').attr('data-id');});}else{s[0]=id;}var ids=s.join("|");$.ajax({type:'post',url:'/template/frstorage/upload',data:{img:v,sid:SID,w:w,ids:ids},dataType:'json',async:true,success:function(data){$.processOFF();if(data.error){alert(data.error);return false;}deferred.resolve(data);}});return deferred.promise();}
$('.element').live({mouseup:function(e){if($('#flat-modal').length)return;menuConfigToggle('close');if($('.site-edit-input').is(':focus'))return;siteConfigToggle('close');tmpEL=$(this).attr('data-el');clearElementController();if($('.gl-text').is(':focus')||$('.elname-input-text').is(':focus')||$('.url-input').is(':focus'))return;$('.colpick_full').each(function(){if($(this).css('display')=='block')isOpen=true;});if(isOpen)return;if(e.which==3){}else{if($('body').width()<769)return false;if(selectEL!=tmpEL){$('#el-property').hide();closeAddContent();if(typeof selectEL!='undefined'&&selectEL){if($('.'+selectEL).find("[contenteditable='true']").attr('contenteditable')){$('*[contenteditable]').attr('contenteditable',false);saveContentedit();}}selectEL=$(this).attr('data-el');selectID=$(this).attr('data-id');selectPOS=$(this).attr('data-pos');if(typeof selectEL=='undefined'){$('.noElement').attr('disabled',true);}else $('.context-menu-list li').removeClass('disabled');$(this).addClass('active').siblings().removeClass('active');}$('.config-element-section').hide();elementEnter();$('.'+selectEL+'_ctrl').show();if(!$(this).find("[contenteditable='true']").is(':focus')){$('.text-menu').removeClass('active').addClass('hide').css('top','-999px').css('left','-999px');if(isEDIT==true){saveContentedit();}}if(!$(this).find("[contenteditable='true']").attr('contenteditable')){$('.element').removeClass('el-active');$('*[contenteditable]').attr('contenteditable',false);if(isEDIT==true)saveContentedit();if($('#el-property').css('display')=='block')$('#el-property').hide(enableCarousel());}}},mouseenter:function(e){$('.recomm-image-text').hide();if($('#flat-modal').length)return;if(isEDIT)return;$('.config-image-edit').hide();$('.recomm-image-text').hide();if($.cookie('mode')=='view')return false;if($('#el-property').css('display')=='block')return false;$('.config-element-section').hide();if($('body').width()<769)return false;tmpEL=$(this).attr('data-el');if(selectEL!=tmpEL){$('.config-element-section').hide();}clearElementController();selectEL=$(this).attr('data-el');selectID=$(this).attr('data-id');selectPOS=$(this).attr('data-pos');$(this).addClass('active').siblings().removeClass('active');elementEnter();if($('header.navbar').hasClass('transparent')&&selectEL=='el_0'){$('.'+selectEL+'_ctrl').css({'top':$('header.navbar').outerHeight()+10+'px'});}if(selectEL=='el-menu'&&$('header.navbar').hasClass('sidebar')){$('.'+selectEL+'_ctrl .config-element').addClass('sidebar');}$('.'+selectEL+'_ctrl').show();},});var elementEnter=function(){addElementButtonDisplay(selectEL);if(VIEW&&selectEL=='el-menu'){$('.'+selectEL).next('.addElementButton').remove();}else{$('.'+selectEL+'.active').next('.addElementButton').show();if(HEADER==1&&$('.el_0').prev('.addElementButton').css('display')=='block'){$('.el_0').prev('.addElementButton').hide();}}}
$('.element img[data-attach="true"]').live('mousemove',function(e){if($('#el-nav').length>0||$('.dsgn-body').width()<769||$('.url-input').is(':focus')||isEDIT)return;if(!selectEL||typeof selectEL=='undefined'){selectEL=$(this).closest('.element').attr('data-el');$('.'+selectEL+'_ctrl').show();}if(imgLinkHover==true||imgEditHover==true||$.cookie('mode')=='view')return;if(typeof selectEL=="undefined")return false;var offset=$(this).offset(),left_or=offset.left+15,left=$(this).width()+offset.left-45,top=offset.top+$(this).height()-45;var index=$('.'+selectEL+' img[data-attach="true"]').index(this),txt=getRecommendInfo($('.'+selectEL),$(this),false),$info=$('.recomm-image-text'),type=$('.'+selectEL).attr('data-type'),type2=$('.'+selectEL).attr('data-type2');if(type=='showcase'&&type2=='imgsize')return;if($info.length==0){$('body').append('<div class="recomm-image-text">'+txt+'</div>');}$info.html(txt);$('.config-image-edit').find('.fa').removeClass('fa-pencil').addClass('fa-picture-o').attr('data-title','EDIT').parent('.config-image-edit').attr('data-original-title','EDIT');if($('header.navbar').hasClass('sidebar'))$('.config-image-edit').css('z-index','25');else $('.config-image-edit').css('z-index','25');$config_img_link=$('.config-image-link').css({top:top+'px',left:(left-45)+'px'}).attr('data-src',$(this).prop('src')).attr('data-index',index);$config_img_original=$('.config-image-view').css({top:offset.top+'px',left:left+20+'px'}).attr('data-src',$(this).prop('src')).attr('data-index',index);$config_img_edit=$('.config-image-edit').css({top:top+'px',left:(left-5)+'px'}).attr('data-src',$(this).prop('src')).attr('data-index',index);if(!$(this).parent().hasClass('navbar-brand'))$config_img_link.show();if(VIEW&&$(this).attr('data-img-original')=='ON')$config_img_original.show();if(type=='sns'||type=='footer'){if(type2=='icon'||type=='footer')$config_img_link.css({top:(top)+'px',left:(left)+'px'});else $config_img_edit.show();}else{$config_img_edit.show();$info.css({'top':(offset.top+10)+'px','left':(offset.left+10)+'px'}).show();}}).live('mouseout',function(e){$('.recomm-image-text').hide();});$('.gallery-item').live('mousemove',function(e){if($('.reorderModal').length)return;if($(this).hasClass('blitem'))return;var offset=$(this).offset(),left=$(this).width()+offset.left-45,top=offset.top+$(this).find('a img').height()-45,seq=$(this).attr('data-seq'),txt=getRecommendInfo($('.'+selectEL),$(this),false),$info=$('.recomm-image-text');if($info.length==0){$('body').append('<div class="recomm-image-text">'+txt+'</div>');}$info.html(txt);if(imgEditHover==true||$.cookie('mode')=='view'||$('.dsgn-body').width()<769)return;$('.config-image-edit').css({top:top+'px',left:left+'px'}).attr('data-index',$(this).attr('data-index')).attr('data-seq',seq).show();$('.config-image-edit').find('.fa').removeClass('fa-picture-o').addClass('fa-pencil').attr('title','EDIT').parent('.config-image-edit').attr('data-original-title','EDIT');if($(this).attr('data-index')=='0'){$('.config-image-add').css({top:top+'px',left:(left-45)+'px'}).attr('data-src',$(this).prop('src')).show();}else $('.config-image-add').hide();$info.css({'top':(offset.top+10)+'px','left':(offset.left+10)+'px'}).show();}).live('mouseout',function(e){$('.recomm-image-text').remove();});$('[data-loop] .grid').live('mousemove',function(e){if(typeof selectEL=='undefined')return;var offset=$(this).offset(),txt=getRecommendInfo($('.'+selectEL),$(this).find('img'),false),$info=$('.recomm-image-text');if($info.length==0){$('body').append('<div class="recomm-image-text">'+txt+'</div>');}$info.html(txt);$info.css({'top':(offset.top+10)+'px','left':(offset.left+10)+'px'}).show();});var addElementButtonDisplay=function(el){if(typeof el=="undefined"||el=="")return false;var $el=$('.'+el);if($('.element.active').next('.addElementButton').hasClass('add'+el)||$.cookie('mode')=='view')return false;if($('header.navbar ul.dropdown').css('display')=='block')return false;var btnStr=(VIEW)?".project":"";str="\
        <ul class='addElementButton add"+el+"'>\
            <li class='add nav-child' data-type='showcase'><div class='add-block' data-toggle='tooltip' data-placement='top' title='"+$.lang[LANG]['editor.addblock.here']+"'><img src='//i.addblock.net/icon/fa_plus_icon.png'></div></li>\
        </ul>\
    ";$str=$(str);$str.hover(function(){if($.cookie('mode')=='view')return;$(str).show();$('.config-image-view').hide();$('.config-image-link').hide();$('.config-image-edit').hide();$('.recomm-image-text').hide();},function(){if($(str).find('.add-block').hasClass('disabled'))return;$(str).hide();});$('.addElementButton').remove();var $str_before=$(str.replace("data-type='showcase'","data-type='showcase' data-index='0'")),$str_after=$(str.replace("data-type='showcase'","data-type='showcase' data-index='1'"));if(!$el.hasClass('fixed')){if(el=='el-menu'){if($('header.navbar').hasClass('sidebar')){$str_after.addClass('sidebar');$str_after.find('.add-block').attr('title',$.lang[LANG]['editor.addblock.here.top']);$str_after.find('li.add').css('top','0px');$str_after.css({'background-repeat':'repeat-y','overflow':'visible','z-index':'10','margin-top':'0px','margin-left':'-30px','padding':'0px','top':'0%','-webkit-transform':'translateY(-50%)','-moz-transform':'translateY(-50%)','-ms-transform':'translateY(-50%)','-o-transform':'translateY(-50%)','transform':'translateY(-50%)',});}else if(!$('.header.el-menu').hasClass('fixed')){$str_after.css({'position':'absolute','top':$('header.navbar').outerHeight()+'px'});if($('header.navbar').hasClass('sidebar')){$str_after.css('top','0');}$str_after.css('z-index','21').show();}}else if(el!='el-menu'){if(VIEW)$str.find('.add-block').attr('title',$.lang[LANG]['editor.addcontents.here']);if($('header.navbar').hasClass('sidebar')){var left_margin=$('header.navbar').outerWidth()+'px';$str_before.css({'margin-left':'-'+left_margin,'padding-left':left_margin});$str_after.css({'margin-left':'-'+left_margin,'padding-left':left_margin});}}if(el!='el-menu'){if(VIEW){if(el!='el_0')$el.before($str_before);}else{$el.before($str_before);}if(el=='el-footer'){$('.add-block').addClass('disabled');}}$el.after($str_after);if(el=='el-footer'||el=='el-menu')$('.add-block').addClass('disabled');$('.addElementButton').show();}}
$('#el-lists > li').live({mousedown:function(e){selectID=$(this).attr('data-id');X=e.pageX;Y=e.pageY;}});$('#prop-method-background-body').live({click:function(){var target=$(this).attr('el');$('.resource-useit').attr('data-property','background-image-body').attr('data-element',target);selectCount=1;}});$('#prop-method-background').live({click:function(){var target=$(this).attr('el');$('.resource-useit').attr('data-property','background-image').attr('data-element',target).attr('data-replace-count',1).removeAttr('data-ctrl').removeAttr('data-idx');selectCount=1;}});$('.ctrl-prop-method-background').live('click',function(){var selector=$(this).attr('selector'),idx=$(this).attr('data-idx');$('.resource-useit').attr('data-property','ctrl-background-image').attr('data-element',selector).attr('data-replace-count',1).attr('data-ctrl','true').attr('data-idx',idx);selectCount=1;});$('.prop-method-image').live({click:function(){var target=$(this).attr('el'),idx=$(this).attr('idx');$('.resource-useit').attr('data-property','image-change').attr('data-element',target).attr('data-idx',idx).attr('data-replace-count',1);selectCount=1;}});$('.prop-method-image-url').live({click:function(){var target=$(this).attr('el'),idx=$(this).attr('idx');$('.resource-useit').attr('data-property','image-url-change').attr('data-element',target).attr('data-idx',idx).attr('data-replace-count',1).removeAttr('data-ctrl');selectCount=1;}});$('.gallery-image-resource').live({click:function(){var seq=$(this).attr('data-seq'),idx=$(this).attr('idx');$('.resource-useit').attr('data-property','gallery-resource-change').attr('data-idx',idx).attr('data-seq',seq).attr('data-replace-count',1);selectCount=1;}});var showConfigPanel=function(){disableCarousel();var tpl_element=$('.'+selectEL);$('#el-property').attr('data-element',selectEL);$('#prop-name').text(tpl_element.data('name'));if(VIEW&&selectEL=='el_0'&&$('.element.'+selectEL).attr('data-type')=='project'){$('#el-property').attr('data-project-block',true);}if(isEDIT==true){X=-1000;Y=-1000;}var setting=getElementController(selectEL);if(setting==false){$('.element').removeClass('el-active');return;}showElementProperty(X,Y);$('#el-property').show();menuConfigToggle('close');siteConfigToggle('close');};var elEditable=function(el){$('.'+el).summernote({airMode:true});isEDIT=true;menuConfigToggle('close');}
var menuConfigToggle=function(open){var t,i;if(open=='close'){$(".menu-config.edit-menu").removeClass('active');$(".menu-config.edit-menu h5").removeClass('open');}else{$(".menu-config.edit-menu").addClass('active');$(".menu-config.edit-menu h5").addClass('open');}i=(typeof open=="undefined"||open=='open')?parseInt($('#el-menu-config').css('top')):0;t=(i<0)?"35":-$('#el-menu-config').outerHeight(true)-5;if(t>-250&&t<0){t=-255;}$('#el-menu-config').animate({top:t+'px'},600);}
var siteConfigToggle=function(open){if($('.input-music-title').is(':focus'))return false;var t,i;if(open=='close'){$(".menu-config.edit-site").removeClass('active');$(".menu-config.edit-site h5").removeClass('open');open='close';}else{$(".menu-config.edit-site").addClass('active');$(".menu-config.edit-site h5").addClass('open');}i=(typeof open=="undefined"||open=='open')?true:false;t=(i)?"35px":-$('#el-site-config').outerHeight(true)-5;$('#el-site-config').animate({top:t},600);}
var addElementInfo=function(){if($('.addEL-wrap').length||COUNT)return;var onclick=(VIEW)?"addController('show');":"showElList();";str='\
    <div class="addEL-wrap element">\
        <div class="info text-shadow" onclick="'+onclick+'"><div><img src="//i.addblock.net/addblock.png"></div>'+$.lang[LANG]['editor.click-to-add']+' <b>'+PAGE.replace(",","/")+$.lang[LANG]['editor.s-block']+'</b></div>\
    </div>\
    ';$(str).insertAfter($('.header.el-menu')).fadeIn();}
var addPageNav=function(page,view,total){$('#prop-gallery-pagination').remove();page_view=6;start=Math.floor((page-1)/page_view)*page_view;pages=Math.ceil(total/view);end=(Math.floor((page-1)/page_view)+1)*page_view;end=(end>pages)?pages:end;prev=(start>0)?start:1;next=((end+1)>pages)?pages:end+1;page_nav='\
    <div id="prop-gallery-pagination">\
        <div class="pull-left" style="margin-top: 5px; line-height: 1;">\
            <ul class="pagination pagination-sm">\
                <li><a href="javascript:;" class="icon-border" onclick="galleryGetPage('+prev+')">&lt;</a></li>\
    ';for(i=start;i<end;i++){active=((i+1)==page)?"active":"";page_nav=page_nav+'\
                <li class="'+active+'"><a href="javascript:;" onclick="galleryGetPage('+(i+1)+')">'+(i+1)+'</a></li>\
        ';}if(pages>end){page_nav=page_nav+'\
                <li> ... </li>\
                <li><a href="javascript:;" onclick="galleryGetPage('+pages+')">'+pages+'</a></li>\
        ';}page_nav=page_nav+'\
                <li><a href="javascript:;" class="icon-border" onclick="galleryGetPage('+next+')">&gt;</a></li>\
            </ul>\
        </div>\
        <div class="pull-right" style="margin:5px 0px 0px;">\
            <span class="btn btn-primary fileinput-button btn-sm gallery-add" data-toggle="modal" data-target="#el-fileupload">\
                <img src="//i.addblock.net/icon/fa_plus_icon.png" alt="" />&nbsp;\
                '+$.lang[LANG]['config.gallery.add']+'\
            </span>\
        </div>\
    </div>\
    ';$('.prop-images').append(page_nav);}
var galleryGetPage=function(item_page){$('#gallery-list-config').empty();$('#gallery-list-config').attr('data-page',item_page);$.ajax({url:'/template/gallery/list/pid/'+selectID+'/sid/'+SID+'/spage/'+PAGE+'/page/'+item_page,dataType:'json',async:false,cache:false,success:function(data){if(typeof(data.error)=="undefined"){if(data.list.length>0){$('.prop-images').show();$('.porp-emptyimages').remove();var rtnPage=(data.list.length==1)?item_page-1:item_page;rtnPage=(rtnPage)?rtnPage:1;$.each(data.list,function(idx,val){addGalleryContent(val.image,RESOURCE,val.seq,val.title,val.caption,val.visible,val.pos,idx,rtnPage,val.gsettings);});addPageNav(item_page,GVIEW,data.total.conf_total);}else{$('#prop-gallery-pagination').remove();noImages=$.lang[LANG]['config.gallery.none'];addImage=$.lang[LANG]['config.gallery.add-image'];add=$.lang[LANG]['config.gallery.add'];str='\
                    <div class="pull-right" style="margin:5px 0px 0px;">\
                        <span class="btn btn-primary fileinput-button btn-sm gallery-add" data-toggle="modal" data-target="#el-fileupload">\
                            <i class="fa fa-plus"></i>&nbsp;\
                            <span>'+$.lang[LANG]['config.gallery.add']+'</span>\
                        </span>\
                    </div>\
                    <div class="clear"></div>\
                    ';$(str).appendTo('#gallery-list-config');$('.prop-images').hide();empty='\
                    <div class="porp-emptyimages">\
                        <p class="text-center" style="margin-top: 20px; margin-bottom: 20px;">\
                            <strong style="color:#4788e6"><i class="fa fa-exclamation-circle"></i>\
                            <span>'+noImages+'</span><br />\
                            <span>'+addImage+'</span>\
                            </strong>\
                        </p>\
                        <div class="pull-right" style="margin:5px 0px 0px;">\
                            <span class="btn btn-primary btn-sm gallery-add empty" >\
                                <i class="fa fa-plus"></i>&nbsp;\
                                <span>'+add+'</span>\
                            </span>\
                        </div>\
                    </div>\
                    <div class="clear"></div>\
                    ';$('.prop-images').after(empty);}}else $(this).showModalFlat('INFORMATION',data.error,true,false,'','ok');}});}
$('.gallery-add.empty').live({click:function(){chooseGalleryType();}});$('.gl-mode').live({click:function(){var m=$(this).data('mode');$.post('/template/gallery/mode',{pid:selectID,mode:m},function(data){checkError(data);},"json");var translate="<span data-lang='config.gallery.type."+m+"'>"+$.lang[LANG]['config.gallery.type.'+m]+"</span>  <span class='caret'></span>";$('#gl-mode').html(translate);(m!="project")?$('.comment-config').hide():$('.comment-config').show();(m!="project")?$('.config-comment-sns').hide():$('.config-comment-sns').show();(m!="project")?$('.config-bottomlist').hide():$('.config-bottomlist').show();(m!="gallery")?$('.config-original-view').hide():$('.config-original-view').show();showPageCallback(showPage);var type=getElementType();setLogs(type,'gallery.type.'+m,"gallery-type-"+m,type);}});$('.comment-mode').live('click',function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var onoff=$(this).attr('data-comment');$('#comment-mode').html("<span data-lang=''>"+onoff+"</span>  <span class='caret'></span>");(onoff=="ON")?$('#comment-mode').removeClass('btn-default').addClass('btn-primary'):$('#comment-mode').removeClass('btn-primary').addClass('btn-default');var settings={comment_display:onoff}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);},'json');showPageCallback(showPage);});$('#comment-display').live({click:function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var comment=$(this).prop('checked'),onoff=(comment)?'ON':'OFF';var settings={comment_display:onoff};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);},'json');showPageCallback(showPage);}});$('#gallery-bottomlist-display').live({click:function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var bottomList=$(this).prop('checked'),onoff=(bottomList)?'ON':'OFF';var settings={bottomlist_display:onoff};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);},'json');showPageCallback(showPage);}});$('#sns-share-display').live({click:function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var snsShare=$(this).prop('checked'),onoff=(snsShare)?'ON':'OFF';var settings={sns_share_display:onoff};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);},'json');showPageCallback(showPage);}});$('#original-view').live({click:function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var original_view=$(this).prop('checked'),onoff=(original_view)?'ON':'OFF';var settings={img_original_display:onoff};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);},'json');showPageCallback(showPage);}});$('.img-original-mode').live('click',function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var onoff=$(this).attr('data-img-original');$('#img-original-mode').html("<span data-lang=''>"+onoff+"</span>  <span class='caret'></span>");(onoff=="ON")?$('#img-original-mode').removeClass('btn-default').addClass('btn-primary'):$('#img-original-mode').removeClass('btn-primary').addClass('btn-default');var settings={img_original_display:onoff}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);$('.userEL'+selectID).find('img[data-attach="true"]').attr('data-img-original',settings.img_original_display);},'json');});$('#forum-config').live('click',function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR','ë¸”ëŸ­ ì„¤ì • ì˜¤ë¥˜ ìž…ë‹ˆë‹¤. íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•˜ì„¸ìš”',true,false,'','ok');return false;}$.forum.config(selectID);});var deleteTemplate=function(seq,type){if(!seq){alert('Invalid template ID');return}if(confirm('Delete?')){tpl=$('.ellist-sidebar .nav li.active').data('type');$.post('/template/element/type/delete/seq/'+seq+'/tpl/'+tpl,{},function(data){checkError(data);},'json');(type=='menu')?showMenuList(tpl):showElementList(tpl);}clearElementView();}
var addTemplate=function(isMenu){initTemplateController('Add template');(typeof isMenu!="undefined")?$('#el-save').attr('data-menu',true):$('#el-save').attr('data-menu',false);$('#el-edit').modal('show');}
var initTemplateController=function(title){title=(typeof title!="undefined")?title:"Edit template";$('#tpl-ctrl-title').text(title);$('#tpl-prop-type').val('');$('#tpl-prop-type2').val('');$('#tpl-prop-feature').val('');$('#tpl-prop-overlap').val('');$('#tpl-prop-folder').val('');$('#tpl-prop-name').val('');$('#tpl-html .tpl-element').val('');$('#tpl-css .tpl-element').val('');$('#tpl-js .tpl-element').val('');$('#tpl-settings .tpl-element').val('');}
var saveContentedit=function(){saving=true;$('.dsgn-body').css('cusor','wait');if(isEDIT&&selectEL){$('.'+selectEL+' *[data-edit="true"]').froalaEditor('destroy');$('.'+selectEL+' *[data-edit="true"]').css('z-index','');$('.'+selectEL).find('.fr-marker').remove();$.each($('.'+selectEL).find('[data-edit="true"] *'),function(i,v){$(this).html().replace(/&zwnj;/g,'');});$('[data-edit="true"][data-attach="true"]').css('-webkit-text-fill-color','rgba(0,0,0,0)');$('.'+selectEL).find("[contenteditable]").removeAttr('contenteditable').removeClass('contenteditable-save');isEDIT=false;var res=saveContentElement(),data=(typeof res!='boolean')?$.parseJSON(res.responseText):{edit:false};if(data.edit){var type=getElementType();setLogs(type,'text.change','text-edit',type);}saving=false;$('.dsgn-body').css('cusor','auto');}}
var saveContentElement=function(){if(typeof selectEL=="undefined")return false;var type=$('.'+selectEL).data('type'),type2=($('.'+selectEL).data('type2'))?$('.'+selectEL).data('type2'):'';if(type=='gallery'){data=saveContentGallery();return data;}var sns_org_container=(type=='sns'&&type2=='feed'&&$('.'+selectEL).find('[data-edit="true"]').length>0&&$('.'+selectEL).find('[social-feed-id]').length>0)?$('.social-feed-container').html():'';if(sns_org_container){$.getJSON('/template/element/type/get/seq/'+selectID,{sid:SID},function(data){checkError(data);var tag=htmlspecialchars_decode(data[0]['eltag']),el=$(tag)[0];sns_org_container='\
            '+$(el).find('[data-loop="true"]').children().outerHTML()+'\
            ';},'json');}var msny=$('.'+selectEL).data('msny');$('.element *[data-edit="false"]').attr('data-edit','true');if(msny){$('.'+selectEL).removeAttr('style').find('*').removeAttr('style');}$('.'+selectEL+' span').each(function(i,v){if($(this).attr('style')){var s=$(this).attr('style').match(/font-size:(\s)*(\d.*)px;/);if(s!=null){$(this).attr('style',$(this).attr('style').replace(/font-size:\s*\d+px;/g,''));$(this).addClass('fsize'+s[2]);}}});$('.'+selectEL).removeAttr('style');var video=$('.'+selectEL).find('.fluid-width-video-wrapper');$.each(video,function(i,v){var source=$(this).html();$('.'+selectEL).find('.video-content:eq('+i+')').html(source);});var seq=(selectEL=='el-menu')?"menu":$('.'+selectEL).data('id'),tpl_tag=(selectEL=='el-menu')?$('header.navbar')[0].outerHTML:$('.'+selectEL)[0].outerHTML;var $temp=(selectEL=='el-menu')?$('header.navbar').clone():$('.'+selectEL).clone();var linkto=$temp.attr('data-link');$temp.find('.social-feed-element img').removeAttr('style');$temp.removeClass('el-active').removeClass('transparent').removeClass('element').removeAttr('data-id').removeAttr('data-msny').removeAttr('data-pos').removeAttr('data-el').removeAttr('data-type').removeAttr('data-type2').removeAttr('data-width').removeAttr('data-overlap').removeAttr('data-name').removeAttr('data-link').removeAttr('data-bookmark').removeAttr('data-mode').removeAttr('style').removeClass('active').removeClass('el-footer').removeClass('link-to-'+linkto).removeClass('disable').removeClass('element-disable');if($temp.find('[data-matrix-loop="true"]').length>0){$temp.find('[data-matrix-loop="true"] .item').removeClass('__matrix_focus').removeAttr('style');$('.'+selectEL).find('[data-matrix-loop="true"] .item').removeClass('__matrix_focus').removeAttr('style');}$temp.removeClass(function(index,css){return(css.match(/el_\d{0,3}/)||[]).join(' ');});if(sns_org_container)$temp.find('[data-loop="true"]').html(sns_org_container);if(selectEL=='el-menu'){$temp.find('#tpl-menu').children().first().find('a').removeAttr('data-selector').removeAttr('data-font').removeAttr('data-title');}var nav=$temp.find('[data-nav="true"]').children(),item=$temp.find('[data-loop="true"]').children();initShowcaseActive(nav);initShowcaseActive(item);$temp.find(".google-map").html('').removeAttr('style');var tpl_return=$temp[0].outerHTML;tpl_return=tpl_return.replace(/&lt;&nbsp;/g,"&lt;").replace(/&nbsp;&gt;/g,"&gt;");tpl_return=tpl_return.replace(/&lt;/g,"&lt;&nbsp;").replace(/&gt;/g,"&nbsp;&gt;");var res=$.post('/template/element/type/update-text/seq/'+seq,{tag:tpl_return,sid:SID},function(data){checkError(data);if(seq=='menu'){MTAG=$.parseJSON(data.tag);MCSS=$.parseJSON(data.css);MSTYLE=$.parseJSON(data.style);showPage(MCSS,MSTYLE,MTAG,true);activeEL(selectEL);}if(type=='sns'&&type2=='feed'){if($('.'+selectEL).find('.social-feed-container .listprogress').length){$(this).showModalFlat('INFORMATION','Please wait...',true,false,'','ok');return false;}if($('.'+selectEL).find('.social-feed-container').children().not('.listprogress').length==0){$(this).showModalFlat('Error','Feed template none',true,false,'','ok');return false;}}},'json');enableCarousel();if(VIEW&&(selectEL=='el_0'||$('.'+selectEL).attr('data-type')=='project')){var title=$('.'+selectEL).find('*[data-project-title]').html(),caption=$('.'+selectEL).find('*[data-project-description]').html(),image=$('.'+selectEL).find('img[data-project-image]').attr('src');if($('.'+selectEL).find('.data-project-image-bg').length>0){image=$('.'+selectEL).find('.data-project-image-bg').css('background-image').replace('url("','').replace('")','');}else if($('.'+selectEL+'.data-project-image-bg').length>0){image=$('.'+selectEL+'.data-project-image-bg').css('background-image').replace('url("','').replace('")','');}$.post('/template/element/type/update-projectData/seq/'+seq,{sid:SID,gid:VIEW,pid:PARENT['pid'],title:title,caption:caption,image:image},function(data){checkError(data);},'json');}$('.dsgn-body').fitVids();if(selectEL!='el-footer')addElementButtonDisplay(selectEL);$('.'+selectEL+' *[data-edit="true"]').each(function(i,v){if($(v).text().length==0){$(v).html("&nbsp; ");}});return res;}
var saveContentGallery=function(){var $gallery=$('.'+selectEL);var seq=$gallery.data('id');if(typeof seq=="undefined"||!seq){alert('Undefined selectEL ID');return false;}var title=$gallery.find('.gallery-title').html(),caption=$gallery.find('.gallery-caption').html();if(typeof title=='undefined'||typeof caption=='undefined')return false;if(title.length==0){$gallery.find('.gallery-title').html('&nbsp;');}if(caption.length==0){$gallery.find('.gallery-caption').html('&nbsp;');}$.getJSON('/template/element/type/get/seq/'+seq+'/tpl/null?sid='+SID,function(data){checkError(data);var r=data[0];var tag=htmlspecialchars_decode(r.eltag),$el=$(tag);$el.find('.gallery-title').html(title);$el.find('.gallery-caption').html(caption);var eltag=$el.outerHTML(),elcss=r.elcss,eljs=r.eljs,eltype=r.type,elfeature=r.feature,elfolder=r.folder,elname=r.elname,eloverlap=r.overlap,tpl_img='';$('.element *[data-edit="false"]').attr('data-edit','true');$.post('/template/element/type/update/seq/'+r.seq+'/tpl/null',{tag:eltag,css:elcss,js:eljs,tpl_type:eltype,tpl_feature:elfeature,tpl_folder:elfolder,tpl_name:elname,tpl_overlap:eloverlap,sid:SID,tpl_img:tpl_img},function(data){checkError(data);},'json');});}
var appendGalleryFrame=function(tpl,seq,elsettings){tpl.find("[data-gallery]").attr('data-gallery','#gframe-'+seq);var settings=(typeof elsettings=="undefined"||elsettings=="")?{}:$.parseJSON(elsettings),img_onoff=(typeof settings.img_original_display=="undefined")?"OFF":settings.img_original_display;tpl.find("[data-gallery]").attr('data-img-original',img_onoff);galleryFrame(seq);return tpl;}
var activeEL=function(active){if(typeof selectEL=='undefined'||selectEL=='')return;header_fixed=$('header.navbar').height();var offset=($('.dsgn-body').hasClass('sidebar'))?0:-header_fixed;$('.dsgn-body').scrollTo('.'+selectEL,0,{offset:offset});if(typeof active!==undefined){var $el=$('.'+selectEL);if($('.dsgn-body').width()>768)$el.addClass('active');if($('#el-property').css('display')=='block')$el.addClass('el-active');}$.cookie('selectEL','');}
var getGalleryViewParent=function(seq){var r;$.ajax({url:'/template/element/type/gallery/seq/'+seq,dataType:'json',async:false,success:function(data){checkError(data);r=data;}},'json');return r;}
$('#change-gallery').live({click:function(){showElementList('gallery','gallery',selectID);$('#el-property').hide(enableCarousel());}});$('#change-forum').live({click:function(){showElementList('forum','forum',selectID);$('#el-property').hide(enableCarousel());}});$('#change-project-titleblock').live({click:function(){var el_name=$(this).attr('data-elname');if($('.'+el_name).find('*[data-project-title],*[data-project-description],*[data-project-image],.data-project-image-bg').length==0&&!$('.'+el_name).attr('data-type2')){$(this).showModalFlat('INFORMATION',$.lang[LANG]['config.project.change-titleblock.info'],true,false,'','ok');return false;}showElementList('project','project',selectID);$('#el-property').hide(enableCarousel());}});$('#change-gallerycategory').live({click:function(){showElementList('gallerycategory','gallerycategory',selectID);$('#el-property').hide(enableCarousel());}});$('#sns-account-save').live({click:function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var el_confing=$(this).closest('#prop-sns-account');if(el_confing.find('.sns-instagram-token').hasClass('disconnect')){el_confing.find('.sns-instagram input.disconnect').removeClass('disconnect').val('');el_confing.find('.sns-instagram .sns-user.disconnect').removeClass('disconnect');}var instagram_data=(el_confing.find('.sns-instagram-token').length>0)?{'token':el_confing.find('.sns-instagram-token').val(),'expires':el_confing.find('.sns-instagram-expires').val(),'id':el_confing.find('.sns-instagram-id').val(),'name':el_confing.find('.sns-instagram-name').val()}:el_confing.find('.sns-instagram span input').val();var settings={sns:{twitter:el_confing.find('.sns-twitter span input').val(),facebook:el_confing.find('.sns-facebook span input').val(),instagram:instagram_data}}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);},'json');var element=$('.'+selectEL).attr('data-name');loadingElement(element,'loading posts...');updateFeed(element,settings.sns);var type=getElementType();setLogs(type,"snsfeed.change","sns-feed",type);}});$('#sns-account-instagram').live({click:function(){var sns_instagram=$(this).closest('.sns-instagram');if(!sns_instagram.find('.sns-instagram-id').val()||sns_instagram.find('.sns-instagram-id.disconnect').val()){if(sns_instagram.find('.sns-instagram-id.disconnect').val()){sns_instagram.find('input.disconnect').val('').removeClass('disconnect');sns_instagram.find('.sns-user.disconnect').removeClass('disconnect');}$.cookie('sns-block-connect-el',selectID,{path:'/',expires:10*60});$.cookie('sns-network-'+selectID,'instagram',{path:'/',expires:10*60});var win=window.open('/socialfeed/oauthInstagram',"_blank","top=15, left=15, width=400, height=232");}else{if($(this).closest('.sns-instagram').find('.hide').length==0){var sns_instagram=$(this).closest('.sns-instagram');sns_instagram.find('input').addClass('disconnect');sns_instagram.find('.sns-user').addClass('disconnect');sns_instagram.find('#sns-account-instagram').html($.lang[LANG]['config.sns.feed.connect']);}}}});$('#list-dataview-save').live({click:function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var type=$(this).attr('data-type'),view=$('.list-default-number span input').val();if(view<1||view>50){$('.list-default-number + .error').removeClass('hide');$('.list-default-number span input').focus().val('');return false;}else{$('.list-default-number + .error').addClass('hide');}$.getJSON('/template/element/type/get/seq/'+selectID,{sid:SID},function(data){checkError(data);var cookie_str=(type=='forum')?type+'_'+selectID:type+'-page-'+selectID;if($.cookie(cookie_str))$.removeCookie(cookie_str,{path:'/'});var tag=htmlspecialchars_decode(data[0]['eltag']),el=$(tag)[0];$(el).find('[data-loop="true"]').attr('data-view',view);var tpl_return='<div class="'+data[0]['elname']+'">'+$(el).html()+'</div>';if(data[0]['type2']&&data[0]['type2']!="normal")tpl_return='<div class="'+data[0]['elname']+'" data-forum-type="'+data[0]['type2']+'">'+$(el).html()+'</div>';$.post('/template/element/type/update-text/seq/'+selectID,{tag:tpl_return,sid:SID},function(data){checkError(data);showPageCallback(showPage);},'json');},'json');}});$(document).ready(function(){$('#flat-modal').live('hidden.bs.modal',function(e){$(this).parent('div').first().remove();});});$('#category-display').live({click:function(){gc=$(this).prop('checked');gallery_settings_category_display=(gc)?"ON":"OFF";$config_panel=$(this).closest('#prop-category');$('.btn-color-mode').removeClass('open active');if(gc)$config_panel.find('.line.disabled,#change-gallerycategory').removeClass('disabled');else $config_panel.find('.line:not(:nth-child(1)),#change-gallerycategory').addClass('disabled');var settings={category_display:gallery_settings_category_display};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);},'json');$('.element[data-id="'+selectID+'"]').attr('data-category',gallery_settings_category_display);loadGalleryCategoryBlock($('.element[data-id="'+selectID+'"]'),selectID);var type=getElementType();setLogs(type,"gallery.category."+gc,"toggle-"+gc,type);}});$('.category-config').live({click:function(){var pid=$(this).attr('data-pid'),cate_str=($('.galleryController').length==0)?$(this).parent().prev().find('.selected-category').text():false,isCheck=true,is_active_gc_delete=false;$('.btn-color-mode').removeClass('open active');var cateedit_modal=$(this).showModalFlat('EDIT CATEGORY',galleryCategoryConfig(pid,cate_str),true,true,function(){if(!$('.category-item.additem').find('.category-name').text()){$('.category-item.additem').remove();}if($('.flat-category-modal .category-editlist').children.length==0){return false;}$('.flat-category-modal .category-editlist input').each(function(){var motion=$(this).attr('data-motion'),val=$(this).attr('value'),newcate=$(this).attr('data-newcate');var cate_list='';if(motion=='edit'&&$('.category-li.active').find('.category-name[data-name="'+val+'"]').length>0){$('.category-li.active').find('.category-name[data-name="'+val+'"]').text(newcate);$('.form-group.category ul li.active').each(function(i){var cate_name=$(this).find('.category-name').text().trim(),divider=($('.form-group.category ul li.active').length-1==i)?'':', ';cate_list=cate_list+cate_name+divider;});$('.gallery-item-category').text(cate_list);}if(motion=='delete'){if($('.element[data-id="'+selectID+'"]').find('.gallery-category-nav .active a').text()==val)is_active_gc_delete=true;$.cookie('gallery-page-'+selectID,1,{path:'/',expires:12*60*60*1000});$.cookie('gallery-category-'+selectID,'',{path:'/',expires:12*60*60*1000});$.removeCookie('loadmore-'+selectID,{path:'/'});}$.post('/template/update/type/gallerycategory',{id:SID,s:val,pid:selectID,motion:motion,newcate:newcate},function(data){isCheck=checkError(data);if(!isCheck)return false;},'json');});var category_result_str=$('.flat-category-modal .category-item').map(function(){return $(this).find('.category-name').text();}).get();$('#prop-category .selected-category').text(category_result_str.toString().replace(/\,/g,'\, '));var category_str='|'+category_result_str.toString().replace(/\,/g,'|,|')+'|';var settings={category:category_str};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){isCheck=checkError(data);if(!isCheck)return false;},'json');$('.flat-category-modal #flat-modal').modal('hide');if(!isCheck)return false;if($('.galleryController').length>0)$('.galleryController .form-group.category').replaceWith(galleryCategoryCheckList(pid,$('.galleryController .form-group.category').find('.gallery-item-category').text()));loadGalleryCategoryBlock($('.element[data-id="'+selectID+'"]'),selectID,'',settings);if($('.element[data-id="'+selectID+'"]').find('.emptyGalleryItem').length==0){if(is_active_gc_delete)$('.element[data-id="'+selectID+'"]').find('.gallery-category-nav li').removeClass('active');$('.element[data-id="'+selectID+'"]').find('.gallery-category-nav li a[data-idx="0"]').click();}else{$('.element[data-id="'+selectID+'"]').find('.gallery-category-nav').addClass('empty');}},'cancel','w480 category-modal').attr({'data-pid':pid}).closest('.flat-modal').removeClass('flat-modal').addClass('flat-category-modal');$('.category-content:not(".empty")').sortable({items:'.category-item',cancel:'.category-update-cancel, button, .category-update-name',update:function(event,ui){}}).disableSelection();}});$('.category-add').live({click:function(){if($('.category-content .category-item.additem').length>0)return;if($('.category-content .category-update').length>0){$('.category-content .category-update').find('input').focus();return false;}var idx=$('.category-content .category-item').length,str=galleryCategoryItem('',idx);$('.category-content').append(str);$('.category-edit[data-idx='+idx+']').click();galleryCategoryItemEmptyCheck();}});$('.category-delete').live({click:function(){var cate_idx=$(this).attr('data-idx'),cate_name=$('.category-content #catesort'+cate_idx+' .category-name').text().trim();var del_modal=$(this).showModalFlat('DELETE CATEGORY',$.lang[LANG]['editor.gallery.category.delete'],true,true,function(){if($('.flat-category-modal .category-editlist').find('input[data-motion="delete"][value="'+cate_name+'"]').length==0)$('.flat-category-modal .category-editlist').append("<input type='hidden' data-motion='delete' value='"+cate_name+"'>");$('.category-content #catesort'+cate_idx).remove();galleryCategoryItemEmptyCheck();del_modal.modal('hide');},'cancel');}});$('.category-edit').live({click:function(){if($('category-content').find('.category-update').length>0)return false;var cate_idx=$(this).attr('data-idx'),cate_name=$('.category-content #catesort'+cate_idx).find('.category-name').text();var input_text=addGalleryCategoryInput(cate_idx,cate_name);$(input_text).appendTo($('.category-content #catesort'+cate_idx).find('.category-info'));$('.category-content').find('.category-item').css('pointer-events','none');$('.category-content').find('.category-update-cancel, .category-update-save, .category-update-name').css('pointer-events','auto');$('.category-update .category-update-name').focus();}});$('.category-update-cancel').live({click:function(){if(!$(this).closest('.category-info').find('.category-name').text()){$(this).closest('.category-item').remove();galleryCategoryItemEmptyCheck();}$('.category-content').find('.config-error').remove();$('.category-content').find('.category-item').removeAttr('style');$('.category-content').find('.category-update').remove();}});$('.category-update-save').live({click:function(){var idx=$(this).attr('data-idx'),category_name=$('.category-update-name').val().trim(),category_prev=$('.category-content #catesort'+idx+' .category-name').text().trim(),regexp=/^[ã„±-ã…Ž|ê°€-íž£|a-z|A-Z|0-9|\#| ]+$/i,editcategoryname=($('.category-content .category-item').length>idx)?'category-edit':'';$position=(editcategoryname)?$('.category-content #catesort'+idx):$('.category-content');$('.config-error').remove();if(category_prev==category_name){if($('.category-content #catesort'+idx).hasClass('additem')){$position.append('<div class="config-error '+editcategoryname+'">'+$.lang[LANG]['editor.gallery.category.enter-name']+'</div>');}else{$('.category-content').find('.category-item').removeAttr('style');$('.category-content').find('.category-update').remove();}return false;}if(!regexp.test(category_name)){$position.append('<div class="config-error '+editcategoryname+'">'+$.lang[LANG]['board.allowed-chars']+'</div>');return false;}if(category_name.length<1){$position.append('<div class="config-error '+editcategoryname+'">'+$.lang[LANG]['board.enter-group-name']+'</div>');return false;}if(category_name.length>20){$position.append('<div class="config-error '+editcategoryname+'">'+$.lang[LANG]['board.enter-max-chars']+'</div>');return false;}var list=$('.category-content .category-item .category-name').map(function(){return $(this).text().trim();}).get();if($.inArray(category_name,list)>-1){$position.append('<div class="config-error '+editcategoryname+'">'+$.lang[LANG]["editor.gallery.category.inuse-name"]+'</div>');return false;}if($('.flat-category-modal .category-editlist').find('input[data-motion="edit"][value="'+category_prev+'"]').length==0){$('.flat-category-modal .category-editlist').append("<input type='hidden' data-motion='edit' data-newcate='"+category_name+"' value='"+category_prev+"'>");}else if($('.flat-category-modal .category-editlist').find('input[data-motion="edit"][value="'+category_prev+'"]').length){$('.flat-category-modal .category-editlist').find('input[data-motion="edit"][value="'+category_prev+'"]').attr('value',category_name);}if($('#catesort'+idx).hasClass('additem'))$('#catesort'+idx).removeClass('additem');$('#catesort'+idx).find('.category-name').text(category_name);$('.category-content').find('.category-item').removeAttr('style');$('.category-content').find('.category-update').remove();}});$('.galleryController .form-group.category .btn-group.open').live({click:function(e){e.stopPropagation();}});$('.category-ch').live({click:function(e){var ch=$(this).prop('checked'),cate_list='';if(ch){$(this).closest('.category-li').addClass('active');if($('.galleryController .gallery-item-category').hasClass('empty'))$('.galleryController .gallery-item-category').text('');}else{$(this).closest('.category-li').removeClass('active');if($('.form-group.category ul li.active').length==0){$('galleryController .gallery-item-category').addClass('empty');cate_list=$.lang[LANG]['editor.gallery.category.selected'];}}$('.form-group.category ul li.active').each(function(i){var cate_name=$(this).find('.category-name').text().trim(),divider=($('.form-group.category ul li.active').length-1==i)?'':', ';cate_list=cate_list+cate_name+divider;});$('.galleryController .gallery-item-category').text(cate_list);}});var addGalleryCategoryInput=function(cateidx,catename){var cateidx=(typeof cateidx=="undefined"||!cateidx)?$('.category-content .category-item').length:cateidx,catename=(typeof catename=="undefined"||!catename)?"":catename,str="\
        <div class='category-update'>\
            <div class='input-group'>\
                <input type='text' class='category-update-name forum-control' placeholder='"+$.lang[LANG]['editor.gallery.category.enter-name']+"' value='"+catename+"'/>\
                <span class='input-group-btn'>\
                    <button class='category-update-save btn btn-active' data-id='"+selectID+"' data-idx='"+cateidx+"'><i class='fa fa-check'></i></button>\
                </span>\
                <div class='category-update-cancel'><i class='fa fa-times'></i></div>\
            </div>\
        </div>\
        ";return str;}
var galleryCategoryCheckList=function(pid,category){var category=(category)?category.replace(/\|/g,"").replace(/\,/g,","):'',categoryli='',categoryempty='dropdown',notselect='',selected='',u_category=(category)?category.split(','):{};$.getJSON('/template/element/type/get/seq/'+pid,function(data){checkError(data);var settings=(typeof data[0].elsettings=="undefined"||data[0].elsettings=="")?{}:$.parseJSON(data[0].elsettings),gallery_settings_category=(typeof settings['category']=="undefined")?"":settings['category'].replace(/\|/g,"").replace(/\,/g,", "),gallery_settings_category_display=(typeof settings['category_display']=="undefined")?"OFF":settings['category_display'],g_category=(typeof gallery_settings_category!="undefined"&&gallery_settings_category)?gallery_settings_category.split(','):{};if(gallery_settings_category_display=="OFF")return false;$.each(u_category,function(u_i,u_v){$.each(g_category,function(g_i,g_v){if(u_v.trim()==g_v.trim()){var divider=(!selected)?'':', ';selected=selected+divider+u_v.trim();}});});notselect=(selected)?'':'empty';selected=(selected)?selected:$.lang[LANG]['editor.gallery.category.selected'];selected_arr=selected.replace(/\, /g,',').split(',');$.each(g_category,function(i,v){if(v){var categortli_active=($.inArray(v.trim(),selected_arr)>-1)?'active':'',input_checked=(categortli_active)?'checked':'';categoryli=categoryli+'\
                    <li class="category-li '+categortli_active+'">\
                        <div class="checkbox-wrap">\
                            <div class="checkbox">\
                                <input class="category-ch" id="category-check-'+i+'" type="checkbox" value="" '+input_checked+'>\
                                <label for="category-check-'+i+'"></label>\
                            </div>\
                        </div>\
                        <div class="category-name" data-name="'+v.trim()+'">\
                        '+v.trim()+'\
                        </div>\
                    </li>\
                ';}});if(Object.keys(g_category).length==0&&!categoryli){categoryempty='false';selected=$.lang[LANG]['editor.gallery.category.empty.str'];}});var str='\
    <div class="form-group category">\
        <!--<label>gallery category</label>-->\
        <div class="btn-group">\
            <button type="button" class="btn dropdown-toggle btn-selected-category" data-toggle="'+categoryempty+'">\
                <span class="gallery-item-category '+notselect+'">'+selected+'</span>\
                <span class="caret"></span>\
            </button>\
            <ul class="dropdown-menu scrollable-menu" role="menu">\
                '+categoryli+'\
            </ul>\
        </div>\
        <div class="btn-wrap">\
            <button type="button" class="btn category-config"  data-pid="'+pid+'"><i class="fa fa-cog"></i></button>\
        </div>\
    </div>\
    ';return str;}
var galleryCategoryConfig=function(pid,category){var str="",gallery_category=[],category_content_list='';if(typeof category=='boolean'||typeof category=='undefined'){$.getJSON('/template/element/type/get/seq/'+pid,function(data){checkError(data);var settings=(typeof data[0].elsettings=="undefined"||data[0].elsettings=="")?{}:$.parseJSON(data[0].elsettings),gallery_settings_category=(typeof settings['category']=="undefined")?"":settings['category'].replace(/\|/g,"").replace(/\,/g,", ");gallery_category=(typeof gallery_settings_category!="undefined"&&gallery_settings_category)?gallery_settings_category.split(','):{};});}else{gallery_category=category.split(',');}$.each(gallery_category,function(i,v){if(v)category_content_list=category_content_list+galleryCategoryItem(v.trim(),i);});var empty=(category_content_list.length==0)?'empty':'';category_content_list=(empty)?"<p>"+$.lang[LANG]['editor.gallery.category.empty.str']+"</p>":category_content_list;str="\
        <div class='category-header'>\
            <p>"+$.lang[LANG]['editor.gallery.category.config.title']+"</p>\
        </div>\
        <div class='category-content "+empty+"'>\
            "+category_content_list+"\
        </div>\
        <div class='btn-wrap'>\
            <span class='btn btn-primary category-add'><img src='//i.addblock.net/icon/fa_plus_icon.png' alt='' />&nbsp;\
                "+$.lang[LANG]['config.gallery.add']+"\
            </span>\
        </div>\
        <div class='category-editlist'></div>\
    \
    ";return str;}
var galleryCategoryItem=function(name,idx){var categoryAdd=(!name)?"additem":"";var str="\
            <div class='category-item "+categoryAdd+"' id='catesort"+idx+"'>\
                <div class='category-info'>\
                    <span class='icons hand'><i class='fa fa-arrows'></i></span>\
                    <span class='category-name'>"+name+"</span>\
                </div>\
                <div class='config-icons'>\
                    <div class='icons hand'>\
                        <i class='fa fa-pencil category-edit' data-idx='"+idx+"'></i>\
                    </div>\
                    <div class='icons hand'>\
                        <img class='fa category-delete hand' src='//i.addblock.net/icon/icon-menu-delete.png' data-idx='"+idx+"'></i>\
                    </div>\
                </div>\
            </div>\
            ";return str;}
var galleryCategoryItemEmptyCheck=function(){if($('.category-content').find('.category-item').length==0){$('.category-content').addClass('empty').html('<p>'+$.lang[LANG]['editor.gallery.category.empty.str']+'</p>');}else{$('.category-content').removeClass('empty').find('p').remove();$('.category-content:not(".empty")').sortable({items:'.category-item',cancel:'.category-update-cancel, button, .category-update-name',update:function(event,ui){}}).disableSelection();}}
var galleryCategoryBlockNav=function(pid,colortype,elsettings){var str="",settings={};if(typeof elsettings!='undefined'){settings=elsettings;}else{$.getJSON('/template/element/type/get/seq/'+pid,function(data){checkError(data);settings=(typeof data[0].elsettings=="undefined"||data[0].elsettings=="")?{}:$.parseJSON(data[0].elsettings);});}var gallery_settings_category=(typeof settings['category']=="undefined")?"":settings['category'].replace(/\|/g,"").replace(/\,/g,", "),gallery_settings_category_color=(typeof colortype!="undefined")?colortype:(typeof settings['category_color_type']=="undefined")?'':settings['category_color_type'],category_nav_list='',g_category=(gallery_settings_category)?gallery_settings_category.split(','):['category1','category2','category3'];if(!gallery_settings_category){var category_str='|category1|,|category2|,|category3|',settings={category:category_str};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:pid},function(data){checkError(data);},'json');}var active_arr=[],cookie_gallery_category=unescape($.cookie('gallery-category-'+pid));$.each(g_category,function(i,v){var active=(v.trim()==cookie_gallery_category)?'active':'';active_arr.push(active);if(v)category_nav_list=category_nav_list+'\
                <li class="'+active+'"><a href="javascript:;" data-idx="'+(i+1)+'">'+v.trim()+'</a></li>\
            ';});var active_empty=($.inArray('active',active_arr)==-1)?'active':'',str='\
        <div class="gallery-category-wrap">\
            <ul class="gallery-category-nav" data-category-color="'+gallery_settings_category_color+'">\
                <li class="'+active_empty+'"><a href="javascript:;" data-idx="0">All</a></li>\
                '+category_nav_list+'\
            </ul>\
        </div>\
    ';return str;}
var loadGalleryCategoryBlock=function(el,selectID,colortype,elsettings){var $el=el,margin_val=$el.find('.row[data-loop="true"]').css('margin-left'),padding_val=$el.find('.grid').first().css('padding-left'),gc=$el.attr('data-category');if(selectID){if(gc=="ON"){if($el.find('.gallery-category-wrap').length==0){if(typeof $el.attr('data-msny')!="undefined"&&$el.attr('data-msny')=="true")$el.prepend(galleryCategoryBlockNav(selectID,colortype,elsettings));else $el.find('[data-loop="true"]').before(galleryCategoryBlockNav(selectID,colortype,elsettings));}else{$el.find('.gallery-category-wrap').replaceWith(galleryCategoryBlockNav(selectID,colortype,elsettings));}if($el.find('.row[data-loop="true"]').find('.emptyGalleryItem').length>0&&$el.find('.gallery-category-nav .active').index()==0)$el.find('.gallery-category-nav').addClass('empty');}else{$el.find('.gallery-category-wrap').remove();}}if($('body').width()<=768&&!$el.find('.container').hasClass('full-width'))padding_val='15px';$el.find('.gallery-category-wrap').css({'margin-left':margin_val,'margin-right':margin_val});$el.find('.gallery-category-nav').css({'padding-left':padding_val,'padding-right':padding_val});var gc_width_control=($el.find('.container').hasClass('full-width'))?true:false;if(typeof $el.attr('data-msny')!="undefined"&&$el.attr('data-msny')=="true"||gc_width_control){var width=(gc_width_control&&$el.find('.container').css('margin')=="0px")?$el.find('.container').outerWidth()-40:$el.find('.container').outerWidth();$el.find('.gallery-category-wrap').css({'width':width,'margin':'0 auto'});}if($el.find('.row[data-loop="true"]').css('overflow')=="hidden")$el.find('.row[data-loop="true"]').css('overflow','visible');}
var resourceFileFolderUpdate=function(prevText,newText){$.ajax({type:'POST',url:'/template/resource/update-ffolder',data:{sid:SID,prevffolder:prevText,newffolder:newText},async:true,success:function(data){checkError(data);}});}
var resourceFileDelete=function(file,seq,callback){$.ajax({type:'POST',url:'/template/resource/delete',data:{s:file,sid:SID,seq:seq},async:true,success:function(data){checkError(data);if(typeof callback=='function'){callback();}}});}
$('.resource-file-delete').live({click:function(e){var file=$(this).closest('ul').attr('data-source'),seq=$(this).closest('ul').attr('data-seq'),size=$(this).closest('ul').attr('data-fsize'),ffolder=$(this).closest('ul').attr('data-ffolder'),page=$(this).closest('ul').attr('data-page'),$parent=$(this).parent(),files=$('.selected-files li').map(function(i,n){return $(this).find("p.selected-file-name").text();}).get();var modal=$(this).showModalFlat('DELETE IMAGE',$.lang[LANG]['config.common.resource.delete'],true,true,function(){$('.selected-files p:contains("'+file+'")').parents('li').remove();$.processON('Deleting the image(s)...');modal.modal('hide');$('.resource-image p[data-seq="'+seq+'"]').remove();$('.resource-useit').removeClass('active');resourceFileDelete(file,seq,function(){if(SFOLDER_ACTIVE!=''){resetFolderInfo(-1,-size,'all','delete');}else{resetFolderInfo(-1,-size,ffolder,'delete');}page=1;resourceGetPage(page,SFOLDER_ACTIVE);updateOutputFolder($('#nestableFolder').data('output',$('#nestableFolder-output')));$.processOFF();});},'cancel');}});$('.resource-file-search').live({click:function(e){$('#resourceImgView .img-wrapper > .img-responsive').attr('src',$(this).closest("ul").children(3).find("a").attr("href"));$('#resourceImgView').modal('show');}});$('.openFormConfig').live({click:function(e){var id=$(this).attr('data-id');if(typeof id=='undefined'||id==''){alert('Invalid variable');return false;}$.post('/template/forms/config',{sid:SID,id:id},function(data){checkError(data);var showForm=showFormElement();showForm.then(function(){showFormConfig(data);})},'json');}});$('#content-wrap').live({click:function(){wp=$(this).prop('checked');el=$(this).data('el');$el=(selectEL=='el-menu')?$('header.navbar'):$('.'+el);(wp)?$el.find('.container').eq(0).removeClass('full-width'):$el.find('.container').eq(0).addClass('full-width');($el.data('type')=='gallery')?saveContentWrap(wp):saveContentElement();var elName=$el.attr('data-name');ctrlElementTplStyleUpdate(elName,'full-width',wp,'content-wrap');var type=getElementType();setLogs(type,"content.wrap."+wp,"wrap-"+wp,type);}});var getElementType=function(){var type="";switch(selectEL){case"el-menu":type="MENU";break;case"el-footer":type="FOOT";break;default:type="ELEM";break;}return type;}
var saveContentWrap=function(wp){var seq=$('.'+selectEL).data('id'),tag;$.getJSON('/template/element/type/get/seq/'+seq,function(data){checkError(data);tag=$(htmlspecialchars_decode(data[0].eltag));});(wp)?tag.children().removeClass('full-width'):tag.children().addClass('full-width');var tpl_return=tag[0].outerHTML;$.post('/template/element/type/update-text/seq/'+seq,{tag:tpl_return,sid:SID},function(data){checkError(data);},'json');showPageCallback(showPage);}
$('#prop-background-delete').live({click:function(){var el=$(this).data('el'),pn=$(this).data('pn'),value="none";$('.prop-background-el').empty();$('.prop-background-option').fadeOut();elUpdate(el,pn,value);var elname=$('.'+el).attr('data-name');ctrlElementTplStyleUpdate(elname,pn,value);var type=getElementType();setLogs(type,"background.image.delete","image-delete",type);}});$('#prop-background-body-delete').live({click:function(){$('.prop-background-body-ctrl').fadeOut().empty();$('.prop-body-background-option').fadeOut();setStyleCss('.dsgn-body','background-image','');setLogs("SITE","background.image.delete","image-delete","SITE");}});var siteTemplateImage=function(file){$('#template-image').append('<img src="'+RPATH+'650/'+file+'" class="img-responsive">');}
var siteTemplateSave=function(){var tmp_category=$('#template-category').val(),tmp_name=$('#template-name').val(),tmp_image=$('#template-image').find('img').attr('src'),tmp_sid=$('#site-template-sid').data('sid');if(!tmp_category||!tmp_name){alert('Invalid variable siteTemplateSave()');return false;}var result=true;$.post('/template/site/type/update',{sid:SID,tmp_name:tmp_name,tmp_category:tmp_category,tmp_image:tmp_image,tmp_sid:tmp_sid},function(data){if(typeof data.error!="undefined"&&data.error){$(this).showModalFlat('INFORMATION',data.error,true,false,'','ok');result=false;return false;}else
$('#template-save').modal('hide');},'json');if(result){(tmp_sid)?alert('Edit site template'):alert('New site template save');}$('#template-save').modal('hide');}
var disableCarousel=function(){$('.carousel').carousel('pause');}
var enableCarousel=function(){$('.carousel').carousel({pause:'none'});}
var showMenuList=function(tpl){tpl=(typeof tpl=="undefined")?"normal":tpl;menuConfigToggle('close');siteConfigToggle('close');$('#setting').fadeOut();clearDsgnbody();setUserStyle({});var toolbar=showMenucontroller(tpl);$('.dsgn-body').append(toolbar);$('.dsgn-body').addClass('tpl-margin').removeClass('element').removeClass('sidebar');$.getJSON('/template/lists/type/menu/feature/'+tpl,function(data){$.each(data.list,function(key,val){var $menutag=$(htmlspecialchars_decode(val.eltag));$menutag.attr('data-name',val.elname);var _name=val.elname;var _css=htmlspecialchars_decode(val.elcss);var $tpl_menu_wrap=$("<div class='tpl_menu_wrap'></div>").attr('data-id',val.seq).addClass('element').addClass(val.feature).attr('data-el','el-menu-template').attr('data-type',val.feature);$('.dsgn-body').append($tpl_menu_wrap);$tpl_menu_wrap.append("<style id='"+val.elname+"'>"+_css+"</style>");var $header_html=$($menutag.outerHTML());$tpl_menu_wrap.append($header_html);});});}
$('.prop-caption-close').live({click:function(e){$(this).parents('.prop-addcaption').hide();}});$('.attach-delete').live({click:function(e){var idx=$(this).attr('data-idx'),item=$('.'+selectEL).find('[data-loop="true"]'),nav=$('.'+selectEL).find('[data-nav="true"]'),target='.'+$('.'+selectEL).attr('data-name')+' '+$(this).attr('data-attach'),css=getStyleText(),btn=$(this);var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.delete.confirm'],true,true,function(){if($('.image-content').children().length<2){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.delete.info'],true,false,'','ok');return false;}$(item).children().eq(idx).remove();$(nav).children().eq(idx).remove();css=style.deleteCssProperty(css,target);setStyleText(css);$.each($(item).children(),function(i,v){var n=$(nav).children()[i];$(n).attr('data-slide-to',i);(i==0)?$(n).addClass('active'):$(n).removeClass('active');(i==0)?$(v).addClass('active').removeClass('left').removeClass('right'):$(v).removeClass('active').removeClass('next').removeClass('left').removeClass('prev').removeClass('right');(i==0)?btn.addClass('active'):btn.removeClass('active');});if($(nav).attr('data-list-type')=='number'){$(nav).find('li').map(function(){$(this).text("0"+($(this).index()+1));});}else if($(nav).attr('data-list-type')=='npage'){$(nav).find('li').map(function(){$(this).text($(nav).find('li').length);});$(nav).attr('data-list-length',$(nav).find('li').length);}var clearHtml=$(nav).html().trim();$(nav).empty();$(nav).html(clearHtml);$(nav).append("\r\n");saveContentElement(selectEL);btn.parents('.image-wrap').remove();$.each($('.image-content').children(),function(i,v){$(v).find('[idx]').attr('idx',i);$(v).find('.attach-delete').attr('data-idx',i);$(v).attr("id","imgsort"+i);});var type=getElementType();setLogs(type,"image.delete","image-delete",type);modal.modal('hide');},'cancel');}});$('.clone-delete').live({click:function(e){var idx=$(this).attr('data-idx'),itemtype=($(this).hasClass('ctext-delete'))?'ctext':'image',itemwrap=$('.'+selectEL+' *[data-clone-loop="true"]'),items=itemwrap.find('.item').first().parent(),total=itemwrap.find('.item').length,target='.'+$('.'+selectEL).attr('data-name')+' '+$(this).attr('data-attach'),css=getStyleText(),btn=$(this),clonemin=(itemwrap.attr('data-clone-min'))?Number(itemwrap.attr('data-clone-min')):1,colset=(itemwrap.attr('data-clone-fixed'))?[[1,1,1],[2,2,2],[3,3,3],[4,4,4],[5,5,5],[6,6,6]]:[[1,1,1],[2,2,1],[3,3,1],[4,2,2],[5,2,1],[6,3,2]],col=(itemwrap.attr('data-clone-col'))?itemwrap.attr('data-clone-col').split(","):[],orgcol=(itemwrap.attr('data-clone-orgcol'))?itemwrap.attr('data-clone-orgcol').split(","):[],colval=['',12,6,4,3,15,2];if($('.'+itemtype+'-content').children().length===clonemin){var str=(clonemin==1)?$.lang[LANG]['editor.delete.info']:$.lang[LANG]['editor.delete.min.front']+clonemin+$.lang[LANG]['editor.delete.min.back'];$(this).showModalFlat('INFORMATION',str,true,false,'','ok');return false;}var delete_confirm=(itemtype=='ctext')?$.lang[LANG]['editor.delete.confirm.data']:$.lang[LANG]['editor.delete.confirm'];var modal=$(this).showModalFlat('INFORMATION',delete_confirm,true,true,function(){if(col.length==0)col=colset[total-2];else $(itemwrap).attr('data-clone-col',(total-1)+','+col[1]+','+col[2]);var colclass=(orgcol.length)?'col-md-'+colval[orgcol[0]]+' col-sm-'+colval[orgcol[1]]+' col-xs-'+colval[orgcol[2]]:'col-md-'+colval[total-1]+' col-sm-'+colval[col[1]]+' col-xs-'+colval[col[2]];if($(target).length>0){css=style.deleteCssProperty(css,target);setStyleText(css);}$(items).children().eq(idx).remove();$(itemwrap).attr('data-child',total-1);$(itemwrap).find('.item').each(function(i){var classstr=$(this).attr('class').split(" "),newclassstr='';$.each(classstr,function(i,v){if(v.indexOf('col-')==-1)newclassstr=newclassstr+v+' ';});newclassstr=newclassstr+colclass;$(this).removeClass().addClass(newclassstr);});saveContentElement(selectEL);btn.parents('.'+itemtype+'-wrap').remove();$.each($('.'+itemtype+'-content').children(),function(i,v){$(v).find('[idx]').attr('idx',i);$(v).find('[data-idx]').attr('data-idx',i);if(itemtype=='image'){$(v).attr("id","imgsort"+i);$(v).find('.prop-image-size li').each(function(){var ffolder=$(this).attr('data-folder');$(this).find('a').attr('onclick','changeImageSize('+i+','+ffolder+')');});}if(itemtype=='ctext')$(v).attr("id","ctxtsort"+i);});var type=getElementType();setLogs(type,itemtype+".content.delete",itemtype+"-delete",type);modal.modal('hide');},'cancel');}});$('#el-property [data-loop-type="matrix"] .ui-sortable').bind('click.outside',function(){console.log('outsite click');});$('.matrix-img-change').live({click:function(e){var idx=$(this).attr('data-idx'),attach_item=$('#el-property [data-loop-type="matrix"] .image-content #imgsort'+idx).find('.attach-thumb'),target=$(attach_item).attr('el');$(attach_item).attr('data-toggle','modal');$($(attach_item).data('target')).modal('show');if($(attach_item).hasClass('prop-method-image-url')){$('.resource-useit').attr('data-property','image-url-change').attr('data-element',target).attr('data-idx',idx).attr('data-replace-count',1).removeAttr('data-ctrl');}else{$('.resource-useit').attr('data-property','image-change').attr('data-element',target).attr('data-idx',idx).attr('data-replace-count',1);}selectCount=1;}});$('.matrix-delete').live({click:function(e){if(typeof $(this).attr('data-idx')=='undefined'||!$(this).attr('data-idx')){$(this).showModalFlat('INFORMATION',$.lang[LANG]['config.matrix.none-selected'],true,false,'','ok');return false;}var matrix_table=$(this).closest('[data-loop-type="matrix"]').find('.ui-sortable'),idx=$(this).attr('data-idx'),itemtype=($(this).hasClass('ctext-delete'))?'ctext':'image',itemwrap=$('.'+selectEL+' *[data-matrix-loop="true"]'),items=itemwrap.find('.item').first().parent(),total=itemwrap.find('.item').length,target='.'+$('.'+selectEL).attr('data-name')+' '+$(this).attr('data-attach'),css=getStyleText(),btn=$(this),itemmin=1;if(matrix_table.children().length<=itemmin){var str=(itemmin==1)?$.lang[LANG]['editor.delete.info']:$.lang[LANG]['editor.delete.min.front']+itemmin+$.lang[LANG]['editor.delete.min.back'];$(this).showModalFlat('INFORMATION',str,true,false,'','ok');return false;}var delete_confirm=(itemtype=='ctext')?$.lang[LANG]['editor.delete.confirm.data']:$.lang[LANG]['editor.delete.confirm'];var modal=$(this).showModalFlat('INFORMATION',delete_confirm,true,true,function(){if($(target).length>0){css=style.deleteCssProperty(css,target);setStyleText(css);}$(items).children().eq(idx).remove();saveContentElement(selectEL);matrix_table.children().eq(idx).remove();btn.removeAttr('data-idx');$.each($('.'+itemtype+'-content').children(),function(i,v){$(v).find('[idx]').attr('idx',i);$(v).find('[data-idx]').attr('data-idx',i);if(itemtype=='image')$(v).attr("id","imgsort"+i);if(itemtype=='ctext')$(v).attr("id","ctxtsort"+i);});var type=getElementType();setLogs(type,itemtype+".content.delete",itemtype+"-delete",type);modal.modal('hide');},'cancel');}});var getStyleText=function(){var css=(selectEL=='el-menu')?CSSJSON.toJSON($('#menu-'+SID).text()):CSSJSON.toJSON($('#'+selectEL+'css').text());return css;}
var setStyleText=function(css){var seq=$('.'+selectEL).data('id');(selectEL=='el-menu')?$('#menu-'+SID).text(CSSJSON.toCSS(css)):$('#'+selectEL+'css').text(CSSJSON.toCSS(css));if(!$.isEmptyObject(css)){$.post('/template/element/type/css/seq/'+seq,{sid:SID,css:CSSJSON.toCSS(css)},function(data){checkError(data);},'json');}}
var initShowcaseActive=function(item){$.each(item,function(idx){if(idx==0)$(this).addClass('active');else $(this).removeClass('active');});}
var selectMenuElement=function(seq){if(!seq){alert('Invalid element seq');return false;}var logo=$('header').find('#site-home img').attr('src'),changed=(logo.indexOf("/resource/")>-1)?true:false;$.getJSON('/template/element/type/get/seq/'+seq+'/tpl/menu-select',function(data){$.modalON();$.each(data,function(key,val){var menu_css=htmlspecialchars_decode(val.elcss),tpl_menu_name=val.elname,tag=htmlspecialchars_decode(val.eltag);setTplmenu(tpl_menu_name);menu_css=menu_css.replace(new RegExp(tpl_menu_name,'gi'),"menu-"+SID);tag=tag.replace(new RegExp(tpl_menu_name,'gi'),"menu-"+SID);var $tag=$(tag);if(changed){$tag.find('#site-home img').attr('src',logo);tag=$tag[0].outerHTML;}user_css=CSSJSON.toJSON(menu_css);var url='/template/update/type/tag';var param={s:tag,css:JSON.stringify(user_css),id:SID,name:tpl_menu_name}
$.post(url,param,function(data){checkError(data);updateOutput($('#nestable').data('output',$('#nestable-output')));setLogs("MENU","menu.change","change","MENU");internalLink=true;location.replace('/config');});});});$.modalOFF();}
var resourceGetPage=function(page,ffolder,keep){if(page==1){$('#resource-files').empty();for(var i=0;i<6;i++){$('#resource-files').append('<li class="f-wrap">');}}$('#resource-files').removeClass('empty');$('#selectAll').prop('checked',false);var selectedAll=true;ffolder=(typeof ffolder=='undefined')?SFOLDER_ACTIVE:ffolder;$.getJSON('/template/resource/files/page/'+page+'/ffolder/'+ffolder,function(data){if(typeof(data.error)=="undefined"){cTotal=data.total;var path=data.path;var selected=$('.selected-files li').map(function(i,n){return $(this).find("p.selected-file-name").text();}).get();resourceNoticeTextTop=$.lang[LANG]['editor.resource.notice.text.top'];resourceNoticeTextBottom=$.lang[LANG]['editor.resource.notice.text.bottom'];page=(data.file.length<2)?page-1:page;page=(page)?page:1;var $fHeight=$('#resource-files .f-wrap');var fi=0,height=[$fHeight.eq(0).height(),$fHeight.eq(1).height(),$fHeight.eq(2).height(),$fHeight.eq(3).height(),$fHeight.eq(4).height(),$fHeight.eq(5).height()];$.each(data.file,function(idx,val){fi=idx%6;var set=(idx<3&&page==1)?idx:height.indexOf(Math.min.apply(null,height));var tag=resourceFileTag(val.filename,val.seq,path,selected,val.ffolder,page,val.origname,parseInt(val.filesize));if($.inArray(val,selected)<0)selectedAll=false;var r=Math.round(val.h*800/val.w);height[set]=height[set]+r;$('#resource-files .f-wrap').eq(set).append(tag);});$('#resource-files').selectable({filter:" .fitem"});var folder_size=(parseInt(data.fsize_total/1024)>0)?parseInt(data.fsize_total/1024):parseInt(data.fsize_total),folder_size_unit=(parseInt(data.fsize_total/1024)>0)?'MB':'KB';$('.fli.active > .dd-flc').attr('attr-count',data.total).text(data.total);$('.fli.active > .dd-fls').attr({'attr-size':parseInt(data.fsize_total),'attr-size-unit':folder_size_unit}).text(folder_size);if(data.total==0){selectedAll=false;$('#resource-files').addClass('empty');var str=""+"<li class='resource-empty-area'>"+" <div class='resource-empty'>"+" <div class='img-wrap'><img src='//i.addblock.net/config/fa_resource_img_icon.png' alt='image storage' /></div>"+" <p>"+resourceNoticeTextTop+"<br>"+""+resourceNoticeTextBottom+"</p>"+"</div>"+"</li>";$('#resource-files').append(str);}else{var load_btn='\
                            <img src="//i.addblock.net/image-upload.gif">&nbsp;&nbsp;\
                            <span class="resource-info"><span>'+$.lang[LANG]["config.file.browse"]+'</span></span>\
                            <input id="fileupload" class="modal-upload-button" type="file" name="files[]" multiple>\
                    ',upgrade_btn='\
                        <a href="/upgrade/site/" style="color: #fff; text-decoration:none;">\
                            <i class="fa fa-level-up" aria-hidden="true" style="margin-right: 5px;"></i>\
                            <span class="resource-info">'+$.lang[LANG]["plan.upgrade"]+'</span>\
                        </a>\
                    ';var str=(data.is_limit)?upgrade_btn:load_btn,css_str=(data.is_limit)?{'background-color':'#4889e7','margin-left':'5px'}:{},max_str=(data.is_limit)?'<span class="error">'+$.lang[LANG]['plan.disk-space.limit.info']+'</span> ':'';$('#el-fileupload .fileinput-button').attr('data-limit',data.is_limit).html(str).css(css_str);$('.upload-max-size').html(max_str);}}else{checkError(data);$('<li class="text-center resource-none"/>').text('No files uploaded').appendTo('#resource-files');}$('.listprogress').remove();});if(selectedAll)$('#selectAll').prop('checked',true);displaySelectedFilesStr();}
var resourcePaging=function(page,total,ffolder){view=RVIEW;$('.resource-paging').empty();page_view=10;start=Math.floor((page-1)/page_view)*page_view;pages=Math.ceil(total/view);end=(Math.floor((page-1)/page_view)+1)*page_view;end=(end>pages)?pages:end;prev=(start>0)?start:1;next=((end+1)>pages)?pages:end+1;ffolder=(ffolder)?'ffolder':'all';var str='\
    <ul class="pagination pagination-sm" data-pages="'+pages+'">\
        <li><a href="javascript:;" onclick="resourceGetPage('+prev+')">&laquo;</a></li>\
    ';for(i=start;i<end;i++){active=((i+1)==page)?"active":"";str=str+'\
        <li class="'+active+'"><a href="javascript:;" onclick="resourceGetPage('+(i+1)+')">'+(i+1)+'</a></li>\
        ';}str=str+'\
        <li><a href="javascript:;" onclick="resourceGetPage('+next+')">&raquo;</a></li>\
    </ul>\
    ';if(total)$('.resource-paging').append(str);}
$('.gallery-loadmore').live({click:function(){var id=$(this).data('id'),page=$(this).data('page'),view=$(this).data('view'),mode=$(this).data('mode'),folder=$(this).data('folder'),org=$('.element[data-id="'+id+'"]').find('[data-loop="true"]'),nodes=org.clone().children(),$this=$(this),$container=$('.element[data-id="'+id+'"] .container'),isMasonry=$(this).hasClass('masonry-layout'),items=0,total=0,gallery_item='',$gc=$('.element[data-id="'+id+'"] .gallery-category-nav li.active'),sfl=($gc.index()>0)?'category':'',stx=(sfl)?$gc.text().trim():'';$.ajax({url:'/template/gallery/list/pid/'+id+'/sid/'+SID+'/spage/'+PAGE+'/page/'+page+'/view/'+view+'/mode/visible',data:{sfl:sfl,stx:stx},dataType:'json',type:'POST',async:false,cache:false,success:function(data){$.cookie('gallery-page-'+id,page,{path:'/',expires:12*60*60*1000});var stx_str=(typeof escape(stx)!='undefined')?escape(stx):'';$.cookie('gallery-category-'+id,stx_str,{path:'/',expires:12*60*60*1000});var loop_count=nodes.length;total=data.total.list_total;items=data.list.length;$.each(data.list,function(i,v){loop_pos=i%loop_count;c=nodes[loop_pos];item_index=((page-1)*loop_count)+i;$(c).addClass('gallery-item').attr('data-index',item_index).attr('data-seq',v.seq);var vgsettings=(typeof v.gsettings!='undefined'&&v.gsettings)?$.parseJSON(v.gsettings):{},img_path=(vgsettings&&typeof vgsettings['storage']!='undefined')?vgsettings['storage']:RESOURCE+"/"+SID+"/",img_original=(vgsettings&&typeof vgsettings['storage']!='undefined')?img_path+'1920/':img_path;$(c).find('img').attr("src",img_path+folder+"/"+v.image);if(typeof vgsettings['glink']!='undefined'&&vgsettings['glink']){var glink=vgsettings['glink'],glink_val=(glink)?makeLinkUrl(glink,ONE,VIEW):'';$(c).find('a').removeAttr('data-gallery');$(c).find('a').attr('href',glink_val);if(MENULIST.indexOf(glink.replace(/ /g,'-'))>-1){$(c).find('a').attr('data-user-link',glink_val);}else if(glink.match(/\@/g)){$(c).find('a').attr('attr-bookmark',glink);}else{$(c).find('a').attr('attr-link',glink);}}else{$(c).find('a').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');if(mode=="gallery"){$(c).find('a').attr("href",img_original+v.image);$(c).find('a').attr('data-gallery','#gframe-'+id);}else{$(c).find('a').removeAttr('data-gallery');$(c).find('a').attr("href","/config/page/"+PAGE+"/view/"+v.seq);}}if(typeof vgsettings['glink_target']!='undefined'&&vgsettings['glink_target']=='_blank')$(c).find('a').attr('target','_blank');else $(c).find('a').removeAttr('target');if(v.title.length==0)v.title="Title";if(v.caption.length==0)v.caption="You can change this text";$(c).find('a').attr("title",v.title).attr('data-title',v.title);var ftitle=$(c).find('h5.figure'),fcaption=$(c).find('p.figure'),fdatetime=$(c).find('.figure.datetime'),fhashtag=$(c).find('.figure.hashtag');if(fdatetime.length<1){$(c).find('figcaption').append("<div class='figure datetime hide'></div>");fdatetime=$(c).find('.figure.datetime');}if(fhashtag.length<1){$(c).find('figcaption').append("<div class='figure hashtag hide'></div>");fhashtag=$(c).find('.figure.hashtag');}$(c).find('figcaption').removeClass('hide');var gallery_caption=v.caption;gallery_caption=gallery_caption.replace(/\n/g,"<br />");ftitle.text(v.title);fcaption.html(gallery_caption);fdatetime.text(v.datetime);fhashtag.text(v.hashtag);fcaption.removeClass('hide');if(isMasonry){gallery_item=gallery_item+$(c)[0].outerHTML;}else{org.append($(c)[0].outerHTML);}});}});if(isMasonry){var $gallery_items=$(gallery_item);$gallery_items.hide();$('.gallery-loadmore[data-id="'+id+'"]').before("<div class='gallery-loading-status'><div class='loading-dots'></div></div>");var process_index=0;$gallery_items.imagesLoaded().progress(function(imgload,image){process_index++;var $item=$(image.img).parents('.grid');$item.show();if(items==process_index){reloadMasonry($container,$gallery_items);}});}var cookie_page=$.cookie('gallery-page-'+id),view=(view>total)?total:view,cookie_view=((cookie_page*view)>total)?total:cookie_page*view;org.parents('.element').find('.display').text(cookie_view);if(total<=cookie_view)$('.gallery-loadmore[data-id="'+id+'"]').fadeOut();if(items)$(this).data('page',page+1);if(org.parents('.element').find('*[data-direffect="true"]').length>0){setTimeout(function(){org.parents('.element').find('.grid').each(function(){$(this).hoverdir();});},400);}}});var reloadMasonry=function(container,items){$('.gallery-loading-status').remove();container.masonry().append(items);container.masonry('appended',items).masonry();}
var setStyleColor=function(rgb){var css=CSSJSON.toJSON($('#dsgn-'+SID).text()),change=style.setStyle(css,rgb);setUserStyle(change);}
var setUserStyle=function(css){USTYLE=css;MSTYLE=css;$('#dsgn-'+SID).text(CSSJSON.toCSS(css));if(!$.isEmptyObject(css)){$.post('/template/config/type/css',{sid:SID,css:JSON.stringify(css)},function(data){checkError(data);},'json');}}
var setMenuStyle=function(css){MCSS=css;$('#menu-'+SID).text(CSSJSON.toCSS(css));if(!$.isEmptyObject(css)){$.post('/template/config/type/menu',{sid:SID,css:JSON.stringify(css)},function(data){checkError(data);},'json');}}
$('.check-transparent').live({click:function(){var check=$(this).prop('checked'),el=$(this).data('el'),color=$(this).parents('span.color-picker').find('span.color').css('background-color');color=(color=='rgba(0, 0, 0, 0)')?'transparent':style.getHex(color).substring(1);if(check){$(this).parents('span.color-picker').find('span.color').addClass('transparent');if(selectEL=='el-menu'&&$('.header-empty').length>0)$('.header-empty').css('background-color','transparent');colorChange('transparent','.'+el);}else{$(this).parents('span.color-picker').find('span.color').removeClass('transparent');color=style.getHex($('.dsgn-body').css('background-color')).substring(1);if(selectEL=='el-menu'&&$('.header-empty').length>0)$('.header-empty').css('background-color','#'+color);colorChange(color,'.'+el);}var type=getElementType();setLogs(type,"background.color."+check,"transparent-"+check,type);}});$('.ctrl-check-transparent').live('click',function(){var check=$(this).prop('checked'),selector=$(this).attr('data-selector'),el=$(this).attr('data-el'),j=CSSJSON.toJSON($('#'+el+'css').text()),seq=$('.'+el).attr('data-id');if(check){$(this).parents('span.color-picker').find('span.color').addClass('transparent');j=style.setCssProperty(j,selector,"background-color","transparent");}else{$(this).parents('span.color-picker').find('span.color').removeClass('transparent');background_color=$(this).parents('span.color-picker').find('span.color').css('background-color');hex=style.getHex(background_color);j=style.setCssProperty(j,selector,"background-color",hex);}$('#'+el+'css').text(CSSJSON.toCSS(j));var css=$('#'+el+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:seq},function(data){checkError(data);},'json');var type=getElementType();setLogs(type,"ctrl.background.color."+check,"transparent-"+check,type);});$('.font-family-body').live({click:function(){fn=style.getCssProperty(USTYLE,'.dsgn-body','font-family').split(",");select_font="'"+$(this).data('font-family')+"'";$(this).addClass('active').siblings().removeClass('active');$('.font-family-body-active').text($(this).data('font-family')).css('font-family',$(this).data('font-family'));fn[0]=select_font;font_family=fn.join(',');setStyleCss('.dsgn-body','font-family',font_family);setLogs("SITE","font.family.change","font-change","SITE");}});$('.font-family-logo').live({click:function(){fn=style.getCssProperty(MCSS,'.menu-'+SID,'font-family').split(",");select_font="'"+$(this).data('font-family')+"'";$(this).addClass('active').siblings().removeClass('active');$('.font-family-logo-active').text($(this).data('font-family')).css('font-family',$(this).data('font-family'));fn[0]=select_font;font_family=fn.join(',');menu_css=style.setCssProperty(MCSS,'.menu-'+SID+' #tpl-logo-text','font-family',font_family);setMenuStyle(menu_css);setLogs('MENU','logo.font.family.change','font-change','MENU');}});$('#body-background-position').live({change:function(){var v=$(this).val();setStyleCss('.dsgn-body','background-position',v);setLogs("SITE","background.property.change","","SITE");}});$('#body-background-repeat').live({change:function(){var v=$(this).val();setStyleCss('.dsgn-body','background-repeat',v);setLogs("SITE","background.property.change","","SITE");}});$('#body-background-size').live({change:function(){var v=$(this).val();setStyleCss('.dsgn-body','background-size',v);setLogs("SITE","background.property.change","","SITE");}});$('#el-background-position').live({change:function(){var v=$(this).val(),elname=$(this).data('elname'),css=getStyleText();setElementStyleCss(css,'.'+elname,'background-position',v);ctrlElementTplStyleUpdate(elname,'background-position',v);var type=getElementType()
setLogs(type,"background.property.change","",type);}});$('#el-background-repeat').live({change:function(){var v=$(this).val(),elname=$(this).data('elname'),css=getStyleText();setElementStyleCss(css,'.'+elname,'background-repeat',v);ctrlElementTplStyleUpdate(elname,'background-repeat',v);var type=getElementType()
setLogs(type,"background.property.change","",type);}});$('#el-background-size').live({change:function(){var v=$(this).val(),elname=$(this).data('elname'),css=getStyleText();setElementStyleCss(css,'.'+elname,'background-size',v);ctrlElementTplStyleUpdate(elname,'background-size',v);var type=getElementType()
setLogs(type,"background.property.change","",type);}});var setStyleCss=function(selector,key,val){var j=CSSJSON.toJSON($('#dsgn-'+SID).text());j=style.setCssProperty(j,selector,key,val);setUserStyle(j);}
$('.map-wrap').live({click:function(){$('.map-wrap .google-map').css("pointer-events","auto");}});var menuContextDisplay=function(display){var menus=$('.context-menu-root');if($(menus[2]).width()){(display=='show')?$(menus[2]).show():$(menus[2]).hide();}$('#el-property').hide();}
$('.logo-edit-save').live({click:function(){var logo=$('.logo-input-text');if(!logo.val()){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.logo.text.input'],true,false,'','ok');logo.focus();return false;}$('#tpl-logo-text').html(logo.val().replace(/\r?\n/g,'<br />'));saveContentElement();setLogs('MENU','logo.text.change','text-edit','MENU');}});$("#menu-show").live({click:function(e){selectPOS=undefined;showElementList('menu','normal');}});$('#footer-show').live('click',function(){hideConfigPanel();selectID='footer';showElementList('footer','footer',selectID);});$('.logotype-mode').live({click:function(){var checked=($(this).attr('data-logotype')=='text')?true:false,logotype_m=$(this).attr('data-logotype');if(checked){$('#site-home img').addClass('hide');$('#tpl-logo-text').removeClass('hide');$('.logo-image-resource').addClass('hide');$('.prop-method-image').addClass('hide');$('.logo-edit-text').removeClass('hide');$('.prop-logos').removeClass('hide');}else{$('#site-home img').removeClass('hide');$('#tpl-logo-text').addClass('hide');$('.logo-image-resource').removeClass('hide');$('.prop-method-image').removeClass('hide');$('.logo-edit-text').addClass('hide');$('.prop-logos').addClass('hide');}var translate="<span data-lang='config.logo.type."+logotype_m+"'>"+$.lang[LANG]['config.logo.type.'+logotype_m]+"</span>  <span class='caret'></span>";$('#logotype-mode').html(translate);setTimeout(function(){saveContentElement();var obj=(checked)?"font-change":"image-change";setLogs('MENU','logo.text.'+checked,obj,'MENU');$('#loading').hide();},500);}});$('#prop-usetext').live({click:function(){var checked=$(this).prop('checked');$('#loading').show();$('.prop-logos').toggleClass('hide');if(checked){$('#site-home img').addClass('hide');$('#tpl-logo-text').removeClass('hide');$('.logo-image-resource').addClass('hide');}else{$('#site-home img').removeClass('hide');$('#tpl-logo-text').addClass('hide');$('.logo-image-resource').removeClass('hide');}setTimeout(function(){saveContentElement();var obj=(checked)?"font-change":"image-change";setLogs('MENU','logo.text.'+checked,obj,'MENU');$('#loading').hide();},500);}});$('.gl-text').live({click:function(){$(this).focus();}});$('.logo-font-wrap').live({click:function(){$('.logo-text-style').toggleClass('hide');}});$('.elname-edit').live({click:function(){$(this).parents('.panel-heading').find('.elname-edit-wrap').removeClass('hide');}});$('.font-family-el').live({change:function(){var elname=(selectEL=='el-menu')?'menu-'+SID:$(this).data('elname'),css=getStyleText();fn=style.getCssProperty(css,'.'+elname,'font-family').split(",");select_font="'"+$(this).val()+"'";fn[0]=select_font;fn.push(add_font);font_family=select_font+","+add_font;setElementStyleCss(css,'.'+elname,'font-family',font_family);}});var setElementStyleCss=function(j,selector,key,val){j=style.setCssProperty(j,selector,key,val);$css=(selectEL=='el-menu')?$('#menu-'+SID).text(CSSJSON.toCSS(j)):$('#'+selectEL+'css').text(CSSJSON.toCSS(j));var seq=(selectEL=='el-menu')?'menu':$('.'+selectEL).data('id');el_style=(selectEL=='el-menu')?JSON.stringify(j):$css.text();if(!$.isEmptyObject(j)){$.post('/template/element/type/css/seq/'+seq,{sid:SID,css:el_style},function(data){checkError(data);},'json');}}
$('.link-check-display').live({click:function(){var checked=$(this).is(':checked'),idx=$(this).attr('data-idx'),item=$('.'+selectEL).find('[data-loop="true"]').children()[idx];(checked)?$(item).find('.conf-link-button').removeClass('hide'):$(item).find('.conf-link-button').addClass('hide');$(this).parents('.gc-title').find('.option-property').toggleClass('hide');saveContentElement(selectEL);}});$('.link-target-property').live({click:function(){var checked=$(this).is(':checked'),idx=$(this).attr('data-idx'),items=$('.'+selectEL).find('[data-loop="true"]').children();(checked)?$(items[idx]).find('.conf-link-button').attr('target','_blank'):$(items[idx]).find('.conf-link-button').attr('target','_self');}});$('.link-to-page').live({click:function(){$(this).parents('.gc-title').find('.link-select').toggleClass('hide');}});$('.page-list li').live({click:function(){var link="/"+$(this).text().replace(" ","-"),idx=$(this).attr('data-idx'),$parent=$(this).parents('.gc-title'),item=$('.'+selectEL).find('[data-loop="true"]').children()[idx];$(item).find('.conf-link-button').attr('href',link).attr('data-user-link',link);$parent.find('.conf-input-link').val(link);$parent.find('.link-select').addClass('hide');}});$('.add-attach').live({click:function(){if($('#el-property .image-content').children().length>7){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.attach.max'],true,false,'','ok');return false;}$('.resource-useit').attr('data-property','add-attach').attr('data-element','').attr('data-replace-count',1);selectCount=1;$('#el-fileupload').modal('show');}});$('.add-clone').live({click:function(){var elclone=$('.element[data-id="'+selectID+'"]').find('[data-clone-loop="true"]'),clonetype=(typeof elclone.attr('data-clone-type')!='undefined'&&elclone.attr('data-clone-type'))?elclone.attr('data-clone-type'):'image',clonemax=(typeof elclone.attr('data-clone-max')!='undefined'&&elclone.attr('data-clone-max'))?Number(elclone.attr('data-clone-max')):6;if($('#el-property .'+clonetype+'-content').children().length>=clonemax){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.attach.max.front']+clonemax+$.lang[LANG]['editor.attach.max.back'],true,false,'','ok');return false;}if(clonetype=='ctext'){addCloneItem(null,null,'ctext',selectEL);}else{$('.resource-useit').attr('data-property','add-clone').attr('data-element','').attr('data-replace-count',1);selectCount=1;$('#el-fileupload').modal('show');}}});$('.add-matrix').live({click:function(){var column=$('.'+selectEL).find('[data-matrix-loop="true"]').attr('data-matrix-column'),itemtype=$(this).closest('[data-loop-type="matrix"]').attr('class'),itemmax=36;if($(this).closest('[data-loop-type="matrix"]').find('.'+itemtype+'-content').children().length>=itemmax){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.attach.max.front']+itemmax+$.lang[LANG]['editor.attach.max.back'],true,false,'','ok');return false;}$(this).closest('[data-loop-type="matrix"]').find('.ui-sortable').find('.active').click();if(itemtype=='ctext'){addCloneItem(null,null,'matrix',selectEL);}else{$('.resource-useit').attr('data-property','add-matrix').attr('data-element','').attr('data-replace-count',1);selectCount=1;$('#el-fileupload').modal('show');}}});$('[data-loop-type="matrix"] .ui-sortable > .image-wrap,[data-loop-type="matrix"] .ui-sortable > .ctext-wrap').live({mouseenter:function(){var idx=$(this).find('.attach-thumb').attr('idx'),matrix_item=$('.'+selectEL).find('[data-matrix-loop="true"]').find('.item').eq(idx);matrix_item.stop().css({'outline':'0px dashed #4789e7'}).animate({'outlineWidth':'1px','outlineColor':'#4789e7'},300);},mouseleave:function(){var idx=$(this).find('.attach-thumb').attr('idx'),matrix_item=$('.'+selectEL).find('[data-matrix-loop="true"]').find('.item').eq(idx);matrix_item.stop().removeAttr('style');},click:function(){var idx=$(this).find('.attach-thumb').attr('idx'),matrix_type=$(this).closest('[data-loop-type]').attr('class'),matrix_item=$('.'+selectEL).find('[data-matrix-loop="true"]').find('.item').eq(idx);matrix_type=(matrix_type=='images')?'image':'ctext';$(this).siblings('.'+matrix_type+'-wrap').removeClass('active');$(this).toggleClass('active');if($(this).hasClass('active')){var offset=($('.dsgn-body').hasClass('sidebar'))?-$('.editor-navbar').outerHeight(true):-$('.header.el-menu').outerHeight(true);$('.dsgn-body').scrollTo(matrix_item,800,{offset:offset-($(window).height()/5),easing:'easeInOutQuart'});var config_panel=$(this).closest('[data-loop-type="matrix"]');config_panel.find('.prop-icons').attr('data-idx',idx);config_panel.find('.__matrix.hand').attr('data-idx',idx);matrix_item.siblings('.item').removeClass('__matrix_focus');matrix_item.addClass('__matrix_focus');setTimeout(function(){matrix_item.removeClass('__matrix_focus');},2500);}else{$(this).closest('[data-loop-type="matrix"]').find('.prop-icons').removeAttr('data-idx');$(this).closest('[data-loop-type="matrix"]').find('.__matrix.hand').removeAttr('data-idx');matrix_item.removeClass('__matrix_focus');}}});var addCloneItem=function(files,path,looptype,s_el){if(typeof selectEL=='undefined'&&s_el)selectEL=s_el;var looptype=(looptype=='matrix')?looptype:'clone',itemtype=(files)?'image':'ctext',itemwrap=$('.'+selectEL).find('[data-'+looptype+'-loop="true"]'),item=$(itemwrap).find('.item').first()[0],css=CSSJSON.toJSON($('#'+selectEL+'css').text()),seq=$('.'+selectEL).data('id'),fwidth=($('.'+selectEL).attr('data-width')!=0)?$('.'+selectEL).attr('data-width'):"",file_path=(files)?path+"/"+((fwidth)?fwidth+"/":"")+files:"",idx=$(itemwrap).find('.item').length,colval=['',12,6,4,3,15,2],colset=[[1,1,1],[1,1,1],[2,2,1],[3,3,1],[4,2,2],[5,2,1],[6,3,2]],col=[],orgcol=[],colclass='';if(looptype=='matrix'){var column=Number($(itemwrap).attr('data-matrix-column'));col=colset[column];colclass='col-xs-'+colval[col[2]]+' col-sm-'+colval[col[1]]+' col-md-'+colval[col[0]];}else{if(itemwrap.attr('data-clone-fixed'))colset=[[1,1,1],[2,2,2],[3,3,3],[4,4,4],[5,5,5],[6,6,6]];if(itemwrap.attr('data-clone-col'))col=itemwrap.attr('data-clone-col').split(",");if(itemwrap.attr('data-clone-orgcol'))orgcol=itemwrap.attr('data-clone-orgcol').split(",");if(col.length==0)col=colset[idx];else $(itemwrap).attr('data-clone-col',(idx+1)+','+col[1]+','+col[2]);colclass=(orgcol.length)?'col-xs-'+colval[orgcol[2]]+' col-sm-'+colval[orgcol[1]]+' col-md-'+colval[orgcol[0]]:'col-xs-'+colval[col[2]]+' col-sm-'+colval[col[1]]+' col-md-'+colval[idx+1];}var add=$(item).clone(),org_img_data=[],img_onoff=$(add).find('img').attr('data-img-original');img_onoff=(typeof img_onoff=='undefined'||img_onoff==""||img_onoff=="OFF")?"OFF":"ON";$('#el-property .'+itemtype+'-content').find('.'+itemtype+'-wrap').each(function(i){$(this).find('[idx]').attr('idx',i+1);$(this).find('[data-idx]').attr('data-idx',i+1);if(itemtype=='ctext'){$(this).attr('id','ctxtsort'+(i+1));}else{org_img_data.push($(this).find('.attach-thumb img').attr('src'));$(this).attr('id','imgsort'+(i+1));$(this).find('.prop-image-size li').each(function(){var ffolder=$(this).attr('data-folder');$(this).find('a').attr('onclick','changeImageSize('+(i+1)+','+ffolder+')');});}});$(add).find('img').attr('data-img-original',img_onoff);$(add).prependTo($(itemwrap).find('.item').first().parent());$(itemwrap).attr('data-child',idx+1);$(itemwrap).find('.item').each(function(i){var classstr=$(this).attr('class').split(" "),newclassstr='';$.each(classstr,function(i,v){if(v.indexOf('col-')==-1)newclassstr=newclassstr+v+' ';});newclassstr=newclassstr+colclass;$(this).removeClass().addClass(newclassstr);if(i==0){if(itemtype=='ctext'){$('#el-property .ctext-content').prepend($('.ctext-content').find('.ctext-wrap').first().clone());var prop_ctext=$('#el-property .ctext-content').find('.ctext-wrap').eq(i);prop_ctext.attr('id','ctxtsort'+i);prop_ctext.find('[idx]').attr('idx',i);prop_ctext.find('[data-idx]').attr('data-idx',i);$('.ctext-content').prepend(ctext_item);saveContentElement(selectEL);}else{var orgTarget=$(item).find('[data-attach="true"]').attr('data-target');if(typeof orgTarget=="undefined"||orgTarget==null){orgTarget=$(item).attr('data-target');}if(myStorageActive()){if(typeof orgTarget=="undefined"||orgTarget==null){$('.image-content').prepend(image_attach(selectEL,i,file_path,'prop-method-image',$(this)));$(this).find('[data-attach="true"]').attr('src',file_path).removeAttr('data-storage').removeAttr('data-photo-id').removeAttr('data-img-val');}else{orgTarget=orgTarget.trim().replace(".","");target="userADD"+microtime(true);selector="."+$('.'+selectEL).attr('data-name')+" ."+target;css_url="url('"+file_path+"')";setElementStyleCss(css,selector,'background-image',css_url);if($(this).hasClass(orgTarget))$(add).removeClass(orgTarget).addClass(target).attr('data-target','.'+target);else $(this).find('[data-attach="true"]').removeClass(orgTarget).addClass(target).attr('data-target','.'+target);$('.image-content').prepend(image_attach('.'+target,i,file_path,'prop-method-image-url',$(item)));}saveContentElement(selectEL);}else{$.processON('Image upload to storage...');fwidth=(fwidth)?fwidth:1920;var frUpload=frStorageUpload(files,fwidth),$item=$(this);frUpload.then(function(data){if(typeof orgTarget=="undefined"||orgTarget==null){$('.image-content').prepend(image_attach(selectEL,i,data.thumb,'prop-method-image',$item));var free_name=(data.f).split('.');$item.find('[data-attach="true"]').attr('src',data.image).attr('data-storage','free').attr('data-photo-id',data.id).attr('data-img-val',free_name[0]);}else{orgTarget=orgTarget.trim().replace(".","");target="userADD"+microtime(true);selector="."+$('.'+selectEL).attr('data-name')+" ."+target;css_url="url('"+data.image+"')";setElementStyleCss(css,selector,'background-image',css_url);if($item.hasClass(orgTarget))$(add).removeClass(orgTarget).addClass(target).attr('data-target','.'+target);else $item.find('[data-attach="true"]').removeClass(orgTarget).addClass(target).attr('data-target','.'+target);$('.image-content').prepend(image_attach('.'+target,i,data.thumb,'prop-method-image-url',$(item)));}}).then(function(){saveContentElement(selectEL);});}}if($(this).find('a[data-user-link]').length>0||$(this).find('a[attr-link]').length>0||$(this).find('a[attr-bookmark]').length>0){var this_html=$(this).html(),atag_pattern1=/<a[^>]+\>/i,atag_pattern2=/<\/a>/i;this_html=this_html.replace(atag_pattern1,'').replace(atag_pattern2,'');$(this).html(this_html);}}});if(looptype=='matrix'){if(!$('#el-property').find('[data-loop-type="matrix"] .ui-sortable').children('.'+itemtype+'-wrap').first().hasClass('active')){setTimeout(function(){$('#el-property').find('[data-loop-type="matrix"] .ui-sortable').children('.'+itemtype+'-wrap').first().click();},700);}}var type=getElementType();setLogs(type,itemtype+".content.add","add",type);}
var addAttachItem=function(files,path){var eltype=$('.'+selectEL).data('type'),item=$('.'+selectEL).find('[data-loop="true"]').children()[0],css=CSSJSON.toJSON($('#'+selectEL+'css').text()),seq=$('.'+selectEL).data('id'),file_path=path+"/"+files,addedShowcaseNav=null;idx=$('.'+selectEL).find('[data-loop="true"]').children().length;var orgTarget=$(item).find('[data-attach="true"]').attr('data-target');if(typeof orgTarget=='undefined'||orgTarget==null){orgTarget=$(item).attr('data-target');}if(typeof orgTarget=="undefined"||orgTarget==null){if(eltype=='showcase'){var target='user_ADD'+microtime(true),add=$(item).clone();if(myStorageActive()){$('.image-content').append(image_attach(selectEL,idx,file_path,'prop-method-image',$(item)));$(add).find('[data-attach="true"]').attr('src',file_path).addClass(target);$(add).removeClass('active').appendTo($('.'+selectEL).find('[data-loop="true"]'));addedShowcaseNav=addShowcaseNav(selectEL,idx,file_path,'prop-method-image',$(item));}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(files,1920);frUpload.then(function(data){$('.image-content').append(image_attach(selectEL,idx,data.image,'prop-method-image',$(item)));$(add).find('[data-attach="true"]').attr('src',data.image).addClass(target);$(add).removeClass('active').appendTo($('.'+selectEL).find('[data-loop="true"]'));}).then(function(){addedShowcaseNav=addShowcaseNav(selectEL,idx,file_path,'prop-method-image',$(item));addedShowcaseNav.then(function(){var selectcarousel=($('.'+selectEL).hasClass('carousel'))?$('.'+selectEL):$('.'+selectEL).find('.carousel');$(selectcarousel).carousel('pause').removeData();$(selectcarousel).carousel();saveContentElement(selectEL);});var type=getElementType();setLogs(type,"image.add","add",type);});}}}else{orgTarget=orgTarget.trim().replace('.','');var target='userADD'+microtime(true),selector='.'+$('.'+selectEL).attr('data-name')+' .'+target,css_url='url("'+file_path+'")';if(myStorageActive()){setElementStyleCss(css,selector,'background-image',css_url);var add=$(item).clone();if($(add).hasClass(orgTarget))$(add).removeClass(orgTarget).addClass(target).attr('data-target','.'+target);else $(add).find('[data-attach="true"]').removeClass(orgTarget).addClass(target).attr('data-target','.'+target);$(add).removeClass('active').appendTo($('.'+selectEL).find('[data-loop="true"]'));$('.image-content').append(image_attach('.'+target,idx,file_path,'prop-method-image-url',$(item)));addedShowcaseNav=addShowcaseNav(selectEL,idx,file_path,'prop-method-image-url',$(add));}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(files,1920);frUpload.then(function(data){setElementStyleCss(css,selector,'background-image','url("'+data.image+'")');var add=$(item).clone();if($(add).hasClass(orgTarget))$(add).removeClass(orgTarget).addClass(target).attr('data-target','.'+target);else $(add).find('[data-attach="true"]').removeClass(orgTarget).addClass(target).attr('data-target','.'+target);$(add).removeClass('active').appendTo($('.'+selectEL).find('[data-loop="true"]'));$('.image-content').append(image_attach('.'+target,idx,data.thumb,'prop-method-image-url',$(item)));}).then(function(){addedShowcaseNav=addShowcaseNav(selectEL,idx,file_path,'prop-method-image-url',$(add));addedShowcaseNav.then(function(){var selectcarousel=($('.'+selectEL).hasClass('carousel'))?$('.'+selectEL):$('.'+selectEL).find('.carousel');$(selectcarousel).carousel('pause').removeData();$(selectcarousel).carousel();saveContentElement(selectEL);});var type=getElementType();setLogs(type,"image.add","add",type);});}}if(addedShowcaseNav!==null){addedShowcaseNav.then(function(){var selectcarousel=($('.'+selectEL).hasClass('carousel'))?$('.'+selectEL):$('.'+selectEL).find('.carousel');$(selectcarousel).carousel('pause').removeData();$(selectcarousel).carousel();saveContentElement(selectEL);});var type=getElementType();setLogs(type,"image.add","add",type);}}
var addShowcaseNav=function(selectEL,idx,file_path,pn){var deferred=$.Deferred();var nav=$('.'+selectEL).find('[data-nav="true"]').children();var datalisttype=$('.'+selectEL).find('[data-nav="true"]').attr('data-list-type');if(datalisttype=='number'||datalisttype=='npage'){$(nav[0]).clone().removeClass('active').attr('data-slide-to',idx).appendTo($('.'+selectEL).find('[data-nav="true"]'));$('.'+selectEL).find('.carousel-indicators li').map(function(){var text=(datalisttype=='npage')?($(this).index()+1):"0"+($(this).index()+1);$(this).text(text);if(datalisttype=='npage')$('.'+selectEL).find('.carousel-indicators').attr('data-list-length',$('.'+selectEL).find('.carousel-indicators li').length);});}else{$(nav[0]).clone().removeClass('active').attr('data-slide-to',idx).appendTo($('.'+selectEL).find('[data-nav="true"]'));}$('.'+selectEL).find('[data-nav="true"]').append("\r\n");deferred.resolve();return deferred.promise();}
var addController=function(visible){var display=(visible=='show')?true:false;(display)?$('.add-contents').fadeIn():$('.add-contents').fadeOut();(display)?$('.add-icon').addClass('slideUp'):$('.add-icon').removeClass('slideUp');$('.add-contents .sub-element').addClass('hide');if(display){$('.add-contents').fadeIn();$('.add-icon').addClass('slideUp');}else{$('.add-contents').fadeOut(function(){$('.add-icon.has-child').removeClass('active').removeClass('hide');$('.add-icon.sub-element').addClass('hide');$('.add-icon.has-child').find('.fa').removeClass('fa-caret-left').addClass('fa-caret-right');});$('.add-icon').removeClass('slideUp');}}
$('.data-page-back').live({click:function(){var pPage=PARENT.page,inMenu=($.inArray(pPage,MENULIST)==-1)?false:true;if(!inMenu){$(this).showModalFlat('INFORMATION','ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤',true,false,'','ok');return false;}else{var c_g_p=(typeof $.cookie('gallery-page-'+PARENT.pid)!='undefined')?$.cookie('gallery-page-'+PARENT.pid):1;$.cookie('gallery','.'+PARENT.element,{path:'/',expires:12*60*60*1000});$.cookie('loadmore-'+PARENT.pid,c_g_p,{path:'/',expires:12*60*60*1000});(ONE)?location.replace('/config/page/index#')+PARENT.page:location.replace('/config/page/'+PARENT.page);}}});$('.site-body-wrap').live('click',function(){if($(this).hasClass('tiny')){$('.dsgn-body').addClass('tiny');}else{$('.dsgn-body').removeClass('tiny');}var wrap=($(this).hasClass('tiny'))?"tiny":"normal";$.post('/template/config/type/body/wrap/'+wrap,{sid:SID});showPageCallback(showPage);});$('.prop-menu-select').live({change:function(){var link=$(this).val();if(!selectID){alert('Invalid selectID');return;}$.post('/template/update/type/el-linkto',{id:SID,s:selectID,link:link,page:PAGE});showPage(MCSS,MSTYLE,MTAG,true);activeEL(selectEL);}});$('#site-onepage').live({click:function(e){var updateOnepageFunc=function(check,sid){if(check&&$('#nestable .menu-lock.active').length>0){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['config.meun-lock.lock-cantuse-onepage'],true,true,function(data){$.processON('Loading...');$('#nestable').find('.dd-list > li > span > .menu-lock').attr('attr-lock','').removeClass('active');updateOutput($('#nestable').data('output',$('#nestable-output')));setLogs("MENU","menu.lock.broken","lock-broken",'ì „ì²´');$.ajax({type:'POST',url:'/template/update/type/onepage',data:{id:sid,s:check},dataType:'json',async:true,success:function(data){internalLink=true;setLogs("SITE","onepage."+check,"toggle-"+check,"SITE");$.processOFF();location.replace('/config');}});},'cancel');}else{$.processON('Loading...');$.ajax({type:'POST',url:'/template/update/type/onepage',data:{id:sid,s:check},dataType:'json',async:true,success:function(data){internalLink=true;setLogs("SITE","onepage."+check,"toggle-"+check,"SITE");$.processOFF();location.replace('/config');}});}}
var check=$(this).prop('checked');if(check){e.preventDefault();$(this).showModalFlat('INFORMATION',$.lang[LANG]['config.onpage.refer'],true,true,function(){updateOnepageFunc(check,SID);},'cancel');}else{updateOnepageFunc(check,SID);}}});$('#loginout-onoff').live({click:function(){var check=$(this).prop('checked');$.post('/template/update/type/loginout',{id:SID,s:check},function(data){setLogs("MENU","loginout."+check,"toggle-"+check,"MENU");setTimeout(function(){location.replace('/config');},'500');});}});$(".nav li a[href*=#]").live({click:function(){var link=$(this).attr('href').replace("#","");if(MENULINK.indexOf(link)>-1){if($('.dsgn-body').width()<769){$('.el-menu .navbar-toggle').click();setTimeout(function(){moveLinkPage(link);},250);}else moveLinkPage(link);}}});$('*[data-edit="true"] a').live('click',function(e){e.preventDefault();});$("a[href*=#][attr-link]").live({click:function(){if($(this).attr('target')!='_blank'){var link=$(this).attr('href').replace("#","");if(MENULINK.indexOf(link)>-1){if($('.dsgn-body').width()<769){$('.el-menu .navbar-toggle').click();setTimeout(function(){moveLinkPage(link);},250);}else moveLinkPage(link);}else if($('.'+link).length){moveLinkPage(link,1200,true);}}}});$('a[data-user-link]').live('click',function(e){var userLink=$(this).attr('href');if(typeof userLink=="undefined"||$(this).attr('data-user-link')==''){return;}e.preventDefault();if(ONE){if(userLink.charAt(0)=="/"){var linkRegExp=/\/view\//gi;var linkMatch=userLink.match(linkRegExp);if(linkMatch&&linkMatch[0]){var url="/config"+userLink;if($(this).attr('target')=='_blank'){var openNewWindow=window.open('about:blank');openNewWindow.location.href=url;}else{location.href=url;}return false;}userLink=userLink.charAt(0).replace("/","")+userLink.slice(1);if(VIEW||$(this).attr('target')=='_blank'){var url="/config#"+userLink;if(VIEW&&$(this).attr('target')!='_blank'){location.href=url;}else{var openNewWindow=window.open('about:blank');openNewWindow.location.href=url;}}else{moveLinkPage(userLink);}}else{alert('Invalid URL');return false;}}else{var url="/config/page"+userLink;if($(this).attr('target')=='_blank'){var openNewWindow=window.open('about:blank');openNewWindow.location.href=url;}else{location.href=url;}}});$("a[attr-bookmark]").live({click:function(e){e.preventDefault();var link=$(this).attr('href').replace(/^\@/g,''),target=(typeof $(this).attr('target')!='undefined')?$(this).attr('target'):'';if($('.element[data-bookmark="'+link+'"]').length>0&&target!='_blank'){moveLinkPage(PAGE+'\@'+link,1200,true);}else{if(typeof SETTINGS.blockBookmarkList=='undefined'||!SETTINGS.blockBookmarkList||typeof SETTINGS.blockBookmarkList['bookmark'+link]=='undefined'){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.link.bookmark.invalid'],true,false,'','ok');return false;}$.post('/template/bookmarkBlock',{sid:SID,seq:link},function(data){checkError(data);var d=data[0],bb_o_page=(d.page.match(/^index/g)!==null)?d.orgpage:d.page,bb_page=(bb_o_page.match(/\,/g)!==null)?bb_o_page.substring(0,d.page.indexOf('\,')):bb_o_page;var is_here=($('.element[data-bookmark="'+link+'"]').length>0)?true:false,is_page=(PAGE.toLowerCase()==d.page.toLowerCase())?true:false,is_visible_menu=($.inArray(bb_page,MENULINK)>-1)?true:false,is_link=($('#nestable').find('.dd-item[data-id="'+bb_page+'"] > span > .menu-link').hasClass('active')&&is_visible_menu&&bb_page!='INTRO')?true:false,is_visible=($('#nestable').find('.dd-item[data-id="'+bb_page+'"] > span > .menu-visible').attr('attr-val')=='off'&&is_visible_menu&&bb_page!='INTRO')?true:false;if((!is_visible_menu&&bb_page!='index')||(typeof d.glivisible!='undefined'&&d.glivisible)||(((is_here&&target=='_blank')||!is_page)&&(is_link||is_visible))||(!is_here&&is_page)){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.link.bookmark.invalid'],true,false,'','ok');return false;}else{moveBookmark(d.page,'\@'+link,1200,target);}},'json');}}});$('.gallery-category-nav li a').live({click:function(){if($(this).closest('.gallery-category-nav').hasClass('empty')){$(this).blur();var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.gallery.add.info.portfolio.img'],true,false,'','ok');return;}if($(this).closest('li').hasClass('active'))return;var d=new Date(),now=d.getTime(),idx=$(this).attr('data-idx'),sfl='category',stx=(idx!='0')?$(this).text().trim():'';$('.element[data-id="'+selectID+'"] .gallery-category-nav li').removeClass('active');$('.element[data-id="'+selectID+'"] .gallery-category-nav li').eq(idx).addClass('active');$('#el-empty').empty();$.getJSON('/template/element/type/get/seq/'+selectID,function(data){checkError(data);var val=data[0],tag=htmlspecialchars_decode(val.eltag);$('#el-empty').append($(tag));$('#el-empty').find('[data-loop="true"]').html('');var nodes=$(tag).find('[data-loop="true"]').children(),p=$('#el-empty').children(),i=[],view=$(tag).find('[data-loop="true"]').data('view'),total=0,display=0;if(typeof view=="undefined")view=10;var cookie_page=1,cookie_view=view,cookie_gallery_category=(typeof escape(stx)!='undefined')?escape(stx):'',is_gc_cookie=(typeof $.cookie('gallery-category-'+val.seq)!='undefined'&&$.cookie('gallery-category-'+val.seq).length>0)?true:false;$.cookie('gallery','.'+$('.element[data-id="'+val.seq+'"]').attr('data-name'),{path:'/',expires:12*60*60*1000});$.cookie('loadmore-'+val.seq,cookie_page,{path:'/',expires:12*60*60*1000});$.cookie('gallery-page-'+val.seq,cookie_page,{path:'/',expires:12*60*60*1000});$.cookie('gallery-category-'+val.seq,cookie_gallery_category,{path:'/',expires:12*60*60*1000});$.ajax({url:'/template/gallery/list/pid/'+val.seq+'/sid/'+SID+'/spage/'+PAGE+'/mode/design/view/'+cookie_view,data:{sfl:sfl,stx:stx},dataType:'json',type:'POST',async:false,cache:false,success:function(data){$.each(data.list,function(idx,v){i.push(v);});total=data.total.list_total;display=data.list.length;if(i.length>0||(i.length==0&&is_gc_cookie)){var loop_count=nodes.length,item_index=0;var elem=[];$.each(i,function(index,v){loop_pos=index%loop_count;c=nodes[loop_pos];v.title=(v.title.length>0)?v.title:'Title';v.caption=(v.caption.length>0)?v.caption:'You can change this text';$(c).addClass('gallery-item').attr('data-index',index).attr('data-seq',v.seq);var vgsettings=(typeof v.gsettings!='undefined'&&v.gsettings)?$.parseJSON(v.gsettings):{},img_path=(vgsettings&&typeof vgsettings['storage']!='undefined')?vgsettings['storage']:RESOURCE+"/"+SID+"/",img_original=(vgsettings&&typeof vgsettings['storage']!='undefined')?img_path+'1920/':img_path;$(c).find('img').attr("src",img_path+val.folder+"/"+v.image);if(typeof vgsettings['glink']!='undefined'&&vgsettings['glink']){var glink=vgsettings['glink'],glink_val=(glink)?makeLinkUrl(glink,ONE,VIEW):'';$(c).find('a').removeAttr('data-gallery');$(c).find('a').attr('href',glink_val);if(MENULIST.indexOf(glink.replace(/ /g,'-'))>-1){$(c).find('a').attr('data-user-link',glink_val);}else if(glink.match(/^\@/g)){$(c).find('a').attr('attr-bookmark',glink);}else{$(c).find('a').attr('attr-link',glink);}}else{$(c).find('a').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');if(val.mode=="gallery"){$(c).find('a').attr("href",img_original+v.image);$(c).find('a').attr('data-gallery','#gframe-'+val.seq);}else{$(c).find('a').removeAttr('data-gallery');$(c).find('a').attr("href","/config/page/"+PAGE+"/view/"+v.seq);}}if(typeof vgsettings['glink_target']!='undefined'&&vgsettings['glink_target']=='_blank')$(c).find('a').attr('target','_blank');else $(c).find('a').removeAttr('target');$(c).find('a').attr("data-title",v.title).attr('title',v.title);var ftitle=$(c).find('h5.figure'),fcaption=$(c).find('p.figure'),fdatetime=$(c).find('.figure.datetime'),fhashtag=$(c).find('.figure.hashtag');if(fdatetime.length<1){$(c).find('figcaption').append("<div class='figure datetime hide'></div>");fdatetime=$(c).find('.figure.datetime');}if(fhashtag.length<1){$(c).find('figcaption').append("<div class='figure hashtag hide'></div>");fhashtag=$(c).find('.figure.hashtag');}$(c).find('figcaption').removeClass('hide');if(v.title||v.caption){ftitle.text(v.title);var gallery_caption=v.caption;gallery_caption=gallery_caption.replace(/\n/g,"<br />");fcaption.html(gallery_caption);fcaption.removeClass('hide');fdatetime.text(v.datetime);fhashtag.text(v.hashtag);}$(p).find('[data-loop="true"]').append($(c)[0].outerHTML);});}else{nodes.find('a').addClass('emptyGalleryItem').attr('href',"/config/page/"+PAGE+"/view/template").removeAttr('data-gallery').find('img').attr('data-index',0);$(p).find('[data-loop="true"]').append(nodes);}tag=$(p)[0].outerHTML;if(val.mode=="gallery"&&total)tag=appendGalleryFrame($(tag),val.seq,val.elsettings);$('#el-empty').empty();}});var $tag=$(tag);$.each($tag.find('[data-edit="true"]'),function(i,v){var source=$(this).html();source=source.replace(/&lt;&nbsp;/g,"&lt;").replace(/&nbsp;&gt;/g,"&gt;");$(this).html(source);});if(val.feature=='masonry'){var $container=$('.element[data-id="'+selectID+'"] .container'),$gallery_items=$tag.find('[data-loop="true"]');$container.html('');$('.element[data-id="'+selectID+'"] [data-loop="true"]').before("<div class='gallery-loading-status'><div class='loading-dots'></div></div>");var process_index=0,last_view=(view>total)?total:view;$gallery_items.imagesLoaded().progress(function(imgload,image){process_index++;if(total>0&&last_view==process_index){reloadMasonry($container,$gallery_items);}});}else{$('.element[data-id="'+val.seq+'"] [data-loop="true"]').replaceWith($tag.find('[data-loop="true"]'));}if(total==0){if(val.feature=='masonry'){$('.element[data-id="'+val.seq+'"]').find('.container').removeAttr('style');}else{$('.element[data-id="'+val.seq+'"]').find('[data-loop="true"]').addClass('empty').empty();}$('.element[data-id="'+val.seq+'"]').find('.gallery-loadmore').remove();}else if(total==view||view>display){$('.element[data-id="'+val.seq+'"]').find('.gallery-loadmore').remove();}else{var btn_class=(val.feature=='masonry')?"gallery-loadmore masonry-layout":"gallery-loadmore",btn_tag='<div class="'+btn_class+'" data-total = "'+total+'" data-id="'+val.seq+'" data-page="2" data-view="'+view+'" data-folder="'+val.folder+'" data-mode="'+val.mode+'">LOAD MORE &nbsp;(<span class="display">'+cookie_view+'</span> / '+total+')</div>';if($('.element[data-id="'+val.seq+'"] .gallery-loadmore').length>0)$('.element[data-id="'+val.seq+'"] .gallery-loadmore').replaceWith(btn_tag);else $('.element[data-id="'+val.seq+'"]').append(btn_tag);}if($('.element[data-id="'+val.seq+'"]').find('*[data-direffect="true"]').length>0){setTimeout(function(){$('.element[data-id="'+val.seq+'"]').find('.grid').each(function(){$(this).hoverdir();});},400);}});}});var fixedMenu=function(){header_fixed=(header_offset)?header_offset:$('.header.el-menu').height();var user_menu=$('.el-menu');if($('.dsgn-body').scrollTop()>header_fixed+15&&user_menu.hasClass('fixed')==false&&!$('.dsgn-body').hasClass('sidebar')){user_menu.fadeOut('fast',function(){$(this).addClass('fixed').fadeIn('fast');($('.editor-navbar').css('display')=='none')?$('.fixed').addClass('fixed-position'):$('.fixed').removeClass('fixed-position');if(!HEADER){header_offset=header_fixed;if($('.header').next().hasClass('addEL-wrap')){$('.header').next().css('margin-top',header_fixed+'px');}else{$('.el_0').css('margin-top',header_fixed+'px');}var $header_empty=$('<div class="header-empty"></div>');if($(".header-empty").length==0){$header_empty.css({'background-color':$('header.navbar').css('background-color'),'position':'absolute','width':'100%','height':header_fixed+'px','z-index':'1'});$('.dsgn-body').prepend($header_empty);}}else{$('header.navbar').removeClass('transparent');}if($('body').width()>768)$('.menu-logo-top').hide();});}else if($('.dsgn-body').scrollTop()<header_fixed&&user_menu.hasClass('fixed')&&!$('.dsgn-body').hasClass('sidebar')){if(!HEADER)$('.addel_0').first().hide().fadeIn('fast');user_menu.fadeOut('fast',function(){($('.editor-navbar').css('display')=='none')?$('.fixed').addClass('fixed-position'):$('.fixed').removeClass('fixed-position');user_menu.removeClass('fixed').fadeIn('fast',function(){if(!$('header.navbar').hasClass('sidebar'))$('.header-emtpy').remove();});if(!HEADER){if($('.header').next().hasClass('addEL-wrap')){$('.header').next().css('margin-top','0px');}else{$('.el_0').css('margin-top','0px');}header_offset=0;}else{$('header.navbar').addClass('transparent');}$('.menu-logo-top').show();});}}
$('#tpl-menu li').live({click:function(){if($(this).hasClass('loginout')){$(this).showModalFlat('INFORMATION','íŽ¸ì§‘ëª¨ë“œìž…ë‹ˆë‹¤.',true,false,'','ok');return false;}else{$('#tpl-menu li').removeClass('active');$(this).addClass('active');}}});$('.save-video-url').live({click:function(){var el=$(this).attr('data-el'),idx=$(this).attr('data-idx'),src=$('.video-iframe-url[data-idx="'+idx+'"]').val().trim();if(!src){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.video.url'],true,false,'','ok');$('.video-iframe-url').focus();return;}src=insertVideo(src,'src');if(!src){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.video.url.error'],true,false,'','ok');return false;}src=src.replace("watch?v=","v/");$('.'+el).find('[data-video="true"]:eq('+idx+')').find('iframe').attr('src',src+'?wmode=transparent');saveContentElement(selectEL);var type=getElementType();setLogs(type,"video.change","video",type);}});var makeLinkUrl=function(link,one,view){var link_url='',link_val='',is_menu=(MENULIST.indexOf(link.replace(/ /g,'-'))>-1)?true:false,regex=/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/,regex2=/^((http(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/;if(one){link_url=(view)?'/config/page/view/index#':'#';if(is_menu)link_url="/";}else{link_url=(is_menu)?"/":" /config/page/";}if(link){link_val=(MENULIST.indexOf(link.replace(/ /g,'-'))>-1)?link_url+link.replace(/ /g,'-'):(!regex2.test(link.replace(/ /g,'-'))&&regex.test(link.replace(/ /g,'-')))?'//'+link.replace(/ /g,'-'):link.replace(/ /g,'-');}return link_val;}
var moveScroll=function(interval){var url=decodeURIComponent(document.URL);link=url.split('#').pop();if($.inArray(link,MENULINK)>-1&&ONE&&!VIEW){moveLinkPage(link,interval);$.removeCookie('gallery',{path:'/'});$.removeCookie('gallery-item',{path:'/'});}else if(url.match(/\@/g)){link=url.split('\@').pop();var bookmark_link=url.substr(url.lastIndexOf('/')+1);if(link)moveLinkPage(bookmark_link,800,true);}}
var moveBookmark=function(page,bookmark,interval,target){var page_arr=(typeof page=='undefined')?new Array():page.split('\,'),view=(page_arr.length>1)?page_arr[1]:'';interval=(typeof interval=='undefined')?1200:interval;target=(typeof target=='undefined')?'':target;if((view!=''&&view==VIEW&&!target)||(view==''&&!VIEW&&page_arr[0]==PAGE&&!target)){moveLinkPage(page_arr[0]+bookmark,interval,true);}else{var link_url='';if(ONE){link_url=(view.length>0)?'/config/page/index/view/'+view+bookmark:'/config/page/index'+bookmark;}else{link_url=(view.length>0)?'/config/page/'+page_arr[0]+'/view/'+view+bookmark:'/config/page/'+page_arr[0]+bookmark;}if(target){var openLinkPage=window.open("about:blank");openLinkPage.location.href=link_url;}else{location.replace(link_url);}}}
var moveLinkPage=function(link,interval,isblock){interval=(typeof interval=='undefined')?1200:interval;if(typeof isblock=='undefined')isblock="";if($('.dsgn-body').width()<769){header_fixed=$('.el-menu .navbar-header').height()-1;}else{header_fixed=$('#tpl-menu').height();}var isBookmark=false,bookmark_arr=new Array();if(link.match(/\@/g)){isBookmark=true;bookmark_arr=link.split('\@');var is_here=($('.element[data-bookmark="'+bookmark_arr[1]+'"]').length>0)?true:false,is_page=(PAGE.toLowerCase()==bookmark_arr[0].toLowerCase()||VIEW&&VIEW==bookmark_arr[0])?true:false,is_o_page=(bookmark_arr[0].indexOf(',')>-1&&!VIEW)?bookmark_arr[0].substring(0,bookmark_arr[0].indexOf(',')):(VIEW)?'index':bookmark_arr[0],is_visible_menu=($.inArray(is_o_page,MENULINK)>-1)?true:false,is_link=($('#nestable').find('.dd-item[data-id="'+bookmark_arr[0]+'"] > span > .menu-link').hasClass('active')&&is_visible_menu&&bookmark_arr[0]!='INTRO')?true:false,is_visible=($('#nestable').find('.dd-item[data-id="'+bookmark_arr[0]+'"] > span > .menu-visible').attr('attr-val')=='off'&&is_visible_menu&&bookmark_arr[0]!='INTRO')?true:false;if((!is_visible_menu&&is_o_page!='index')||(!is_page&&(is_link||is_visible))||(is_page&&!is_here)){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.link.bookmark.invalid'],true,false,'','ok');return false;}link='element[data-bookmark="'+bookmark_arr[1]+'"]';}else{link=(isblock=="")?"link-to-"+link:link;}var offset=($('.dsgn-body').hasClass('sidebar'))?0:-header_fixed;$('.dsgn-body').scrollTo('.'+link,interval,{offset:offset,easing:'easeInOutQuart'});var menuStr=(!isBookmark)?link.replace('link-to-',''):bookmark_arr[0];setTimeout(function(){$("#tpl-menu li a:contains('"+menuStr+"')").closest('li').addClass('active').siblings().removeClass('active');},10);}
var moveGallery=function(element,type){var offset=$('header.navbar').height();setTimeout(function(){if(typeof type=="undefined"){offset=($('.dsgn-body').hasClass('sidebar'))?0:-offset;$('.dsgn-body').scrollTo(element,0,{offset:offset});}else{offset=($('.dsgn-body').hasClass('sidebar'))?0:offset;var centered=($('.dsgn-body').height()/2-$(element).height()/2);centered=(centered<0)?offset:centered;$('.dsgn-body').scrollTo(element,0,{offset:-centered});}$.removeCookie('gallery',{path:'/'});$.removeCookie('block-add',{path:'/'});},10);}
$('.save-map-url').live({click:function(){setMap();}});$('.map-style').live('click',function(){setMap();});var setMap=function(){var url=$('.map-iframe-url');if(!url.val()){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.insert-gmap-url'],true,false,'','ok');url.focus();return false;}if(url.val().indexOf('goo.gl')>-1){$(this).showModalFlat('INFORMATION',$.lang[LANG]['config.map.url.info'],true,false,'','ok');url.focus();return false;}var el=$('.save-map-url').attr('data-el'),mapid=$('.'+el).find('[data-map="true"]').attr('id'),map_style=$('.map-style:checked').val();$('.'+el).find('[data-map="true"]').attr('data-style',map_style);$('.'+el).find('#'+mapid).attr('data-url',url.val());saveContentElement();loadmap(url.val(),mapid,map_style);var type=getElementType();setLogs(type,"map.change","map",type);}
$('#ctrl-accordion .panel-title').live('click',function(){var id=$('#prop-accordion').find('.panel-collapse.in').prop('id');$('#'+id).collapse('hide');});var ctrlElementUpdate=function(el,key,val,idx){var seq=$('.'+selectEL).attr('data-id'),j=CSSJSON.toJSON($('#'+selectEL+'css').text());if(myStorageActive()){j=style.setCssProperty(j,el,'background-image','url("'+RPATH+val+'")');$('.ctrl-element-background'+idx).empty();if(val!="none"){bg=RPATH+val;ctrl="<span class='attach-thumb'><img src='"+bg+"'></span> <i class='fa fa-trash-o hand ctrl-prop-background-delete' data-el='"+selectEL+"' data-selector='"+el+"' data-pn='background-image' data-idx='"+idx+"'></i></span>";$('.ctrl-element-background'+idx).append(ctrl);$('.prop-ctrl-background-option'+idx).fadeIn();}ctrlElementTplStyleUpdate(el,'background-image','url("'+RPATH+val+'")');$('#'+selectEL+'css').text(CSSJSON.toCSS(j));var css=$('#'+selectEL+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:seq},function(data){checkError(data);},'json');}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(val,1920);frUpload.then(function(data){j=style.setCssProperty(j,el,'background-image','url("'+data.image+'")');$('.ctrl-element-background'+idx).empty();if(val!="none"){bg=RPATH+val;ctrl="<span class='attach-thumb'><img src='"+data.thumb+"'></span> <i class='fa fa-trash-o hand ctrl-prop-background-delete' data-el='"+selectEL+"' data-selector='"+el+"' data-pn='background-image' data-idx='"+idx+"'></i></span>";$('.ctrl-element-background'+idx).append(ctrl);$('.prop-ctrl-background-option'+idx).fadeIn();}ctrlElementTplStyleUpdate(el,'background-image','url("'+data.image+'")');$('#'+selectEL+'css').text(CSSJSON.toCSS(j));var css=$('#'+selectEL+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:seq},function(data){checkError(data);},'json');});}var type=getElementType();setLogs(type,'block.background.image.change','image-change',type);}
$('.ctrl-prop-background-delete').live('click',function(){var el=$(this).attr('data-el'),seq=$('.'+el).attr('data-id'),idx=$(this).attr('data-idx'),selector=$(this).attr('data-selector'),j=CSSJSON.toJSON($('#'+el+'css').text());j=style.setCssProperty(j,selector,'background-image','none');$('#'+el+'css').text(CSSJSON.toCSS(j));$(this).parent().empty();$('.prop-ctrl-background-option'+idx).fadeOut();var css=$('#'+el+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:seq},function(data){checkError(data);},'json');var type=getElementType();setLogs(type,'block.background.image.delete','delete',type);});$('.ctrl_background-position').live('change',function(){var selector=$(this).attr('data-elname'),val=$(this).val();ctrlElementStyleUpdate(selector,'background-position',val);});$('.ctrl_background-repeat').live('change',function(){var selector=$(this).attr('data-elname'),val=$(this).val();ctrlElementStyleUpdate(selector,'background-repeat',val);});$('.ctrl_background-size').live('change',function(){var selector=$(this).attr('data-elname'),val=$(this).val();ctrlElementStyleUpdate(selector,'background-size',val);});var ctrlElementStyleUpdate=function(selector,key,val,targetEL){if(typeof targetEL=="undefined"||targetEL==""){targetEL=selectEL;}var seq=(targetEL=='el-menu')?'menu':$('.'+targetEL).attr('data-id'),j=(targetEL=='el-menu')?CSSJSON.toJSON($('#menu-'+SID).text()):CSSJSON.toJSON($('#'+targetEL+'css').text());j=style.setCssProperty(j,selector,key,val);(targetEL=='el-menu')?$('#menu-'+SID).text(CSSJSON.toCSS(j)):$('#'+targetEL+'css').text(CSSJSON.toCSS(j));var css=(targetEL=='el-menu')?JSON.stringify(CSSJSON.toJSON($('#menu-'+SID).text())):$('#'+targetEL+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:seq},function(data){checkError(data);if(targetEL=='el-menu'){MCSS=$.parseJSON(css);}},'json');}
var ctrlElementTplStyleUpdate=function(el,key,val,action){var mediaQuery=(action=='media')?true:false,action=(typeof action!='undefined')?action:'update';if($('#el_0css').length>0){$.ajax({type:'get',url:'/template/contents/sid/'+SID+'/page/index,template',dataType:'json',success:function(data){if(typeof data=='object'&&typeof data[0]!='undefined'&&data[0]){var template=data[0],templateName=checkNested(template,'elname')?template.elname:'',type=checkNested(template,'type')?template.type:'',elParts=[],templateSelector='',j={},tplcss,seq='';if(templateName!=''&&type!=''&&type=='project'){if(!mediaQuery){elParts=el.split(' ');if(typeof elParts=='object'&&elParts.length==1&&typeof elParts[0]!='undefined'&&elParts[0]){templateSelector='.'+templateName;}else if(typeof elParts=='object'&&elParts.length>0&&typeof elParts[1]!='undefined'&&elParts[1]){templateSelector='.'+templateName+' '+elParts[1];}}if(templateSelector!=''&&!mediaQuery||mediaQuery){j=CSSJSON.toJSON(htmlspecialchars_decode(data[0].elcss));tplcss=CSSJSON.toCSS(j);$('#el_0css').after(function(){return $(this).clone().attr('id','el_tplcss');});$('#el_tplcss').empty().text(tplcss);if(checkNested(data,0,'seq')){$('#el_tplcss').after(function(){return $('<div class="el_tpl" data-id="'+data[0].seq+'"></div>');});}if(!mediaQuery&&action=='update'){ctrlElementStyleUpdate(templateSelector,key,val,'el_tpl');}else if(action=='content-wrap'){var htmlString=htmlspecialchars_decode(template.eltag),wp=(key=='full-width')?val:'',eltag='',el_id='';if($('.el_tpl').length>0){$('.el_tpl').html(htmlString);(wp)?$('.el_tpl').find('.container').eq(0).removeClass('full-width'):$('.el_tpl').find('.container').eq(0).addClass('full-width');eltag=$('.el_tpl').html();el_id=(checkNested(template,'seq'))?template.seq:'';if(el_id){$.post('/template/update/type/el-tag',{id:SID,s:eltag,seq:el_id},function(data){checkError(data);},'json');}}}else{if(key=='padding-top'||key=='padding-bottom'){var css='@media only screen and (max-width:991px) {\
                                        .'+templateName+' { '+key+': '+Math.ceil(el.value*0.8)+'px!important }\
                                    }\
                                    @media only screen and (max-width:767px) {\
                                        .'+templateName+' { '+key+': '+Math.ceil(el.value*0.5)+'px!important }\
                                    }\
                                    ';tplcss+=css;seq=(checkNested(template,'seq'))?template.seq:$('.el_tpl').attr('data-id');$.post('/template/update/type/el-css',{id:SID,s:tplcss,seq:seq},function(data){checkError(data);},'json');}}$('#el_tplcss').remove();$('.el_tpl').remove();}}}},});}};$('.ctrl-el-font-align').live('click',function(){var selector=$(this).attr('data-selector'),val=$(this).attr('data-textalign');ctrlElementStyleUpdate(selector,'text-align',val);$(this).addClass('btn-primary').siblings().removeClass('btn-primary');});$('.ctrl-el-border-style').live('change',function(){var val=$(this).val(),selector=$(this).attr('data-selector');ctrlElementStyleUpdate(selector,'border-style',val);});$('[data-edit="true"]').live('click',function(e){if($('#flat-modal').length)return;var $editEL=$(this);$.each($(this).find('*'),function(i,v){var spanClass=$(this).attr('class'),$elSpan=$(this);if(typeof spanClass!='undefined'){var thisClass=spanClass.split(' ');$.each(thisClass,function(k,s){if(s&&s.indexOf('fsize')>-1){s=s.replace(/fsize/g,'');$elSpan.css('font-size',s+'px');$elSpan.removeClass(function(index,css){return(css.match(/fsize[\d]+/)||[]).join(' ');});}});}});var linkList=new Array();$.each(MENULINK,function(i,v){linkList.push({displayText:v,href:'/'+v,'data-user-link':'/'+v});});var efonts=style.getUserFontsArr('font-family-body','');$(this).on('froalaEditor.initialized',function(e,editor){editor.events.bindClick($('.dsgn-body'),'button.fr-command',function(){});editor.popups.onShow('link.insert',function(){var $popup=editor.popups.get('link.insert');$('.fr-link-insert-layer').find('.fr-checkbox-line label').text($.lang[LANG]['config.new-window-str']);});}).froalaEditor({pastePlain:true,initOnClick:true,toolbarInline:true,toolbarButtons:['fontFamily','fontSize','text-color','insertLink','bold','italic','underline','strikeThrough','text-align','clearFormatting'],toolbarButtonsMD:['fontFamily','fontSize','text-color','insertLink','bold','italic','underline','strikeThrough','text-align','clearFormatting'],toolbarButtonsSM:['fontFamily','fontSize','text-color','insertLink','bold','italic','underline','strikeThrough','text-align','clearFormatting'],toolbarButtonsXS:['fontFamily','fontSize','text-color','insertLink','bold','italic','underline','strikeThrough','text-align','clearFormatting'],pluginsEnabled:['align','codeBeautifier','codeView','colors','draggable','entities','file','fontFamily','fontSize','image','inlineStyle','lineBreaker','link','lists','quote','save','table','url','video','customPlugin'],enter:$.FroalaEditor.ENTER_BR,fontFamily:efonts,fontFamilySelection:true,fontSizeSelection:true,fontSize:arr_font_size,zIndex:20,placeholderText:'',charCounterCount:false,linkInsertButtons:['linkBack','|','linkList'],linkList:linkList,linkText:true,linkAttributes:{'data-user-link':'Link to MENU'},linkEditButtons:['linkEdit','linkRemove'],imageEditButtons:['imageRemove'],keepFormatOnDelete:true}).on('froalaEditor.commands.after',function(e,editor,cmd,param1,param2){if(cmd!='text-color')removeColpick();});;var pY=e.pageY,above=($(window).height()<pY+320)?'fr-above':'',frShow=0,$toolbar=$('.fr-toolbar');scrollPos=$('.dsgn-body').scrollTop();$('[data-edit="true"][data-attach="true"]').css('-webkit-text-fill-color','rgba(0,0,0,100)');$(this).on('froalaEditor.toolbar.show',function(e,editor){$('.fr-toolbar').css('visibility','hidden');sRect=selectionRect();setTimeout(function(){var top=sRect.top-45;if(above){$('.fr-toolbar').css('top',top+'px');$('.fr-toolbar').addClass('fr-above');}if($('.fr-toolbar').hasClass('fr-above')){$('.fr-toolbar .fr-dropdown-menu').addClass('dropup');}else{$('.fr-toolbar .fr-dropdown-menu').removeClass('dropup');}$('.fr-toolbar').css('visibility','visible');toolPos=$('.fr-toolbar').css('top').replace('px','');var align=$editEL.css('text-align');if(['left','center','right','justify'].indexOf(align)<0)align='left';$('.fr-toolbar').find('button[data-cmd="align"] i').attr('class','').addClass('fa fa-align-'+align);},'100');});$(this).on('froalaEditor.buttons.refresh',function(e,editor){scrollPos=$('.dsgn-body').scrollTop();if($('.fr-toolbar').hasClass('fr-above')){scrollPos2=$('.dsgn-body').scrollTop();$('.fr-popup').css('visibility','hidden');setTimeout(function(){var top=$('.fr-toolbar').css('top').replace('px','')-170;if($('.fr-popup.fr-active .fr-link-insert-layer').length)top=$('.fr-toolbar').css('top').replace('px','')-180;$('.fr-popup').addClass('fr-above').css('top',top+'px');$('.fr-popup').css('visibility','visible');},'100');}if($('.fr-popup').length)popPos=$('.fr-popup').css('top').replace('px','');$('button[data-cmd="text-color"]').colpickHide();if($('.fr-toolbar.fr-inline button[data-cmd="text-color"]').hasClass('active')){$('button[data-cmd="text-color"]').click();if($('.colpick.extend').css('left')=='0px'){removeColpick();}else{$('.fr-toolbar.fr-inline').addClass('always');}}if($('.fr-popup').hasClass('fr-active')){removeColpick();}});if($(this).attr('id')=='tpl-logo-text'){$('#site-home').prop('href','#');e.preventDefault();}var type=$('.'+selectEL).attr('data-type'),rolling=$('.'+selectEL).attr('data-rolling');if(type=='showcase'||(typeof rolling!='undefined'&&rolling=="true")){disableCarousel();}if($('.addElementWrap').length||$('.dsgn-body').width()<769)return false;if($('.header.el-menu').hasClass('element')){$(this).focus();var offset=$(this).offset();var top=offset.top;var left=offset.left;left=left+$(this).width();X=left;Y=top;if(typeof $(this).attr('data-selector')!='undefined')ctrlEL='.'+$('.'+selectEL).attr('data-name')+' '+$(this).attr('data-selector');else{ctrlEL='';console.log('Undefined data-selector : '+selectEL);return false;}if($('#el-property').css('display')=='none'){isEDIT=true;}}});$('.addElementButton li').live({click:function(){if(isEDIT)saveContentedit();if($(this).find('.add-block').hasClass('disabled'))return false;var type=$(this).attr('data-type');$(this).parent().addClass('active').attr('data-idx',$(this).attr('data-index'));if(typeof type=="undefined")return false;if($(this).attr('data-index')=="0"){selectPOS=((selectPOS-1)>0)?selectPOS-1:0;if(selectEL=='el-footer'){selectPOS=COUNT;selectEL=$('.element[data-pos="'+COUNT+'"]').attr('data-el');selectID=$('.element[data-pos="'+COUNT+'"]').attr('data-id');}else{selectEL=(selectPOS==0)?'el-menu':$('.element[data-pos="'+selectPOS+'"]').attr('data-el');}}if(VIEW)addController('show');else showElementList(type);}});var clearElementController=function(){$('.config-image-view').hide();$('.config-image-link').hide();$('.config-image-edit').hide();$('.config-image-add').hide();$('.recomm-image-text').hide();}
var showFormConfig=function(data){$('#el-property').hide();if(!$('.elform-sidebar').hasClass('open')){clearElementController();$('.addFormWrap').remove();$('.dsgn-body').append("<div class='addFormWrap'></div>");var $modal=$("<div class='modal-addForm'></div>");$('.dsgn-body').prepend($modal);$modal.on('click',function(){hideFormListPanel();});var formSidebar='\
        <div class="elform-sidebar">\
            <ul class="form-item-list" data-id="'+data.config.seq+'">\
            </ul>\
        </div>\
        ';var $addElementWrap=$('.addFormWrap');$addElementWrap.append(formSidebar);var $title=$('<li class="add-form-property"><div class="input-group"><input type="text" class="form-control form-title" value="'+data.config.name+'" readonly><span class="input-group-addon form-title-edit"><i class="fa fa-pencil"></i></span></div></li>');$('.form-item-list').append($title);if(data.items.length>0){$.each(data.items,function(i,v){form_item_config(data,v);});var $addItem=$('<li class="add-form-property first"><div class="add-form-items"><i class="fa fa-plus"></i> '+$.lang[LANG]['form.add.item']+'</div></li>'),$addDropdown=$('<ul class="form-item-type"></ul>'),itemGrop=['text','memo','radio','check','select','date','date2'],prop_item='';$.each(itemGrop,function(i,v){prop_item=prop_item+'<li data-val="'+v+'">'+$.lang[LANG]['config.form.'+v]+'</li>';});$addDropdown.append(prop_item);$addItem.append($addDropdown);var $h3Font=$('<li class="add-form-property fonts h3"><h5>'+$.lang[LANG]['form.item.font.title']+'</h5></li>'),fn=$('.'+selectEL+' h3').css('font-family'),h3_color=$('.'+selectEL+' h3').css('color'),h3_size=$('.'+selectEL+' h3').css('font-size').replace('px','');fn=style.getFontcss(fn);var $h3Color=$('<span class="color tooltips font-picker-form-h3" el="h3" pn="color" title="color" style="background-color:'+h3_color+';"></span>'),$h3Size=$('<select class="form-control form-h3-size"></select>');$.each(arr_font_size,function(i,v){$h3Size.append('<option value="'+v+'" '+((h3_size==v)?'selected':'')+'>'+v+'</option>');});var elname=$('.'+selectEL).attr('data-name');$h3Font.append(style.selectFontSelectForm('ctrl-font-family-form-h3',fn,'.'+elname));$h3Font.append($h3Color);$h3Font.append($h3Size);$h3Font.append('<div class="clear"></div>');var $pFont=$('<li class="add-form-property fonts"><h5>'+$.lang[LANG]['form.item.font.text']+'</h5></li>'),fn=$('.'+selectEL+' p.text').css('font-family'),p_color=$('.'+selectEL+' p.text').css('color'),p_size=$('.'+selectEL+' p.text').css('font-size').replace('px','');fn=style.getFontcss(fn);var $pColor=$('<span class="color tooltips font-picker-form-p" el="p.text" pn="color" title="color" style="background-color:'+p_color+';"></span>'),$pSize=$('<select class="form-control form-p-size"></select>');$.each(arr_font_size,function(i,v){$pSize.append('<option value="'+v+'" '+((p_size==v)?'selected':'')+'>'+v+'</option>');});$pFont.append(style.selectFontSelectForm('ctrl-font-family-form-p',fn,'.'+elname));$pFont.append($pColor);$pFont.append($pSize);$pFont.append('<div class="clear"></div>');var $done=$('<li class="add-form-property done"><h5>'+$.lang[LANG]['form.done.text']+' ('+$.lang[LANG]['form.done.info']+')</h5></li>'),$done_input=$('<div class="input-group"><input type="text" class="form-control form-input-done" maxlength="50" readonly value="'+data.config.done+'" placeholder=""><span class="input-group-addon form-done-edit"><i class="fa fa-pencil"></i></span></div>');$done.append($done_input);var $receive=$('<li class="add-form-property receive"><h5>'+$.lang[LANG]['form.item.recevie']+'</h5></li>'),$receive_input=$('<div class="input-group"><input type="text" class="form-control form-input-receive" readonly value="'+data.config.receive+'"><span class="input-group-addon form-receive-edit"><i class="fa fa-pencil"></i></span></div>');$receive.append($receive_input);var privacy_caption=$('#element-display .form-group.form-privacy p.text').length,privacy=$('#element-display .form-group.form-privacy').css('display'),privacy_display=(privacy!='none')?true:false,privacy_caption_display=$('#element-display .form-group.form-privacy p.text').css('display');var privacy_display_text=privacy_caption_display;if(privacy_display==false)privacy_display_text='none';var $privacy=$('<li class="add-form-property privacy"><h5>'+$.lang[LANG]['form.item.privacy']+' <span class="pull-right form-switch-privacy"><label class="switch form-privacy-onoff"><input type="checkbox" class="switch-input" id="form-privacy-onoff" '+((privacy_display)?'checked':'')+'><span class="switch-label" data-on="On" data-off="Off"></span><span class="switch-handle"></span></label></span></h5></li>'),$privacy_text=$('<textarea class="form-control form-privacy-text">'+data.config.privacy_text+'</textarea>'),form_privacy_text=$('#element-display .form-group.form-privacy p.text').text(),$privacy_caption=$('<input class="form-control form-privacy-caption" value="'+form_privacy_text+'" style="display:'+((privacy_display_text!='none')?'block':'none')+'">'),$privacy_caption_check=$('<label class="label-privacy"><input class="check-privacy" type="checkbox" '+((privacy_caption_display!='none')?'checked':'')+'> '+$.lang[LANG]['form.use.description']+'</label>');$privacy.append($privacy_text);$privacy.append($privacy_caption);$privacy.append($privacy_caption_check);var $close=$('<div class="form-config-close"><span class="btn btn-primary btn-flat btn-form-close">'+$.lang[LANG]['form.button.done']+'</span></div>'),$close2=$('<div class="form-config-close img-close"><img src="//i.addblock.net/btn_close.gif" class="btn-form-close hand"></div>');$('.elform-sidebar').append($close).append($close2);$('.form-item-list').append($addItem).append($h3Font).append($pFont).append($done).append($receive).append($privacy);if(privacy_display){$('.form-privacy-text').text(data.config.privacy_text);$('.'+elname+' .form-privacy textarea').text(data.config.privacy_text);$('.form-privacy-text').slideDown();$('.label-privacy').show();}else{$('.form-privacy-text').slideUp();$('.label-privacy').hide();}$addItem.click(function(e){$('.form-item-type').slideToggle();});$('.btn-form-close').click(function(e){hideFormListPanel();});}$('.font-picker-form-h3').colpick({color:'#000',onSubmit:function(hsb,hex,rgb){var elname=$('.'+selectEL).attr('data-name');ctrlElementStyleUpdate('.'+elname+' h3','color','#'+hex);$('.font-picker-form-h3').css('background-color','#'+hex);$('.font-picker-form-h3').colpickHide();saveFormElementCss();}});$('.font-picker-form-p').colpick({color:'#000',onSubmit:function(hsb,hex,rgb){var elname=$('.'+selectEL).attr('data-name');ctrlElementStyleUpdate('.'+elname+' p.text','color','#'+hex);$('.font-picker-form-p').css('background-color','#'+hex);$('.font-picker-form-p').colpickHide();saveFormElementCss();}});$('.form-item-list').sortable({items:".form-sort-item",handle:".fa-arrows",update:function(event,ui){var order=$(this).sortable('toArray',{attribute:'data-id'}),$lists=$('.form-item-list .form-sort-item');var sorts=[];$.each($lists,function(i,v){sorts.push($(this).attr('data-idx'));});if($('.'+selectEL).length==0){alert('Error form config');return false;}var target=$('.'+selectEL).attr('data-name'),$parent_display=$('#element-display .'+target+' .form-inline .form-group:not(".form-privacy")'),$parent_element=$('.'+selectEL+'.'+target+' .form-inline .form-group:not(".form-privacy")'),$items=$parent_display.clone();$parent_display.remove();$parent_element.remove();$.each(sorts,function(i,v){$items.eq(v-1).find('[form-idx]').attr('form-idx',i+1);$('.'+target).find('.form-privacy').before($items[v-1]);});$.post('/template/forms/sort',{sid:SID,pid:data.config.pid,order:order},function(data){checkError(data);},'json');saveFormElement();$.each($lists,function(i,v){$(this).attr('data-idx',i+1);});}});$('.check-privacy').click(function(e){var check=$(this).prop('checked');if(check){$('.form-privacy-caption').show();$('.form-group.form-privacy').find('p.text').show();}else{$('.form-privacy-caption').hide();$('.form-group.form-privacy').find('p.text').hide();}saveFormElement();});$('.form-privacy-caption').keyup(function(e){var $parent=$(this).parents('.form-sort-item'),idx=$parent.attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' .form-privacy');$form_item.find('p.text').text(this.value);}).blur(function(e){saveFormElement();});$('#form-privacy-onoff').click(function(e){var id=$(this).parents('.form-item-list').attr('data-id'),elname=$('.'+selectEL).attr('data-name');if($(this).is(':checked')){$('.'+elname+' .form-group.form-privacy').show();($('#element-display .form-group.form-privacy p.text').css('display')!='none')?$('.form-privacy-caption').show():$('.form-privacy-caption').hide();$('.form-privacy-text').show();$('.label-privacy').show();$('.'+elname+' .form-privacy textarea').text($('.form-privacy-text').val());}else{$('.'+elname+' .form-group.form-privacy').hide();$('.form-privacy-caption').hide();$('.form-privacy-text').hide();$('.label-privacy').hide();}var settings={'type':'privacy','value':($(this).is(':checked'))?'1':''}
$.post('/template/forms/preferences',{sid:SID,id:id,settings:settings,text:$('.form-privacy-text').text()},function(data){checkError(data);},'json');saveFormElement();});$('.form-title-edit').click(function(e){var readonly=$(this).prev().attr('readonly'),id=$(this).parents('.form-item-list').attr('data-id');if(readonly=='readonly'){$(this).prev().removeAttr('readonly');$(this).find('.fa').removeClass('fa-pencil').addClass('fa-check');$(this).prev().focus();}else{var val=$(this).prev().val().trim();if(val==''){alert($.lang[LANG]['form.title.info']);return false;}var settings={'type':'name','value':val}
$.post('/template/forms/preferences',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');$(this).prev().attr('readonly',true);$(this).find('.fa').removeClass('fa-check').addClass('fa-pencil');}});$('.form-done-edit, .form-receive-edit').click(function(e){var readonly=$(this).prev().attr('readonly'),id=$(this).parents('.form-item-list').attr('data-id');if(readonly=='readonly'){$(this).prev().removeAttr('readonly');$(this).find('.fa').removeClass('fa-pencil').addClass('fa-check');}else{var name=$(this).parents('.add-form-property').find('h5').text(),val=$(this).prev().val().trim();if(val==''){if($(this).hasClass('form-receive-edit')){alert($.lang[LANG]['customsite.validate.message.email']);}else{alert($.lang[LANG]['form.done.error']);}return false;}if($(this).hasClass('form-done-edit')){var settings={'type':'done','value':val}
$.post('/template/forms/preferences',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');}else if($(this).hasClass('form-receive-edit')){if(!emailcheck(val)){alert($.lang[LANG]['customsite.validate.message.email.2']);return false;}var settings={'type':'receive','value':val}
$.post('/template/forms/preferences',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');}$(this).prev().attr('readonly',true);$(this).find('.fa').removeClass('fa-check').addClass('fa-pencil');}});$('.form-privacy-text').blur(function(e){var text=$(this).val().trim(),id=$(this).parents('.form-item-list').attr('data-id'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname);var settings={'type':'privacy_text','value':text}
$.post('/template/forms/preferences',{sid:SID,id:id,settings:settings},function(data){checkError(data);$form_item.find('.form-privacy textarea').text(text);},'json');saveFormElement();});$('.form-h3-size, .form-p-size').change(function(){var elname=$('.'+selectEL).attr('data-name'),type=($(this).hasClass('form-h3-size'))?'h3':'p.text',$form_item=$('.'+elname+' '+type),size=$(this).val();$form_item.removeClass(function(index,className){return(className.match(/fsize\d+/g)||[]).join(' ');});$form_item.addClass('fsize'+size);saveFormElement();});$('.ctrl-font-family-form-h3, .ctrl-font-family-form-p').click(function(e){$(this).addClass('active').siblings().removeClass('active');var font_family=$(this).attr('data-font-family').trim(),el=$(this).data('elname');$(this).parents('.btn-group').find('.font-preview').text(font_family).css('font-family',font_family);var fel=($(this).hasClass('ctrl-font-family-form-h3'))?' h3':' p.text';if(fel==' p.text'){ctrlElementStyleUpdate(el+fel,'font-family',font_family);ctrlElementTplStyleUpdate(el+fel,'font-family',font_family);ctrlElementStyleUpdate(el,'font-family',font_family);ctrlElementTplStyleUpdate(el,'font-family',font_family);}else{ctrlElementStyleUpdate(el+fel,'font-family',font_family);ctrlElementTplStyleUpdate(el+fel,'font-family',font_family);}var type=getElementType(),log=($(this).parents('.btn-group').parent().hasClass('gallery-category-font'))?'.gallerycategory':'';setLogs(type,"font.family.change"+log,"font-change",type);});$('.form-item-type li').click(function(e){var pid=$('.'+selectEL).attr('data-id'),type=$(this).attr('data-val');if(typeof pid=='undefined'||pid==''){alert('Undefined variable PID');return false;}$.post('/template/forms/additem',{sid:SID,pid:pid,type:type},function(data){var idx=$('.form-sort-item').length+1,tpl=tplFormitem(type,idx,data.item.val),target=$('.'+selectEL).attr('data-name'),name=data.name;var $form_group=$('<div class="form-group"></div>');$form_group.append("<h3>"+data.item.name+"</h3>");$form_group.append("<p class='text'>"+data.item.desc+"</p>");var h3_class=$('.'+selectEL).find('.form-group').eq(0).find('h3').attr('class'),p_class=$('.'+selectEL).find('.form-group').eq(0).find('p.text').attr('class');$form_group.find('h3').addClass(h3_class);$form_group.find('p.text').addClass(p_class);$tpl=$(tpl).attr('form-idx',idx).attr('form-seq',data.item.seq).attr('form-name',name).attr('form-type',type).attr('form-require',data.item.require);$form_group.append($tpl);$('.'+target).find('.form-privacy').before($form_group);form_item_config(data,data.item,'before');saveFormElement();},'json');});$('.elform-sidebar').animate({left:'0px'},{duration:'slow',easing:'easeInOutCubic'},500).addClass('open');}}
$('.form-input-caption').live('keyup',function(e){var $parent=$(this).parents('.form-sort-item'),idx=$parent.attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]');$form_item.parents('.form-group').find('p.text').text(this.value);}).live('blur',function(e){saveFormElement();});$('.toggle-content').live('click',function(e){$(this).toggleClass('open');if($(this).hasClass('open')){$(this).find('.fa').removeClass('fa-angle-down').addClass('fa-angle-up');}else{$(this).find('.fa').removeClass('fa-angle-up').addClass('fa-angle-down');}$(this).parent().find('.form-item-content').toggle();});$('.check-text').live('click',function(e){var idx=$(this).attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]');if($(this).prop('checked')){$form_item.parents('.form-group').find('p.text').show();$(this).parents('.form-sort-item').find('.form-input-caption').removeClass('hide');}else{$form_item.parents('.form-group').find('p.text').hide();$(this).parents('.form-sort-item').find('.form-input-caption').addClass('hide');}saveFormElement();});$('.form-type-select').live('change',function(e){var idx=$(this).attr('data-idx'),$parent=$(this).parents('.form-sort-item'),id=$(this).parents('.form-sort-item').attr('data-id'),name=$parent.find('.name').text(),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]'),require=$form_item.attr('form-require'),type=$(this).val(),val=$(this).attr('data-val');var tpl=tplFormitem(type,idx,val);$tpl=$(tpl).attr('form-idx',idx).attr('form-seq',id).attr('form-name',name).attr('form-type',type).attr('form-require',require);$form_item.replaceWith($tpl);if(type=='radio'||type=='check'||type=='select'){$parent.find('.form-item-option-wrap').remove();var $select_options=$('<div class="form-item-option-wrap"></div>'),options=(val).split('`'),$option;if(val==''){options=['A','B'];var settings={'type':'val','value':'A`B'}
$.post('/template/forms/items',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');}$.each(options,function(k,o){$option=$('<div class="form-item-option"><input type="text" class="option-name" value="'+replaceQuote(o)+'"></div>');if(k!=0)$option.append('<span class="pull-right hand option-delete">&times;</span>');$select_options.append($option)});$add_option=$('<div class="add-option"><i class="fa fa-plus"></i> '+$.lang[LANG]['form.add.option']+'</div>');$select_options.append($add_option);$('.form-sort-item[data-id="'+id+'"] .form-item-content .form-type-select').after($select_options);}else $parent.find('.form-item-option-wrap').remove();var settings={'type':'type','value':type}
$.post('/template/forms/items',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');saveFormElement();});$('.option-name').live('blur',function(e){var $parent=$(this).parents('.form-sort-item'),idx=$parent.attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),name=$parent.find('.name').text(),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]'),type=$parent.find('.form-type-select').val(),val=$parent.find('.form-type-select').attr('data-val'),require=$form_item.attr('form-require');var options=$parent.find('.option-name').map(function(){return replaceQuote($(this).val().trim());}).get().join('`');if(options!=val){var tpl=tplFormitem(type,idx,options);$tpl=$(tpl).attr('form-idx',idx).attr('form-seq',id).attr('form-name',name).attr('form-type',type).attr('form-require',require);$form_item.replaceWith($tpl);$parent.find('.form-type-select').attr('data-val',options);var settings={'type':'val','value':options}
$.post('/template/forms/items',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');saveFormElement();}}).live('keypress',function(e){var keycode=e.charCode||e.keyCode;if(keycode==96||keycode==34){e.stopPropagation();alert($.lang[LANG]['form.not.allow.char']);return false;}});$('.form-item-option').live({mouseenter:function(e){$(this).find('.option-delete').show();},mouseleave:function(e){$(this).find('.option-delete').hide();}});$('.option-delete').live('click',function(e){var $parent=$(this).parents('.form-sort-item'),idx=$parent.attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),name=$parent.find('.name').text(),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]'),type=$parent.find('.form-type-select').val(),val=$parent.find('.form-type-select').attr('data-val'),require=$form_item.attr('form-require');$(this).parents('.form-item-option').remove();var options=$parent.find('.option-name').map(function(){return replaceQuote($(this).val().trim());}).get().join('`');var tpl=tplFormitem(type,idx,options);$tpl=$(tpl).attr('form-idx',idx).attr('form-seq',id).attr('form-name',name).attr('form-type',type).attr('form-require',require);$form_item.replaceWith($tpl);$parent.find('.form-type-select').attr('data-val',options);var settings={'type':'val','value':options}
$.post('/template/forms/items',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');saveFormElement();});$('.add-option').live('click',function(e){$(this).parents('.form-item-option-wrap').find('.form-item-option').last().after('<div class="form-item-option-wrap"><div class="form-item-option"><input type="text" class="option-name" value=""><span class="pull-right hand option-delete">&times;</span></div></div>');});$('.form-item-delete').live('click',function(e){var $parent=$(this).parents('.form-sort-item'),id=$parent.attr('data-id'),idx=$parent.attr('data-idx'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]');if($('.form-sort-item').length==1){$(this).showModalFlat('DELETE',$.lang[LANG]['form.delete.info'],true,false,'',$.lang[LANG]['config.ok']);return false;}var modal=$(this).showModalFlat('DELETE',$.lang[LANG]['form.item.delete'],true,true,function(){$.post('/template/forms/delitem',{sid:SID,id:id,idx:idx},function(data){checkError(data);$form_item.parents('.form-group').remove();$parent.remove();$form_item.remove();$.each($('.'+elname+' [form-idx]'),function(i,v){var index=$(this).attr('form-idx');if(index>idx){$(this).attr('form-idx',Number(index)-1);}});$.each($('.form-sort-item'),function(i,v){$(this).attr('data-idx',i+1);});saveFormElement();},'json');modal.modal('hide');},'cancel');$('.flat-modal .modal').css('z-index','1034');$('.modal-backdrop').css('z-index','1033');});$('.form-item-list li .name').live('click',function(e){}).live('keypress',function(e){var keycode=e.charCode||e.keyCode;if(keycode==13){e.preventDefault();return false;}}).live('keyup',function(e){var $parent=$(this).parents('.form-sort-item'),idx=$parent.attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]');$form_item.parents('.form-group').find('h3').text($(this).val().trim());}).live('focus',function(e){$(this).parent().css('border-color','#4789E7');}).live('blur',function(e){$(this).parent().attr('style','');var $parent=$(this).parents('.form-sort-item'),idx=$parent.attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]'),name=$(this).val().trim();console.log(name);var settings={'type':'name','value':name}
$.post('/template/forms/items',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');saveFormElement();});$('.check-require').live('click',function(e){var idx=$(this).parents('.form-sort-item').attr('data-idx'),id=$(this).parents('.form-sort-item').attr('data-id'),elname=$('.'+selectEL).attr('data-name'),$form_item=$('.'+elname+' [form-idx="'+idx+'"]');$form_item.parent().find('h3').toggleClass('require');($(this).prop('checked'))?$form_item.attr('form-require','1'):$form_item.attr('form-require','');if(typeof id=="undefined"||id==""){alert('Undefined form item id');return false;}var settings={'type':'require','value':($(this).prop('checked'))?'1':''}
$.post('/template/forms/items',{sid:SID,id:id,settings:settings},function(data){checkError(data);},'json');saveFormElement();});var saveFormElement=function(){var seq=$('.'+selectEL).attr('data-id'),el='.'+$('.'+selectEL).attr('data-name');setDefaultForm(el);var tpl_return=$('#element-display').html();$.post('/template/element/type/update-text/seq/'+seq,{tag:tpl_return,sid:SID},function(data){checkError(data);},'json');}
var saveFormElementCss=function(){var seq=$('.'+selectEL).attr('data-id'),elname=$('.'+selectEL).attr('data-name'),css=$('#'+selectEL+'css').text();console.log(css);}
function setDefaultForm(el){$(el+' [form-idx]').val('');$(el+' [form-idx]').find('.form-date').val('');$(el).find('input:checkbox').removeAttr('checked');$(el).find('input:radio').removeAttr('checked');}var showElementList=function(type,selector,id){elgroup=[];$('#el-property').hide();$('.g-body .text-menu').removeClass('active').addClass('hide');type=(typeof type=="undefined")?"showcase":type;if(!$('.ellist-sidebar').hasClass('open')){clearElementController();$('.addElementWrap').remove();$('.dsgn-body').append("<div class='addElementWrap'></div>");var $modal=$("<div class='modal-addElement'></div>");$('.dsgn-body').prepend($modal);$modal.on('click',function(){hideElementListPanel();});elnav="\
        <div class='ellist-wrap'>\
        </div>\
        ";elicon=getElementListNav(type,selector,id);var $addElementWrap=$('.addElementWrap');$addElementWrap.append(elnav);$(elicon).appendTo($('.ellist-wrap')).animate({left:'0px'},{duration:'slow',easing:'easeInOutCubic'},500).addClass('open');}elementGetPage(1,type,selector,id);}
var elementGetPage=function(page,type,selector,id){selector=(typeof selector=="undefined")?"":selector;id=(typeof id=="undefined")?"":id;login(SID);var ref=id;var up=($('#el-list-image').hasClass('up'))?true:false;if(page==1){$('#el-list-image').remove();}$('.ellist-paging').remove();$('.ellist-sidebar').append('<div class="ellist-paging"></div>');if(page==1){$('.ellist-sidebar').append('<ul id="el-list-image"></ul>');}var url=(type!='menu')?'/template/lists/type/'+type+'/page/'+page:'/template/lists/type/'+type+'/page/'+page+'/feature/'+selector;$.ajax({url:url,dataType:'json',async:false,cache:false,success:function(data){checkError(data);$('#el-list-image').attr('data-page',page).attr('data-type',type).attr('data-selector',selector).attr('data-id',id);var tpl_css,tpl_seq,$tpl_tag,tpl_name,tpl_type,tpl_type2,tpl_elnew,$el_list_item;elgroup=elgroup.concat(data.list);$.each(data.list,function(key,val){tpl_seq=val.seq;tpl_name=val.elname;tpl_type=val.type;tpl_type2=val.type2;tpl_elnew=val.elnew;tpl_key=(page>1)?key+(30*(page-1)):key;$el_new_icon=$('<img src="//i.addblock.net/icon/icon_new.png" alt="" class="newicon" />');$el_type2=(tpl_type2)?$('<div class="tpl-type2" data-type2="'+val.type2+'">'+val.type2+'</div>'):'';$el_feature=(val.feature)?$('<div class="tpl-feature" data-feature="'+val.feature+'">'+val.feature+'</div>'):'';$el_list_item=$('<li></li>').css('position','relative');$el_list_item.attr('data-id',tpl_seq).attr('data-type',tpl_type).attr('data-ref',id).attr('data-idx',tpl_key);if(val.elimg&&val.elimg!='0'){$el_list_item.append('<img src="'+val.elimg+'">');}else $el_list_item.append('<img src="//i.addblock.net/image_none.png">');if(tpl_elnew=='1'){$el_list_item.append($el_new_icon);}else{$el_list_item.find('.newicon').remove();}$el_list_item.append($el_type2);$el_list_item.append($el_feature);$el_list_item.appendTo($('#el-list-image')).hide().fadeIn(500);});elementPaging(page,data.total,type,ref,selector);}});}
var elementPaging=function(page,total,type,id,selector){view=30;$('.ellist-paging').empty();page_view=5;start=Math.floor((page-1)/page_view)*page_view;pages=Math.ceil(total/view);end=(Math.floor((page-1)/page_view)+1)*page_view;last=end;end=(end>pages)?pages:end;prev=(start>0)?start:1;next=((end+1)>pages)?pages:end+1;var str='\
    <ul class="theme-pagination pagination-sm">\
        <li class="white"><a href="javascript:;" class="icon-border" onclick="elementGetPage('+prev+',\''+type+'\',\''+selector+'\',\''+id+'\')"><</a></li>\
    ';for(i=start;i<end;i++){active=((i+1)==page)?"active":"";str=str+'\
        <li class="'+active+'"><a href="javascript:;" onclick="elementGetPage('+(i+1)+',\''+type+'\',\''+selector+'\',\''+id+'\')">'+(i+1)+'</a></li>\
        ';}if(last<pages){str=str+'\
        <li><a href="javascript:;">...</a></li>\
        ';}str=str+'\
        <li class="white"><a href="javascript:;" class="icon-border" onclick="elementGetPage('+next+',\''+type+'\',\''+selector+'\',\''+id+'\')">></a></li>\
    </ul>\
    ';if(total)$('.ellist-paging').append(str);}
var getElementListNav=function(type,selector,id){var active=new Array();if(type=='menu'){active[0]=(selector=='normal')?"active":"";active[1]=(selector=='sidebar')?"active":"";}else{active[0]=(type=='back')?"active":"";active[1]=(type=='showcase')?"active":"";active[2]=(type=='header')?"active":"";active[3]=(type=='contents')?"active":"";active[4]=(type=='gallery')?"active":"";active[5]=(type=='text')?"active":"";active[6]=(type=='image')?"active":"";active[7]=(type=='video')?"active":"";active[8]=(type=='dividers')?"active":"";active[9]=(type=='contact')?"active":"";active[10]=(type=='forum')?"active":"";active[11]=(type=='sns')?"active":"";active[12]=(type=='footer')?"active":"";active[13]=(type=='title')?"active":"";active[14]=(type=='temp')?"active":"";active[15]=(type=='addtemp')?"active":"";}var one='',tmp='',str='';if(type=='menu'){tmp='<li data-type="menu" data-feature="normal" class="'+active[0]+'"><img src="//i.addblock.net/icon/fa_topmenu.png"><div>'+$.lang[LANG]['editor.block.normal']+'</div></li>';str=str+tmp;tmp='<li data-type="menu" data-feature="sidebar" class="'+active[1]+'"><img src="//i.addblock.net/icon/fa_leftmenu.png"><div>'+$.lang[LANG]['editor.block.sidebar']+'</div></li>';str=str+tmp;}else{tmp='<li data-type="showcase"  class="'+active[1]+'"><img src="//i.addblock.net/icon/icon-showcase.png"><div>'+$.lang[LANG]['editor.block.showcase']+'</div></li>';(selector=='showcase')?one=tmp:str=str+tmp;tmp='<li data-type="header"  class="'+active[2]+'"><img src="//i.addblock.net/icon/icon-header.png"><div>'+$.lang[LANG]['editor.block.header']+'</div></li>';(selector=='header')?one=tmp:str=str+tmp;tmp='<li data-type="contents"  class="'+active[3]+'"><img src="//i.addblock.net/icon/icon-content.png"><div>'+$.lang[LANG]['editor.block.content']+'</div></li>';(selector=='contents')?one=tmp:str=str+tmp;tmp='<li data-type="gallery"  class="'+active[4]+'"><img src="//i.addblock.net/icon/icon-gallery.png"><div>'+$.lang[LANG]['editor.block.gallery']+'</div></li>';(selector=='gallery')?one=tmp:str=str+tmp;tmp='<li data-type="text"  class="'+active[5]+'"><img src="//i.addblock.net/icon/icon-text.png"><div>'+$.lang[LANG]['editor.block.text']+'</div></li>';(selector=='text')?one=tmp:str=str+tmp;tmp='<li data-type="image"  class="'+active[6]+'"><img src="//i.addblock.net/icon/icon-image.png"><div>'+$.lang[LANG]['editor.block.image']+'</div></li>';(selector=='image')?one=tmp:str=str+tmp;tmp='<li data-type="video"  class="'+active[7]+'"><img src="//i.addblock.net/icon/icon-video.png"><div>'+$.lang[LANG]['editor.block.video']+'</div></li>';(selector=='video')?one=tmp:str=str+tmp;tmp='<li data-type="dividers"  class="'+active[8]+'"><img src="//i.addblock.net/icon/icon-divider.png"><div>'+$.lang[LANG]['editor.block.divider']+'</div></li>';(selector=='dividers')?one=tmp:str=str+tmp;tmp='<li data-type="contact"  class="'+active[9]+'"><img src="//i.addblock.net/icon/icon-contact.png"><div>'+$.lang[LANG]['editor.block.contact']+'</div></li>';(selector=='contact')?one=tmp:str=str+tmp;tmp='<li data-type="forum"  class="'+active[10]+'"><img src="//i.addblock.net/icon/icon-forum.png"><div>'+$.lang[LANG]['editor.block.forum']+'</div></li>';(selector=='forum')?one=tmp:str=str+tmp;tmp='<li data-type="sns"  class="'+active[11]+'"><img src="//i.addblock.net/icon/icon-social.png"><div>'+$.lang[LANG]['editor.block.sns']+'</div></li>';(selector=='sns')?one=tmp:str=str+tmp;tmp='<li data-type="form"  class="'+active[12]+'"><img src="//i.addblock.net/icon/icon-form.png"><div>'+$.lang[LANG]['editor.block.form']+'</div></li>';(selector=='form')?one=tmp:str=str+tmp;tmp='<li data-type="others"  class="'+active[13]+'"><img src="//i.addblock.net/icon/icon-others.png"><div>'+$.lang[LANG]['editor.block.others']+'</div></li>';(selector=='others')?one=tmp:str=str+tmp;tmp='<li data-type="footer"  class="'+active[14]+'"><img src="//i.addblock.net/icon/icon-footer.png"><div>'+$.lang[LANG]['editor.block.footer']+'</div></li>';(selector=='footer')?one=tmp:str=str+'';tmp='<li data-type="project"  class="'+active[15]+'"><img src="//i.addblock.net/icon/icon-header.png"><div>'+$.lang[LANG]['editor.block.project']+'</div></li>';(selector=='project')?one=tmp:str=str+'';tmp='<li data-type="gallerycategory"  class="'+active[16]+'"><img src="//i.addblock.net/icon/icon-header.png"><div>'+$.lang[LANG]['editor.block.gallerycategory']+'</div></li>';(selector=='gallerycategory')?one=tmp:str=str+'';}str=str+'<li class="elCtrlbtn panel-close" onclick="hideElementListPanel()"><img src="//i.addblock.net/btn_close.gif"></li>';one=one+'<li class="elCtrlbtn panel-close" onclick="hideElementListPanel()"><img src="//i.addblock.net/btn_close.gif"></li>';if(rt_admin=="adm"){tmp='\
      <li class="elCtrlbtn add addon" onclick="addTemplate()"><i class="fa fa-plus"></i><div>add</div></li>\
      <li data-type="temp" class="'+active[17]+' template elCtrlbtn addon"><img src="//i.addblock.net/icon/icon-header.png"><div>Temp</div></li>\
      <li data-type="addtemp" class="'+active[18]+' addelement elCtrlbtn addon"><i class="fa fa-plus-circle"></i><div>add<br>temp</div></li>\
      <li class="elCtrlhide addon" onclick="elHideToolbar()"><i class="fa fa-eye"></i><div>hide toolbar</div></li>\
        ';str=str+tmp;one=one+tmp;}if(typeof id!='undefined'){str=one;}var nav_tpl='\
    <div class="ellist-sidebar">\
        <ul class="nav">\
    '+str+'\
        </ul>\
    </div>\
    ';return nav_tpl;}
$('.ellist-sidebar li.disabled').live('click',function(e){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.prepare'],true,false,'','ok');});var hideFormListPanel=function(){$('.element').removeClass('el-active');$('.elform-sidebar').animate({left:'-260px'},{duration:'slow',easing:'easeInOutCubic'},250).removeClass('open');$('#selected-element').remove();$('.addFormWrap').fadeOut(1000,function(){$(this).remove();});$('.elform-content').fadeOut(1000,function(){$(this).remove();});$('.ellist-content').fadeOut(1000,function(){$(this).remove();});$('.modal-addForm').fadeOut(1000,function(){$(this).remove();});}
var hideElementListPanel=function(){$('.element').removeClass('el-active');$('.ellist-sidebar').animate({left:'-260px'},{duration:'slow',easing:'easeInOutCubic'},250).removeClass('open');$('.addElementWrap').fadeOut(1000,function(){$(this).remove();});$('.ellist-content').fadeOut(1000,function(){$(this).remove();});$('.modal-addElement').fadeOut(1000,function(){$(this).remove();});}
var showFormElement=function(){var deferred=$.Deferred();elgroup=[];var seq=$('.'+selectEL).attr('data-id');if(typeof seq=='undefined'||seq==''){alert('Undefined variable');return false;}$.post('/template/element/type/get/seq/'+seq,{sid:SID,form:true},function(data){elgroup=elgroup.concat(data);showElementView(0);$('.viewBolckToolbar').remove();},'json');deferred.resolve();return deferred.promise();}
var showElementView=function(idx){var curEL=elgroup[idx];if(typeof curEL.elname=='undefined'){alert('Error element index');return false;}$('.ellist-content').remove();$('#selected-element').remove();$('#selected-element-js').remove();var tpl_css=htmlspecialchars_decode(curEL.elcss),tpl_seq=curEL.seq,tpl_name=curEL.elname,tpl_type=curEL.type,tpl_type2=curEL.type2,$tpl_description='',$tpl_tag=$(htmlspecialchars_decode(curEL.eltag)),tpl_bgcolor=$('.dsgn-body').css('background-color'),$view_content=$('<div class="ellist-content"></div>'),$view_wrap=$('<div class="element-content"></div>');if(curEL.type=='showcase'){if(curEL.type2.toLowerCase()=='imgsize'||curEL.feature.toLowerCase()=='device'){}else{$tpl_description='<div class="tpl-description"><label class="showcase-default">NOTICE</label><span>'+$.lang[LANG]['editor.block.showcase.default']+'</span></div>';}}if(curEL.type=='gallery'&&curEL.type2.toLowerCase()=='hexagon unsupported')$tpl_description='<div class="tpl-description"><label>NOTICE</label><span>'+$.lang[LANG]['editor.block.gallery.hexagon.unsupported']+'</span></div>';if(curEL.type=='forum'&&curEL.type2.toLowerCase()=='faq')$tpl_description='<div class="tpl-description"><label>NOTICE</label><span>'+$.lang[LANG]['editor.block.forum.faq']+'</span></div>';if(curEL.feature=='parallax'){$tpl_description+='<div class="tpl-description"><label>PARALLAX SCROLL</label><span>'+$.lang[LANG]['editor.block.parallax']+'</span></div>';}$view_content.appendTo($('.dsgn-body'));$view_content.append($tpl_description).append($view_wrap);$('.dsgn-body').prepend("<style id='selected-element'>"+tpl_css+"</style>");$.processON();$el_list_item=$('<div id="element-display"></div>');$el_list_item.css('background-color',tpl_bgcolor);$view_content.css({'top':'-100%','transform':'translateY(-50%)','-o-transform':'translateY(-50%)','-moz-transform':'translateY(-50%)','-webkit-transform':'translateY(-50%)','-moz-transform':'translateY(-50%)','position':'fixed'});$el_list_item.attr('data-id',tpl_seq).attr('data-type',tpl_type).attr('data-ref',selectEL);$el_list_item.append($tpl_tag);$el_list_item.find('[data-map="true"]').attr('id','map-'+curEL.seq);var map_url=$el_list_item.find('[data-map="true"]').attr('data-url');$el_list_item.appendTo($('.element-content')).hide().fadeIn(1000);if($el_list_item.find('header').hasClass('sidebar')){$el_list_item.find('header').css({'position':'static','height':'600px'});$view_content.css({'height':'600px',});}$el_list_item.find('[data-fixed-width]').each(function(){$(this).css('width',$(this).attr('data-fixed-width')+'px');});setTimeout(function(){$el_list_item.promise().done(function(){if($el_list_item.height()>$('.dsgn-body').height()-200){$view_content.css('transform','none');$view_content.animate({'top':'100px','bottom':'50px','max-height':'90%',},{duration:0,});$view_content.find('.element-content').css({'overflow-x':'hidden','overflow-y':'auto','max-height':'100%',});}else{$view_content.animate({'top':'50%'},{duration:0,});}$view_content.hide().fadeIn();if($el_list_item.height()<$('.dsgn-body').height()-400)$('.viewBolckToolbar').css('top','-48px');$.processOFF();});},500);$el_list_item.on('resize',function(e){console.log('resize');});str="<div class='viewBolckToolbar'>";if(rt_admin=="adm"){str=str+"\
        <div class='toolbarButton block-close' data-toggle='tooltip' data-placement='bottom' title='delete' onclick='deleteTemplate("+curEL.seq+",\"element\")'><i class='fa fa-trash-o'></i></div>\
        <div class='toolbarButton block-html' data-toggle='tooltip' data-placement='bottom' title='html' onclick='elHtml("+curEL.seq+")'><i class='fa fa-file-code-o'></i></div>\
        ";}var func=(selectEL=='el-menu'&&typeof selectPOS=='undefined')?'selectMenuElement':'selectElement';if(curEL.type=='gallerycategory')func='selectGalleryCategory';str=str+"\
        <div class='toolbarButton block-useit' data-toggle='tooltip' data-placement='bottom' title='use' onclick='"+func+"("+curEL.seq+")'><i class='fa fa-check'></i> <span data-lang='config.element-useit'> "+$.lang[LANG]['config.element-useit']+"</span></div>\
    </div>\
    ";$el_list_item.append(str);if(typeof map_url!='undefined')loadmap(map_url,'map-'+curEL.seq);if(typeof tpl_type2!='undefined'&&tpl_type2=='countdown'||$tpl_tag.find('[data-dday="true"]').length>0){var el_dday=$tpl_tag.find('[data-dday="true"]'),nowdate=new Date(),dateformat={days:'%D',hours:'%H',minutes:'%M',seconds:'%S'},dateendformat={days:'00',hours:'00',minutes:'00',seconds:'00'};nowdate.setTime(nowdate.getTime()+(35*24*60*60*1000));var cd_date=moment(nowdate).format('YYYY/MM/DD HH:mm:ss');el_dday.find('.date-item').each(function(){if(typeof $(this).attr('data-format')!='undefined'&&$(this).attr('data-format')){dateformat[$(this).attr('data-datetype')]=$(this).attr('data-format');}if(typeof $(this).attr('data-finish')!='undefined'&&$(this).attr('data-finish')){dateendformat[$(this).attr('data-datetype')]=$(this).attr('data-finish');}});el_dday.countdown(cd_date,function(event){if(event.elapsed){$tpl_tag.find('.date-item[data-datetype="days"]').text(dateendformat['days']);$tpl_tag.find('.date-item[data-datetype="hours"]').text(dateendformat['hours']);$tpl_tag.find('.date-item[data-datetype="minutes"]').text(dateendformat['minutes']);$tpl_tag.find('.date-item[data-datetype="seconds"]').text(dateendformat['seconds']);}else{$tpl_tag.find('.date-item[data-datetype="days"]').text(event.strftime(dateformat['days']));$tpl_tag.find('.date-item[data-datetype="hours"]').text(event.strftime(dateformat['hours']));$tpl_tag.find('.date-item[data-datetype="minutes"]').text(event.strftime(dateformat['minutes']));$tpl_tag.find('.date-item[data-datetype="seconds"]').text(event.strftime(dateformat['seconds']));}});}if(curEL.eljs)$('.dsgn-body').append("<script id='selected-element-js'>"+curEL.eljs+"</"+"script>");$(".dsgn-body").fitVids();}
$('.ellist-sidebar .nav li').live('click',function(){var type=$(this).attr('data-type'),feature=$(this).attr('data-feature');if(typeof type=="undefined"||$(this).hasClass('disabled')){return false;}$(this).addClass('active').siblings().removeClass('active');elgroup=[];showElementList(type,feature);if($('#el-list-image').children().length==0){$('#el-list-image').append('<div class="available-soon">'+$.lang[LANG]['config.available.soon']+'</div>');}});$('#el-list-image li').live('click',function(){$('.ellist-sidebar .none').remove();$('.elCtrlbtn').fadeIn();$('.elCtrlhide').animate({left:'315px'},500);$('.elCtrlhide').removeClass('move');$(this).addClass('active').siblings().removeClass('active');showElementView($(this).attr('data-idx'));});var clearElementView=function(){$('.ellist-content').empty();}
var elHideToolbar=function(){if($('.elCtrlhide').hasClass('move')){$('.viewBolckToolbar').fadeIn();$('.elCtrlbtn').fadeIn();$('.elCtrlhide').animate({left:'315px'},500);$('.elCtrlhide').removeClass('move');}else{$('.viewBolckToolbar').fadeOut();$('.elCtrlbtn').fadeOut();$('.elCtrlhide').animate({left:'271px'},500);$('.elCtrlhide').addClass('move');}}
var elementUploadImage=function(seq,file){if(!seq||!file){alert('Error variable elementID or file');return false;}var file_path=RPATH+'800/'+file;$('#tpl-image').empty();$('#tpl-image').append('<img src="'+file_path+'">');}
var elFooter=function(){if($('.el-footer').length)return false;if(!FTAG){addFooterInfoDisplay();return false;}FTAG=FTAG.replace(/&zwnj;/g,'');var $cog=$('<div class="el-footer_ctrl config-element-section"><div class="config-element"><img src="//i.addblock.net/icon/fa_config_icon.png"></div></div>');$('.dsgn-body').append($cog);$footer=$(FTAG);$footer.find('.link-site-home').prop('href','/config');$footer.addClass('element').attr('data-type','footer').attr('data-el','el-footer').addClass('el-footer').attr('data-id','footer').attr('data-name','footer-'+SID);if(FOOTER)$footer.addClass('disable');if($.cookie('mode')=='view')$footer.removeClass('element').addClass('element-disable');else $footer.removeClass('element-disable');$footer.appendTo($('.dsgn-body'));if(FOOTER&&$.cookie('mode')=='view'){$footer.hide();}$('.dsgn-body').prepend("<style id='el-footercss'>"+FCSS+"</style>");setPanelTranslate($footer);if($('.el-footer').find('.creatorlink-box').length>0){if($('.el-footer').find('.creatorlink-box').prev().hasClass('col-md-10'))$('.el-footer').find('.creatorlink-box').prev().removeClass('col-md-10').addClass('col-md-12');$('.el-footer').find('.creatorlink-box').remove();}if($('.el-footer').find('*[data-edit="true"]').first().closest('.row').children('div').length==1&&$('.el-footer').find('*[data-edit="true"]').first().closest('.row').children('div').hasClass('col-md-10')){$('.el-footer').find('*[data-edit="true"]').first().closest('.row').children('div').removeClass('col-md-10').addClass('col-md-12');}if(typeof VALIDPLAN!="undefined"&&VALIDPLAN){if($('.el-footer').find('.creatorlink-footer').length>0)$('.el-footer').find('.creatorlink-footer').remove();}else{if($('.el-footer').find('.creatorlink-footer').length==0){setFooterCretorlinkBox();var feltag='<div class="footer-'+SID+'">'+$('.el-footer').html()+'</div>',fel_id=$('.el-footer').attr('data-id');if(SID){$.post('/template/update/type/el-tag',{id:SID,s:feltag,seq:fel_id,trans:'true'},function(data){checkError(data);},'json');}}}}
var setFooterCretorlinkBox=function(){if($('.el-footer').find('.creatorlink-footer').length==0){var str="\
            <div class='creatorlink-footer'>\
                <a href='http://creatorlink.net' target='_blank'><span>powered by <b>Creatorlink.net</b></span></a>\
            </div>\
        ";$('.el-footer').find('*[data-edit="true"]').first().closest('.row').append(str);var $footer_text=$('.el-footer').find('*[data-edit="true"]').first(),fcolor=($footer_text.find('span').length==0)?$footer_text.css('color'):$footer_text.find("span[style*='color']").first().css('color'),fbgcolor=($('.el-footer').css('background-color')=='rgba(0, 0, 0, 0)')?$('.dsgn-body').css('background-color'):$('.el-footer').css('background-color');if(fbgcolor=='rgba(0, 0, 0, 0)'){fbgcolor='#ffffff';fcolor='#000000';}var fdefaultcss='background-color:'+fbgcolor+';color:'+fcolor+';border-color:'+fcolor+';white-space:nowrap;';$('.el-footer').find('.creatorlink-footer').first().find('span').attr("style",fdefaultcss);}}
var addFooterInfoDisplay=function(){var str="<div class='element add-footer-information' data-type='footer'>"+$.lang[LANG]['editor.click-to-add']+" <b>footer"+$.lang[LANG]['editor.s-content']+"</b></div>";var $addFooter=$(str);if($.cookie('mode')=='view')$addFooter.hide();$addFooter.click(function(){selectPOS="";selectEL="footer";selectID="footer";showElementList('footer','footer',selectID);});$addFooter.appendTo($('.dsgn-body'));}
var galleryController=function(idx){clearElementController();$('.galleryController').remove();var $modal=$('<div class="galleryController"></div>'),$modal_bg=$('<div class="modal-background"></div>'),$wrap=$('<div class="wrap"></div>'),seq=$('.'+selectEL).attr('data-id'),d;$img=$('<div class="half image clear"></div>');$content=$('<div class="half content"></div>');$modal_bg.on('click',function(){galleryControllerClose();});var data=getTitleCaption(idx);var file=data.img.replace(/^.*[\\\/]/,''),file_path=RPATH+'600/'+file;var $item_title=$('.'+selectEL+'[data-id="'+seq+'"]').find('h5.figure'),$item_caption=$('.'+selectEL+'[data-id="'+seq+'"]').find('p.figure'),title_enable=($item_title.length>0)?"":"disabled",caption_enable=($item_caption.length>0)?"":"disabled",info_enable=(caption_enable!="")?$.lang[LANG]['config.gallery.text.info']:"",gallerycategory=$('.element[data-id="'+data.pid+'"]').attr('data-category'),caption_height=(gallerycategory=="ON")?'style="height:150px;"':'style="height:200px;"';file_path=(data.img)?file_path:'//i.addblock.net/image_upload.png';$img.append("<img src='"+file_path+"' class='gallery-item-image img-responsive'>");$img.append("<div class='upload-image gallery-item-image'>"+$.lang[LANG]['config.gallery.image-upload']+"</div>");str='\
    <div class="form-group">\
        <!--<label>'+$.lang[LANG]['config.gallery.title']+'</label>-->\
        <input type="text" class="form-control gallery-item-title" placeholder="'+$.lang[LANG]['config.gallery.title']+'" value="'+data.title+'">\
    </div>\
    <div class="form-group">\
        <!--<label>'+$.lang[LANG]['config.gallery.caption']+'</label>-->\
        <textarea class="form-control gallery-item-caption" placeholder="'+$.lang[LANG]['config.gallery.caption']+'" '+caption_height+'>'+data.caption+'</textarea>\
        <span class="tip" style="color:#4789E7;">'+info_enable+'</span>\
    </div>\
    ';if(gallerycategory=="ON")str=str+galleryCategoryCheckList(data.pid,data.category);str=str+'\
    <div class="form-group hide">\
        <div class="input-group date datetimepicker">\
            <input type="text" class="form-control gallery-item-datetime" placeholder="date" value="'+data.datetime+'">\
            <div class="input-group-addon"><i class="fa fa-calendar"></i> &nbsp;&nbsp;<b>'+$.lang[LANG]['config.date']+'</b></div>\
        </div>\
    </div>\
    <div class="form-group hide">\
        <label>'+$.lang[LANG]['config.gallery.hashtag']+'</label>\
        <input type="text" class="form-control gallery-item-hashtag" placeholder="'+$.lang[LANG]['config.gallery.hashtag']+'" value="">\
    </div>\
    ';$content.append(str);$wrap.append('\
    <div class="modal-header">\
        <button type="button" class="close galleryControllerClose"><span aria-hidden="true"><img src="//i.addblock.net/fa-close-modal.png" alt="close" /></span></button>\
        <h3>'+$.lang[LANG]['config.gallery.type.project.config.title']+'</h3>\
    </div>\
    ');$wrap.append($img).append($content);$wrap.append('\
    <div class="clear">\
        <div class="pull-left tip"><span class="tip-title"><i class="fa fa-info-circle"></i> &nbsp;IMAGE UPLOAD TIP</span><br>'+$.lang[LANG]['editor.upload.multi.info']+'</div>\
        <div class="pull-right" style="padding-top:10px; padding-bottom: 30px;"><span class="btn btn-default btn-sm galleryControllerClose">'+$.lang[LANG]['config.close']+'</span> &nbsp;&nbsp;&nbsp;<span class="btn btn-primary btn-sm galleryItemSave" data-idx="'+data.idx+'">'+$.lang[LANG]['config.save']+'</span></div>\
    </div>\
    ');$modal.append($wrap);$modal_bg.appendTo($('.dsgn-body')).hide().fadeIn(500);$modal.appendTo($('.dsgn-body')).hide().fadeIn(500);$('.datetimepicker').datetimepicker({format:'YYYY-MM-DD HH:mm'});if(idx==-1)$('.gallery-item-image').trigger('click');}
var galleryItemController=function(seq){clearElementController();$('.galleryController').remove();var $modal=$('<div class="galleryController"></div>'),$modal_bg=$('<div class="modal-background"></div>'),$wrap=$('<div class="wrap"></div>');$img=$('<div class="half image clear"><div class="gallery-item-link-icon"><i class="fa fa-link"></i></div><div class="gallery-item-image-icon"><i class="fa fa-picture-o"></i></div></div>');$content=$('<div class="half content"></div>');$modal_bg.on('click',function(){galleryControllerClose();});var r=getGalleryViewParent(seq),v=r[0],file=v.image,settings=$.parseJSON(v.gsettings);if(settings==null||typeof settings['storage']=='undefined'||settings['storage']==""){var $item_title=$('.gallery-item[data-seq="'+seq+'"]').find('h5.figure'),$item_caption=$('.gallery-item[data-seq="'+seq+'"]').find('p.figure'),title_enable=($item_title.length)?"":"disabled",caption_enable=($item_caption.length)?"":"disabled",info_enable=(caption_enable!="")?$.lang[LANG]['config.gallery.text.info']:"",gallerycategory=$('.element[data-id="'+v.pid+'"]').attr('data-category'),caption_height=(gallerycategory=="ON")?'style="height:150px;"':'style="height:200px;"',gsettings=(typeof v.gsettings=="undefined")?new Object():$.parseJSON(v.gsettings);var glink=(gsettings&&typeof gsettings['glink']!="undefined"&&gsettings['glink'])?gsettings['glink']:'',glink_target=(gsettings&&typeof gsettings['glink_target']!="undefined"&&gsettings['glink_target']=='_blank')?'_blank':'',img_path=RESOURCE+"/"+SID+"/",img_original=img_path;file_path=img_path+'600/'+file;file_path=(v.image)?file_path:'//i.addblock.net/image_upload.png';$img.find('.gallery-item-link-icon').attr({'data-glink':glink,'data-glink-target':glink_target,'data-glseq':v.seq});$img.append("<img src='"+file_path+"' class='gallery-item-image img-responsive'>");str='\
        <div class="form-group">\
            <input type="text" class="form-control gallery-item-title" placeholder="'+$.lang[LANG]['config.gallery.title']+'" value="'+v.title+'">\
        </div>\
        <div class="form-group">\
            <textarea class="form-control gallery-item-caption" placeholder="'+$.lang[LANG]['config.gallery.caption']+'" '+caption_height+'>'+v.caption+'</textarea>\
            <span class="tip" style="color:#4789E7;">'+info_enable+'</span>\
        </div>\
        ';if(gallerycategory=="ON")str=str+galleryCategoryCheckList(v.pid,v.category);str=str+'\
        <div class="form-group hide">\
            <div class="input-group date datetimepicker">\
                <input type="text" class="form-control gallery-item-datetime" placeholder="date" value="'+v.datetime+'">\
                <div class="input-group-addon"><i class="fa fa-calendar"></i>  &nbsp;&nbsp;<b>'+$.lang[LANG]['config.date']+'</b></div>\
            </div>\
        </div>\
        <div class="form-group hide">\
            <label>'+$.lang[LANG]['config.gallery.hashtag']+'</label>\
            <input type="text" class="form-control gallery-item-hashtag" placeholder="'+$.lang[LANG]['config.gallery.hashtag']+'" value="'+v.hashtag+'">\
        </div>\
        ';$content.append(str);$wrap.append('\
        <div class="modal-header">\
            <button type="button" class="close galleryControllerClose"><span aria-hidden="true"><img src="//i.addblock.net/fa-close-modal.png" alt="close" /></span></button>\
            <h3>'+$.lang[LANG]['config.gallery.type.project.config.title']+'</h3>\
        </div>\
        ');$wrap.append($img).append($content);$wrap.append('\
        <div class="clear">\
            <div class="pull-right" style="padding-top:10px; padding-bottom: 30px;"><span class="btn btn-default btn-sm galleryControllerClose">'+$.lang[LANG]['config.close']+'</span> &nbsp;&nbsp;&nbsp;<span class="btn btn-primary btn-sm galleryItemSave" data-seq="'+seq+'" data-idx="'+(v.pos-1)+'">'+$.lang[LANG]['config.save']+'</span></div>\
        </div>\
        ');$modal.append($wrap);$modal_bg.appendTo($('.dsgn-body')).hide().fadeIn(500);$modal.appendTo($('.dsgn-body')).hide().fadeIn(500);$('.datetimepicker').datetimepicker({format:'YYYY-MM-DD HH:mm'});}else{$.processON('Image upload to storage...');var tmp=file.split('.'),frUpload=frStorageUpload(tmp[0],600);frUpload.then(function(data){var $item_title=$('.gallery-item[data-seq="'+seq+'"]').find('h5.figure'),$item_caption=$('.gallery-item[data-seq="'+seq+'"]').find('p.figure'),title_enable=($item_title.length)?"":"disabled",caption_enable=($item_caption.length)?"":"disabled",info_enable=(caption_enable!="")?$.lang[LANG]['config.gallery.text.info']:"",gallerycategory=$('.element[data-id="'+v.pid+'"]').attr('data-category'),caption_height=(gallerycategory=="ON")?'style="height:150px;"':'style="height:200px;"',gsettings=(typeof v.gsettings=="undefined")?new Object():$.parseJSON(v.gsettings);var glink=(gsettings&&typeof gsettings['glink']!="undefined"&&gsettings['glink'])?gsettings['glink']:'',glink_target=(gsettings&&typeof gsettings['glink_target']!="undefined"&&gsettings['glink_target']=='_blank')?'_blank':'',img_path=(gsettings&&typeof gsettings['storage']!='undefined')?gsettings['storage']:RESOURCE+"/"+SID+"/",img_original=(gsettings&&typeof gsettings['storage']!='undefined')?img_path+'1920/':img_path;file_path=img_path+'600/'+file;file_path=(v.image)?file_path:'//i.addblock.net/image_upload.png';$img.find('.gallery-item-link-icon').attr({'data-glink':glink,'data-glink-target':glink_target,'data-glseq':v.seq});$img.append("<img src='"+file_path+"' class='gallery-item-image img-responsive'>");str='\
            <div class="form-group">\
                <input type="text" class="form-control gallery-item-title" placeholder="'+$.lang[LANG]['config.gallery.title']+'" value="'+v.title+'">\
            </div>\
            <div class="form-group">\
                <textarea class="form-control gallery-item-caption" placeholder="'+$.lang[LANG]['config.gallery.caption']+'" '+caption_height+'>'+v.caption+'</textarea>\
                <span class="tip" style="color:#4789E7;">'+info_enable+'</span>\
            </div>\
            ';if(gallerycategory=="ON")str=str+galleryCategoryCheckList(v.pid,v.category);str=str+'\
            <div class="form-group hide">\
                <div class="input-group date datetimepicker">\
                    <input type="text" class="form-control gallery-item-datetime" placeholder="date" value="'+v.datetime+'">\
                    <div class="input-group-addon"><i class="fa fa-calendar"></i>  &nbsp;&nbsp;<b>'+$.lang[LANG]['config.date']+'</b></div>\
                </div>\
            </div>\
            <div class="form-group hide">\
                <label>'+$.lang[LANG]['config.gallery.hashtag']+'</label>\
                <input type="text" class="form-control gallery-item-hashtag" placeholder="'+$.lang[LANG]['config.gallery.hashtag']+'" value="'+v.hashtag+'">\
            </div>\
            ';$content.append(str);$wrap.append('\
            <div class="modal-header">\
                <button type="button" class="close galleryControllerClose"><span aria-hidden="true"><img src="//i.addblock.net/fa-close-modal.png" alt="close" /></span></button>\
                <h3>'+$.lang[LANG]['config.gallery.type.project.config.title']+'</h3>\
            </div>\
            ');$wrap.append($img).append($content);$wrap.append('\
            <div class="clear">\
                <div class="pull-right" style="padding-top:10px; padding-bottom: 30px;"><span class="btn btn-default btn-sm galleryControllerClose">'+$.lang[LANG]['config.close']+'</span> &nbsp;&nbsp;&nbsp;<span class="btn btn-primary btn-sm galleryItemSave" data-seq="'+seq+'" data-idx="'+(data.pos-1)+'">'+$.lang[LANG]['config.save']+'</span></div>\
            </div>\
            ');$modal.append($wrap);$modal_bg.appendTo($('.dsgn-body')).hide().fadeIn(500);$modal.appendTo($('.dsgn-body')).hide().fadeIn(500);$('.datetimepicker').datetimepicker({format:'YYYY-MM-DD HH:mm'});});}}
$('.galleryControllerClose').live('click',function(){galleryControllerClose();});var galleryControllerClose=function(){$('.galleryController').fadeOut(500,function(){$(this).remove();});$('.modal-background').fadeOut(500,function(){$(this).remove();});}
var getTitleCaption=function(idx){var $el=$('.'+selectEL),$nodes=$el.find('[data-loop="true"]').children(),item=$nodes[idx],title=$(item).find("h5.figure").text(),caption=$(item).find("p.figure").text(),datetime=$(item).find(".figure.datetime").text(),hashtag=$(item).find(".figure.hashtag").text(),img=$(item).find("a img").attr('src'),pid=($el.attr('data-id'))?$el.attr('data-id'):selectID;var data={"idx":idx,"title":title,"caption":caption,"datetime":datetime,"hashtag":hashtag,"img":img,"pid":pid,}
if(idx==-1){var data={"idx":'-1',"title":'',"caption":'',"datetime":moment().format('YYYY-MM-DD hh:mm'),"hashtag":'',"img":'',"pid":pid,}}return data;}
$('.galleryItemSave').live('click',function(){var title=$('.gallery-item-title').val(),caption=$('.gallery-item-caption').val(),datetime=$('.gallery-item-datetime').val(),hashtag=$('.gallery-item-hashtag').val(),category='|'+$('.gallery-item-category').text().replace(/, /g,'|,|')+'|',idx=$(this).attr('data-idx'),width=$('.'+selectEL).attr('data-width'),path=(width)?RPATH+width+'/':PATH,thumb=$('.gallery-item-image').attr('src');var pathinfo=thumb.split('/');if(title.trim().length==0){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.gallery.title.input'],true,false,'','ok');return false;}var seq=$(this).attr('data-seq'),file=$('.gallery-item-image').prop('src').replace(/^.*[\\\/]/,'');if(moment(datetime).isValid()===false){$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.gallery.datetime.error'],true,false,'','ok');$('.gallery-item-datetime').focus();return false;}if(file=='image_upload.png'){alert('Please image select');return;}var $gitem=$('.'+selectEL).find('.gallery-item[data-seq="'+seq+'"]'),$citem=$('.image-wrap[data-glseq="'+seq+'"]');$gitem.find('[data-gallery]').attr('title',title);if(title.length>0){$citem.find('.image-title').text(title).removeClass('none');}else{$citem.find('.image-title').text($.lang[LANG]['config.click-to-text']).addClass('none');}if(myStorageActive()&&pathinfo[4]!='free'){$gitem.find('img').attr('src',path+file);if($('.'+selectEL).attr('data-mode')=='gallery'){$gitem.find('a[data-gallery="#gframe-'+selectID+'"]').attr('href',RPATH+file);}$citem.find('.galleryItemEdit').attr('src',RPATH+'60/'+file);var type=getElementType();if(idx=='-1'){$.post('/template/gallery/add/sid/'+SID+'/spage/'+PAGE,{s:file,pid:selectID,title:title,caption:caption,datetime:datetime,hashtag:hashtag,category:category,storage:'false'},function(data){showPageCallback(showPage);setLogs(type,"gallery.data.add","add",type);},'json');}else{$.post('/template/update/type/gallery',{s:seq,id:SID,title:title,caption:caption,datetime:datetime,hashtag:hashtag,category:category,file:file,storage:'false'},function(data){var isCheck=checkError(data);if(!isCheck)return false;setLogs(type,"gallery.data.edit","modify",type);},'json');}}else{var val=file.split('.');$.processON('Image upload to storage...');var frUpload=frStorageUpload(val[0],width);frUpload.then(function(data){$gitem.find('img').attr('src',data.image);if($('.'+selectEL).attr('data-mode')=='gallery'){$gitem.find('a[data-gallery="#gframe-'+selectID+'"]').attr('href',data.path+'1920/'+data.f);}$citem.find('.galleryItemEdit').attr('src',data.thumb);var type=getElementType();if(idx=='-1'){$.post('/template/gallery/add/sid/'+SID+'/spage/'+PAGE,{s:file,pid:selectID,title:title,caption:caption,datetime:datetime,hashtag:hashtag,category:category,storage:data.path},function(data){showPageCallback(showPage);setLogs(type,"gallery.data.add","add",type);},'json');}else{$.post('/template/update/type/gallery',{s:seq,id:SID,title:title,caption:caption,datetime:datetime,hashtag:hashtag,category:category,file:file,storage:data.path},function(data){var isCheck=checkError(data);if(!isCheck)return false;setLogs(type,"gallery.data.edit","modify",type);},'json');}});}caption=caption.replace(/\n/g,"<br />");(title.length>0)?$gitem.find('h5.figure').text(title):$gitem.find('h5.figure').text('Title');(caption.length>0)?$gitem.find('p.figure').html(caption):$gitem.find('p.figure').text('You can change this text');$gitem.find('.figure.datetime').text(datetime);$gitem.find('.figure.hashtag').text(hashtag);ieLineClamp();galleryControllerClose();});$('.gallery-item-image').live('click',function(){$('.resource-useit').attr('data-property','gallery-item-image').attr('data-element','').attr('data-replace-count',1);selectCount=1;$('#el-fileupload').modal('show');});$('.gallery-item-image-icon').live('click',function(){$('.resource-useit').attr('data-property','gallery-item-image').attr('data-element','').attr('data-replace-count',1);selectCount=1;$('#el-fileupload').modal('show');});var myStorageActive=function(){return($('#mystorage').hasClass('active'))?true:false;}
var galleryItemImageChange=function(files){if(myStorageActive()){var file_path=RPATH+'600/'+files;$('.gallery-item-image').attr('src',file_path);}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(files,600);frUpload.then(function(data){$('.gallery-item-image').attr('src',data.image);});}$('.upload-image.gallery-item-image').remove();}
$('.gallery-add').live('click',function(){$('.resource-useit').removeAttr('data-property').removeAttr('data-element').attr('data-replace-count','0');selectCount=0;});$('.config-element').live('click',function(e){if($(this).hasClass('disabled'))return false;X=e.pageX;Y=e.pageY+25;$('.'+selectEL).addClass('el-active').siblings().removeClass('el-active');if(isEDIT==true)saveContentedit();var elController=$('#el-property');if(elController.css('display')=='block'){elController.hide();$('.'+selectEL).removeClass('el-active');return false;}showConfigPanel();});$('.ctrl-font-family-el').live('click',function(){$(this).addClass('active').siblings().removeClass('active');var font_family=$(this).attr('data-font-family').trim(),el=$(this).data('elname');$(this).parents('.btn-group').find('.ctrl-font-family-el-active').text(font_family).css('font-family',font_family);ctrlElementStyleUpdate(el,'font-family',font_family);ctrlElementTplStyleUpdate(el,'font-family',font_family);var type=getElementType(),log=($(this).parents('.btn-group').parent().hasClass('gallery-category-font'))?'.gallerycategory':'';setLogs(type,"font.family.change"+log,"font-change",type);});$('.edit-font-family-el div').live('click',function(){$(this).addClass('active').siblings().removeClass('active');var val=$(this).attr('value').trim();val=val.replace(/ /g,'-');setFontFamily(val);});$('.ctrl-text-align-el').live('click',function(){$(this).addClass('active').siblings().removeClass('active');var el=$(this).data('elname'),org_align=$(el).css('text-align'),text_align=$(this).attr('data-text-align').trim(),change_str='<img class="fa" src="//i.addblock.net/icon-align-'+text_align+'.gif" alt="gallery category align '+text_align+'" />';if(org_align==text_align)return;ctrlElementStyleUpdate(el,'text-align',text_align);ctrlElementTplStyleUpdate(el,'text-align',text_align);var type=getElementType(),log=($(this).parents('.btn-group').parent().hasClass('gallery-category-align'))?'.gallerycategory':'',icon='-'+text_align;setLogs(type,"text.align.change"+log,"text-align"+icon,type);});$('.gc-option.gallery-category-color .ctrl-gc-color').live({click:function(){$(this).closest('.now-color-palette').toggleClass('open');}});$('.gc-option.gallery-category-color .now-color-palette .ctrl-gc-color[data-type="custom"]').live({click:function(){$(this).closest('.btn-color-mode').addClass('active').siblings().removeClass('active');}});$('.gc-option.gallery-category-color .ctrl-gc-color:not([data-type="custom"])').live({click:function(){$(this).closest('.btn-color-mode').addClass('active').siblings().removeClass('active');$('.now-color-palette').removeClass('open');var color_type=$(this).attr('data-type'),el=$(this).attr('data-elname'),el_css=$('#'+selectEL+'css'),el_css_j=CSSJSON.toJSON(el_css.text()),search_str='.'+el+' .gallery-category-nav li:not(.active) a, .'+el+' .gallery-category-nav li:not(.active):before',search_str_a='.'+el+' .gallery-category-nav li.active a, .'+el+' .gallery-category-nav li a:hover, .'+el+' .gallery-category-nav li a:focus, .'+el+' .gallery-category-nav li.active:after',el_css_reset=false;$.each(el_css_j["children"],function(i,v){if(i.indexOf(search_str)>-1||i.indexOf(search_str_a)>-1){el_css_reset=true;delete el_css_j["children"][i];}});if(el_css_reset){el_css.text(CSSJSON.toCSS(el_css_j));var css=$('#'+selectEL+'css').text();$.post('/template/update/type/el-css',{id:SID,s:css,seq:selectID},function(data){var isCheck=checkError(data);if(!isCheck)return false;},'json');}if($('.'+el).find('.gallery-category-nav').attr('data-category-color')!=color_type){var settings={category_color_type:color_type};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){var isCheck=checkError(data);if(!isCheck)return false;$('.'+el).find('.gallery-category-nav').attr('data-category-color',color_type);},'json');}}});var editGalleryItem=function(idx){var folder=$('.'+selectEL).attr('data-width'),ig=$('.'+selectEL).attr('data-type');if(idx==-1&&ig!='gallery'){alert('undefined attach index!');return false;}$('.resource-useit').attr('data-property','image-change').attr('data-element',selectEL).attr('data-idx',idx).attr('data-replace-count',1);selectCount=1;if(ig=='gallery'){galleryController(idx);}else $('#el-fileupload').modal('show');}
$('.galleryItemEdit').live('click',function(e){var seq=$(this).attr('data-seq');seq=(typeof seq=='undefined')?-1:seq;editConfigPanelGalleryItem(seq);});var editConfigPanelGalleryItem=function(seq){var ig=$('.'+selectEL).attr('data-type');if(seq==-1&&ig!='gallery'){alert('undefined attach index!');return false;}$('.resource-useit').attr('data-property','image-change').attr('data-element',selectEL).attr('data-seq',seq).attr('data-replace-count',1);selectCount=1;if(ig=='gallery'){galleryItemController(seq);}else $('#el-fileupload').modal('show');}
$('.scroll-next').live('click',function(){var next='el_'+$(this).parents('.element').attr('data-pos');activeEL(next);});var checkError=function(data){if(typeof data.error!="undefined"&&data.error){if(data.error=="No user data"){internalLink=true;setTimeout(function(){hideAllModal();var modal=$(this).showModalFlat('<img src="//i.addblock.net/modal-logo-dark.png" alt="creaotrlink logo"/>',loginForm(),true,true,function(){},'cancel','w450');$('.flat-modal .modal-footer').hide();$('#flat-modal .modal-dialog .modal-body').css('margin','55px 45px 35px');$('#flat-modal').css('z-index','1041');$('.flat-modal').next('.modal-backdrop').css('z-index','1040');},500);}return false;}else{internalLink=false;return true;}}
var loginForm=function(){var str='\
    <div class="form-group re-login">\
        <input type="text" id="re_mb_id" name="mb_id" class="form-control" placeholder="Email Address"/>\
        <input type="password" id="re_mb_password" name="mb_password" class="form-control" placeholder="Password" />\
        <div class="row">\
            <label class="remember col-md-6 col-sm-6 col-xs-6"><input type="checkbox"/> <span data-lang="page.member.login-modal.reId">Stay signed in</span></label>\
            <label class="forget col-md-6 col-sm-6 col-xs-6"><a href="/member/support/password_reset" data-lang="page.member.login-modal.password-reset">Forgot password?</a></label>\
        </div>\
    </div>\
    <div class="btn-wrap re">\
        <a href="javascript:;" class="btn btn-primary btn-lg btn-block btn-relogin" data-lang="config.modal.login">LOGIN</a>\
        <div class="hr-box"><hr/></div>\
        <a href="javascript:;" class="btn btn-lg btn-block btn-fblogin" onclick="FaceBookLoginAPI()" data-lang="config.modal.fblogin"><i class="fa fa-facebook"></i> FACEBOOK</a>\
    </div>\
    ';return str;}
$(document).on('click','.btn-relogin',function(e){var $mb_id=$('#re_mb_id'),$mb_password=$('#re_mb_password'),isSubmit=true;$('label.error').remove();if($mb_id.val().length==0){$mb_id.after('<label class="error">'+$.lang[LANG]['config.enter-id']+'</label>').focus();isSubmit=false;}if($mb_password.val().length==0){$mb_password.after('<label class="error">! '+$.lang[LANG]['config.enter-password']+'</label>').focus();isSubmit=false;}else if($mb_password.val().length<4){$mb_password.after('<label class="error">'+$.lang[LANG]['config.pass-min-length']+'</label>').focus();isSubmit=false;}if(isSubmit){$.post('/member/login/outlogin',{mb_id:$mb_id.val(),mb_password:hex_md5($mb_password.val()),sid:SID},function(data){if(typeof data.error!="undefined"&&data.error){$('.re-login').before("<label class='error text-center'>"+data.error+"</label>");return false;}else{isEDIT=true;saveContentedit();hideAllModal();}},'json');}});function setFontSize(size){var randomCssClass="rangyTemp_"+(+new Date());var classApplier=rangy.createCssClassApplier(randomCssClass,true);classApplier.applyToSelection();$("."+randomCssClass).removeClass(function(){var r='',classes=$(this).attr('class').split(' ');for(var i=0;i<classes.length;i++){if(/fsize\d{1,2}$/.test(classes[i]))r+=classes[i]+' ';}return r;});$("."+randomCssClass).removeClass(randomCssClass).addClass("fsize"+size);}function setFontFamily(ff){var randomCssClass="rangyTemp_"+(+new Date());var classApplier=rangy.createCssClassApplier(randomCssClass,true);classApplier.applyToSelection();$("."+randomCssClass).removeClass(function(){var r='',classes=$(this).attr('class').split(' ');for(var i=0;i<classes.length;i++){if(/ffamily.+/.test(classes[i]))r+=classes[i]+' ';}return r;});$("."+randomCssClass).removeClass(randomCssClass).addClass('ffamily'+ff);}function setFontColor(hex){var sel=rangy.getSelection();var randomCssClass="rangyTemp_"+(+new Date());var classApplier=rangy.createCssClassApplier(randomCssClass,true);classApplier.applyToSelection();$("."+randomCssClass).css({"color":hex}).removeClass(randomCssClass).addClass("fcolor");}var addSelectBlock=function(idx,block,callback){$('.addEL-wrap').remove();if(VIEW&&COUNT==0)selectEL='el-menu';var tag=htmlspecialchars_decode(block.eltag),$next=$('.addel_'+(idx-1)+'.active');if($next.length==0){$next=$('.el_'+(idx-1));}selectedEL=selectEL;var $style_tag=$('<style type="text/css"></style>');$style_tag.attr('id',"el_"+idx+"css");$style_tag.html(htmlspecialchars_decode(block.elcss));selectedEL=(selectEL=='el-menu')?"el_1":selectEL;($('#'+selectedEL+'css').length)?$('#'+selectedEL+'css').before($style_tag):$('.dsgn-body').prepend($style_tag);if(block.type=='gallery'){tag=appendGalleryFrame($(tag),block.seq,block.elsettings);}$tag=$(tag);msny=(block.feature=='masonry')?true:false;$tag.addClass('el_'+idx).attr('data-id',block.seq).attr('data-el','el_'+idx).attr('data-pos',idx+1).attr('data-name',block.elname).attr('data-msny',msny).attr('data-type',block.type).attr('data-type2',block.type2).attr('data-width',block.folder).attr('data-overlap',block.overlap).attr('data-link',block.linkto);if(block.type=='gallery'){$tag.find('[data-loop="true"] a').addClass('emptyGalleryItem').removeAttr('data-gallery').find('img').attr('data-index',0);}$tag.find('[data-map="true"]').attr('id','map-'+block.seq);$tag.addClass('element');var map_url=$tag.find('[data-map="true"]').attr('data-url');if(block.orgpos==1)$tag.addClass('link-to-'+block.orgpage);var $cog=$('<div class="el_'+idx+'_ctrl config-element-section" data-id="'+block.seq+'"><div class="config-element"><img src="//i.addblock.net/icon/fa_config_icon.png"></div></div>');$next.after($tag);$next.after($cog);if(typeof map_url!='undefined'){map_style=$tag.find('[data-map="true"]').attr('data-style')
loadmap(map_url,'map-'+block.seq,map_style);}if(block.eljs){var js_string=block.eljs;var $script_tag=$('<script type="text/javascript"></script>');$script_tag.html(js_string);$('.dsgn-body').append($script_tag);}if(typeof callback=='function'){callback();}if(VIEW&&COUNT==1){$('.default_project_contents').remove();}$('.addElementButton').remove();}
var scrollspy=function(){if(!ONE)return false;var top=0,active='';if($('.dsgn-body').hasClass('sidebar')){top=($('.editor-navbar').css('display')=='none')?0:35;}else{top=($('.editor-navbar').css('display')=='none')?$('header.navbar').height():$('header.navbar').height()+35;}$.each(MENULINK,function(i,v){var $el=$('.link-to-'+v);if($el.length>0){var offset=$el.offset();if(Math.floor(offset.top)<=top)active=v;}});$('#tpl-menu li').removeClass('active');$('#tpl-menu > li > a[href="#'+active+'"]').parent().addClass('active');if($('.dsgn-body').scrollTop()+$('.dsgn-body').height()==$('.dsgn-body').prop('scrollHeight')){var last=MENULINK[MENULINK.length-1],$el=$('.link-to-'+last);if($el.length>0){if($el.offset().top>top){$('#tpl-menu li').removeClass('active');$('#tpl-menu > li > a[href="#'+last+'"]').parent().addClass('active');}}}}
var parallax=function(){$('.element[data-parallax="true"]').each(function(){var yPos=-($(this).offset().top-$('.dsgn-body').scrollTop());yPos=(yPos/100);coords='50% '+yPos+'px';if(isMobile())$(this).css('background-attachment','fixed !important');else
$(this).css('background-attachment','fixed');$(this).css('background-position',coords);$(this).css('background-size','cover !important');$(this).css('background-repeat','no-repeat');$(this).css('-ms-transform','translate(0,0)');$(this).css('-moz-transform','translate(0,0)');$(this).css('-webkit-transform','translate(0,0)');$(this).css('-o-transform','translate(0,0)');$(this).css('transform','translate(0,0)');});}
$('.addEL-wrap').live('mouseenter',function(){selectID='';});$('.emptyGallery').live('click',function(e){});$('.emptyGalleryItem').live('click',function(e){e.preventDefault();chooseGalleryType();});var chooseGalleryType=function(){if($('.reorderModal').length)return;var title=$.lang[LANG]['config.gallery.type.choose'],galleryTypeInfoTop=$.lang[LANG]['config.gallery.type.info.top'],galleryTypeInfoBottom=$.lang[LANG]['config.gallery.type.info.bottom'],galleryImageType=$.lang[LANG]['config.gallery.type.gallery'],galleryProjectType=$.lang[LANG]['config.gallery.type.project'],galleryImageTypeInfo=$.lang[LANG]['config.gallery.type.gallery.info'],galleryProjectTypeInfo=$.lang[LANG]['config.gallery.type.project.info'],content='<div class="modal-caption">'+galleryTypeInfoTop+'<br>'+galleryTypeInfoBottom+'</div>'+'<ul class="choose-gallery-type">'+'<li data-gallery-type="gallery"><div><i class="fa fa-check-circle"></i></div><div class="info"><b>'+galleryImageType+'</b><br>'+galleryImageTypeInfo+'</div><div class="gallery-type-image"><img src="//i.addblock.net/config/img-type-gallery.png"></div></li>'+'<li data-gallery-type="project"><div><i class="fa fa-check-circle"></i></div><div class="info"><b>'+galleryProjectType+'</b><br>'+galleryProjectTypeInfo+'</div><div class="gallery-type-image"><img src="//i.addblock.net/config/img-type-project.png"></div></li>'+'</ul>';var modal=$(this).showModal(title,content,false,false);}
$('.choose-gallery-type li').live('click',function(e){var type=$(this).attr('data-gallery-type');$.post('/template/gallery/mode',{pid:selectID,mode:type},function(data){checkError(data);if(type=='project'){$('.comment-config').show();}},"json");$('#generic-modal').modal('hide');$('.resource-useit').removeAttr('data-property').removeAttr('data-element').attr('data-replace-count','0');selectCount=0;setTimeout(function(){$('#el-fileupload').modal('show');if(type=='project'){var noticemodal=$(this).showModalFlat($.lang[LANG]['config.gallery.type.project.upload.title'],$.lang[LANG]['config.gallery.type.project.upload'],true,false,'','ok','w385').addClass('project-notice-modal').closest('.flat-modal').removeClass('flat-modal').addClass('pn-modal').find('.modal-dialog.w385').css('padding-top','15%').find('[data-dismiss]').attr('data-backdrop','false');}},700);});var getContnetsAlign=function(align,attr){var id=0;align=(typeof align=="undefined")?"":align;switch(align){case"left":id=contents_left[attr];break;case"right":id=contents_right[attr];break;default:id=contents[attr];break;}return id;}
var duplicate=function(id){if($('.ctrl-copypaste').hasClass('disabled'))return false;if(typeof id=="undefined"){alert('Invalid block ID');return;}$('#el-property').hide();selectElement(id,true);}
var callChangeImageSize=function(size){var idx=$('#el-property').find('.attach-folder-update.__matrix').attr('data-idx');switch(size){case 1920:changeImageSize(idx,1920);break;case 800:changeImageSize(idx,800);break;case 700:changeImageSize(idx,700);break;case 670:changeImageSize(idx,670);break;case 650:changeImageSize(idx,650);break;case 600:changeImageSize(idx,600);break;case 0:default:changeImageSize(idx);break;}}
var changeImageSize=function(idx,folder){folder=(typeof folder=="undefined")?"":folder;if(typeof idx=="undefined"){alert('Undefined image index');return false;}var imgAttach=$('.'+selectEL).find('[data-attach="true"]')[idx],folderRegExp=/(\/600\/|\/650\/|\/670\/|\/700\/|\/800\/|\/1920\/)/,imgSrc=$(imgAttach).attr('src'),folderMatch=imgSrc.match(folderRegExp);$(imgAttach).attr('data-width',folder);var imgFolder=(folderMatch===null)?"":folderMatch[0].replace(/\//g,"");var imgFilename=pathinfo(imgSrc,'PATHINFO_BASENAME'),folderNfilename=(folder)?"/"+folder+"/"+imgFilename:"/"+imgFilename,oldfolderNfilename=(imgFolder)?"/"+imgFolder+"/"+imgFilename:"/"+imgFilename;var storage=$(imgAttach).attr('data-storage'),img_val=$(imgAttach).attr('data-img-val'),isStorage=(typeof storage=='undefined')?false:true;if(isStorage){$.processON('Image upload to storage...');var photo_id=$(imgAttach).attr('data-photo-id');photo_id=(typeof photo_id=="undefined")?"":photo_id;var frUpload=frStorageUpload(img_val,folder,photo_id);frUpload.then(function(data){$(imgAttach).attr('src',data.image);saveContentElement();});}else{var replace=imgSrc.replace(oldfolderNfilename,folderNfilename);$(imgAttach).attr('src',replace);$(imgAttach).removeAttr('data-storage').removeAttr('data-photo-id').removeAttr('data-img-val');saveContentElement();}var type=getElementType();if(typeof folder=="undefined"||!folder)folder=0;setLogs(type,"image.size."+folder,"resize",type);}
$('.dropdown-menu.prop-image-size li').live('click',function(e){$(this).addClass('active').siblings().removeClass('active');e.stopPropagation();});$('.attach-folder-update').live('click',function(e){var i=$(this).attr('data-idx'),imgAttach=$('.'+selectEL).find('[data-attach="true"]')[i],folderRegExp=/(\/600\/|\/650\/|\/670\/|\/700\/|\/800\/|\/1920\/)/,imgSrc=$(imgAttach).attr('src'),folderMatch=imgSrc.match(folderRegExp),imgFolder=(folderMatch===null)?"":folderMatch[0].replace(/\//g,"");$(this).parent().find('.dropdown-menu.prop-image-size li').removeClass('active');$(this).parent().find('.dropdown-menu.prop-image-size li[data-folder="'+imgFolder+'"]').addClass('active');});$('.prop-image-display').live('click',function(){var i=$(this).data('idx'),imgAttach=$('.'+selectEL).find('[data-attach="true"]')[i];var icon=$(imgAttach).hasClass('hide')?"fa-eye-slash":"fa-eye";$(this).removeClass('fa-eye').removeClass('fa-eye-slash').addClass(icon);if($(this).hasClass('fa-eye')){$(this).removeClass('fa-eye').addClass('fa-eye-slash');$(imgAttach).addClass('hide');var ss=$('#'+selectEL+'css'),j=CSSJSON.toJSON(ss.text()),eid=$('.'+selectEL).attr('data-id'),selector=$('.'+selectEL).attr('data-name')
if($('.'+selectEL).css('padding-top').replace('px','')=='0'&&$('.'+selectEL).css('padding-bottom').replace('px','')=='0'){j=style.setCssProperty(j,'.'+selector,'padding-top','25px');j=style.setCssProperty(j,'.'+selector,'padding-bottom','25px');ss.text(CSSJSON.toCSS(j));$.post('/template/update/type/el-css',{id:SID,s:ss.text(),seq:eid},function(data){checkError(data);},'json');}}else{$(this).removeClass('fa-eye-slash').addClass('fa-eye');$(imgAttach).removeClass('hide');}saveContentElement();});var noPaddingColumnFixed=function(){var $items=$('.no-padding.gallery-item');if($items.length==0)return false;var heights=$items.map(function(){return $(this).height();}).get(),maxHeight=Math.max.apply(null,heights);$items.height(maxHeight);}
$('.data-page-prev').live('click',function(e){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.gallery.prev.next'],true,false,'','ok');return false;});$('.data-page-next').live('click',function(){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.gallery.prev.next'],true,false,'','ok');return false;});var getImageAlign=function(obj){var align=obj.css('float'),r='';switch(align){case"left":r=align;break;case"right":r=align;break;default:r='center';break;}return r;}
$('.prop-image-align').live('click',function(e){var i=$(this).attr('data-idx');var imgAlign=(typeof i=='undefined')?$('.'+selectEL).find('.image-wrap'):$('.'+selectEL).find('.image-wrap').eq(i);var align=getImageAlign(imgAlign);$(this).parent().find('li[data-image-align]').siblings().removeClass('active')
$(this).parent().find('li[data-image-align="'+align+'"]').addClass('active');});$('.dropdown-menu.prop-image-align li').live('click',function(e){$(this).addClass('active').siblings().removeClass('active');$(this).parents('.icons').find('i.prop-image-align').removeClass('fa-align-center').removeClass('fa-align-left').removeClass('fa-align-right').addClass('fa-align-'+$(this).attr('data-image-align'));e.stopPropagation();});var imageWrap=function(align,idx){var target=(typeof idx!='undefined'&&idx)?' .item:nth-child('+(Number(idx)+1)+') .image-wrap':' .image-wrap';var imgAlign=$('.'+selectEL).find(target),j=CSSJSON.toJSON($('#'+selectEL+'css').text()),selector="."+$('.'+selectEL).attr('data-name')+target;align=(align=='center')?"none":align;setElementStyleCss(j,selector,"float",align);var type=getElementType();setLogs(type,"image.align."+align,"image-align-"+align,type);}
$('.contact-title-edit').live('click',function(e){$('.contact-edit-input').val($('.contact-title.contact-title-edit').text());$('.contact-edit-text').show();});$('.contact-edit-cancel').live('click',function(e){$('.contact-edit-text').hide();});$('.contact-edit-save').live('click',function(e){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var email=$('.contact-edit-input').val().trim();if(!emailcheck(email)){alert($.lang[LANG]["page.contact.error.msg.email.2"]);return false;}var settings={contact_email:email}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings),el:selectID},function(data){checkError(data);$('.contact-title.contact-title-edit').text(email);$('.contact-edit-text').hide();},'json');});$('.site-edit-cancel').live('click',function(e){$('.site-edit-text').hide();});$('.site-title-edit').live('click',function(e){$('.site-edit-input').val(TITLE);$('.site-edit-text').show();});$('.site-edit-save').live('click',function(e){var title=$('.site-edit-input').val().trim(),prev=$('.site-title').text().trim();if(title.length==0){var modal=$(this).showModalFlat('INFORMATION',$.lang[LANG]['editor.sitename.input'],true,false,'','ok');$('.site-edit-input').focus();return;}$('.site-edit-text').hide();if(prev==title)return;$.post('/template/config/type/sname',{sid:SID,title:title},function(data){checkError(data);TITLE=data.sname;$('.site-title').text(stripslashes(TITLE));$('.site-edit-input').val(stripslashes(TITLE));$('title').text($.lang[LANG]['editor.title.prefix']+stripslashes(TITLE));setLogs("SITE","site.title.change","text-edit","SITE");},'json');});var ieLineClamp=function(){if(isIE()){$('*[data-ie-clamp]').each(function(index,element){var clamp=$(this).attr('data-ie-clamp').split(','),line=new Array();$.each(clamp,function(k,v){line.push(v);});for(i=line.length;i<3;i++)line[i]=0;var idx=getScreenIndex();var apply=line[idx];console.log("line = "+apply);$clamp(element,{clamp:apply,useNativeClamp:true});});}}
var getScreen=function(){var wid=window.innerWidth;var screen_size=0;if(0<wid&&wid<480){screen_size=320;}else if(wid<=480&&wid<768){screen_size=480;}else if(768<=wid&&wid<992){screen_size=768;}else if(992<=wid&&wid<1200){screen_size=992;}else if(wid>=1200){screen_size=1200;}return screen_size;}
var getScreenIndex=function(){var idx=0;switch(SCREEN){case 320:case 480:idx=2;break;case 769:idx=1;break;case 992:case 1200:idx=0;break;default:idx=0;break;}return idx;}
var setPanelTranslate=function(obj){if(LANG=='en')return;$.each(obj.find('[data-title]'),function(i,v){var el_title=$(this).attr('data-title'),arr=$.lang['en'];if($(this).parent().hasClass('gallery-item'))return true;key=getKeyByValue(arr,el_title);if(key)$(this).attr('data-title',$.lang[LANG][key]);});}
var displaySelectedFilesStr=function(){if($('.selected-files').children().length){$('.selected-files-count').text($('.selected-files').children().length);$('.resource-selected-str').show();}else{$('.resource-selected-str').hide();}}
$('header.navbar #tpl-menu > li.dropdown').live({mouseenter:function(e){$('.addel-menu').hide();},mousemove:function(e){if($('.addel-menu').css('display')!='none'){$('.addel-menu').hide();}}});$('.user-logs').live('click',function(){$('.user-logs').removeClass('active');var seq=$(this).attr('data-seq');if(!seq){var modal=$(this).showModalFlat('ERROR','Undefined history data-seq',true,false,'','ok');$('.user-logs').removeClass('active');return;}$.processON('Loading history...');$.ajax({type:'POST',url:'/template/history',data:{sid:SID,seq:seq},dataType:'json',async:true,success:function(data){checkError(data);SMENU=$.parseJSON(data.smenu);MTAG=$.parseJSON(data.tag);MCSS=$.parseJSON(data.css);MSTYLE=$.parseJSON(data.style);USTYLE=$.parseJSON(data.style);TITLE=data.title;var el=data.el,url=data.url;$('#nestable').empty().append(makeMenuList(SMENU));$.cookie('selectEL',el);location.replace(url);}});$(this).addClass('active');});var setLogs=function(type,action,icon,obj){$.post('/template/log',{sid:SID,page:PAGE,type:type,el:selectEL,action:action,icon:icon,obj:obj},function(data){if(typeof data.error!="undefined"&&data.error){return false;}addlogs(data);},'json');}
var addlogs=function(data){$('.history-dropdown li a').removeClass('active');var $li=$('<li>'),$log=$('<a>'),str=$.lang[LANG]["log."+data.action],obj=(typeof $.lang[LANG]['log.'+data.obj]=='undefined')?data.obj+" ":$.lang[LANG]['log.'+data.obj]+" ",obj=(data.type=='MENU'||data.type=='FOOT'||data.type=='BOOKMARK')?obj:"",logEL=(data.el)?data.el:"";logEL=logEL.replace("el_","");block=(data.obj=="ELEM")?"#"+logEL+" ":" ";if($('.history-dropdown').children().length>14){$('.history-dropdown li').last().remove();}$log.attr('href','#').attr('data-seq',data.seq).attr('data-toggle','tooltip').attr('data-placement','left').attr('title',data.date).addClass('user-logs').addClass('active').append("<i class='fa "+data.icon+"'></i> "+obj+str);$li.append($log);$('.history-dropdown').prepend($li);}
$('#site-music-use').live('click',function(e){var checked=$(this).prop('checked'),settings={musicUse:checked}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);},'json');});$('#site-right-click').live('click',function(){var checked=$(this).prop('checked');var settings={rightClick:checked}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);},'json');});$('#site-mobile-zoom').live('click',function(e){var checked=$(this).prop('checked');var settings={zoom:checked}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);},'json');});$('.site-popup-add, .site-popup-change').live({click:function(){var pn_mode=($(this).hasClass('site-popup-add'))?'add':'change',idx=(pn_mode=='add')?$('.popup-list').children().length:$(this).closest('li').attr('data-idx'),target=(typeof $(this).attr('el')!='undefined')?$(this).attr('el'):SID+'-popup-'+idx;$('.resource-useit').attr('data-property','popup-image-'+pn_mode).attr('data-replace-count',1).attr('data-element',target).attr('data-idx',idx);selectCount=1;$('#el-fileupload').modal('show');}});$('.popup-delete').live({click:function(){var idx=$(this).closest('li').index(),site_popup=(typeof SETTINGS.sitePopup!='undefined')?SETTINGS.sitePopup:new Array();if(site_popup)site_popup.splice(idx,1);var settings={'sitePopup':site_popup};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);$('.popup-list li[data-idx="'+idx+'"]').fadeOut().remove();SETTINGS.sitePopup=site_popup;popupItemAddInit(function(){sitePopupClose(idx,'delete');setTimeout(function(){sitePopupOpen(null,site_popup);},200);});},'json');setLogs("SITE","popup.image.delete","popup-delete","SITE");}});$('.popup-link').live({click:function(){var idx=$(this).closest('li').index(),popupEL=$('#'+SID+'Popup'+idx),plink=popupEL.attr('data-link'),is_plink_target=popupEL.attr('data-target'),str=sitePopupLinkEditConfig(idx,plink,is_plink_target),site_popup=SETTINGS.sitePopup;var modal=$(this).showModalFlat('SITE POPUP LINK',str,true,true,function(){var plink_type=$('.link-content.popup .active').children().attr('class'),attr_plink=(typeof plink!="undefined"&&plink!=""&&plink!="javascript:;")?true:false;if(plink_type=='link-out'){var plink_val=$('.link-content.popup .active').find('.plink').val(),plink_target=$('.link-content.popup .active').find('.plink-target').prop('checked'),regex=/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/,regex2=/^((http(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/;var error_str='';if(!plink_val){error_str='! '+$.lang[LANG]['editor.link.input.info'];}else if(plink_val!=''){if(plink_val.match("^(tel:|mailto:)")!==null){error_str='';attr_plink=true;}else if(!regex2.test(plink_val)){if(regex.test(plink_val)){error_str='';attr_plink=true;}else{error_str='!'+$.lang[LANG]['editor.menu.input-link.info'];}}}if(error_str.length>0){$('.error-msg').text(error_str).fadeIn().css('display','block').prev().focus();return false;}else{$('.error-msg').text('').fadeOut();site_popup[idx]['popuplink']=plink_val;site_popup[idx]['popuplink_target']=plink_target;}}else{attr_plink=false;site_popup[idx]['popuplink']='';site_popup[idx]['popuplink_target']='';}var settings={'sitePopup':site_popup};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);if(attr_plink){$('#'+SID+'Popup'+idx).attr({'data-link':plink_val,'data-target':plink_target});$('#'+SID+'Popup'+idx).find('a').attr({'href':(!plink_val.match("^(http://|https://|mailto:|tel:)")&&plink_val.substring(0,1)!='/')?'http://'+plink_val:plink_val,'target':(plink_target)?'_blank':''});}else{$('#'+SID+'Popup'+idx).removeAttr('data-link').removeAttr('data-target');$('#'+SID+'Popup'+idx).find('a').removeAttr('target').attr({'href':'javascript:;'});}sitePopupClose(idx,'cookie');},'json');modal.modal('hide');var log=(attr_plink)?'active':'broken';setLogs("SITE","popup.link."+log,"link-"+log,"SITE");sitePopupOpen();},'cancel','w450 site-popup-link');}});$('#site-popup-use').live({click:function(){var checked=$(this).prop('checked');var settings={showPopup:checked}
$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);if(checked){$('.popup-panel').show().removeAttr('style');sitePopupOpen();}else{$('.popup-panel').hide();sitePopupClose();}setLogs("SITE","popup."+checked,"toggle-"+checked,"SITE");},'json');}});$('.popup-refresh').live({click:function(){sitePopupClose();sitePopupOpen();}});$('.sitePopupTodayHide').live({click:function(){var selectedPopup=$(this).closest('.modal-popup').attr('id'),checked=($(this).prop('checked'))?true:false;if(checked)$('#'+selectedPopup).find('.popup-close').click();}});$('.popup-close').live({click:function(){var selectedPopup=$(this).closest('.modal-popup').attr('id'),idx=$(this).closest('.modal-popup').attr('data-idx'),ptime=$(this).closest('.modal-popup').attr('data-time'),isTodayHide=$(this).closest('.modal-popup').find('.sitePopupTodayHide').prop('checked'),date=new Date();var ptime_val={'always':0,'onlyone':365*24*60*60*1000,'week':7*24*60*60*1000,'day':24*60*60*1000,'12hours':12*60*60*1000,'6hours':6*60*60*1000,'2hours':2*60*60*1000,'1hours':60*60*1000,'30min':30*60*1000,'10min':10*60*1000};if(isTodayHide){date.setTime(date.getTime()+ptime_val['day']);}else{date.setTime(date.getTime()+ptime_val[ptime]);}$('#'+selectedPopup).fadeOut();if(isTodayHide||(typeof ptime!='undefined'&&ptime!='always'&&ptime!='')){$.cookie(selectedPopup,true,{path:'/',expires:date});}else{$.removeCookie(selectedPopup,{path:'/'});}}});var addPopupItem=function(idx,data,func){var $popup=$('.popup-list'),tpl="\
            <li data-idx='"+idx+"'>\
                <!--<div class='drag-handle'><i class='fa fa-arrows'></i></div>-->\
                <div class='popup-wrap'>\
                    <span class='attach-thumb site-popup-change' el='"+SID+"-popup-"+idx+"'>\
                        <img src='"+data.popupthumb+"' class='popupthumb' data-toggle='tooltip' data-placement='left' data-html='html' data-original-title='"+$.lang[LANG]['editor.popup.tooltip.image.click.change']+"'></span>\
                    </span>\
                    <span class='popup-title'>"+$.lang[LANG]['editor.popup.modal.'+idx]+"</span>\
                    <span class='pull-right popup-delete' data-toggle='tooltip' data-placement='top' data-original-title='"+$.lang[LANG]['editor.popup.tooltip.delete']+"'><i class='fa fa-trash-o'></i></span>\
                    <span class='pull-right popup-time' data-toggle='tooltip' data-placement='top' data-original-title='"+$.lang[LANG]['editor.popup.tooltip.ptime']+"'>\
                        <i class='fa fa-hourglass-o dropdown-toggle' data-toggle='dropdown' data-idx='"+idx+"''></i>\
                        <ul class='dropdown-menu' role='menu'>\
                            <li class='active' data-ptime='always'><a href='javascript:;' onclick='sitePopupTime("+idx+",\"always\")'>"+$.lang[LANG]['editor.popup.ptime.always']+"</a></li>\
                            <li data-ptime='12hours'><a href='javascript:;' onclick='sitePopupTime("+idx+",\"12hours\")' >"+$.lang[LANG]['editor.popup.ptime.12hours']+"</a></li>\
                            <li data-ptime='6hours'><a href='javascript:;' onclick='sitePopupTime("+idx+",\"6hours\")' >"+$.lang[LANG]['editor.popup.ptime.6hours']+"</a></li>\
                            <li data-ptime='1hours'><a href='javascript:;' onclick='sitePopupTime("+idx+",\"1hours\")'>"+$.lang[LANG]['editor.popup.ptime.1hours']+"</a></li>\
                            <li data-ptime='30min'><a href='javascript:;' onclick='sitePopupTime("+idx+",\"30min\")'>"+$.lang[LANG]['editor.popup.ptime.30min']+"</a></li>\
                            <li data-ptime='10min'><a href='javascript:;' onclick='sitePopupTime("+idx+",\"10min\")'>"+$.lang[LANG]['editor.popup.ptime.10min']+"</a></li>\
                        </ul>\
                    </span>\
                    <span class='pull-right popup-link' data-toggle='tooltip' data-placement='top' data-original-title='"+$.lang[LANG]['editor.popup.tooltip.link']+"'><i class='fa fa-link'></i></span>\
                </div>\
            </li>\
        ";$popup.append(tpl);if(typeof func=='function')func();}
var popupItemAddInit=function(func){if($('.popup-list').children().length>2){$('.site-popup-add').hide();}else{$('.site-popup-add').show();}if(typeof func=='function')func();}
var popupItemImageChange=function(el,value,p,idx,pn_mode){var site_popup=(typeof SETTINGS.sitePopup=="undefined")?new Array():SETTINGS.sitePopup,new_popup={'popupimg':p+'/'+value,'popupthumb':p+'/60/'+value};if(myStorageActive()){if(pn_mode=='change'){site_popup[idx]=new_popup;}else{site_popup.push(new_popup);}var settings={'sitePopup':site_popup};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);SETTINGS.sitePopup=site_popup;if(pn_mode=='change'){$('.attach-thumb[el="'+el+'"]').find('.popupthumb').attr('src',new_popup.popupthumb);sitePopupClose();setTimeout(function(){sitePopupOpen(null,site_popup);},200);}else if(pn_mode=='add'){addPopupItem(idx,new_popup,function(){popupItemAddInit(function(){sitePopupClose();setTimeout(function(){sitePopupOpen(null,site_popup);},200);});});}},'json');}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(value,800);frUpload.then(function(data){new_popup={'popupimg':data.image,'popupthumb':data.thumb}
if(pn_mode=='change'){site_popup[idx]=new_popup;}else{site_popup.push(new_popup);}var settings={'sitePopup':site_popup};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);SETTINGS.sitePopup=site_popup;if(pn_mode=='change'){$('.attach-thumb[el="'+el+'"]').find('.popupthumb').attr('src',new_popup.popupthumb);sitePopupClose();setTimeout(function(){sitePopupOpen(null,site_popup);},200);}else if(pn_mode=='add'){addPopupItem(idx,new_popup,function(){popupItemAddInit(function(){sitePopupClose();setTimeout(function(){sitePopupOpen(null,site_popup);},200);});});}},'json');});}setLogs("SITE","popup.image."+pn_mode,"popup-"+pn_mode,"SITE");}
var sitePopupLinkEditConfig=function(idx,plink,is_plink_target){var is_plink=(typeof plink=="undefined"||plink=="javascript:;"||plink.length==0)?false:true;var active=(!is_plink)?['active','']:['','active'],checked=(is_plink&&is_plink_target=='true')?'checked':'';if(!is_plink)plink='';var str='\
    <ul class="link-content popup">\
        <li class="link-type '+active[0]+'">\
            <div class="link-default">\
                <i class="fa fa-check-circle"></i>\
                <h5>'+$.lang[LANG]['editor.link.default.popup']+'</h5>\
            </div>\
        </li>\
        <li class="link-type '+active[1]+'">\
            <div class="link-out">\
                <i class="fa fa-check-circle"></i>\
                <h5>'+$.lang[LANG]['editor.link.out']+'</h5>\
                <div class="group-wrap">\
                    <div class="input-group">\
                        <input type="text" class="link-input form-control plink" placeholder="'+$.lang[LANG]['editor.link.input.info']+'" value="'+plink+'">\
                        <label for=".plink" class="error-msg"></label>\
                        <div class="checkbox">\
                            <label><input class="plink-target" type="checkbox" '+checked+'>'+$.lang[LANG]['editor.link.open.target']+'</label>\
                        </div>\
                    </div>\
                </div>\
            </div>\
        </li>\
    </ul>\
    ';return str;}
var sitePopupTime=function(idx,ptime){var site_popup=(typeof SETTINGS.sitePopup=="undefined")?new Array():SETTINGS.sitePopup;site_popup[idx]['popuptime']=ptime;sitePopupClose(idx,'cookie');$('#'+SID+'-popup-'+idx).next('.prop-popup-image-ctrl').find('#prop-popup-time ul li[data-ptime="'+ptime+'"]').addClass('active').siblings().removeClass('active');var settings={'sitePopup':site_popup};$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);sitePopupClose(idx,'cookie');sitePopupOpen(idx,site_popup);$('#'+SID+'Popup'+idx).attr('data-time',ptime);setLogs("SITE","popup.time","popup-time","SITE");},'json');}
var sitePopupClose=function(idx,fn){if(typeof idx!='undefined'){$.removeCookie(SID+'Popup'+idx,{path:'/'});if(fn=='cookie'){return false;}else if(fn=='delete'){$('#'+SID+'Popup'+idx).remove();$('.popup-list').children().each(function(i){if(i>=idx){$(this).attr('data-idx',i);$(this).find('.attach-thumb').attr({'el':SID+'-popup-'+i,'data-idx':i,'id':SID+'-popup-'+i});$(this).find('.popup-title').text($.lang[LANG]['editor.popup.modal.'+i]);$(this).find('.popup-time').each(function(){var ptime=$(this).attr('data-ptime');$(this).find('a').attr('onclick','sitePopupTime('+i+','+ptime+')');})
$.removeCookie(SID+'Popup'+i,{path:'/'});}});}else{$('#'+SID+'Popup'+idx).fadeOut();}}else{$('.popup-list').children().each(function(i){$.removeCookie(SID+'Popup'+i,{path:'/'});$('#'+SID+'Popup'+i).fadeOut();});}}
var sitePopupOpen=function(idx,data){var site_popup=(typeof data!='undefined'&data)?data:new Array();if(site_popup.length==0)site_popup=(typeof SETTINGS.sitePopup!='undefined'&&SETTINGS.sitePopup)?SETTINGS.sitePopup:site_popup;if(site_popup.length>0){var isShow=true;if(typeof idx!='undefined'){if($('#'+SID+'Popup'+idx).length==0)isShow=false;else $('#'+SID+'Popup'+idx).fadeIn();}else{if($('.popup .modal-popup').length>0){$('.popup .modal-popup').fadeIn();}else{isShow=false;}}if(!isShow){var modal=$(this).showPopupModal(site_popup);return modal;}}}
var sitePopupResize=function(){if($('.popup').find('.modal-popup').length==0)return false;$('.modal-popup').each(function(i){if($(this).css('display')!='none'){var popupEL=$('.modal-popup[data-idx="'+i+'"]'),b_w=$(this).closest('.popup-modal').width(),p_l=parseInt(popupEL.css('left').replace('px','')),p_m_l=i*parseInt(popupEL.css('margin-left').replace('px','')),p_w=popupEL.width();if(b_w<=p_l+p_m_l+p_w){if($(this).closest('.popup-modal').hasClass('popupimg-overflow-y')){fitOverflowPopup(i,p_m_l);}else{fitRefreshPopup();return false;}}}});function fitOverflowPopup(idx,margin){$('.modal-popup[data-idx="'+idx+'"]').css({'left':margin+'px'});$('.modal-popup[data-idx="'+idx+'"]').addClass('fit-popup fit-'+margin);}function fitRefreshPopup(){$('.modal-popup').each(function(idx){var margin=idx*30,p_t=parseInt($(this).css('top').replace('px',''))+margin;$('.modal-popup[data-idx="'+idx+'"]').css({'left':margin+'px','top':p_t+'px'});$('.modal-popup[data-idx="'+idx+'"]').addClass('fit-popup fit-'+margin);});}}
var setFocusEL=function(){if(typeof selectEL!="undefined"||selectEL)return;}
var releaseLink=function(menu){var isChild=false;menu=jQuery.parseJSON(menu);$.each(menu,function(i,obj){if(obj.link){if(obj.children!=''){$.each(obj.children,function(idx,child){isChild=(obj.link==child.name)?true:isChild;});if(MENULIST.indexOf(obj.link.replace(/ /g,'-'))>-1&&isChild==false)resetLink(obj.name);}else{if(obj.link=='folder-menu')resetLink(obj.name);if(MENULINK.indexOf(obj.link.replace(/ /g,'-'))>-1)resetLink(obj.name);}}});}
var resetLink=function(name){var $menu=$('.dd-item[data-id="'+name+'"]');$menu.find('.menu-link').first().attr({'attr-link':'','attr-ltarget':''}).removeClass('active');updateOutput($('#nestable').data('output',$('#nestable-output')));}
$('*[data-type="gallery"]').live({mouseenter:function(){if($(this).find('*[data-direffect="true"]').length==0){return false;}$(this).find('.grid').each(function(){$(this).hoverdir();});}});$('#el-list-image').live({mouseenter:function(){$('#el-list-image').scroll(function(){var listScroll=$('#el-list-image').scrollTop();if((this.scrollTop+this.clientHeight)>(this.scrollHeight-50)){if(!$('.theme-pagination').find('li.active').next().hasClass('white')){if($('#el-list-image').find('.listprogress').length==0){$('#el-list-image').append('<div class="listprogress" style="width: 100%; min-height: 40px; text-align:center; padding-top:10px;"><svg version="1.1" xmlns="http://www.w3.org/svg/2000" viewBox="0 0 30 30" width="60" style="width:20px; height: 20px;"><circle cy="15" cx="15" r="14" style="stroke:#00baff;"></circle></svg></div>');setTimeout(function(){$('#el-list-image .listprogress').remove();var $data=$('#el-list-image'),page=$data.attr('data-page'),type=$data.attr('data-type'),selector=$data.attr('data-selector'),id=$data.attr('data-id');elementGetPage(Number(page)+1,type,selector,id);},1000);}}}});}});$('#resource-files').live({mouseenter:function(){$('#resource-files').scroll(function(){var listScroll=$('#resource-files').scrollTop();if((this.scrollTop+this.clientHeight)>(this.scrollHeight-100)){if($('.resource-image').length==cTotal)return;if($('#resource-files').find('.listprogress').length==0){$('#resource-files').append('<div class="listprogress" style="width: 100%; min-height: 40px; text-align:center; padding-top:10px;"><svg version="1.1" xmlns="http://www.w3.org/svg/2000" viewBox="0 0 30 30" width="60" style="width:30px; height: 30px;"><circle cy="15" cx="15" r="14" style="stroke:#00baff;"></circle></svg></div>');cPage=cPage+1;resourceGetPage(cPage);}}});}});$('body').on('click','.config-window .save-bg-video-url',function(){var $this=$(this),el=$this.attr('data-el'),$el=$('.'+el),src=$('.bg-video-url').val().trim(),isGfy=false,isGfyPageUrl=false,gfyPattern=new RegExp("gfycat"),gfyPagePattern=new RegExp("detail\/.*")
gfyName='';isGfy=gfyPattern.test(src);if(isGfy){isGfyPageUrl=gfyPagePattern.test(src);if(isGfyPageUrl){var gfyUrlSubstring=gfyPagePattern.exec(src),slashIndex,questionIndex;slashIndex=gfyUrlSubstring[0].indexOf('\/')+1;questionIndex=gfyUrlSubstring[0].indexOf('\?');gfyName=gfyUrlSubstring[0].substring(slashIndex,questionIndex);}else{srcParts=src.split('/'),lastPartIndex=srcParts.length-1,gfyName=srcParts[lastPartIndex];}var gfyFetchUrl='https://gfycat.com/cajax/get/'+gfyName,isError=false;$.get(gfyFetchUrl,function(data){if(data.error){isError=true;$this.showModalFlat('INFORMATION',$.lang[LANG]['editor.bg-video.url.error'],true,false,'','ok');$('.bg-video-url').focus();return;}else
isGfy=true;var gfyItem=data.gfyItem,gfyData={'video':{'webm':gfyItem.webmUrl,'mp4':gfyItem.mp4Url,},'poster':{'normal':gfyItem.posterUrl,},},videoUrls=gfyData.video,posterUrls=gfyData.poster;for(type in videoUrls){$el.find('video source.'+type).attr('src',videoUrls[type]);}for(type in posterUrls){if(type=='normal'){$el.find('video').attr('data-poster-thumb',posterUrls[type]);$('.config-window .bg-video-poster-controller .prop-video-poster img').attr('src',posterUrls[type]);setVideoBackgroundImage(el,posterUrls[type]);}}},'json');}else{var isVideoFile=false;isVideoFile=src.match('mp4$|webm$');if(isVideoFile!=null){if(src.match('mp4$')!=null){type='mp4';}else if(src.match('webm$')!=null){type='webm';}$el.find('video source.'+type).attr('src',src);$el.find('video source.'+type).addClass('display');$el.find('video source.'+type).siblings().each(function(){$(this).attr('src','');$(this).removeClass('display');});}else{$(this).showModalFlat('Error',$.lang[LANG]['editor.bg-video.filetype.error'],true,false,'','ok');return false;}}if(!src){$this.showModalFlat('INFORMATION',$.lang[LANG]['editor.video.url'],true,false,'','ok');$('.bg-video-url').focus();return;}if(!src){$this.showModalFlat('INFORMATION',$.lang[LANG]['editor.video.url.error'],true,false,'','ok');return false;}if(!isError){var content='\
                <div class="save-bg-video-url-info"><p class="main-msg">'+$.lang[LANG]['editor.bg-video.url.saved-msg.1']+'</p><p class="main-msg">'+$.lang[LANG]['editor.bg-video.url.saved-msg.2']+'</p><p class="main-msg">'+$.lang[LANG]['editor.bg-video.url.saved-msg.3']+'</p><p class="more-msg">'+$.lang[LANG]['editor.bg-video.url.saved-msg.4']+'</p></div>';$(this).showModalFlat('INFORMATION',content,true,false,function(){saveContentElement(selectEL);var type=getElementType();setLogs(type,"video.change","video",type);showPageCallback(showPage);},'ok');}});$('#bg-video-poster-change').live({click:function(){selectCount=1;$('.resource-useit').attr('data-property','video-poster-change').attr('data-element',selectEL);$('#el-fileupload').modal('show');}});var videoPosterChange=function(element,files,p){var thumb=p+'/60/'+files,original=p+'/'+files;if(myStorageActive()){$('.prop-video-poster .attach-thumb img').attr('src',thumb);$('.'+element+' .video-wrap video').attr('data-poster-thumb',thumb);setVideoBackgroundImage(element,original);}else{$.processON('Image upload to storage...');var frUpload=frStorageUpload(files,1920);frUpload.then(function(data){$('.prop-video-poster .attach-thumb img').attr('src',data.thumb);$('.'+element+' .video-wrap video').attr('data-poster-thumb',data.thumb);setVideoBackgroundImage(element,data.image);});}saveContentElement(element);}
var setVideoBackgroundImage=function(element,img){var elname=$('.'+element).attr('data-name'),eid=$('.'+element).attr('data-id'),css=$('#'+element+'css').text(),j=CSSJSON.toJSON(css);j=style.setCssProperty(j,'.'+elname+' .video-wrap','background-image',"url( '"+img+"' )");r_css=CSSJSON.toCSS(j);$('#'+element+'css').text(r_css);$.post('/template/update/type/el-css',{id:SID,s:r_css,seq:eid},function(data){checkError(data);var type=getElementType();setLogs(type,"background.image.change","image-change",type);},'json');}
$('body').on('focus, mouseover','.config-window .bg-video .trigger',function(){$(this).next().addClass('in');$('#el-property').addClass('bg-video-info-show');});$('body').on('click','.bg-video-info, .bg-preview-image-info',function(e){e.stopPropagation();});$('body').on('click','.bg-video-info-show',function(){$('.bg-video-info').removeClass('in');$('.bg-preview-image-info').removeClass('in');});$('.gallery-item a[title]').live('mouseenter',function(){$(this).tooltip('destroy');});$('.gallery-item').live('click',function(e){$('.blueimp-gallery').addClass('blueimp-gallery-controls');$('.blueimp-gallery a.view-original').remove();if($(this).find('a').attr('data-img-original')=='ON'){$('.blueimp-gallery a.close').after('<a class="view-original" data-id="'+selectID+'"><img src="//i.addblock.net/icon/fa_gframe_vieworiginal.png" class="img-responsive"></a>');}$.cookie('gallery-item',$(this).attr('data-seq'),{path:'/'});e.stopPropagation();});$('body').on('click','.blueimp-gallery a.view-original',function(e){var idx=0,eid=$(this).attr('data-id');$('#gframe-'+eid+' .slide').each(function(i,v){var trans=$(v).attr('style');if(trans.indexOf('translate(0px, 0px)')>-1){idx=i;}});var src=$('#gframe-'+eid+' .slide[data-index="'+idx+'"] > img').attr('src');$('.blueimp-gallery a.view-original').attr('href',src).attr('target','_blank');e.stopPropagation();});$('.btn-default-language').live({click:function(){var str=getLanguagesSettingStr(SID,SETTINGS);var modal=$(this).showModalFlat('LANGUAGE SUPPORT',str,true,true,function(){var languages=$('#languages-support li').map(function(){if($(this).find('input[type="checkbox"]').attr('checked')=='checked')return $(this).find('input[type="checkbox"]').val();}).get();var settings={languages:languages};if(SETTINGS.languages==languages)return false;SETTINGS.languages=languages;$.post('/template/settings',{sid:SID,settings:JSON.stringify(settings)},function(data){checkError(data);setLanguageSettings(languages);modal.modal('hide');},'json');},'cancel');}});var getLanguagesSettingStr=function(sid,settings){var isLangs=(!settings.languages&&typeof settings.languages=="undefined")?false:true;var langs={'en':'checked','ko':(!isLangs||isLangs&&settings.languages.indexOf('ko')>0)?'checked':'','ja':(isLangs&&settings.languages.indexOf('ja')>0)?'checked':'','th':(isLangs&&settings.languages.indexOf('th')>0)?'checked':'','ar':(isLangs&&settings.languages.indexOf('ar')>0)?'checked':'','cr':(isLangs&&settings.languages.indexOf('cr')>0)?'checked':'','he':(isLangs&&settings.languages.indexOf('he')>0)?'checked':'','ch':(isLangs&&settings.languages.indexOf('ch')>0)?'checked':'','vi':(isLangs&&settings.languages.indexOf('vi')>0)?'checked':'',};var lang_arr=[];$.each(langs,function(i,v){if(v=='checked')lang_arr.push(i);});var str="\
        <div class='default-language-top'>"+$.lang[LANG]['editor.languages-support.info']+"</div>\
        <div class='default-language-box'>\
            <ul id='languages-support'>\
                <li class='default active'>\
                    <div class='checkbox checkbox-info checkbox-circle'>\
                        <input id='lang-en' type='checkbox' value='en' "+langs.en+" disabled>\
                        <label for='lang-en'>"+$.lang[LANG]['editor.languages-en']+"</label>\
                    </div>\
                </li>\
                <li class='active'>\
                    <div class='checkbox checkbox-info checkbox-circle'>\
                        <input id='lang-ko' type='checkbox' value='ko' "+langs.ko+">\
                        <label for='lang-ko'>"+$.lang[LANG]['editor.languages-ko']+"</label>\
                        <img src='//i.addblock.net/config/langs_ko.jpg' alt='' />\
                    </div>\
                </li>\
                <li class=''>\
                    <div class='checkbox'>\
                        <input id='lang-ja' type='checkbox' value='ja' "+langs.ja+">\
                        <label for='lang-ja'>"+$.lang[LANG]['editor.languages-ja']+"</label>\
                        <img src='//i.addblock.net/config/langs_ja.jpg' alt='' />\
                    </div>\
                </li>\
                <li class=''>\
                    <div class='checkbox'>\
                        <input id='lang-th' type='checkbox' value='th' "+langs.th+">\
                        <label for='lang-th'>"+$.lang[LANG]['editor.languages-th']+"</label>\
                        <img src='//i.addblock.net/config/langs_th.jpg' alt='' />\
                    </div>\
                </li>\
                <li class=''>\
                    <div class='checkbox'>\
                        <input id='lang-ar' type='checkbox' value='ar' "+langs.ar+">\
                        <label for='lang-ar'>"+$.lang[LANG]['editor.languages-ar']+"</label>\
                        <img src='//i.addblock.net/config/langs_ar.jpg' alt='' />\
                    </div>\
                </li>\
                <li class=''>\
                    <div class='checkbox checkbox-info checkbox-circle'>\
                        <input id='lang-cr' type='checkbox' value='cr' "+langs.cr+">\
                        <label for='lang-cr'>"+$.lang[LANG]['editor.languages-cr']+"</label>\
                        <img src='//i.addblock.net/config/langs_cr.jpg' alt='' />\
                    </div>\
                </li>\
                <li class=''>\
                    <div class='checkbox checkbox-info checkbox-circle'>\
                        <input id='lang-he' type='checkbox' value='he' "+langs.he+">\
                        <label for='lang-he'>"+$.lang[LANG]['editor.languages-he']+"</label>\
                        <img src='//i.addblock.net/config/langs_he.jpg' alt='' />\
                    </div>\
                </li>\
                <li class=''>\
                    <div class='checkbox checkbox-info checkbox-circle'>\
                        <input id='lang-ch' type='checkbox' value='ch' "+langs.ch+">\
                        <label for='lang-ch'>"+$.lang[LANG]['editor.languages-ch']+"</label>\
                        <img src='//i.addblock.net/config/langs_ch.jpg' alt='' />\
                    </div>\
                </li>\
                <li class=''>\
                    <div class='checkbox checkbox-info checkbox-circle'>\
                        <input id='lang-vi' type='checkbox' value='vi' "+langs.vi+">\
                        <label for='lang-vi'>"+$.lang[LANG]['editor.languages-vi']+"</label>\
                        <img src='//i.addblock.net/config/langs_vi.jpg' alt='' />\
                    </div>\
                </li>\
            </ul>\
        </div>\
    ";return str;}
var setLanguageSettings=function(languages){var prev_FONTS=FONTS;FONTS=[];for(i=0;i<languages.length;i++){var lang=eval('fonts_'+languages[i]);FONTS=arrayUnique(lang.concat(FONTS));}function arrayUnique(array){var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j])a.splice(j--,1);}}return a;}UFONTS=FONTS;$('#user-fonts').attr('href','/cssloader/font/'+SID+'/?_'+new Date().getTime());if(prev_FONTS!=FONTS){if($('#el-property .panel-collapse.in .sub div').find('.btn-default-language').length>0){var ctrl_el_name=(selectEL=="el-menu")?'menu-'+SID:$('.element.'+selectEL+'.active').attr('data-name'),ctrl_el_data_ctrl_id=$('#ctrl-accordion .panel[data-ctrl-id] .font-preview').closest('.panel').attr('data-ctrl-id');ctrl_el='.'+ctrl_el_name+' '+ctrl_el_data_ctrl_id,ctrl_font_name=$(ctrl_el).css('font-family').split(",");ctrl_font_name=ctrl_font_name[0].replace(/'/g,'').replace(/"/g,'').trim();if(!ctrl_font_name||ctrl_font_name=='initial'){var tmp=$('.dsgn-body').css('font-family').split(",");ctrl_font=tmp[0].replace(/'/g,'').replace(/"/g,'').trim();}$('#ctrl-accordion .panel[data-ctrl-id="'+ctrl_el_data_ctrl_id+'"]').find('.font-preview').parent('.btn-group').empty().append(style.selectFontSelectForm('ctrl-font-family-el',ctrl_font_name,ctrl_el));}$('.g-body .text-menu').addClass('hide');var fn=$('.dsgn-body').css('font-family').replace(/"/g,'');$('#site-font').find('.set-font > .btn-group').first().empty().append(style.selectFontSelectForm('font-family-body',fn));}}
var reorderBlock=function(id){var check=(ONE)?'false':'true';prevONE=ONE;prevPAGE=PAGE;if(check=='true'){if(!VIEW){$.processON('Loading blocks ...');$.ajax({type:'POST',url:'/template/update/type/onepage',data:{id:SID,s:check},dataType:'json',async:true,success:function(data){internalLink=true;ONE=(check=='true')?1:0;PAGE=data.menu;selectEL='';blockCallback(showPageCallback(showPage),function(){$.processOFF();$.reorderON();});}});}else $.reorderON();}else $.reorderON();}
var resetFolderInfo=function(count,size,ffolder,state){if(ffolder!='all'||ffolder=='all'&&state!='move'){var flc=$('#nestableFolder .fli[data-id="'+ffolder+'"]').find('.dd-flc').attr('attr-count'),fls=$('#nestableFolder .fli[data-id="'+ffolder+'"]').find('.dd-fls').attr('attr-size'),fls_u=$('#nestableFolder .fli[data-id="'+ffolder+'"]').find('.dd-fls').attr('attr-size-unit');fls=parseInt(fls);fls_v=(parseInt((fls+size)/1024)>0)?(fls+size)/1024:fls+size;fls_u=(parseInt((fls+size)/1024)>0)?"MB":"KB";$('#nestableFolder .fli[data-id="'+ffolder+'"]').find('.dd-flc').attr('attr-count',parseInt(flc)+count).text(parseInt(flc)+count);$('#nestableFolder .fli[data-id="'+ffolder+'"]').find('.dd-fls').attr({'attr-size':fls+size,'attr-size-unit':fls_u}).text(parseInt(fls_v));}}
var resetFileSelectedStr=function(){if($('.selected-files').children().length>0){$('.resource-useit').addClass('active');$('.resource-selected-str').show();$('.selected-files-count').text($('.selected-files').children().length);}else{$('.resource-useit').removeClass('active');$('.resource-selected-str').hide();$('.selected-files-count').text('0');}}
var resetFileSelectedFr=function(){if($('.fr-selected-files').children().length>0){$('.resource-useit').addClass('active');$('.resource-selected-str').show();$('.selected-files-count').text($('.selected-files').children().length);}else{$(".fr-selected-files").empty();$('.resource-useit').removeClass('active');$('.resource-selected-str').hide();$('.selected-files-count').text('0');}}
$('#resource-files').live('mousedown',function(e){if(event.shiftKey){$('.selected-files').children('li').each(function(){var s_file=$(this).attr('data-source'),s_file_seq=$(this).attr('data-seq'),s_file_size=$(this).attr('data-size');if($("#resource-files .ui-selected ul[data-source='"+s_file+"']").length==0){$("#resource-files ul[data-source='"+s_file+"']").closest('.fitem').find('.resource-image').addClass('ui-selected');}});}});$('.resource-image img').live('mousedown',function(e){if($(this).closest('.fitem').hasClass('ui-selected')){fileDrag=true;}if(e.ctrlKey||e.shiftKey){if($(this).closest('.fitem').hasClass('ui-selected')){$(this).closest('.fitem').removeClass('ui-selected');$('.selected-files').find('li[data-source="'+$(this).attr('alt')+'"]').remove();}if($('.selected-files').children().length!=$('#resource-files').children('.fitem').length){if($('#selectAll').prop('checked'))$('#selectAll').removeAttr('checked');}resetFileSelectedStr();}}).live('mouseup',function(){$('.fli').removeClass('drag-selected');fileDrag=false;}).live('mousemove',function(e){if(fileDrag){var classstr=($('.ui-selected').length>1)?'multiple':'';$('.resource-tooltip').fadeIn().addClass(classstr).find('img').attr('src',$('.selected-files').children().last().find('img').attr('src')).next('.count').text($('.selected-files').children().length);}}).live('dragstart',function(e){e.preventDefault();});$('.fli').live('mouseup',function(){if(fileDrag){$('li.fitem .resource-image').removeClass('ui-selected');$('.fli').removeClass('drag-selected');var prevffolder=[],fsize=[],targetffolder=$(this).attr('data-id'),fselected=$('.selected-files li').map(function(i,n){prevffolder.push($(this).attr('data-ffolder'));fsize.push(parseInt($(this).find('p.selected-file-size').text()));return $(this).find("p.selected-file-name").text();}).get();if(SID){var activeffolder=$('#nestableFolder').find('.fli.active').attr('data-id'),r_pages=Number($('.resource-paging .pagination').attr('data-pages')),r_page=Number($('.resource-paging .pagination li.active').text()),r_file_cnt=$('#resource-files li.fitem').length;$.post('/template/resource/update-fmove',{sid:SID,fselected:fselected,prevffolder:prevffolder,targetffolder:targetffolder},function(data){checkError(data);$.each(fselected,function(i,v){if(activeffolder[i]!=prevffolder){resetFolderInfo(-1,-fsize[i],prevffolder[i],'move');}resetFolderInfo(1,fsize[i],targetffolder,'move');});r_page=((r_file_cnt-fselected.length)==0&&r_pages<=r_page&&SFOLDER_ACTIVE)?r_page-1:r_page;r_page=1;resourceGetPage(r_page,SFOLDER_ACTIVE);updateOutputFolder($('#nestableFolder').data('output',$('#nestableFolder-output')));$('#resource-files').find('li.fitem .resource-image.ui-selected').removeClass('ui-selected');$(".selected-files").empty();resetFileSelectedStr();},'json');}}}).live('mouseenter',function(){$('.fli').removeClass('drag-selected');if(fileDrag){$(this).addClass('drag-selected');}}).live('mouseleave',function(){$('.fli').removeClass('drag-selected');});$('.resource-files-content').live('mouseup',function(){$('.resource-tooltip').fadeOut();fileDrag=false;});$('.music-delete').live('click',function(e){var $li=$(this).parents('li'),seq=$li.attr('data-seq');var modal=$(this).showModalFlat('DELETE',$.lang[LANG]['editor.music.delete.confirm'],true,true,function(){modal.modal('hide');$li.remove();updateMusicList();$.post('/template/music/delete',{seq:seq});});});$('.music-edit').live('click',function(e){var $li=$(this).parents('li'),title=$li.find('.music-title').text(),input='<div class="music-input-wrap">\
            <div class="input-group">\
              <input type="text" class="form-control input-sm input-music-title" value="'+title+'">\
              <span class="input-group-btn">\
                <button class="btn btn-primary btn-sm music-title-save" type="button">SAVE</button>\
              </span>\
            </div>\
        </div>';$('.music-input-wrap').remove();$li.append(input);});$('.music-title-save').live('click',function(e){var $li=$(this).parents('li'),seq=$li.attr('data-seq'),title=$li.find('.input-music-title').val();title=$.trim(title);if(typeof seq=="undefined"||seq==""){alert('Undefined music id');return false;}if(!title||title.length==0){alert('Please enter title');$('.input-music-title').focus();return false;}$('.music-input-wrap').remove();$li.find('.music-title').text(title);$.post('/template/music/title',{seq:seq,title:title});});var removeColpick=function(){$('.fr-toolbar.fr-inline').removeClass('always');$('button[data-cmd="text-color"]').removeClass('active').colpickHide();}
var addMusicItem=function(title,id,pos,func){var $music=$('.music-list'),tpl="\
            <li data-seq='"+id+"'>\
                <div class='drag-handle'><i class='fa fa-arrows'></i></div>\
                <div class='music-wrap'>\
                    <span class='music-title'>"+title+"</span>\
                    <span class='pull-right music-delete'><i class='fa fa-trash-o'></i></span>\
                    <span class='pull-right music-edit'><i class='fa fa-pencil'></i></span>\
                </div>\
            </li>\
        ";$music.append(tpl);if(typeof func=='function')func();}
var updateMusicList=function(){var order=$('.music-list').sortable('toArray',{attribute:'data-seq'});$.post('/template/music/sort',{sort:order},function(data){if(data.count>4){$('.music-fileinput').hide();}else{$('.music-fileinput').show();}},'json');}
$('#bookmark').live({click:function(){var checked=$(this).prop('checked'),el=$(this).data('el'),elname=$('.'+el).attr('data-name');$('.property-bookmark-name-wrap').toggleClass('hide');if(checked){bookmarkUpdate(SID,selectID,elname);bookmarkListUpdate('update',SID,selectID,elname);}else{if($('#tpl-menu li a[href="@'+selectID+'"][attr-bookmark]').length>0){resetLink($('#tpl-menu li a[href="@'+selectID+'"][attr-bookmark]').text());}bookmarkUpdate(SID,selectID,'');bookmarkListUpdate('delete',SID,selectID);}}});$('#bookmark-name-save').live({click:function(){if(typeof selectID=="undefined"||!selectID){$(this).showModalFlat('ERROR',$.lang[LANG]['board.error-setting-value'],true,false,'','ok');return false;}var bookmark_name=trim($('.property-bookmark-name-wrap span input').val()),regex=/[\{\}\[\]\/!?.,;:|\)*~`^\-_+<>@\#$%&\\\=\(\'\"]/gi,bookmark_list=(typeof SETTINGS.blockBookmarkList!='undefined'&&SETTINGS.blockBookmarkList)?SETTINGS.blockBookmarkList:{};err_str='',isUpdate=false,bookmarkname_arr=new Array();if(Object.keys(bookmark_list).length>0){$.each(bookmark_list,function(k,v){bookmarkname_arr.push(v)});}if(typeof bookmark_list['bookmark'+selectID]!='undefined'&&bookmark_list['bookmark'+selectID]==bookmark_name){return false;}else if(bookmark_name.length==0||bookmark_name.length>20){err_str=$.lang[LANG]['config.bookmark.name.length'];}else if(regex.test(bookmark_name)){err_str=$.lang[LANG]['config.bookmark.name.specialchar'];}else if($.inArray(bookmark_name,bookmarkname_arr)>-1){err_str=$.lang[LANG]['config.bookmark.name.overlap'];}else{isUpdate=true;}if(err_str.length>0){$('.property-bookmark-name-wrap + .error').removeClass('hide').find('span').text(err_str);$('.property-bookmark-name-wrap span input').focus();}else{$('.property-bookmark-name-wrap + .error').addClass('hide').find('span').text('');$('.property-bookmark-name-wrap').find('.bookmark-name-saved').removeClass('hide');}if(!isUpdate)return false;bookmarkUpdate(SID,selectID,bookmark_name);bookmarkListUpdate('update',SID,selectID,bookmark_name);}});var bookmarkDelete=function(sid,seq){if(typeof seq=='undefined'||typeof sid=='undefined'||!seq||!sid||typeof SETTINGS.blockBookmarkList=='undefined'||typeof SETTINGS.blockBookmarkList['bookmark'+seq]=='undefined')return false;if($('#tpl-menu li a[href="@'+seq+'"][attr-bookmark]').length>0){resetLink($('#tpl-menu li a[href="@'+seq+'"][attr-bookmark]').text());}bookmarkUpdate(sid,seq,'');bookmarkListUpdate('delete',sid,seq);}
var bookmarkUpdate=function(sid,id,name){var elsettings={bookmark:name};$.post('/template/settings',{sid:sid,settings:JSON.stringify(elsettings),el:id},function(data){var isCheck=checkError(data);if(!isCheck)return false;if(typeof name=='undefined'||!name)$('.element[data-id="'+id+'"]').removeAttr('data-bookmark');else $('.element[data-id="'+id+'"]').attr('data-bookmark',id);$('.property-bookmark-name-wrap span input').val(name);},'json');}
var form_item_config=function(data,v,where){var $li=$('<li class="form-sort-item" data-id="'+v.seq+'" data-idx="'+v.idx+'">'),$form_item=$('.userEL'+data.config.pid+' [form-idx="'+v.idx+'"]').parent().find('h3'),$p_item=$('#element-display .userEL'+data.config.pid+' [form-idx="'+v.idx+'"]').parent().find('.text'),options='';where=(typeof where=='undefined'||where=='')?'append':'before';if(v.require)$form_item.addClass('require');else $form_item.removeClass('require');var p_display=($p_item.css('display')!='none')?true:false;$.each(data.types,function(k,s){options=options+'<option value="'+k+'" '+((v.type==k)?'selected':'')+'>'+s+'</option>';});$li.append('\
        <i class="fa fa-arrows"></i> <span class="form-item-wrap"><input type="text" class="name" value="'+v.name+'"></span> <span class="toggle-content"><i class="fa fa-angle-down hand"></i></span>\
        <span class="pull-right">\
            <label><input class="check-require" type="checkbox" '+((v.require)?'checked':'')+'> '+$.lang[LANG]['form.check.require']+'</label> \
            <i class="fa fa-trash-o form-item-delete"></i>\
        </span>\
        <div class="clear"></div>\
        <div class="form-item-content">\
            <select class="form-control form-type-select" data-idx="'+v.idx+'" data-val="'+v.val+'">'+options+'</select>\
            <input type="text" class="form-control form-input-caption '+((p_display)?'':'hide')+'" value="'+$p_item.text()+'">\
            <label class="label-caption"><input class="check-text" data-idx="'+v.idx+'" type="checkbox" '+((p_display)?'checked':'')+'> '+$.lang[LANG]['form.use.description']+'</label>\
        </div>\
    ');if(where=='append')$('.form-item-list').append($li);else
$('.add-form-property.first').before($li);if(v.type=='radio'||v.type=='check'||v.type=='select'){var $select_options=$('<div class="form-item-option-wrap"></div>'),options=(v.val).split('`'),$option;if(v.val==''){options=['A','B'];}$.each(options,function(k,o){$option=$('<div class="form-item-option"><input type="text" class="option-name" value="'+replaceQuote(o)+'"></div>');if(k!=0)$option.append('<span class="pull-right hand option-delete">&times;</span>');$select_options.append($option)});$add_option=$('<div class="add-option"><i class="fa fa-plus"></i> '+$.lang[LANG]['form.add.option']+'</div>');$select_options.append($add_option);$('.form-sort-item[data-id="'+v.seq+'"] .form-item-content .form-type-select').after($select_options);}}
var bookmarkListUpdate=function(fn,sid,id,name){var bookmarklist={};if(typeof SETTINGS.blockBookmarkList=='undefined'){SETTINGS.blockBookmarkList={};}if(fn=='update'){var bookmark_item={};bookmark_item['bookmark'+id]=name;bookmarklist=$.extend({},SETTINGS.blockBookmarkList,bookmark_item);}else if(fn=='delete'){if(typeof SETTINGS.blockBookmarkList['bookmark'+id]=='undefined'){return false;}delete SETTINGS.blockBookmarkList['bookmark'+id];bookmarklist=SETTINGS.blockBookmarkList;}var settings={blockBookmarkList:bookmarklist};$.post('/template/settings',{sid:sid,settings:JSON.stringify(settings),el:null},function(data){var isCheck=checkError(data);if(!isCheck)return false;SETTINGS.blockBookmarkList=bookmarklist;},'json');if(fn=='delete'){$.post('/template/element/type/gitem-bookmarklink-delete/seq/'+id,{sid:SID},function(data){checkError(data);},'json');}}